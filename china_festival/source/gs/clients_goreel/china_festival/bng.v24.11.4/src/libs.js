window.createjs=window.createjs||{};createjs.extend=function(subclass,superclass){"use strict";function o(){this.constructor=subclass}o.prototype=superclass.prototype;return subclass.prototype=new o};window.createjs=window.createjs||{};createjs.promote=function(subclass,prefix){"use strict";var subP=subclass.prototype,supP=Object.getPrototypeOf&&Object.getPrototypeOf(subP)||subP.__proto__;if(supP){subP[(prefix+="_")+"constructor"]=supP.constructor;for(var n in supP){if(subP.hasOwnProperty(n)&&typeof supP[n]=="function"){subP[prefix+n]=supP[n]}}}return subclass};window.createjs=window.createjs||{};createjs.deprecate=function(fallbackMethod,name){"use strict";return function(){var msg="Deprecated property or method '"+name+"'. See docs for info.";console&&(console.warn?console.warn(msg):console.log(msg));return fallbackMethod&&fallbackMethod.apply(this,arguments)}};window.createjs=window.createjs||{};(function(){"use strict";function Event(type,bubbles,cancelable){this.type=type;this.target=null;this.currentTarget=null;this.eventPhase=0;this.bubbles=!!bubbles;this.cancelable=!!cancelable;this.timeStamp=new Date().getTime();this.defaultPrevented=false;this.propagationStopped=false;this.immediatePropagationStopped=false;this.removed=false}var p=Event.prototype;p.preventDefault=function(){this.defaultPrevented=this.cancelable&&true};p.stopPropagation=function(){this.propagationStopped=true};p.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=true};p.remove=function(){this.removed=true};p.clone=function(){return new Event(this.type,this.bubbles,this.cancelable)};p.set=function(props){for(var n in props){this[n]=props[n]}return this};p.toString=function(){return"[Event (type="+this.type+")]"};createjs.Event=Event})();window.createjs=window.createjs||{};(function(){"use strict";function EventDispatcher(){this._listeners=null;this._captureListeners=null}var p=EventDispatcher.prototype;EventDispatcher.initialize=function(target){target.addEventListener=p.addEventListener;target.on=p.on;target.removeEventListener=target.off=p.removeEventListener;target.removeAllEventListeners=p.removeAllEventListeners;target.hasEventListener=p.hasEventListener;target.dispatchEvent=p.dispatchEvent;target._dispatchEvent=p._dispatchEvent;target.willTrigger=p.willTrigger};p.addEventListener=function(type,listener,useCapture){var listeners;if(useCapture){listeners=this._captureListeners=this._captureListeners||{}}else{listeners=this._listeners=this._listeners||{}}var arr=listeners[type];if(arr){this.removeEventListener(type,listener,useCapture)}arr=listeners[type];if(!arr){listeners[type]=[listener]}else{arr.push(listener)}return listener};p.on=function(type,listener,scope,once,data,useCapture){if(listener.handleEvent){scope=scope||listener;listener=listener.handleEvent}scope=scope||this;return this.addEventListener(type,function(evt){listener.call(scope,evt,data);once&&evt.remove()},useCapture)};p.removeEventListener=function(type,listener,useCapture){var listeners=useCapture?this._captureListeners:this._listeners;if(!listeners){return}var arr=listeners[type];if(!arr){return}for(var i=0,l=arr.length;i<l;i++){if(arr[i]==listener){if(l==1){delete listeners[type]}else{arr.splice(i,1)}break}}};p.off=p.removeEventListener;p.removeAllEventListeners=function(type){if(!type){this._listeners=this._captureListeners=null}else{if(this._listeners){delete this._listeners[type]}if(this._captureListeners){delete this._captureListeners[type]}}};p.dispatchEvent=function(eventObj,bubbles,cancelable){if(typeof eventObj=="string"){var listeners=this._listeners;if(!bubbles&&(!listeners||!listeners[eventObj])){return true}eventObj=new createjs.Event(eventObj,bubbles,cancelable)}else if(eventObj.target&&eventObj.clone){eventObj=eventObj.clone()}try{eventObj.target=this}catch(e){}if(!eventObj.bubbles||!this.parent){this._dispatchEvent(eventObj,2)}else{var top=this,list=[top];while(top.parent){list.push(top=top.parent)}var i,l=list.length;for(i=l-1;i>=0&&!eventObj.propagationStopped;i--){list[i]._dispatchEvent(eventObj,1+(i==0))}for(i=1;i<l&&!eventObj.propagationStopped;i++){list[i]._dispatchEvent(eventObj,3)}}return!eventObj.defaultPrevented};p.hasEventListener=function(type){var listeners=this._listeners,captureListeners=this._captureListeners;return!!(listeners&&listeners[type]||captureListeners&&captureListeners[type])};p.willTrigger=function(type){var o=this;while(o){if(o.hasEventListener(type)){return true}o=o.parent}return false};p.toString=function(){return"[EventDispatcher]"};p._dispatchEvent=function(eventObj,eventPhase){var l,arr,listeners=eventPhase<=2?this._captureListeners:this._listeners;if(eventObj&&listeners&&(arr=listeners[eventObj.type])&&(l=arr.length)){try{eventObj.currentTarget=this}catch(e){}try{eventObj.eventPhase=eventPhase|0}catch(e){}eventObj.removed=false;arr=arr.slice();for(var i=0;i<l&&!eventObj.immediatePropagationStopped;i++){var o=arr[i];if(o.handleEvent){o.handleEvent(eventObj)}else{o(eventObj)}if(eventObj.removed){this.off(eventObj.type,o,eventPhase==1);eventObj.removed=false}}}if(eventPhase===2){this._dispatchEvent(eventObj,2.1)}};createjs.EventDispatcher=EventDispatcher})();window.createjs=window.createjs||{};(function(){"use strict";function AbstractTween(props){this.EventDispatcher_constructor();this.ignoreGlobalPause=false;this.loop=0;this.useTicks=false;this.reversed=false;this.bounce=false;this.timeScale=1;this.duration=0;this.position=0;this.rawPosition=-1;this._paused=true;this._next=null;this._prev=null;this._parent=null;this._labels=null;this._labelList=null;if(props){this.useTicks=!!props.useTicks;this.ignoreGlobalPause=!!props.ignoreGlobalPause;this.loop=props.loop===true?-1:props.loop||0;this.reversed=!!props.reversed;this.bounce=!!props.bounce;this.timeScale=props.timeScale||1;props.onChange&&this.addEventListener("change",props.onChange);props.onComplete&&this.addEventListener("complete",props.onComplete)}};var p=createjs.extend(AbstractTween,createjs.EventDispatcher);p._setPaused=function(value){createjs.Tween._register(this,value);return this};p.setPaused=createjs.deprecate(p._setPaused,"AbstractTween.setPaused");p._getPaused=function(){return this._paused};p.getPaused=createjs.deprecate(p._getPaused,"AbstactTween.getPaused");p._getCurrentLabel=function(pos){var labels=this.getLabels();if(pos==null){pos=this.position}for(var i=0,l=labels.length;i<l;i++){if(pos<labels[i].position){break}}return i===0?null:labels[i-1].label};p.getCurrentLabel=createjs.deprecate(p._getCurrentLabel,"AbstractTween.getCurrentLabel");try{Object.defineProperties(p,{paused:{set:p._setPaused,get:p._getPaused},currentLabel:{get:p._getCurrentLabel}})}catch(e){}p.advance=function(delta,ignoreActions){this.setPosition(this.rawPosition+delta*this.timeScale,ignoreActions)};p.setPosition=function(rawPosition,ignoreActions,jump,callback){var d=this.duration,loopCount=this.loop,prevRawPos=this.rawPosition;var loop=0,t=0,end=false;if(rawPosition<0){rawPosition=0}if(d===0){end=true;if(prevRawPos!==-1){return end}}else{loop=rawPosition/d|0;t=rawPosition-loop*d;end=loopCount!==-1&&rawPosition>=loopCount*d+d;if(end){rawPosition=(t=d)*(loop=loopCount)+d}if(rawPosition===prevRawPos){return end}var rev=!this.reversed!==!(this.bounce&&loop%2);if(rev){t=d-t}}this.position=t;this.rawPosition=rawPosition;this._updatePosition(jump,end);if(end){this.paused=true}callback&&callback(this);if(!ignoreActions){this._runActions(prevRawPos,rawPosition,jump,!jump&&prevRawPos===-1)}this.dispatchEvent("change");if(end){this.dispatchEvent("complete")}};p.calculatePosition=function(rawPosition){var d=this.duration,loopCount=this.loop,loop=0,t=0;if(d===0){return 0}if(loopCount!==-1&&rawPosition>=loopCount*d+d){t=d;loop=loopCount}else if(rawPosition<0){t=0}else{loop=rawPosition/d|0;t=rawPosition-loop*d}var rev=!this.reversed!==!(this.bounce&&loop%2);return rev?d-t:t};p.getLabels=function(){var list=this._labelList;if(!list){list=this._labelList=[];var labels=this._labels;for(var n in labels){list.push({label:n,position:labels[n]})}list.sort(function(a,b){return a.position-b.position})}return list};p.setLabels=function(labels){this._labels=labels;this._labelList=null};p.addLabel=function(label,position){if(!this._labels){this._labels={}}this._labels[label]=position;var list=this._labelList;if(list){for(var i=0,l=list.length;i<l;i++){if(position<list[i].position){break}}list.splice(i,0,{label:label,position:position})}};p.gotoAndPlay=function(positionOrLabel){this.paused=false;this._goto(positionOrLabel)};p.gotoAndStop=function(positionOrLabel){this.paused=true;this._goto(positionOrLabel)};p.resolve=function(positionOrLabel){var pos=Number(positionOrLabel);if(isNaN(pos)){pos=this._labels&&this._labels[positionOrLabel]}return pos};p.toString=function(){return"[AbstractTween]"};p.clone=function(){throw"AbstractTween can not be cloned."};p._init=function(props){if(!props||!props.paused){this.paused=false}if(props&&props.position!=null){this.setPosition(props.position)}};p._updatePosition=function(jump,end){};p._goto=function(positionOrLabel){var pos=this.resolve(positionOrLabel);if(pos!=null){this.setPosition(pos,false,true)}};p._runActions=function(startRawPos,endRawPos,jump,includeStart){if(!this._actionHead&&!this.tweens){return}var d=this.duration,reversed=this.reversed,bounce=this.bounce,loopCount=this.loop;var loop0,loop1,t0,t1;if(d===0){loop0=loop1=t0=t1=0;reversed=bounce=false}else{loop0=startRawPos/d|0;loop1=endRawPos/d|0;t0=startRawPos-loop0*d;t1=endRawPos-loop1*d}if(loopCount!==-1){if(loop1>loopCount){t1=d;loop1=loopCount}if(loop0>loopCount){t0=d;loop0=loopCount}}if(jump){return this._runActionsRange(t1,t1,jump,includeStart)}else if(loop0===loop1&&t0===t1&&!jump&&!includeStart){return}else if(loop0===-1){loop0=t0=0}var dir=startRawPos<=endRawPos,loop=loop0;do{var rev=!reversed!==!(bounce&&loop%2);var start=loop===loop0?t0:dir?0:d;var end=loop===loop1?t1:dir?d:0;if(rev){start=d-start;end=d-end}if(bounce&&loop!==loop0&&start===end){}else if(this._runActionsRange(start,end,jump,includeStart||loop!==loop0&&!bounce)){return true}includeStart=false}while(dir&&++loop<=loop1||!dir&&--loop>=loop1)};p._runActionsRange=function(startPos,endPos,jump,includeStart){};createjs.AbstractTween=createjs.promote(AbstractTween,"EventDispatcher")})();window.createjs=window.createjs||{};(function(){"use strict";function Tween(target,props){this.AbstractTween_constructor(props);this.pluginData=null;this.target=target;this.passive=false;this._stepHead=new TweenStep(null,0,0,{},null,true);this._stepTail=this._stepHead;this._stepPosition=0;this._actionHead=null;this._actionTail=null;this._plugins=null;this._pluginIds=null;this._injected=null;if(props){this.pluginData=props.pluginData;if(props.override){Tween.removeTweens(target)}}if(!this.pluginData){this.pluginData={}}this._init(props)};var p=createjs.extend(Tween,createjs.AbstractTween);Tween.IGNORE={};Tween._tweens=[];Tween._plugins=null;Tween._tweenHead=null;Tween._tweenTail=null;Tween.get=function(target,props){return new Tween(target,props)};Tween.tick=function(delta,paused){var tween=Tween._tweenHead;while(tween){var next=tween._next;if(paused&&!tween.ignoreGlobalPause||tween._paused){}else{tween.advance(tween.useTicks?1:delta)}tween=next}};Tween.handleEvent=function(event){if(event.type==="tick"){this.tick(event.delta,event.paused)}};Tween.removeTweens=function(target){if(!target.tweenjs_count){return}var tween=Tween._tweenHead;while(tween){var next=tween._next;if(tween.target===target){Tween._register(tween,true)}tween=next}target.tweenjs_count=0};Tween.removeAllTweens=function(){var tween=Tween._tweenHead;while(tween){var next=tween._next;tween._paused=true;tween.target&&(tween.target.tweenjs_count=0);tween._next=tween._prev=null;tween=next}Tween._tweenHead=Tween._tweenTail=null};Tween.hasActiveTweens=function(target){if(target){return!!target.tweenjs_count}return!!Tween._tweenHead};Tween._installPlugin=function(plugin){var priority=plugin.priority=plugin.priority||0,arr=Tween._plugins=Tween._plugins||[];for(var i=0,l=arr.length;i<l;i++){if(priority<arr[i].priority){break}}arr.splice(i,0,plugin)};Tween._register=function(tween,paused){var target=tween.target;if(!paused&&tween._paused){if(target){target.tweenjs_count=target.tweenjs_count?target.tweenjs_count+1:1}var tail=Tween._tweenTail;if(!tail){Tween._tweenHead=Tween._tweenTail=tween}else{Tween._tweenTail=tail._next=tween;tween._prev=tail}if(!Tween._inited&&createjs.Ticker){createjs.Ticker.addEventListener("tick",Tween);Tween._inited=true}}else if(paused&&!tween._paused){if(target){target.tweenjs_count--}var next=tween._next,prev=tween._prev;if(next){next._prev=prev}else{Tween._tweenTail=prev}if(prev){prev._next=next}else{Tween._tweenHead=next}tween._next=tween._prev=null}tween._paused=paused};p.wait=function(duration,passive){if(duration>0){this._addStep(+duration,this._stepTail.props,null,passive)}return this};p.to=function(props,duration,ease){if(duration==null||duration<0){duration=0}var step=this._addStep(+duration,null,ease);this._appendProps(props,step);return this};p.label=function(name){this.addLabel(name,this.duration);return this};p.call=function(callback,params,scope){return this._addAction(scope||this.target,callback,params||[this])};p.set=function(props,target){return this._addAction(target||this.target,this._set,[props])};p.play=function(tween){return this._addAction(tween||this,this._set,[{paused:false}])};p.pause=function(tween){return this._addAction(tween||this,this._set,[{paused:true}])};p.w=p.wait;p.t=p.to;p.c=p.call;p.s=p.set;p.toString=function(){return"[Tween]"};p.clone=function(){throw"Tween can not be cloned."};p._addPlugin=function(plugin){var ids=this._pluginIds||(this._pluginIds={}),id=plugin.ID;if(!id||ids[id]){return}ids[id]=true;var plugins=this._plugins||(this._plugins=[]),priority=plugin.priority||0;for(var i=0,l=plugins.length;i<l;i++){if(priority<plugins[i].priority){plugins.splice(i,0,plugin);return}}plugins.push(plugin)};p._updatePosition=function(jump,end){var step=this._stepHead.next,t=this.position,d=this.duration;if(this.target&&step){var stepNext=step.next;while(stepNext&&stepNext.t<=t){step=step.next;stepNext=step.next}var ratio=end?d===0?1:t/d:(t-step.t)/step.d;this._updateTargetProps(step,ratio,end)}this._stepPosition=step?t-step.t:0};p._updateTargetProps=function(step,ratio,end){if(this.passive=!!step.passive){return}var v,v0,v1,ease;var p0=step.prev.props;var p1=step.props;if(ease=step.ease){ratio=ease(ratio,0,1,1)}var plugins=this._plugins;proploop:for(var n in p0){v0=p0[n];v1=p1[n];if(v0!==v1&&typeof v0==="number"){v=v0+(v1-v0)*ratio}else{v=ratio>=1?v1:v0}if(plugins){for(var i=0,l=plugins.length;i<l;i++){var value=plugins[i].change(this,step,n,v,ratio,end);if(value===Tween.IGNORE){continue proploop}if(value!==undefined){v=value}}}this.target[n]=v}};p._runActionsRange=function(startPos,endPos,jump,includeStart){var rev=startPos>endPos;var action=rev?this._actionTail:this._actionHead;var ePos=endPos,sPos=startPos;if(rev){ePos=startPos;sPos=endPos}var t=this.position;while(action){var pos=action.t;if(pos===endPos||pos>sPos&&pos<ePos||includeStart&&pos===startPos){action.funct.apply(action.scope,action.params);if(t!==this.position){return true}}action=rev?action.prev:action.next}};p._appendProps=function(props,step,stepPlugins){var initProps=this._stepHead.props,target=this.target,plugins=Tween._plugins;var n,i,value,initValue,inject;var oldStep=step.prev,oldProps=oldStep.props;var stepProps=step.props||(step.props=this._cloneProps(oldProps));var cleanProps={};for(n in props){if(!props.hasOwnProperty(n)){continue}cleanProps[n]=stepProps[n]=props[n];if(initProps[n]!==undefined){continue}initValue=undefined;if(plugins){for(i=plugins.length-1;i>=0;i--){value=plugins[i].init(this,n,initValue);if(value!==undefined){initValue=value}if(initValue===Tween.IGNORE){delete stepProps[n];delete cleanProps[n];break}}}if(initValue!==Tween.IGNORE){if(initValue===undefined){initValue=target[n]}oldProps[n]=initValue===undefined?null:initValue}}for(n in cleanProps){value=props[n];var o,prev=oldStep;while((o=prev)&&(prev=o.prev)){if(prev.props===o.props){continue}if(prev.props[n]!==undefined){break}prev.props[n]=oldProps[n]}}if(stepPlugins!==false&&(plugins=this._plugins)){for(i=plugins.length-1;i>=0;i--){plugins[i].step(this,step,cleanProps)}}if(inject=this._injected){this._injected=null;this._appendProps(inject,step,false)}};p._injectProp=function(name,value){var o=this._injected||(this._injected={});o[name]=value};p._addStep=function(duration,props,ease,passive){var step=new TweenStep(this._stepTail,this.duration,duration,props,ease,passive||false);this.duration+=duration;return this._stepTail=this._stepTail.next=step};p._addAction=function(scope,funct,params){var action=new TweenAction(this._actionTail,this.duration,scope,funct,params);if(this._actionTail){this._actionTail.next=action}else{this._actionHead=action}this._actionTail=action;return this};p._set=function(props){for(var n in props){this[n]=props[n]}};p._cloneProps=function(props){var o={};for(var n in props){o[n]=props[n]}return o};createjs.Tween=createjs.promote(Tween,"AbstractTween");function TweenStep(prev,t,d,props,ease,passive){this.next=null;this.prev=prev;this.t=t;this.d=d;this.props=props;this.ease=ease;this.passive=passive;this.index=prev?prev.index+1:0};function TweenAction(prev,t,scope,funct,params){this.next=null;this.prev=prev;this.t=t;this.d=0;this.scope=scope;this.funct=funct;this.params=params};})();window.createjs=window.createjs||{};(function(){"use strict";function Timeline(props){var tweens,labels;if(props instanceof Array||props==null&&arguments.length>1){tweens=props;labels=arguments[1];props=arguments[2]}else if(props){tweens=props.tweens;labels=props.labels}this.AbstractTween_constructor(props);this.tweens=[];if(tweens){this.addTween.apply(this,tweens)}this.setLabels(labels);this._init(props)};var p=createjs.extend(Timeline,createjs.AbstractTween);p.addTween=function(tween){if(tween._parent){tween._parent.removeTween(tween)}var l=arguments.length;if(l>1){for(var i=0;i<l;i++){this.addTween(arguments[i])}return arguments[l-1]}else if(l===0){return null}this.tweens.push(tween);tween._parent=this;tween.paused=true;var d=tween.duration;if(tween.loop>0){d*=tween.loop+1}if(d>this.duration){this.duration=d}if(this.rawPosition>=0){tween.setPosition(this.rawPosition)}return tween};p.removeTween=function(tween){var l=arguments.length;if(l>1){var good=true;for(var i=0;i<l;i++){good=good&&this.removeTween(arguments[i])}return good}else if(l===0){return true}var tweens=this.tweens;var i=tweens.length;while(i--){if(tweens[i]===tween){tweens.splice(i,1);tween._parent=null;if(tween.duration>=this.duration){this.updateDuration()}return true}}return false};p.updateDuration=function(){this.duration=0;for(var i=0,l=this.tweens.length;i<l;i++){var tween=this.tweens[i];var d=tween.duration;if(tween.loop>0){d*=tween.loop+1}if(d>this.duration){this.duration=d}}};p.toString=function(){return"[Timeline]"};p.clone=function(){throw"Timeline can not be cloned."};p._updatePosition=function(jump,end){var t=this.position;for(var i=0,l=this.tweens.length;i<l;i++){this.tweens[i].setPosition(t,true,jump)}};p._runActionsRange=function(startPos,endPos,jump,includeStart){var t=this.position;for(var i=0,l=this.tweens.length;i<l;i++){this.tweens[i]._runActions(startPos,endPos,jump,includeStart);if(t!==this.position){return true}}};createjs.Timeline=createjs.promote(Timeline,"AbstractTween")})();window.createjs=window.createjs||{};(function(){"use strict";function Ease(){throw"Ease cannot be instantiated."}Ease.linear=function(t){return t};Ease.none=Ease.linear;Ease.get=function(amount){if(amount<-1){amount=-1}else if(amount>1){amount=1}return function(t){if(amount==0){return t}if(amount<0){return t*(t*-amount+1+amount)}return t*((2-t)*amount+(1-amount))}};Ease.getPowIn=function(pow){return function(t){return Math.pow(t,pow)}};Ease.getPowOut=function(pow){return function(t){return 1-Math.pow(1-t,pow)}};Ease.getPowInOut=function(pow){return function(t){if((t*=2)<1)return 0.5*Math.pow(t,pow);return 1-0.5*Math.abs(Math.pow(2-t,pow))}};Ease.quadIn=Ease.getPowIn(2);Ease.quadOut=Ease.getPowOut(2);Ease.quadInOut=Ease.getPowInOut(2);Ease.cubicIn=Ease.getPowIn(3);Ease.cubicOut=Ease.getPowOut(3);Ease.cubicInOut=Ease.getPowInOut(3);Ease.quartIn=Ease.getPowIn(4);Ease.quartOut=Ease.getPowOut(4);Ease.quartInOut=Ease.getPowInOut(4);Ease.quintIn=Ease.getPowIn(5);Ease.quintOut=Ease.getPowOut(5);Ease.quintInOut=Ease.getPowInOut(5);Ease.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)};Ease.sineOut=function(t){return Math.sin(t*Math.PI/2)};Ease.sineInOut=function(t){return-0.5*(Math.cos(Math.PI*t)-1)};Ease.getBackIn=function(amount){return function(t){return t*t*((amount+1)*t-amount)}};Ease.backIn=Ease.getBackIn(1.7);Ease.getBackOut=function(amount){return function(t){return--t*t*((amount+1)*t+amount)+1}};Ease.backOut=Ease.getBackOut(1.7);Ease.getBackInOut=function(amount){amount*=1.525;return function(t){if((t*=2)<1)return 0.5*(t*t*((amount+1)*t-amount));return 0.5*((t-=2)*t*((amount+1)*t+amount)+2)}};Ease.backInOut=Ease.getBackInOut(1.7);Ease.circIn=function(t){return-(Math.sqrt(1-t*t)-1)};Ease.circOut=function(t){return Math.sqrt(1- --t*t)};Ease.circInOut=function(t){if((t*=2)<1)return-0.5*(Math.sqrt(1-t*t)-1);return 0.5*(Math.sqrt(1-(t-=2)*t)+1)};Ease.bounceIn=function(t){return 1-Ease.bounceOut(1-t)};Ease.bounceOut=function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){return 7.5625*(t-=1.5/2.75)*t+0.75}else if(t<2.5/2.75){return 7.5625*(t-=2.25/2.75)*t+0.9375}else{return 7.5625*(t-=2.625/2.75)*t+0.984375}};Ease.bounceInOut=function(t){if(t<0.5)return Ease.bounceIn(t*2)*.5;return Ease.bounceOut(t*2-1)*0.5+0.5};Ease.getElasticIn=function(amplitude,period){var pi2=Math.PI*2;return function(t){if(t==0||t==1)return t;var s=period/pi2*Math.asin(1/amplitude);return-(amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period))}};Ease.elasticIn=Ease.getElasticIn(1,0.3);Ease.getElasticOut=function(amplitude,period){var pi2=Math.PI*2;return function(t){if(t==0||t==1)return t;var s=period/pi2*Math.asin(1/amplitude);return amplitude*Math.pow(2,-10*t)*Math.sin((t-s)*pi2/period)+1}};Ease.elasticOut=Ease.getElasticOut(1,0.3);Ease.getElasticInOut=function(amplitude,period){var pi2=Math.PI*2;return function(t){var s=period/pi2*Math.asin(1/amplitude);if((t*=2)<1)return-0.5*(amplitude*Math.pow(2,10*(t-=1))*Math.sin((t-s)*pi2/period));return amplitude*Math.pow(2,-10*(t-=1))*Math.sin((t-s)*pi2/period)*0.5+1}};Ease.elasticInOut=Ease.getElasticInOut(1,0.3*1.5);createjs.Ease=Ease})();window.createjs=window.createjs||{};(function(){"use strict";function MotionGuidePlugin(){throw"MotionGuidePlugin cannot be instantiated."}var s=MotionGuidePlugin;s.priority=0;s.ID="MotionGuide";s.install=function(){createjs.Tween._installPlugin(MotionGuidePlugin);return createjs.Tween.IGNORE};s.init=function(tween,prop,value){if(prop=="guide"){tween._addPlugin(s)}};s.step=function(tween,step,props){for(var n in props){if(n!=="guide"){continue}var guideData=step.props.guide;var error=s._solveGuideData(props.guide,guideData);guideData.valid=!error;var end=guideData.endData;tween._injectProp("x",end.x);tween._injectProp("y",end.y);if(error||!guideData.orient){break}var initRot=step.prev.props.rotation===undefined?tween.target.rotation||0:step.prev.props.rotation;guideData.startOffsetRot=initRot-guideData.startData.rotation;if(guideData.orient=="fixed"){guideData.endAbsRot=end.rotation+guideData.startOffsetRot;guideData.deltaRotation=0}else{var finalRot=props.rotation===undefined?tween.target.rotation||0:props.rotation;var deltaRot=finalRot-guideData.endData.rotation-guideData.startOffsetRot;var modRot=deltaRot%360;guideData.endAbsRot=finalRot;switch(guideData.orient){case"auto":guideData.deltaRotation=deltaRot;break;case"cw":guideData.deltaRotation=(modRot+360)%360+360*Math.abs(deltaRot/360|0);break;case"ccw":guideData.deltaRotation=(modRot-360)%360+-360*Math.abs(deltaRot/360|0);break}}tween._injectProp("rotation",guideData.endAbsRot)}};s.change=function(tween,step,prop,value,ratio,end){var guideData=step.props.guide;if(!guideData||step.props===step.prev.props||guideData===step.prev.props.guide){return}if(prop==="guide"&&!guideData.valid||prop=="x"||prop=="y"||prop==="rotation"&&guideData.orient){return createjs.Tween.IGNORE}s._ratioToPositionData(ratio,guideData,tween.target)};s.debug=function(guideData,ctx,higlight){guideData=guideData.guide||guideData;var err=s._findPathProblems(guideData);if(err){console.error("MotionGuidePlugin Error found: \n"+err)}if(!ctx){return err}var i;var path=guideData.path;var pathLength=path.length;var width=3;var length=9;ctx.save();ctx.lineCap="round";ctx.lineJoin="miter";ctx.beginPath();ctx.moveTo(path[0],path[1]);for(i=2;i<pathLength;i+=4){ctx.quadraticCurveTo(path[i],path[i+1],path[i+2],path[i+3])}ctx.strokeStyle="black";ctx.lineWidth=width*1.5;ctx.stroke();ctx.strokeStyle="white";ctx.lineWidth=width;ctx.stroke();ctx.closePath();var hiCount=higlight.length;if(higlight&&hiCount){var tempStore={};var tempLook={};s._solveGuideData(guideData,tempStore);for(var i=0;i<hiCount;i++){tempStore.orient="fixed";s._ratioToPositionData(higlight[i],tempStore,tempLook);ctx.beginPath();ctx.moveTo(tempLook.x,tempLook.y);ctx.lineTo(tempLook.x+Math.cos(tempLook.rotation*0.0174533)*length,tempLook.y+Math.sin(tempLook.rotation*0.0174533)*length);ctx.strokeStyle="black";ctx.lineWidth=width*1.5;ctx.stroke();ctx.strokeStyle="red";ctx.lineWidth=width;ctx.stroke();ctx.closePath()}}ctx.restore();return err};s._solveGuideData=function(source,storage){var err=undefined;if(err=s.debug(source)){return err}var path=storage.path=source.path;var orient=storage.orient=source.orient;storage.subLines=[];storage.totalLength=0;storage.startOffsetRot=0;storage.deltaRotation=0;storage.startData={ratio:0};storage.endData={ratio:1};storage.animSpan=1;var pathLength=path.length;var precision=10;var sx,sy,cx,cy,ex,ey,i,j,len,temp={};sx=path[0];sy=path[1];for(i=2;i<pathLength;i+=4){cx=path[i];cy=path[i+1];ex=path[i+2];ey=path[i+3];var subLine={weightings:[],estLength:0,portion:0};var subX=sx,subY=sy;for(j=1;j<=precision;j++){s._getParamsForCurve(sx,sy,cx,cy,ex,ey,j/precision,false,temp);var dx=temp.x-subX,dy=temp.y-subY;len=Math.sqrt(dx*dx+dy*dy);subLine.weightings.push(len);subLine.estLength+=len;subX=temp.x;subY=temp.y}storage.totalLength+=subLine.estLength;for(j=0;j<precision;j++){len=subLine.estLength;subLine.weightings[j]=subLine.weightings[j]/len}storage.subLines.push(subLine);sx=ex;sy=ey}len=storage.totalLength;var l=storage.subLines.length;for(i=0;i<l;i++){storage.subLines[i].portion=storage.subLines[i].estLength/len}var startRatio=isNaN(source.start)?0:source.start;var endRatio=isNaN(source.end)?1:source.end;s._ratioToPositionData(startRatio,storage,storage.startData);s._ratioToPositionData(endRatio,storage,storage.endData);storage.startData.ratio=startRatio;storage.endData.ratio=endRatio;storage.animSpan=storage.endData.ratio-storage.startData.ratio};s._ratioToPositionData=function(ratio,guideData,output){var lineSegments=guideData.subLines;var i,l,t,test,target;var look=0;var precision=10;var effRatio=ratio*guideData.animSpan+guideData.startData.ratio;l=lineSegments.length;for(i=0;i<l;i++){test=lineSegments[i].portion;if(look+test>=effRatio){target=i;break}look+=test}if(target===undefined){target=l-1;look-=test}var subLines=lineSegments[target].weightings;var portion=test;l=subLines.length;for(i=0;i<l;i++){test=subLines[i]*portion;if(look+test>=effRatio){break}look+=test}target=target*4+2;t=i/precision+(effRatio-look)/test*(1/precision);var pathData=guideData.path;s._getParamsForCurve(pathData[target-2],pathData[target-1],pathData[target],pathData[target+1],pathData[target+2],pathData[target+3],t,guideData.orient,output);if(guideData.orient){if(ratio>=0.99999&&ratio<=1.00001&&guideData.endAbsRot!==undefined){output.rotation=guideData.endAbsRot}else{output.rotation+=guideData.startOffsetRot+ratio*guideData.deltaRotation}}return output};s._getParamsForCurve=function(sx,sy,cx,cy,ex,ey,t,orient,output){var inv=1-t;output.x=inv*inv*sx+2*inv*t*cx+t*t*ex;output.y=inv*inv*sy+2*inv*t*cy+t*t*ey;if(orient){output.rotation=57.2957795*Math.atan2((cy-sy)*inv+(ey-cy)*t,(cx-sx)*inv+(ex-cx)*t)}};s._findPathProblems=function(guideData){var path=guideData.path;var valueCount=path&&path.length||0;if(valueCount<6||(valueCount-2)%4){var message="\tCannot parse 'path' array due to invalid number of entries in path. ";message+="There should be an odd number of points, at least 3 points, and 2 entries per point (x & y). ";message+="See 'CanvasRenderingContext2D.quadraticCurveTo' for details as 'path' models a quadratic bezier.\n\n";message+="Only [ "+valueCount+" ] values found. Expected: "+Math.max(Math.ceil((valueCount-2)/4)*4+2,6);return message}for(var i=0;i<valueCount;i++){if(isNaN(path[i])){return"All data in path array must be numeric"}}var start=guideData.start;if(isNaN(start)&&!(start===undefined)){return"'start' out of bounds. Expected 0 to 1, got: "+start}var end=guideData.end;if(isNaN(end)&&end!==undefined){return"'end' out of bounds. Expected 0 to 1, got: "+end}var orient=guideData.orient;if(orient){if(orient!="fixed"&&orient!="auto"&&orient!="cw"&&orient!="ccw"){return"Invalid orientation value. Expected [\"fixed\", \"auto\", \"cw\", \"ccw\", undefined], got: "+orient}}return undefined};createjs.MotionGuidePlugin=MotionGuidePlugin})();window.createjs=window.createjs||{};(function(){"use strict";var s=createjs.TweenJS=createjs.TweenJS||{};s.version="1.0.0";s.buildDate="Thu, 14 Sep 2017 19:47:47 GMT"})();window.createjs=window.createjs||{};(function(){var s=createjs.SoundJS=createjs.SoundJS||{};s.version="1.0.0";s.buildDate="Thu, 12 Oct 2017 16:34:05 GMT"})();window.createjs=window.createjs||{};createjs.extend=function(subclass,superclass){"use strict";function o(){this.constructor=subclass}o.prototype=superclass.prototype;return subclass.prototype=new o};window.createjs=window.createjs||{};createjs.promote=function(subclass,prefix){"use strict";var subP=subclass.prototype,supP=Object.getPrototypeOf&&Object.getPrototypeOf(subP)||subP.__proto__;if(supP){subP[(prefix+="_")+"constructor"]=supP.constructor;for(var n in supP){if(subP.hasOwnProperty(n)&&typeof supP[n]=="function"){subP[prefix+n]=supP[n]}}}return subclass};window.createjs=window.createjs||{};createjs.deprecate=function(fallbackMethod,name){"use strict";return function(){var msg="Deprecated property or method '"+name+"'. See docs for info.";console&&(console.warn?console.warn(msg):console.log(msg));return fallbackMethod&&fallbackMethod.apply(this,arguments)}};window.createjs=window.createjs||{};createjs.indexOf=function(array,searchElement){"use strict";for(var i=0,l=array.length;i<l;i++){if(searchElement===array[i]){return i}}return-1};window.createjs=window.createjs||{};(function(){"use strict";createjs.proxy=function(method,scope){var aArgs=Array.prototype.slice.call(arguments,2);return function(){return method.apply(scope,Array.prototype.slice.call(arguments,0).concat(aArgs))}}})();window.createjs=window.createjs||{};(function(){"use strict";function BrowserDetect(){throw"BrowserDetect cannot be instantiated"};var agent=BrowserDetect.agent=window.navigator.userAgent;BrowserDetect.isWindowPhone=agent.indexOf("IEMobile")>-1||agent.indexOf("Windows Phone")>-1;BrowserDetect.isFirefox=agent.indexOf("Firefox")>-1;BrowserDetect.isOpera=window.opera!=null;BrowserDetect.isChrome=agent.indexOf("Chrome")>-1;BrowserDetect.isIOS=(agent.indexOf("iPod")>-1||agent.indexOf("iPhone")>-1||agent.indexOf("iPad")>-1)&&!BrowserDetect.isWindowPhone;BrowserDetect.isAndroid=agent.indexOf("Android")>-1&&!BrowserDetect.isWindowPhone;BrowserDetect.isBlackberry=agent.indexOf("Blackberry")>-1;createjs.BrowserDetect=BrowserDetect})();window.createjs=window.createjs||{};(function(){"use strict";function EventDispatcher(){this._listeners=null;this._captureListeners=null}var p=EventDispatcher.prototype;EventDispatcher.initialize=function(target){target.addEventListener=p.addEventListener;target.on=p.on;target.removeEventListener=target.off=p.removeEventListener;target.removeAllEventListeners=p.removeAllEventListeners;target.hasEventListener=p.hasEventListener;target.dispatchEvent=p.dispatchEvent;target._dispatchEvent=p._dispatchEvent;target.willTrigger=p.willTrigger};p.addEventListener=function(type,listener,useCapture){var listeners;if(useCapture){listeners=this._captureListeners=this._captureListeners||{}}else{listeners=this._listeners=this._listeners||{}}var arr=listeners[type];if(arr){this.removeEventListener(type,listener,useCapture)}arr=listeners[type];if(!arr){listeners[type]=[listener]}else{arr.push(listener)}return listener};p.on=function(type,listener,scope,once,data,useCapture){if(listener.handleEvent){scope=scope||listener;listener=listener.handleEvent}scope=scope||this;return this.addEventListener(type,function(evt){listener.call(scope,evt,data);once&&evt.remove()},useCapture)};p.removeEventListener=function(type,listener,useCapture){var listeners=useCapture?this._captureListeners:this._listeners;if(!listeners){return}var arr=listeners[type];if(!arr){return}for(var i=0,l=arr.length;i<l;i++){if(arr[i]==listener){if(l==1){delete listeners[type]}else{arr.splice(i,1)}break}}};p.off=p.removeEventListener;p.removeAllEventListeners=function(type){if(!type){this._listeners=this._captureListeners=null}else{if(this._listeners){delete this._listeners[type]}if(this._captureListeners){delete this._captureListeners[type]}}};p.dispatchEvent=function(eventObj,bubbles,cancelable){if(typeof eventObj=="string"){var listeners=this._listeners;if(!bubbles&&(!listeners||!listeners[eventObj])){return true}eventObj=new createjs.Event(eventObj,bubbles,cancelable)}else if(eventObj.target&&eventObj.clone){eventObj=eventObj.clone()}try{eventObj.target=this}catch(e){}if(!eventObj.bubbles||!this.parent){this._dispatchEvent(eventObj,2)}else{var top=this,list=[top];while(top.parent){list.push(top=top.parent)}var i,l=list.length;for(i=l-1;i>=0&&!eventObj.propagationStopped;i--){list[i]._dispatchEvent(eventObj,1+(i==0))}for(i=1;i<l&&!eventObj.propagationStopped;i++){list[i]._dispatchEvent(eventObj,3)}}return!eventObj.defaultPrevented};p.hasEventListener=function(type){var listeners=this._listeners,captureListeners=this._captureListeners;return!!(listeners&&listeners[type]||captureListeners&&captureListeners[type])};p.willTrigger=function(type){var o=this;while(o){if(o.hasEventListener(type)){return true}o=o.parent}return false};p.toString=function(){return"[EventDispatcher]"};p._dispatchEvent=function(eventObj,eventPhase){var l,arr,listeners=eventPhase<=2?this._captureListeners:this._listeners;if(eventObj&&listeners&&(arr=listeners[eventObj.type])&&(l=arr.length)){try{eventObj.currentTarget=this}catch(e){}try{eventObj.eventPhase=eventPhase|0}catch(e){}eventObj.removed=false;arr=arr.slice();for(var i=0;i<l&&!eventObj.immediatePropagationStopped;i++){var o=arr[i];if(o.handleEvent){o.handleEvent(eventObj)}else{o(eventObj)}if(eventObj.removed){this.off(eventObj.type,o,eventPhase==1);eventObj.removed=false}}}if(eventPhase===2){this._dispatchEvent(eventObj,2.1)}};createjs.EventDispatcher=EventDispatcher})();window.createjs=window.createjs||{};(function(){"use strict";function Event(type,bubbles,cancelable){this.type=type;this.target=null;this.currentTarget=null;this.eventPhase=0;this.bubbles=!!bubbles;this.cancelable=!!cancelable;this.timeStamp=new Date().getTime();this.defaultPrevented=false;this.propagationStopped=false;this.immediatePropagationStopped=false;this.removed=false}var p=Event.prototype;p.preventDefault=function(){this.defaultPrevented=this.cancelable&&true};p.stopPropagation=function(){this.propagationStopped=true};p.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=true};p.remove=function(){this.removed=true};p.clone=function(){return new Event(this.type,this.bubbles,this.cancelable)};p.set=function(props){for(var n in props){this[n]=props[n]}return this};p.toString=function(){return"[Event (type="+this.type+")]"};createjs.Event=Event})();window.createjs=window.createjs||{};(function(){"use strict";function ErrorEvent(title,message,data){this.Event_constructor("error");this.title=title;this.message=message;this.data=data}var p=createjs.extend(ErrorEvent,createjs.Event);p.clone=function(){return new createjs.ErrorEvent(this.title,this.message,this.data)};createjs.ErrorEvent=createjs.promote(ErrorEvent,"Event")})();window.createjs=window.createjs||{};(function(scope){"use strict";function ProgressEvent(loaded,total){this.Event_constructor("progress");this.loaded=loaded;this.total=total==null?1:total;this.progress=total==0?0:this.loaded/this.total};var p=createjs.extend(ProgressEvent,createjs.Event);p.clone=function(){return new createjs.ProgressEvent(this.loaded,this.total)};createjs.ProgressEvent=createjs.promote(ProgressEvent,"Event")})(window);window.createjs=window.createjs||{};(function(){"use strict";function LoadItem(){this.src=null;this.type=null;this.id=null;this.maintainOrder=false;this.callback=null;this.data=null;this.method=createjs.Methods.GET;this.values=null;this.headers=null;this.withCredentials=false;this.mimeType=null;this.crossOrigin=null;this.loadTimeout=s.LOAD_TIMEOUT_DEFAULT};var p=LoadItem.prototype={};var s=LoadItem;s.LOAD_TIMEOUT_DEFAULT=8000;s.create=function(value){if(typeof value=="string"){var item=new LoadItem;item.src=value;return item}else if(value instanceof s){return value}else if(value instanceof Object&&value.src){if(value.loadTimeout==null){value.loadTimeout=s.LOAD_TIMEOUT_DEFAULT}return value}else{throw new Error("Type not recognized.")}};p.set=function(props){for(var n in props){this[n]=props[n]}return this};createjs.LoadItem=s})();window.createjs=window.createjs||{};(function(){var s={};s.POST="POST";s.GET="GET";createjs.Methods=s})();window.createjs=window.createjs||{};(function(){var s={};s.BINARY="binary";s.CSS="css";s.FONT="font";s.FONTCSS="fontcss";s.IMAGE="image";s.JAVASCRIPT="javascript";s.JSON="json";s.JSONP="jsonp";s.MANIFEST="manifest";s.SOUND="sound";s.VIDEO="video";s.SPRITESHEET="spritesheet";s.SVG="svg";s.TEXT="text";s.XML="xml";createjs.Types=s})();(function(){var s={};s.a=function(){return s.el("a")};s.svg=function(){return s.el("svg")};s.object=function(){return s.el("object")};s.image=function(){return s.el("image")};s.img=function(){return s.el("img")};s.style=function(){return s.el("style")};s.link=function(){return s.el("link")};s.script=function(){return s.el("script")};s.audio=function(){return s.el("audio")};s.video=function(){return s.el("video")};s.text=function(value){return document.createTextNode(value)};s.el=function(name){return document.createElement(name)};createjs.Elements=s})();(function(){var s={container:null};s.appendToHead=function(el){s.getHead().appendChild(el)};s.appendToBody=function(el){if(s.container==null){s.container=document.createElement("div");s.container.id="preloadjs-container";var style=s.container.style;style.visibility="hidden";style.position="absolute";style.width=s.container.style.height="10px";style.overflow="hidden";style.transform=style.msTransform=style.webkitTransform=style.oTransform="translate(-10px, -10px)";s.getBody().appendChild(s.container)}s.container.appendChild(el)};s.getHead=function(){return document.head||document.getElementsByTagName("head")[0]};s.getBody=function(){return document.body||document.getElementsByTagName("body")[0]};s.removeChild=function(el){if(el.parent){el.parent.removeChild(el)}};s.isImageTag=function(item){return item instanceof HTMLImageElement};s.isAudioTag=function(item){if(window.HTMLAudioElement){return item instanceof HTMLAudioElement}else{return false}};s.isVideoTag=function(item){if(window.HTMLVideoElement){return item instanceof HTMLVideoElement}else{return false}};createjs.DomUtils=s})();(function(){var s={};s.isBinary=function(type){switch(type){case createjs.Types.IMAGE:case createjs.Types.BINARY:return true;default:return false}};s.isText=function(type){switch(type){case createjs.Types.TEXT:case createjs.Types.JSON:case createjs.Types.MANIFEST:case createjs.Types.XML:case createjs.Types.CSS:case createjs.Types.SVG:case createjs.Types.JAVASCRIPT:case createjs.Types.SPRITESHEET:return true;default:return false}};s.getTypeByExtension=function(extension){if(extension==null){return createjs.Types.TEXT}switch(extension.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.Types.IMAGE;case"ogg":case"mp3":case"webm":return createjs.Types.SOUND;case"mp4":case"webm":case"ts":return createjs.Types.VIDEO;case"json":return createjs.Types.JSON;case"xml":return createjs.Types.XML;case"css":return createjs.Types.CSS;case"js":return createjs.Types.JAVASCRIPT;case"svg":return createjs.Types.SVG;default:return createjs.Types.TEXT}};createjs.RequestUtils=s})();(function(){var s={};s.ABSOLUTE_PATT=/^(?:\w+:)?\/{2}/i;s.RELATIVE_PATT=/^[./]*?\//i;s.EXTENSION_PATT=/\/?[^/]+\.(\w{1,5})$/i;s.parseURI=function(path){var info={absolute:false,relative:false,protocol:null,hostname:null,port:null,pathname:null,search:null,hash:null,host:null};if(path==null){return info}var parser=createjs.Elements.a();parser.href=path;for(var n in info){if(n in parser){info[n]=parser[n]}}var queryIndex=path.indexOf("?");if(queryIndex>-1){path=path.substr(0,queryIndex)}var match;if(s.ABSOLUTE_PATT.test(path)){info.absolute=true}else if(s.RELATIVE_PATT.test(path)){info.relative=true}if(match=path.match(s.EXTENSION_PATT)){info.extension=match[1].toLowerCase()}return info};s.formatQueryString=function(data,query){if(data==null){throw new Error("You must specify data.")}var params=[];for(var n in data){params.push(n+"="+escape(data[n]))}if(query){params=params.concat(query)}return params.join("&")};s.buildURI=function(src,data){if(data==null){return src}var query=[];var idx=src.indexOf("?");if(idx!=-1){var q=src.slice(idx+1);query=query.concat(q.split("&"))}if(idx!=-1){return src.slice(0,idx)+"?"+this.formatQueryString(data,query)}else{return src+"?"+this.formatQueryString(data,query)}};s.isCrossDomain=function(item){var target=createjs.Elements.a();target.href=item.src;var host=createjs.Elements.a();host.href=location.href;var crossdomain=target.hostname!=""&&(target.port!=host.port||target.protocol!=host.protocol||target.hostname!=host.hostname);return crossdomain};s.isLocal=function(item){var target=createjs.Elements.a();target.href=item.src;return target.hostname==""&&target.protocol=="file:"};createjs.URLUtils=s})();window.createjs=window.createjs||{};(function(){"use strict";function AbstractLoader(loadItem,preferXHR,type){this.EventDispatcher_constructor();this.loaded=false;this.canceled=false;this.progress=0;this.type=type;this.resultFormatter=null;if(loadItem){this._item=createjs.LoadItem.create(loadItem)}else{this._item=null}this._preferXHR=preferXHR;this._result=null;this._rawResult=null;this._loadedItems=null;this._tagSrcAttribute=null;this._tag=null};var p=createjs.extend(AbstractLoader,createjs.EventDispatcher);var s=AbstractLoader;try{Object.defineProperties(s,{POST:{get:createjs.deprecate(function(){return createjs.Methods.POST},"AbstractLoader.POST")},GET:{get:createjs.deprecate(function(){return createjs.Methods.GET},"AbstractLoader.GET")},BINARY:{get:createjs.deprecate(function(){return createjs.Types.BINARY},"AbstractLoader.BINARY")},CSS:{get:createjs.deprecate(function(){return createjs.Types.CSS},"AbstractLoader.CSS")},FONT:{get:createjs.deprecate(function(){return createjs.Types.FONT},"AbstractLoader.FONT")},FONTCSS:{get:createjs.deprecate(function(){return createjs.Types.FONTCSS},"AbstractLoader.FONTCSS")},IMAGE:{get:createjs.deprecate(function(){return createjs.Types.IMAGE},"AbstractLoader.IMAGE")},JAVASCRIPT:{get:createjs.deprecate(function(){return createjs.Types.JAVASCRIPT},"AbstractLoader.JAVASCRIPT")},JSON:{get:createjs.deprecate(function(){return createjs.Types.JSON},"AbstractLoader.JSON")},JSONP:{get:createjs.deprecate(function(){return createjs.Types.JSONP},"AbstractLoader.JSONP")},MANIFEST:{get:createjs.deprecate(function(){return createjs.Types.MANIFEST},"AbstractLoader.MANIFEST")},SOUND:{get:createjs.deprecate(function(){return createjs.Types.SOUND},"AbstractLoader.SOUND")},VIDEO:{get:createjs.deprecate(function(){return createjs.Types.VIDEO},"AbstractLoader.VIDEO")},SPRITESHEET:{get:createjs.deprecate(function(){return createjs.Types.SPRITESHEET},"AbstractLoader.SPRITESHEET")},SVG:{get:createjs.deprecate(function(){return createjs.Types.SVG},"AbstractLoader.SVG")},TEXT:{get:createjs.deprecate(function(){return createjs.Types.TEXT},"AbstractLoader.TEXT")},XML:{get:createjs.deprecate(function(){return createjs.Types.XML},"AbstractLoader.XML")}})}catch(e){}p.getItem=function(){return this._item};p.getResult=function(raw){return raw?this._rawResult:this._result};p.getTag=function(){return this._tag};p.setTag=function(tag){this._tag=tag};p.load=function(){this._createRequest();this._request.on("complete",this,this);this._request.on("progress",this,this);this._request.on("loadStart",this,this);this._request.on("abort",this,this);this._request.on("timeout",this,this);this._request.on("error",this,this);var evt=new createjs.Event("initialize");evt.loader=this._request;this.dispatchEvent(evt);this._request.load()};p.cancel=function(){this.canceled=true;this.destroy()};p.destroy=function(){if(this._request){this._request.removeAllEventListeners();this._request.destroy()}this._request=null;this._item=null;this._rawResult=null;this._result=null;this._loadItems=null;this.removeAllEventListeners()};p.getLoadedItems=function(){return this._loadedItems};p._createRequest=function(){if(!this._preferXHR){this._request=new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)}else{this._request=new createjs.XHRRequest(this._item)}};p._createTag=function(src){return null};p._sendLoadStart=function(){if(this._isCanceled()){return}this.dispatchEvent("loadstart")};p._sendProgress=function(value){if(this._isCanceled()){return}var event=null;if(typeof value=="number"){this.progress=value;event=new createjs.ProgressEvent(this.progress)}else{event=value;this.progress=value.loaded/value.total;event.progress=this.progress;if(isNaN(this.progress)||this.progress==Infinity){this.progress=0}}this.hasEventListener("progress")&&this.dispatchEvent(event)};p._sendComplete=function(){if(this._isCanceled()){return}this.loaded=true;var event=new createjs.Event("complete");event.rawResult=this._rawResult;if(this._result!=null){event.result=this._result}this.dispatchEvent(event)};p._sendError=function(event){if(this._isCanceled()||!this.hasEventListener("error")){return}if(event==null){event=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY")}this.dispatchEvent(event)};p._isCanceled=function(){if(window.createjs==null||this.canceled){return true}return false};p.resultFormatter=null;p.handleEvent=function(event){switch(event.type){case"complete":this._rawResult=event.target._response;var result=this.resultFormatter&&this.resultFormatter(this);if(result instanceof Function){result.call(this,createjs.proxy(this._resultFormatSuccess,this),createjs.proxy(this._resultFormatFailed,this))}else{this._result=result||this._rawResult;this._sendComplete()}break;case"progress":this._sendProgress(event);break;case"error":this._sendError(event);break;case"loadstart":this._sendLoadStart();break;case"abort":case"timeout":if(!this._isCanceled()){this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_"+event.type.toUpperCase()+"_ERROR"))}break}};p._resultFormatSuccess=function(result){this._result=result;this._sendComplete()};p._resultFormatFailed=function(event){this._sendError(event)};p.toString=function(){return"[PreloadJS AbstractLoader]"};createjs.AbstractLoader=createjs.promote(AbstractLoader,"EventDispatcher")})();window.createjs=window.createjs||{};(function(){"use strict";function AbstractMediaLoader(loadItem,preferXHR,type){this.AbstractLoader_constructor(loadItem,preferXHR,type);this.resultFormatter=this._formatResult;this._tagSrcAttribute="src";this.on("initialize",this._updateXHR,this)};var p=createjs.extend(AbstractMediaLoader,createjs.AbstractLoader);p.load=function(){if(!this._tag){this._tag=this._createTag(this._item.src)}this._tag.preload="auto";this._tag.load();this.AbstractLoader_load()};p._createTag=function(){};p._createRequest=function(){if(!this._preferXHR){this._request=new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)}else{this._request=new createjs.XHRRequest(this._item)}};p._updateXHR=function(event){if(event.loader.setResponseType){event.loader.setResponseType("blob")}};p._formatResult=function(loader){this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler);this._tag.onstalled=null;if(this._preferXHR){var URL=window.URL||window.webkitURL;var result=loader.getResult(true);loader.getTag().src=URL.createObjectURL(result)}return loader.getTag()};createjs.AbstractMediaLoader=createjs.promote(AbstractMediaLoader,"AbstractLoader")})();window.createjs=window.createjs||{};(function(){"use strict";var AbstractRequest=function(item){this._item=item};var p=createjs.extend(AbstractRequest,createjs.EventDispatcher);p.load=function(){};p.destroy=function(){};p.cancel=function(){};createjs.AbstractRequest=createjs.promote(AbstractRequest,"EventDispatcher")})();window.createjs=window.createjs||{};(function(){"use strict";function TagRequest(loadItem,tag,srcAttribute){this.AbstractRequest_constructor(loadItem);this._tag=tag;this._tagSrcAttribute=srcAttribute;this._loadedHandler=createjs.proxy(this._handleTagComplete,this);this._addedToDOM=false};var p=createjs.extend(TagRequest,createjs.AbstractRequest);p.load=function(){this._tag.onload=createjs.proxy(this._handleTagComplete,this);this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);this._tag.onerror=createjs.proxy(this._handleError,this);var evt=new createjs.Event("initialize");evt.loader=this._tag;this.dispatchEvent(evt);this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout);this._tag[this._tagSrcAttribute]=this._item.src;if(this._tag.parentNode==null){createjs.DomUtils.appendToBody(this._tag);this._addedToDOM=true}};p.destroy=function(){this._clean();this._tag=null;this.AbstractRequest_destroy()};p._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var tag=this._tag;if(tag.readyState=="loaded"||tag.readyState=="complete"){this._handleTagComplete()}};p._handleError=function(){this._clean();this.dispatchEvent("error")};p._handleTagComplete=function(){this._rawResult=this._tag;this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult;this._clean();this.dispatchEvent("complete")};p._handleTimeout=function(){this._clean();this.dispatchEvent(new createjs.Event("timeout"))};p._clean=function(){this._tag.onload=null;this._tag.onreadystatechange=null;this._tag.onerror=null;if(this._addedToDOM&&this._tag.parentNode!=null){this._tag.parentNode.removeChild(this._tag)}clearTimeout(this._loadTimeout)};p._handleStalled=function(){};createjs.TagRequest=createjs.promote(TagRequest,"AbstractRequest")})();window.createjs=window.createjs||{};(function(){"use strict";function MediaTagRequest(loadItem,tag,srcAttribute){this.AbstractRequest_constructor(loadItem);this._tag=tag;this._tagSrcAttribute=srcAttribute;this._loadedHandler=createjs.proxy(this._handleTagComplete,this)};var p=createjs.extend(MediaTagRequest,createjs.TagRequest);var s=MediaTagRequest;p.load=function(){var sc=createjs.proxy(this._handleStalled,this);this._stalledCallback=sc;var pc=createjs.proxy(this._handleProgress,this);this._handleProgress=pc;this._tag.addEventListener("stalled",sc);this._tag.addEventListener("progress",pc);this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,false);this.TagRequest_load()};p._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var tag=this._tag;if(tag.readyState=="loaded"||tag.readyState=="complete"){this._handleTagComplete()}};p._handleStalled=function(){};p._handleProgress=function(event){if(!event||event.loaded>0&&event.total==0){return}var newEvent=new createjs.ProgressEvent(event.loaded,event.total);this.dispatchEvent(newEvent)};p._clean=function(){this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler);this._tag.removeEventListener("stalled",this._stalledCallback);this._tag.removeEventListener("progress",this._progressCallback);this.TagRequest__clean()};createjs.MediaTagRequest=createjs.promote(MediaTagRequest,"TagRequest")})();window.createjs=window.createjs||{};(function(){"use strict";function XHRRequest(item){this.AbstractRequest_constructor(item);this._request=null;this._loadTimeout=null;this._xhrLevel=1;this._response=null;this._rawResponse=null;this._canceled=false;this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this);this._handleProgressProxy=createjs.proxy(this._handleProgress,this);this._handleAbortProxy=createjs.proxy(this._handleAbort,this);this._handleErrorProxy=createjs.proxy(this._handleError,this);this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this);this._handleLoadProxy=createjs.proxy(this._handleLoad,this);this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this);if(!this._createXHR(item)){}};var p=createjs.extend(XHRRequest,createjs.AbstractRequest);XHRRequest.ACTIVEX_VERSIONS=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];p.getResult=function(raw){if(raw&&this._rawResponse){return this._rawResponse}return this._response};p.cancel=function(){this.canceled=true;this._clean();this._request.abort()};p.load=function(){if(this._request==null){this._handleError();return}if(this._request.addEventListener!=null){this._request.addEventListener("loadstart",this._handleLoadStartProxy,false);this._request.addEventListener("progress",this._handleProgressProxy,false);this._request.addEventListener("abort",this._handleAbortProxy,false);this._request.addEventListener("error",this._handleErrorProxy,false);this._request.addEventListener("timeout",this._handleTimeoutProxy,false);this._request.addEventListener("load",this._handleLoadProxy,false);this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,false)}else{this._request.onloadstart=this._handleLoadStartProxy;this._request.onprogress=this._handleProgressProxy;this._request.onabort=this._handleAbortProxy;this._request.onerror=this._handleErrorProxy;this._request.ontimeout=this._handleTimeoutProxy;this._request.onload=this._handleLoadProxy;this._request.onreadystatechange=this._handleReadyStateChangeProxy}if(this._xhrLevel==1){this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout)}try{if(!this._item.values){this._request.send()}else{this._request.send(createjs.URLUtils.formatQueryString(this._item.values))}}catch(error){this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,error))}};p.setResponseType=function(type){if(type==="blob"){type=window.URL?"blob":"arraybuffer";this._responseType=type}this._request.responseType=type};p.getAllResponseHeaders=function(){if(this._request.getAllResponseHeaders instanceof Function){return this._request.getAllResponseHeaders()}else{return null}};p.getResponseHeader=function(header){if(this._request.getResponseHeader instanceof Function){return this._request.getResponseHeader(header)}else{return null}};p._handleProgress=function(event){if(!event||event.loaded>0&&event.total==0){return}var newEvent=new createjs.ProgressEvent(event.loaded,event.total);this.dispatchEvent(newEvent)};p._handleLoadStart=function(event){clearTimeout(this._loadTimeout);this.dispatchEvent("loadstart")};p._handleAbort=function(event){this._clean();this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,event))};p._handleError=function(event){this._clean();this.dispatchEvent(new createjs.ErrorEvent(event.message))};p._handleReadyStateChange=function(event){if(this._request.readyState==4){this._handleLoad()}};p._handleLoad=function(event){if(this.loaded){return}this.loaded=true;var error=this._checkError();if(error){this._handleError(error);return}this._response=this._getResponse();if(this._responseType==="arraybuffer"){try{this._response=new Blob([this._response])}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(e.name==="TypeError"&&window.BlobBuilder){var builder=new BlobBuilder;builder.append(this._response);this._response=builder.getBlob()}}}this._clean();this.dispatchEvent(new createjs.Event("complete"))};p._handleTimeout=function(event){this._clean();this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,event))};p._checkError=function(){var status=parseInt(this._request.status);if(status>=400&&status<=599){return new Error(status)}else if(status==0){if(/^https?:/.test(location.protocol)){return new Error(0)}return null}else{return null}};p._getResponse=function(){if(this._response!=null){return this._response}if(this._request.response!=null){return this._request.response}try{if(this._request.responseText!=null){return this._request.responseText}}catch(e){}try{if(this._request.responseXML!=null){return this._request.responseXML}}catch(e){}return null};p._createXHR=function(item){var crossdomain=createjs.URLUtils.isCrossDomain(item);var headers={};var req=null;if(window.XMLHttpRequest){req=new XMLHttpRequest;if(crossdomain&&req.withCredentials===undefined&&window.XDomainRequest){req=new XDomainRequest}}else{for(var i=0,l=s.ACTIVEX_VERSIONS.length;i<l;i++){var axVersion=s.ACTIVEX_VERSIONS[i];try{req=new ActiveXObject(axVersion);break}catch(e){}}if(req==null){return false}}if(item.mimeType==null&&createjs.RequestUtils.isText(item.type)){item.mimeType="text/plain; charset=utf-8"}if(item.mimeType&&req.overrideMimeType){req.overrideMimeType(item.mimeType)}this._xhrLevel=typeof req.responseType==="string"?2:1;var src=null;if(item.method==createjs.Methods.GET){src=createjs.URLUtils.buildURI(item.src,item.values)}else{src=item.src}req.open(item.method||createjs.Methods.GET,src,true);if(crossdomain&&req instanceof XMLHttpRequest&&this._xhrLevel==1){headers["Origin"]=location.origin}if(item.values&&item.method==createjs.Methods.POST){headers["Content-Type"]="application/x-www-form-urlencoded"}if(!crossdomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}if(item.headers){for(var n in item.headers){headers[n]=item.headers[n]}}for(n in headers){req.setRequestHeader(n,headers[n])}if(req instanceof XMLHttpRequest&&item.withCredentials!==undefined){req.withCredentials=item.withCredentials}this._request=req;return true};p._clean=function(){clearTimeout(this._loadTimeout);if(this._request.removeEventListener!=null){this._request.removeEventListener("loadstart",this._handleLoadStartProxy);this._request.removeEventListener("progress",this._handleProgressProxy);this._request.removeEventListener("abort",this._handleAbortProxy);this._request.removeEventListener("error",this._handleErrorProxy);this._request.removeEventListener("timeout",this._handleTimeoutProxy);this._request.removeEventListener("load",this._handleLoadProxy);this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy)}else{this._request.onloadstart=null;this._request.onprogress=null;this._request.onabort=null;this._request.onerror=null;this._request.ontimeout=null;this._request.onload=null;this._request.onreadystatechange=null}};p.toString=function(){return"[PreloadJS XHRRequest]"};createjs.XHRRequest=createjs.promote(XHRRequest,"AbstractRequest")})();window.createjs=window.createjs||{};(function(){"use strict";function SoundLoader(loadItem,preferXHR){this.AbstractMediaLoader_constructor(loadItem,preferXHR,createjs.Types.SOUND);if(createjs.DomUtils.isAudioTag(loadItem)){this._tag=loadItem}else if(createjs.DomUtils.isAudioTag(loadItem.src)){this._tag=loadItem}else if(createjs.DomUtils.isAudioTag(loadItem.tag)){this._tag=createjs.DomUtils.isAudioTag(loadItem)?loadItem:loadItem.src}if(this._tag!=null){this._preferXHR=false}};var p=createjs.extend(SoundLoader,createjs.AbstractMediaLoader);var s=SoundLoader;s.canLoadItem=function(item){return item.type==createjs.Types.SOUND};p._createTag=function(src){var tag=createjs.Elements.audio();tag.autoplay=false;tag.preload="none";tag.src=src;return tag};createjs.SoundLoader=createjs.promote(SoundLoader,"AbstractMediaLoader")})();window.createjs=window.createjs||{};(function(){"use strict";var PlayPropsConfig=function(){this.interrupt=null;this.delay=null;this.offset=null;this.loop=null;this.volume=null;this.pan=null;this.startTime=null;this.duration=null};var p=PlayPropsConfig.prototype={};var s=PlayPropsConfig;s.create=function(value){if(typeof value==="string"){console&&(console.warn||console.log)("Deprecated behaviour. Sound.play takes a configuration object instead of individual arguments. See docs for info.");return new createjs.PlayPropsConfig().set({interrupt:value})}else if(value==null||value instanceof s||value instanceof Object){return new createjs.PlayPropsConfig().set(value)}else if(value==null){throw new Error("PlayProps configuration not recognized.")}};p.set=function(props){if(props!=null){for(var n in props){this[n]=props[n]}}return this};p.toString=function(){return"[PlayPropsConfig]"};createjs.PlayPropsConfig=s})();window.createjs=window.createjs||{};(function(){"use strict";function Sound(){throw"Sound cannot be instantiated"}var s=Sound;s.INTERRUPT_ANY="any";s.INTERRUPT_EARLY="early";s.INTERRUPT_LATE="late";s.INTERRUPT_NONE="none";s.PLAY_INITED="playInited";s.PLAY_SUCCEEDED="playSucceeded";s.PLAY_INTERRUPTED="playInterrupted";s.PLAY_FINISHED="playFinished";s.PLAY_FAILED="playFailed";s.SUPPORTED_EXTENSIONS=["mp3","ogg","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"];s.EXTENSION_MAP={m4a:"mp4"};s.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/;s.defaultInterruptBehavior=s.INTERRUPT_NONE;s.alternateExtensions=[];s.activePlugin=null;s._masterVolume=1;s._getMasterVolume=function(){return this._masterVolume};s.getVolume=createjs.deprecate(s._getMasterVolume,"Sound.getVolume");s._setMasterVolume=function(value){if(Number(value)==null){return}value=Math.max(0,Math.min(1,value));s._masterVolume=value;if(!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(value)){var instances=this._instances;for(var i=0,l=instances.length;i<l;i++){instances[i].setMasterVolume(value)}}};s.setVolume=createjs.deprecate(s._setMasterVolume,"Sound.setVolume");s._masterMute=false;s._getMute=function(){return this._masterMute};s.getMute=createjs.deprecate(s._getMute,"Sound.getMute");s._setMute=function(value){if(value==null){return}this._masterMute=value;if(!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(value)){var instances=this._instances;for(var i=0,l=instances.length;i<l;i++){instances[i].setMasterMute(value)}}};s.setMute=createjs.deprecate(s._setMute,"Sound.setMute");s._getCapabilities=function(){if(s.activePlugin==null){return null}return s.activePlugin._capabilities};s.getCapabilities=createjs.deprecate(s._getCapabilities,"Sound.getCapabilities");Object.defineProperties(s,{volume:{get:s._getMasterVolume,set:s._setMasterVolume},muted:{get:s._getMute,set:s._setMute},capabilities:{get:s._getCapabilities}});s._pluginsRegistered=false;s._lastID=0;s._instances=[];s._idHash={};s._preloadHash={};s._defaultPlayPropsHash={};s.addEventListener=null;s.removeEventListener=null;s.removeAllEventListeners=null;s.dispatchEvent=null;s.hasEventListener=null;s._listeners=null;createjs.EventDispatcher.initialize(s);s.getPreloadHandlers=function(){return{callback:createjs.proxy(s.initLoad,s),types:["sound"],extensions:s.SUPPORTED_EXTENSIONS}};s._handleLoadComplete=function(event){var src=event.target.getItem().src;if(!s._preloadHash[src]){return}for(var i=0,l=s._preloadHash[src].length;i<l;i++){var item=s._preloadHash[src][i];s._preloadHash[src][i]=true;if(!s.hasEventListener("fileload")){continue}var event=new createjs.Event("fileload");event.src=item.src;event.id=item.id;event.data=item.data;event.sprite=item.sprite;s.dispatchEvent(event)}};s._handleLoadError=function(event){var src=event.target.getItem().src;if(!s._preloadHash[src]){return}for(var i=0,l=s._preloadHash[src].length;i<l;i++){var item=s._preloadHash[src][i];s._preloadHash[src][i]=false;if(!s.hasEventListener("fileerror")){continue}var event=new createjs.Event("fileerror");event.src=item.src;event.id=item.id;event.data=item.data;event.sprite=item.sprite;s.dispatchEvent(event)}};s._registerPlugin=function(plugin){if(plugin.isSupported()){s.activePlugin=new plugin;return true}return false};s.registerPlugins=function(plugins){s._pluginsRegistered=true;for(var i=0,l=plugins.length;i<l;i++){if(s._registerPlugin(plugins[i])){return true}}return false};s.initializeDefaultPlugins=function(){if(s.activePlugin!=null){return true}if(s._pluginsRegistered){return false}if(s.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])){return true}return false};s.isReady=function(){return s.activePlugin!=null};s.initLoad=function(loadItem){if(loadItem.type=="video"){return true}return s._registerSound(loadItem)};s._registerSound=function(loadItem){if(!s.initializeDefaultPlugins()){return false}var details;if(loadItem.src instanceof Object){details=s._parseSrc(loadItem.src);details.src=loadItem.path+details.src}else{details=s._parsePath(loadItem.src)}if(details==null){return false}loadItem.src=details.src;loadItem.type="sound";var data=loadItem.data;var numChannels=null;if(data!=null){if(!isNaN(data.channels)){numChannels=parseInt(data.channels)}else if(!isNaN(data)){numChannels=parseInt(data)}if(data.audioSprite){var sp;for(var i=data.audioSprite.length;i--;){sp=data.audioSprite[i];s._idHash[sp.id]={src:loadItem.src,startTime:parseInt(sp.startTime),duration:parseInt(sp.duration)};if(sp.defaultPlayProps){s._defaultPlayPropsHash[sp.id]=createjs.PlayPropsConfig.create(sp.defaultPlayProps)}}}}if(loadItem.id!=null){s._idHash[loadItem.id]={src:loadItem.src}};var loader=s.activePlugin.register(loadItem);SoundChannel.create(loadItem.src,numChannels);if(data==null||!isNaN(data)){loadItem.data=numChannels||SoundChannel.maxPerChannel()}else{loadItem.data.channels=numChannels||SoundChannel.maxPerChannel()}if(loader.type){loadItem.type=loader.type}if(loadItem.defaultPlayProps){s._defaultPlayPropsHash[loadItem.src]=createjs.PlayPropsConfig.create(loadItem.defaultPlayProps)}return loader};s.registerSound=function(src,id,data,basePath,defaultPlayProps){var loadItem={src:src,id:id,data:data,defaultPlayProps:defaultPlayProps};if(src instanceof Object&&src.src){basePath=basePath;loadItem=src}loadItem=createjs.LoadItem.create(loadItem);loadItem.path=basePath||"";if(basePath&&!(loadItem.src instanceof Object)){loadItem.src=basePath+loadItem.src}var loader=s._registerSound(loadItem);if(!loader){return false}if(!s._preloadHash[loadItem.src]){s._preloadHash[loadItem.src]=[]}s._preloadHash[loadItem.src].push(loadItem);if(s._preloadHash[loadItem.src].length==1){loader.on("complete",this._handleLoadComplete,this);loader.on("error",this._handleLoadError,this);s.activePlugin.preload(loader)}else{if(s._preloadHash[loadItem.src][0]==true){return true}}return{loadItem,loader}};s.registerSounds=function(sounds,basePath){var returnValues=[];if(sounds.path){if(!basePath){basePath=sounds.path}else{basePath=basePath+sounds.path}sounds=sounds.manifest}for(var i=0,l=sounds.length;i<l;i++){returnValues[i]=createjs.Sound.registerSound(sounds[i].src,sounds[i].id,sounds[i].data,basePath,sounds[i].defaultPlayProps)}return returnValues};s.removeSound=function(src,basePath){if(s.activePlugin==null){return false}if(src instanceof Object&&src.src){src=src.src}var details;if(src instanceof Object){details=s._parseSrc(src)}else{src=s._getSrcById(src).src;details=s._parsePath(src)}if(details==null){return false}src=details.src;if(basePath!=null){src=basePath+src}for(var prop in s._idHash){if(s._idHash[prop].src==src){delete s._idHash[prop]}}SoundChannel.removeSrc(src);delete s._preloadHash[src];s.activePlugin.removeSound(src);return true};s.removeSounds=function(sounds,basePath){var returnValues=[];if(sounds.path){if(!basePath){basePath=sounds.path}else{basePath=basePath+sounds.path}sounds=sounds.manifest}for(var i=0,l=sounds.length;i<l;i++){returnValues[i]=createjs.Sound.removeSound(sounds[i].src,basePath)}return returnValues};s.removeAllSounds=function(){s._idHash={};s._preloadHash={};SoundChannel.removeAll();if(s.activePlugin){s.activePlugin.removeAllSounds()}};s.loadComplete=function(src){if(!s.isReady()){return false}var details=s._parsePath(src);if(details){src=s._getSrcById(details.src).src}else{src=s._getSrcById(src).src}if(s._preloadHash[src]==undefined){return false}return s._preloadHash[src][0]==true};s._parsePath=function(value){if(typeof value!="string"){value=value.toString()}var match=value.match(s.FILE_PATTERN);if(match==null){return false}var name=match[4];var ext=match[5];var c=s.capabilities;var i=0;while(!c[ext]){ext=s.alternateExtensions[i++];if(i>s.alternateExtensions.length){return null}}value=value.replace("."+match[5],"."+ext);var ret={name:name,src:value,extension:ext};return ret};s._parseSrc=function(value){var ret={name:undefined,src:undefined,extension:undefined};var c=s.capabilities;for(var prop in value){if(value.hasOwnProperty(prop)&&c[prop]){ret.src=value[prop];ret.extension=prop;break}}if(!ret.src){return false}var i=ret.src.lastIndexOf("/");if(i!=-1){ret.name=ret.src.slice(i+1)}else{ret.name=ret.src}return ret};s.play=function(src,props){var playProps=createjs.PlayPropsConfig.create(props);var instance=s.createInstance(src,playProps.startTime,playProps.duration);var ok=s._playInstance(instance,playProps);if(!ok){instance._playFailed()}return instance};s.createInstance=function(src,startTime,duration){if(!s.initializeDefaultPlugins()){return new createjs.DefaultSoundInstance(src,startTime,duration)}var defaultPlayProps=s._defaultPlayPropsHash[src];src=s._getSrcById(src);var details=s._parsePath(src.src);var instance=null;if(details!=null&&details.src!=null){SoundChannel.create(details.src);if(startTime==null){startTime=src.startTime}instance=s.activePlugin.create(details.src,startTime,duration||src.duration);defaultPlayProps=defaultPlayProps||s._defaultPlayPropsHash[details.src];if(defaultPlayProps){instance.applyPlayProps(defaultPlayProps)}}else{instance=new createjs.DefaultSoundInstance(src,startTime,duration)}instance.uniqueId=s._lastID++;return instance};s.stop=function(){var instances=this._instances;for(var i=instances.length;i--;){instances[i].stop()}};s.setDefaultPlayProps=function(src,playProps){src=s._getSrcById(src);s._defaultPlayPropsHash[s._parsePath(src.src).src]=createjs.PlayPropsConfig.create(playProps)};s.getDefaultPlayProps=function(src){src=s._getSrcById(src);return s._defaultPlayPropsHash[s._parsePath(src.src).src]};s._playInstance=function(instance,playProps){var defaultPlayProps=s._defaultPlayPropsHash[instance.src]||{};if(playProps.interrupt==null){playProps.interrupt=defaultPlayProps.interrupt||s.defaultInterruptBehavior};if(playProps.delay==null){playProps.delay=defaultPlayProps.delay||0}if(playProps.offset==null){playProps.offset=instance.position}if(playProps.loop==null){playProps.loop=instance.loop}if(playProps.volume==null){playProps.volume=instance.volume}if(playProps.pan==null){playProps.pan=instance.pan}if(playProps.delay==0){var ok=s._beginPlaying(instance,playProps);if(!ok){return false}}else{var delayTimeoutId=setTimeout(function(){s._beginPlaying(instance,playProps)},playProps.delay);instance.delayTimeoutId=delayTimeoutId}this._instances.push(instance);return true};s._beginPlaying=function(instance,playProps){if(!SoundChannel.add(instance,playProps.interrupt)){return false}var result=instance._beginPlaying(playProps);if(!result){var index=createjs.indexOf(this._instances,instance);if(index>-1){this._instances.splice(index,1)}return false}return true};s._getSrcById=function(value){return s._idHash[value]||{src:value}};s._playFinished=function(instance){SoundChannel.remove(instance);var index=createjs.indexOf(this._instances,instance);if(index>-1){this._instances.splice(index,1)}};createjs.Sound=Sound;function SoundChannel(src,max){this.init(src,max)}SoundChannel.channels={};SoundChannel.create=function(src,max){var channel=SoundChannel.get(src);if(channel==null){SoundChannel.channels[src]=new SoundChannel(src,max);return true}return false};SoundChannel.removeSrc=function(src){var channel=SoundChannel.get(src);if(channel==null){return false}channel._removeAll();delete SoundChannel.channels[src];return true};SoundChannel.removeAll=function(){for(var channel in SoundChannel.channels){SoundChannel.channels[channel]._removeAll()}SoundChannel.channels={}};SoundChannel.add=function(instance,interrupt){var channel=SoundChannel.get(instance.src);if(channel==null){return false}return channel._add(instance,interrupt)};SoundChannel.remove=function(instance){var channel=SoundChannel.get(instance.src);if(channel==null){return false}channel._remove(instance);return true};SoundChannel.maxPerChannel=function(){return p.maxDefault};SoundChannel.get=function(src){return SoundChannel.channels[src]};var p=SoundChannel.prototype;p.constructor=SoundChannel;p.src=null;p.max=null;p.maxDefault=100;p.length=0;p.init=function(src,max){this.src=src;this.max=max||this.maxDefault;if(this.max==-1){this.max=this.maxDefault}this._instances=[]};p._get=function(index){return this._instances[index]};p._add=function(instance,interrupt){if(!this._getSlot(interrupt,instance)){return false}this._instances.push(instance);this.length++;return true};p._remove=function(instance){var index=createjs.indexOf(this._instances,instance);if(index==-1){return false}this._instances.splice(index,1);this.length--;return true};p._removeAll=function(){for(var i=this.length-1;i>=0;i--){this._instances[i].stop()}};p._getSlot=function(interrupt,instance){var target,replacement;if(interrupt!=Sound.INTERRUPT_NONE){replacement=this._get(0);if(replacement==null){return true}}for(var i=0,l=this.max;i<l;i++){target=this._get(i);if(target==null){return true}if(target.playState==Sound.PLAY_FINISHED||target.playState==Sound.PLAY_INTERRUPTED||target.playState==Sound.PLAY_FAILED){replacement=target;break}if(interrupt==Sound.INTERRUPT_NONE){continue}if(interrupt==Sound.INTERRUPT_EARLY&&target.position<replacement.position||interrupt==Sound.INTERRUPT_LATE&&target.position>replacement.position){replacement=target}}if(replacement!=null){replacement._interrupt();this._remove(replacement);return true}return false};p.toString=function(){return"[Sound SoundChannel]"};createjs.SoundChannel=SoundChannel})();window.createjs=window.createjs||{};(function(){"use strict";var AbstractSoundInstance=function(src,startTime,duration,playbackResource){this.EventDispatcher_constructor();this.src=src;this.uniqueId=-1;this.playState=null;this.delayTimeoutId=null;this._volume=1;Object.defineProperty(this,"volume",{get:this._getVolume,set:this._setVolume});this.getVolume=createjs.deprecate(this._getVolume,"AbstractSoundInstance.getVolume");this.setVolume=createjs.deprecate(this._setVolume,"AbstractSoundInstance.setVolume");this._pan=0;Object.defineProperty(this,"pan",{get:this._getPan,set:this._setPan});this.getPan=createjs.deprecate(this._getPan,"AbstractSoundInstance.getPan");this.setPan=createjs.deprecate(this._setPan,"AbstractSoundInstance.setPan");this._startTime=Math.max(0,startTime||0);Object.defineProperty(this,"startTime",{get:this._getStartTime,set:this._setStartTime});this.getStartTime=createjs.deprecate(this._getStartTime,"AbstractSoundInstance.getStartTime");this.setStartTime=createjs.deprecate(this._setStartTime,"AbstractSoundInstance.setStartTime");this._duration=Math.max(0,duration||0);Object.defineProperty(this,"duration",{get:this._getDuration,set:this._setDuration});this.getDuration=createjs.deprecate(this._getDuration,"AbstractSoundInstance.getDuration");this.setDuration=createjs.deprecate(this._setDuration,"AbstractSoundInstance.setDuration");this._playbackResource=null;Object.defineProperty(this,"playbackResource",{get:this._getPlaybackResource,set:this._setPlaybackResource});if(playbackResource!==false&&playbackResource!==true){this._setPlaybackResource(playbackResource)}this.getPlaybackResource=createjs.deprecate(this._getPlaybackResource,"AbstractSoundInstance.getPlaybackResource");this.setPlaybackResource=createjs.deprecate(this._setPlaybackResource,"AbstractSoundInstance.setPlaybackResource");this._position=0;Object.defineProperty(this,"position",{get:this._getPosition,set:this._setPosition});this.getPosition=createjs.deprecate(this._getPosition,"AbstractSoundInstance.getPosition");this.setPosition=createjs.deprecate(this._setPosition,"AbstractSoundInstance.setPosition");this._loop=0;Object.defineProperty(this,"loop",{get:this._getLoop,set:this._setLoop});this.getLoop=createjs.deprecate(this._getLoop,"AbstractSoundInstance.getLoop");this.setLoop=createjs.deprecate(this._setLoop,"AbstractSoundInstance.setLoop");this._muted=false;Object.defineProperty(this,"muted",{get:this._getMuted,set:this._setMuted});this.getMuted=createjs.deprecate(this._getMuted,"AbstractSoundInstance.getMuted");this.setMuted=createjs.deprecate(this._setMuted,"AbstractSoundInstance.setMuted");this._paused=false;Object.defineProperty(this,"paused",{get:this._getPaused,set:this._setPaused});this.getPaused=createjs.deprecate(this._getPaused,"AbstractSoundInstance.getPaused");this.setPaused=createjs.deprecate(this._setPaused,"AbstractSoundInstance.setPaused")};var p=createjs.extend(AbstractSoundInstance,createjs.EventDispatcher);p.play=function(props){var playProps=createjs.PlayPropsConfig.create(props);if(this.playState==createjs.Sound.PLAY_SUCCEEDED){this.applyPlayProps(playProps);if(this._paused){this._setPaused(false)}return}this._cleanUp();createjs.Sound._playInstance(this,playProps);return this};p.stop=function(){this._position=0;this._paused=false;this._handleStop();this._cleanUp();this.playState=createjs.Sound.PLAY_FINISHED;return this};p.destroy=function(){this._cleanUp();this.src=null;this.playbackResource=null;this.removeAllEventListeners()};p.applyPlayProps=function(playProps){if(playProps.offset!=null){this._setPosition(playProps.offset)}if(playProps.loop!=null){this._setLoop(playProps.loop)}if(playProps.volume!=null){this._setVolume(playProps.volume)}if(playProps.pan!=null){this._setPan(playProps.pan)}if(playProps.startTime!=null){this._setStartTime(playProps.startTime);this._setDuration(playProps.duration)}return this};p.toString=function(){return"[AbstractSoundInstance]"};p._getPaused=function(){return this._paused};p._setPaused=function(value){if(value!==true&&value!==false||this._paused==value){return}if(value==true&&this.playState!=createjs.Sound.PLAY_SUCCEEDED){return}this._paused=value;if(value){this._pause()}else{this._resume()}clearTimeout(this.delayTimeoutId);return this};p._setVolume=function(value){if(value==this._volume){return this}this._volume=Math.max(0,Math.min(1,value));if(!this._muted){this._updateVolume()}return this};p._getVolume=function(){return this._volume};p._setMuted=function(value){if(value!==true&&value!==false){return}this._muted=value;this._updateVolume();return this};p._getMuted=function(){return this._muted};p._setPan=function(value){if(value==this._pan){return this}this._pan=Math.max(-1,Math.min(1,value));this._updatePan();return this};p._getPan=function(){return this._pan};p._getPosition=function(){if(!this._paused&&this.playState==createjs.Sound.PLAY_SUCCEEDED){this._position=this._calculateCurrentPosition()}return this._position};p._setPosition=function(value){this._position=Math.max(0,value);if(this.playState==createjs.Sound.PLAY_SUCCEEDED){this._updatePosition()}return this};p._getStartTime=function(){return this._startTime};p._setStartTime=function(value){if(value==this._startTime){return this}this._startTime=Math.max(0,value||0);this._updateStartTime();return this};p._getDuration=function(){return this._duration};p._setDuration=function(value){if(value==this._duration){return this}this._duration=Math.max(0,value||0);this._updateDuration();return this};p._setPlaybackResource=function(value){this._playbackResource=value;if(this._duration==0&&this._playbackResource){this._setDurationFromSource()}return this};p._getPlaybackResource=function(){return this._playbackResource};p._getLoop=function(){return this._loop};p._setLoop=function(value){if(this._playbackResource!=null){if(this._loop!=0&&value==0){this._removeLooping(value)}else if(this._loop==0&&value!=0){this._addLooping(value)}}this._loop=value};p._sendEvent=function(type){var event=new createjs.Event(type);this.dispatchEvent(event)};p._cleanUp=function(){clearTimeout(this.delayTimeoutId);this._handleCleanUp();this._paused=false;createjs.Sound._playFinished(this)};p._interrupt=function(){this._cleanUp();this.playState=createjs.Sound.PLAY_INTERRUPTED;this._sendEvent("interrupted")};p._beginPlaying=function(playProps){this._setPosition(playProps.offset);this._setLoop(playProps.loop);this._setVolume(playProps.volume);this._setPan(playProps.pan);if(playProps.startTime!=null){this._setStartTime(playProps.startTime);this._setDuration(playProps.duration)}if(this._playbackResource!=null&&this._position<this._duration){this._paused=false;this._handleSoundReady();this.playState=createjs.Sound.PLAY_SUCCEEDED;this._sendEvent("succeeded");return true}else{this._playFailed();return false}};p._playFailed=function(){this._cleanUp();this.playState=createjs.Sound.PLAY_FAILED;this._sendEvent("failed")};p._handleSoundComplete=function(event){this._position=0;if(this._loop!=0){this._loop--;this._handleLoop();this._sendEvent("loop");return}this._cleanUp();this.playState=createjs.Sound.PLAY_FINISHED;this._sendEvent("complete")};p._handleSoundReady=function(){};p._updateVolume=function(){};p._updatePan=function(){};p._updateStartTime=function(){};p._updateDuration=function(){};p._setDurationFromSource=function(){};p._calculateCurrentPosition=function(){};p._updatePosition=function(){};p._removeLooping=function(value){};p._addLooping=function(value){};p._pause=function(){};p._resume=function(){};p._handleStop=function(){};p._handleCleanUp=function(){};p._handleLoop=function(){};createjs.AbstractSoundInstance=createjs.promote(AbstractSoundInstance,"EventDispatcher");createjs.DefaultSoundInstance=createjs.AbstractSoundInstance})();window.createjs=window.createjs||{};(function(){"use strict";var AbstractPlugin=function(){this._capabilities=null;this._loaders={};this._audioSources={};this._soundInstances={};this._volume=1;this._loaderClass;this._soundInstanceClass};var p=AbstractPlugin.prototype;AbstractPlugin._capabilities=null;AbstractPlugin.isSupported=function(){return true};p.register=function(loadItem){var loader=this._loaders[loadItem.src];if(loader&&!loader.canceled){return this._loaders[loadItem.src]}this._audioSources[loadItem.src]=true;this._soundInstances[loadItem.src]=[];loader=new this._loaderClass(loadItem);loader.on("complete",this._handlePreloadComplete,this);this._loaders[loadItem.src]=loader;return loader};p.preload=function(loader){loader.on("error",this._handlePreloadError,this);loader.load()};p.isPreloadStarted=function(src){return this._audioSources[src]!=null};p.isPreloadComplete=function(src){return!(this._audioSources[src]==null||this._audioSources[src]==true)};p.removeSound=function(src){if(!this._soundInstances[src]){return}for(var i=this._soundInstances[src].length;i--;){var item=this._soundInstances[src][i];item.destroy()}delete this._soundInstances[src];delete this._audioSources[src];if(this._loaders[src]){this._loaders[src].destroy()}delete this._loaders[src]};p.removeAllSounds=function(){for(var key in this._audioSources){this.removeSound(key)}};p.create=function(src,startTime,duration){if(!this.isPreloadStarted(src)){this.preload(this.register(src))}var si=new this._soundInstanceClass(src,startTime,duration,this._audioSources[src]);if(this._soundInstances[src]){this._soundInstances[src].push(si)}si.setMasterVolume&&si.setMasterVolume(createjs.Sound.volume);si.setMasterMute&&si.setMasterMute(createjs.Sound.muted);return si};p.setVolume=function(value){this._volume=value;this._updateVolume();return true};p.getVolume=function(){return this._volume};p.setMute=function(value){this._updateVolume();return true};p.toString=function(){return"[AbstractPlugin]"};p._handlePreloadComplete=function(event){var src=event.target.getItem().src;this._audioSources[src]=event.result;for(var i=0,l=this._soundInstances[src].length;i<l;i++){var item=this._soundInstances[src][i];item.playbackResource=this._audioSources[src]}this._soundInstances[src]=null};p._handlePreloadError=function(event){};p._updateVolume=function(){};createjs.AbstractPlugin=AbstractPlugin})();window.createjs=window.createjs||{};(function(){"use strict";function Loader(loadItem){this.AbstractLoader_constructor(loadItem,true,createjs.Types.SOUND)};var p=createjs.extend(Loader,createjs.AbstractLoader);Loader.context=null;p.toString=function(){return"[WebAudioLoader]"};p._createRequest=function(){this._request=new createjs.XHRRequest(this._item,false);this._request.setResponseType("arraybuffer");if(!this._request._request.responseType){this._request._request.responseType="arraybuffer"}};p._sendComplete=function(event){Loader.context.decodeAudioData(this._rawResult,createjs.proxy(this._handleAudioDecoded,this),createjs.proxy(this._sendError,this))};p._handleAudioDecoded=function(decodedAudio){this._result=decodedAudio;this.AbstractLoader__sendComplete()};createjs.WebAudioLoader=createjs.promote(Loader,"AbstractLoader")})();window.createjs=window.createjs||{};(function(){"use strict";function WebAudioSoundInstance(src,startTime,duration,playbackResource){this.AbstractSoundInstance_constructor(src,startTime,duration,playbackResource);this.gainNode=s.context.createGain();this.panNode=s.context.createPanner();this.panNode.panningModel=s._panningModel;this.panNode.connect(this.gainNode);this._updatePan();this.sourceNode=null;this._soundCompleteTimeout=null;this._sourceNodeNext=null;this._playbackStartTime=0;this._endedHandler=createjs.proxy(this._handleSoundComplete,this)};var p=createjs.extend(WebAudioSoundInstance,createjs.AbstractSoundInstance);var s=WebAudioSoundInstance;s.context=null;s._scratchBuffer=null;s.destinationNode=null;s._panningModel="equalpower";p.destroy=function(){this.AbstractSoundInstance_destroy();this.panNode.disconnect(0);this.panNode=null;this.gainNode.disconnect(0);this.gainNode=null};p.toString=function(){return"[WebAudioSoundInstance]"};p._updatePan=function(){this.panNode.setPosition(this._pan,0,-0.5)};p._removeLooping=function(value){this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)};p._addLooping=function(value){if(this.playState!=createjs.Sound.PLAY_SUCCEEDED){return}this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0)};p._setDurationFromSource=function(){this._duration=this.playbackResource.duration*1000};p._handleCleanUp=function(){if(this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED){this.sourceNode=this._cleanUpAudioNode(this.sourceNode);this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)}if(this.gainNode.numberOfOutputs!=0){this.gainNode.disconnect(0)}clearTimeout(this._soundCompleteTimeout);this._playbackStartTime=0};p._cleanUpAudioNode=function(audioNode){if(audioNode){audioNode.stop(0);audioNode.disconnect(0);if(createjs.BrowserDetect.isIOS){try{audioNode.buffer=s._scratchBuffer}catch(e){}}audioNode=null}return audioNode};p._handleSoundReady=function(event){this.gainNode.connect(s.destinationNode);var dur=this._duration*0.001,pos=Math.min(Math.max(0,this._position)*0.001,dur);this.sourceNode=this._createAndPlayAudioNode(s.context.currentTime-dur,pos);this._playbackStartTime=this.sourceNode.startTime-pos;this._soundCompleteTimeout=setTimeout(this._endedHandler,(dur-pos)*1000);if(this._loop!=0){this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0)}};p._createAndPlayAudioNode=function(startTime,offset){var audioNode=s.context.createBufferSource();audioNode.buffer=this.playbackResource;audioNode.connect(this.panNode);var dur=this._duration*0.001;audioNode.startTime=startTime+dur;audioNode.start(audioNode.startTime,offset+this._startTime*0.001,dur-offset);return audioNode};p._pause=function(){this._position=(s.context.currentTime-this._playbackStartTime)*1000;this.sourceNode=this._cleanUpAudioNode(this.sourceNode);this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);if(this.gainNode.numberOfOutputs!=0){this.gainNode.disconnect(0)}clearTimeout(this._soundCompleteTimeout)};p._resume=function(){this._handleSoundReady()};p._updateVolume=function(){var newVolume=this._muted?0:this._volume;if(newVolume!=this.gainNode.gain.value){this.gainNode.gain.value=newVolume}};p._calculateCurrentPosition=function(){return(s.context.currentTime-this._playbackStartTime)*1000};p._updatePosition=function(){this.sourceNode=this._cleanUpAudioNode(this.sourceNode);this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext);clearTimeout(this._soundCompleteTimeout);if(!this._paused){this._handleSoundReady()}};p._handleLoop=function(){this._cleanUpAudioNode(this.sourceNode);this.sourceNode=this._sourceNodeNext;this._playbackStartTime=this.sourceNode.startTime;this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0);this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)};p._updateDuration=function(){if(this.playState==createjs.Sound.PLAY_SUCCEEDED){this._pause();this._resume()}};createjs.WebAudioSoundInstance=createjs.promote(WebAudioSoundInstance,"AbstractSoundInstance")})();window.createjs=window.createjs||{};(function(){"use strict";function WebAudioPlugin(){this.AbstractPlugin_constructor();this._panningModel=s._panningModel;;this.context=s.context;this.dynamicsCompressorNode=this.context.createDynamicsCompressor();this.dynamicsCompressorNode.connect(this.context.destination);this.gainNode=this.context.createGain();this.gainNode.connect(this.dynamicsCompressorNode);createjs.WebAudioSoundInstance.destinationNode=this.gainNode;this._capabilities=s._capabilities;this._loaderClass=createjs.WebAudioLoader;this._soundInstanceClass=createjs.WebAudioSoundInstance;this._addPropsToClasses()}var p=createjs.extend(WebAudioPlugin,createjs.AbstractPlugin);var s=WebAudioPlugin;s._capabilities=null;s._panningModel="equalpower";s.context=null;s._scratchBuffer=null;s._unlocked=false;s.DEFAULT_SAMPLE_RATE=44100;s.isSupported=function(){var isMobilePhoneGap=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;if(location.protocol=="file:"&&!isMobilePhoneGap&&!this._isFileXHRSupported()){return false}s._generateCapabilities();if(s.context==null){return false}return true};s.playEmptySound=function(){if(s.context==null){return}var source=s.context.createBufferSource();source.buffer=s._scratchBuffer;source.connect(s.context.destination);source.start(0,0,0)};s._isFileXHRSupported=function(){var supported=true;var xhr=new XMLHttpRequest;try{xhr.open("GET","WebAudioPluginTest.fail",false)}catch(error){supported=false;return supported}xhr.onerror=function(){supported=false};xhr.onload=function(){supported=this.status==404||this.status==200||this.status==0&&this.response!=""};try{xhr.send()}catch(error){supported=false}return supported};s._generateCapabilities=function(){if(s._capabilities!=null){return}var t=document.createElement("audio");if(t.canPlayType==null){return null}if(s.context==null){s.context=s._createAudioContext();if(s.context==null){return null}}if(s._scratchBuffer==null){s._scratchBuffer=s.context.createBuffer(1,1,22050)}s._compatibilitySetUp();if("ontouchstart"in window&&s.context.state!="running"){s._unlock();document.addEventListener("mousedown",s._unlock,true);document.addEventListener("touchstart",s._unlock,true);document.addEventListener("touchend",s._unlock,true)}s._capabilities={panning:true,volume:true,tracks:-1};var supportedExtensions=createjs.Sound.SUPPORTED_EXTENSIONS;var extensionMap=createjs.Sound.EXTENSION_MAP;for(var i=0,l=supportedExtensions.length;i<l;i++){var ext=supportedExtensions[i];var playType=extensionMap[ext]||ext;s._capabilities[ext]=t.canPlayType("audio/"+ext)!="no"&&t.canPlayType("audio/"+ext)!=""||t.canPlayType("audio/"+playType)!="no"&&t.canPlayType("audio/"+playType)!=""}if(s.context.destination.numberOfChannels<2){s._capabilities.panning=false}};s._createAudioContext=function(){var AudioCtor=window.AudioContext||window.webkitAudioContext;if(AudioCtor==null){return null}var context=new AudioCtor;if(/(iPhone|iPad)/i.test(navigator.userAgent)&&context.sampleRate!==s.DEFAULT_SAMPLE_RATE){var buffer=context.createBuffer(1,1,s.DEFAULT_SAMPLE_RATE),dummy=context.createBufferSource();dummy.buffer=buffer;dummy.connect(context.destination);dummy.start(0);dummy.disconnect();context.close();context=new AudioCtor}return context};s._compatibilitySetUp=function(){s._panningModel="equalpower";if(s.context.createGain){return}s.context.createGain=s.context.createGainNode;var audioNode=s.context.createBufferSource();audioNode.__proto__.start=audioNode.__proto__.noteGrainOn;audioNode.__proto__.stop=audioNode.__proto__.noteOff;s._panningModel=0};s._unlock=function(){if(s._unlocked){return}s.playEmptySound();if(s.context.state=="running"){document.removeEventListener("mousedown",s._unlock,true);document.removeEventListener("touchend",s._unlock,true);document.removeEventListener("touchstart",s._unlock,true);s._unlocked=true}};p.toString=function(){return"[WebAudioPlugin]"};p._addPropsToClasses=function(){var c=this._soundInstanceClass;c.context=this.context;c._scratchBuffer=s._scratchBuffer;c.destinationNode=this.gainNode;c._panningModel=this._panningModel;this._loaderClass.context=this.context};p._updateVolume=function(){var newVolume=createjs.Sound._masterMute?0:this._volume;if(newVolume!=this.gainNode.gain.value){this.gainNode.gain.value=newVolume}if(this.context.resume&&this.context.state==="interrupted"){this.context.resume()}};createjs.WebAudioPlugin=createjs.promote(WebAudioPlugin,"AbstractPlugin")})();window.createjs=window.createjs||{};(function(){"use strict";function HTMLAudioTagPool(){throw"HTMLAudioTagPool cannot be instantiated"}var s=HTMLAudioTagPool;s._tags={};s._tagPool=new TagPool;s._tagUsed={};s.get=function(src){var t=s._tags[src];if(t==null){t=s._tags[src]=s._tagPool.get();t.src=src}else{if(s._tagUsed[src]){t=s._tagPool.get();t.src=src}else{s._tagUsed[src]=true}}return t};s.set=function(src,tag){if(tag==s._tags[src]){s._tagUsed[src]=false}else{s._tagPool.set(tag)}};s.remove=function(src){var tag=s._tags[src];if(tag==null){return false}s._tagPool.set(tag);delete s._tags[src];delete s._tagUsed[src];return true};s.getDuration=function(src){var t=s._tags[src];if(t==null||!t.duration){return 0}return t.duration*1000};createjs.HTMLAudioTagPool=HTMLAudioTagPool;function TagPool(src){this._tags=[]};var p=TagPool.prototype;p.constructor=TagPool;p.get=function(){var tag;if(this._tags.length==0){tag=this._createTag()}else{tag=this._tags.pop()}if(tag.parentNode==null){document.body.appendChild(tag)}return tag};p.set=function(tag){var index=createjs.indexOf(this._tags,tag);if(index==-1){this._tags.src=null;this._tags.push(tag)}};p.toString=function(){return"[TagPool]"};p._createTag=function(){var tag=document.createElement("audio");tag.autoplay=false;tag.preload="none";return tag}})();window.createjs=window.createjs||{};(function(){"use strict";function HTMLAudioSoundInstance(src,startTime,duration,playbackResource){this.AbstractSoundInstance_constructor(src,startTime,duration,playbackResource);this._audioSpriteStopTime=null;this._delayTimeoutId=null;this._endedHandler=createjs.proxy(this._handleSoundComplete,this);this._readyHandler=createjs.proxy(this._handleTagReady,this);this._stalledHandler=createjs.proxy(this._playFailed,this);this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this);this._loopHandler=createjs.proxy(this._handleSoundComplete,this);if(duration){this._audioSpriteStopTime=(startTime+duration)*0.001}else{this._duration=createjs.HTMLAudioTagPool.getDuration(this.src)}}var p=createjs.extend(HTMLAudioSoundInstance,createjs.AbstractSoundInstance);p.setMasterVolume=function(value){this._updateVolume()};p.setMasterMute=function(isMuted){this._updateVolume()};p.toString=function(){return"[HTMLAudioSoundInstance]"};p._removeLooping=function(){if(this._playbackResource==null){return}this._playbackResource.loop=false;this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false)};p._addLooping=function(){if(this._playbackResource==null||this._audioSpriteStopTime){return}this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);this._playbackResource.loop=true};p._handleCleanUp=function(){var tag=this._playbackResource;if(tag!=null){tag.pause();tag.loop=false;tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);tag.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false);try{tag.currentTime=this._startTime}catch(e){}createjs.HTMLAudioTagPool.set(this.src,tag);this._playbackResource=null}};p._beginPlaying=function(playProps){this._playbackResource=createjs.HTMLAudioTagPool.get(this.src);return this.AbstractSoundInstance__beginPlaying(playProps)};p._handleSoundReady=function(event){if(this._playbackResource.readyState!==4){var tag=this._playbackResource;tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);tag.preload="auto";tag.load();return}this._updateVolume();this._playbackResource.currentTime=(this._startTime+this._position)*0.001;if(this._audioSpriteStopTime){this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false)}else{this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);if(this._loop!=0){this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);this._playbackResource.loop=true}}this._playbackResource.play()};p._handleTagReady=function(event){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,false);this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,false);this._handleSoundReady()};p._pause=function(){this._playbackResource.pause()};p._resume=function(){this._playbackResource.play()};p._updateVolume=function(){if(this._playbackResource!=null){var newVolume=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;if(newVolume!=this._playbackResource.volume){this._playbackResource.volume=newVolume}}};p._calculateCurrentPosition=function(){return this._playbackResource.currentTime*1000-this._startTime};p._updatePosition=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false);this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,false);try{this._playbackResource.currentTime=(this._position+this._startTime)*0.001}catch(error){this._handleSetPositionSeek(null)}};p._handleSetPositionSeek=function(event){if(this._playbackResource==null){return}this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,false);this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false)};p._handleAudioSpriteLoop=function(event){if(this._playbackResource.currentTime<=this._audioSpriteStopTime){return}this._playbackResource.pause();if(this._loop==0){this._handleSoundComplete(null)}else{this._position=0;this._loop--;this._playbackResource.currentTime=this._startTime*0.001;if(!this._paused){this._playbackResource.play()}this._sendEvent("loop")}};p._handleLoop=function(event){if(this._loop==0){this._playbackResource.loop=false;this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,false)}};p._updateStartTime=function(){this._audioSpriteStopTime=(this._startTime+this._duration)*0.001;if(this.playState==createjs.Sound.PLAY_SUCCEEDED){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false)}};p._updateDuration=function(){this._audioSpriteStopTime=(this._startTime+this._duration)*0.001;if(this.playState==createjs.Sound.PLAY_SUCCEEDED){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,false);this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,false)}};p._setDurationFromSource=function(){this._duration=createjs.HTMLAudioTagPool.getDuration(this.src);this._playbackResource=null};createjs.HTMLAudioSoundInstance=createjs.promote(HTMLAudioSoundInstance,"AbstractSoundInstance")})();window.createjs=window.createjs||{};(function(){"use strict";function HTMLAudioPlugin(){this.AbstractPlugin_constructor();this._capabilities=s._capabilities;this._loaderClass=createjs.SoundLoader;this._soundInstanceClass=createjs.HTMLAudioSoundInstance}var p=createjs.extend(HTMLAudioPlugin,createjs.AbstractPlugin);var s=HTMLAudioPlugin;s.MAX_INSTANCES=30;s._AUDIO_READY="canplaythrough";s._AUDIO_ENDED="ended";s._AUDIO_SEEKED="seeked";s._AUDIO_STALLED="stalled";s._TIME_UPDATE="timeupdate";s._capabilities=null;s.isSupported=function(){s._generateCapabilities();return s._capabilities!=null};s._generateCapabilities=function(){if(s._capabilities!=null){return}var t=document.createElement("audio");if(t.canPlayType==null){return null}s._capabilities={panning:false,volume:true,tracks:-1};var supportedExtensions=createjs.Sound.SUPPORTED_EXTENSIONS;var extensionMap=createjs.Sound.EXTENSION_MAP;for(var i=0,l=supportedExtensions.length;i<l;i++){var ext=supportedExtensions[i];var playType=extensionMap[ext]||ext;s._capabilities[ext]=t.canPlayType("audio/"+ext)!="no"&&t.canPlayType("audio/"+ext)!=""||t.canPlayType("audio/"+playType)!="no"&&t.canPlayType("audio/"+playType)!=""}};p.register=function(loadItem){var tag=createjs.HTMLAudioTagPool.get(loadItem.src);var loader=this.AbstractPlugin_register(loadItem);loader.setTag(tag);return loader};p.removeSound=function(src){this.AbstractPlugin_removeSound(src);createjs.HTMLAudioTagPool.remove(src)};p.create=function(src,startTime,duration){var si=this.AbstractPlugin_create(src,startTime,duration);si.playbackResource=null;return si};p.toString=function(){return"[HTMLAudioPlugin]"};p.setVolume=p.getVolume=p.setMute=null;createjs.HTMLAudioPlugin=createjs.promote(HTMLAudioPlugin,"AbstractPlugin")})();!function(e){"use strict";var i=-1,t={onVisible:function(e){var i=t.isSupported();if(!i||!t.hidden())return e(),i;var n=t.change(function(i,r){t.hidden()||(t.unbind(n),e())});return n},change:function(e){if(!t.isSupported())return!1;i+=1;var n=i;return t._callbacks[n]=e,t._listen(),n},unbind:function(e){delete t._callbacks[e]},afterPrerendering:function(e){var i=t.isSupported(),n="prerender";if(!i||n!=t.state())return e(),i;var r=t.change(function(i,d){n!=d&&(t.unbind(r),e())});return r},hidden:function(){return!(!t._doc.hidden&&!t._doc.webkitHidden)},state:function(){return t._doc.visibilityState||t._doc.webkitVisibilityState||"visible"},isSupported:function(){return!(!t._doc.visibilityState&&!t._doc.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(e){var i=t.state();for(var n in t._callbacks)t._callbacks[n].call(t._doc,e,i)},_listen:function(){if(!t._init){var e="visibilitychange";t._doc.webkitVisibilityState&&(e="webkit"+e);var i=function(){t._change.apply(t,arguments)};t._doc.addEventListener?t._doc.addEventListener(e,i):t._doc.attachEvent(e,i),t._init=!0}}};"undefined"!=typeof module&&module.exports?module.exports=t:e.Visibility=t}(this),function(e){"use strict";var i=-1,t=function(t){return t.every=function(e,n,r){t._time(),r||(r=n,n=null),i+=1;var d=i;return t._timers[d]={visible:e,hidden:n,callback:r},t._run(d,!1),t.isSupported()&&t._listen(),d},t.stop=function(e){return t._timers[e]?(t._stop(e),delete t._timers[e],!0):!1},t._timers={},t._time=function(){t._timed||(t._timed=!0,t._wasHidden=t.hidden(),t.change(function(){t._stopRun(),t._wasHidden=t.hidden()}))},t._run=function(i,n){var r,d=t._timers[i];if(t.hidden()){if(null===d.hidden)return;r=d.hidden}else r=d.visible;var a=function(){d.last=new Date,d.callback.call(e)};if(n){var o=new Date,c=o-d.last;r>c?d.delay=setTimeout(function(){a(),d.id=setInterval(a,r)},r-c):(a(),d.id=setInterval(a,r))}else d.id=setInterval(a,r)},t._stop=function(e){var i=t._timers[e];clearInterval(i.id),clearTimeout(i.delay),delete i.id,delete i.delay},t._stopRun=function(e){var i=t.hidden(),n=t._wasHidden;if(i&&!n||!i&&n)for(var r in t._timers)t._stop(r),t._run(r,!i)},t};"undefined"!=typeof module&&module.exports?module.exports=t(require("./visibility.core")):t(e.Visibility)}(window);!function(A,e,n){function a(A){var e=u.className,n=Modernizr._config.classPrefix||"";if(c&&(e=e.baseVal),Modernizr._config.enableJSClass){var a=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");e=e.replace(a,"$1"+n+"js$2")}Modernizr._config.enableClasses&&(e+=" "+n+A.join(" "+n),c?u.className.baseVal=e:u.className=e)}function o(A,e){return typeof A===e}function s(){var A,e,n,a,s,t,r;for(var f in l)if(l.hasOwnProperty(f)){if(A=[],e=l[f],e.name&&(A.push(e.name.toLowerCase()),e.options&&e.options.aliases&&e.options.aliases.length))for(n=0;n<e.options.aliases.length;n++)A.push(e.options.aliases[n].toLowerCase());for(a=o(e.fn,"function")?e.fn():e.fn,s=0;s<A.length;s++)t=A[s],r=t.split("."),1===r.length?Modernizr[r[0]]=a:(!Modernizr[r[0]]||Modernizr[r[0]]instanceof Boolean||(Modernizr[r[0]]=new Boolean(Modernizr[r[0]])),Modernizr[r[0]][r[1]]=a),i.push((a?"":"no-")+r.join("-"))}}function t(A,e){if("object"==typeof A)for(var n in A)f(A,n)&&t(n,A[n]);else{A=A.toLowerCase();var o=A.split("."),s=Modernizr[o[0]];if(2==o.length&&(s=s[o[1]]),"undefined"!=typeof s)return Modernizr;e="function"==typeof e?e():e,1==o.length?Modernizr[o[0]]=e:(!Modernizr[o[0]]||Modernizr[o[0]]instanceof Boolean||(Modernizr[o[0]]=new Boolean(Modernizr[o[0]])),Modernizr[o[0]][o[1]]=e),a([(e&&0!=e?"":"no-")+o.join("-")]),Modernizr._trigger(A,e)}return Modernizr}var i=[],l=[],r={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(A,e){var n=this;setTimeout(function(){e(n[A])},0)},addTest:function(A,e,n){l.push({name:A,fn:e,options:n})},addAsyncTest:function(A){l.push({name:null,fn:A})}},Modernizr=function(){};Modernizr.prototype=r,Modernizr=new Modernizr;var f,u=e.documentElement,c="svg"===u.nodeName.toLowerCase();!function(){var A={}.hasOwnProperty;f=o(A,"undefined")||o(A.call,"undefined")?function(A,e){return e in A&&o(A.constructor.prototype[e],"undefined")}:function(e,n){return A.call(e,n)}}(),r._l={},r.on=function(A,e){this._l[A]||(this._l[A]=[]),this._l[A].push(e),Modernizr.hasOwnProperty(A)&&setTimeout(function(){Modernizr._trigger(A,Modernizr[A])},0)},r._trigger=function(A,e){if(this._l[A]){var n=this._l[A];setTimeout(function(){var A,a;for(A=0;A<n.length;A++)(a=n[A])(e)},0),delete this._l[A]}},Modernizr._q.push(function(){r.addTest=t}),Modernizr.addAsyncTest(function(){var A=new Image;A.onerror=function(){t("webplossless",!1,{aliases:["webp-lossless"]})},A.onload=function(){t("webplossless",1==A.width,{aliases:["webp-lossless"]})},A.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="}),Modernizr.addAsyncTest(function(){var A=new Image;A.onerror=function(){t("webpalpha",!1,{aliases:["webp-alpha"]})},A.onload=function(){t("webpalpha",1==A.width,{aliases:["webp-alpha"]})},A.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA=="}),Modernizr.addAsyncTest(function(){function A(A,e,n){function a(e){var a=e&&"load"===e.type?1==o.width:!1,s="webp"===A;t(A,s&&a?new Boolean(a):a),n&&n(e)}var o=new Image;o.onerror=a,o.onload=a,o.src=e}var e=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],n=e.shift();A(n.name,n.uri,function(n){if(n&&"load"===n.type)for(var a=0;a<e.length;a++)A(e[a].name,e[a].uri)})}),s(),a(i),delete r.addTest,delete r.addAsyncTest;for(var p=0;p<Modernizr._q.length;p++)Modernizr._q[p]();A.Modernizr=Modernizr}(window,document);var PIXI=function(exports){"use strict";var ENV=(ENV2=>(ENV2[ENV2.WEBGL_LEGACY=0]="WEBGL_LEGACY",ENV2[ENV2.WEBGL=1]="WEBGL",ENV2[ENV2.WEBGL2=2]="WEBGL2",ENV2))(ENV||{}),RENDERER_TYPE=(RENDERER_TYPE2=>(RENDERER_TYPE2[RENDERER_TYPE2.UNKNOWN=0]="UNKNOWN",RENDERER_TYPE2[RENDERER_TYPE2.WEBGL=1]="WEBGL",RENDERER_TYPE2[RENDERER_TYPE2.CANVAS=2]="CANVAS",RENDERER_TYPE2))(RENDERER_TYPE||{}),BUFFER_BITS=(BUFFER_BITS2=>(BUFFER_BITS2[BUFFER_BITS2.COLOR=16384]="COLOR",BUFFER_BITS2[BUFFER_BITS2.DEPTH=256]="DEPTH",BUFFER_BITS2[BUFFER_BITS2.STENCIL=1024]="STENCIL",BUFFER_BITS2))(BUFFER_BITS||{}),BLEND_MODES=(BLEND_MODES2=>(BLEND_MODES2[BLEND_MODES2.NORMAL=0]="NORMAL",BLEND_MODES2[BLEND_MODES2.ADD=1]="ADD",BLEND_MODES2[BLEND_MODES2.MULTIPLY=2]="MULTIPLY",BLEND_MODES2[BLEND_MODES2.SCREEN=3]="SCREEN",BLEND_MODES2[BLEND_MODES2.OVERLAY=4]="OVERLAY",BLEND_MODES2[BLEND_MODES2.DARKEN=5]="DARKEN",BLEND_MODES2[BLEND_MODES2.LIGHTEN=6]="LIGHTEN",BLEND_MODES2[BLEND_MODES2.COLOR_DODGE=7]="COLOR_DODGE",BLEND_MODES2[BLEND_MODES2.COLOR_BURN=8]="COLOR_BURN",BLEND_MODES2[BLEND_MODES2.HARD_LIGHT=9]="HARD_LIGHT",BLEND_MODES2[BLEND_MODES2.SOFT_LIGHT=10]="SOFT_LIGHT",BLEND_MODES2[BLEND_MODES2.DIFFERENCE=11]="DIFFERENCE",BLEND_MODES2[BLEND_MODES2.EXCLUSION=12]="EXCLUSION",BLEND_MODES2[BLEND_MODES2.HUE=13]="HUE",BLEND_MODES2[BLEND_MODES2.SATURATION=14]="SATURATION",BLEND_MODES2[BLEND_MODES2.COLOR=15]="COLOR",BLEND_MODES2[BLEND_MODES2.LUMINOSITY=16]="LUMINOSITY",BLEND_MODES2[BLEND_MODES2.NORMAL_NPM=17]="NORMAL_NPM",BLEND_MODES2[BLEND_MODES2.ADD_NPM=18]="ADD_NPM",BLEND_MODES2[BLEND_MODES2.SCREEN_NPM=19]="SCREEN_NPM",BLEND_MODES2[BLEND_MODES2.NONE=20]="NONE",BLEND_MODES2[BLEND_MODES2.SRC_OVER=0]="SRC_OVER",BLEND_MODES2[BLEND_MODES2.SRC_IN=21]="SRC_IN",BLEND_MODES2[BLEND_MODES2.SRC_OUT=22]="SRC_OUT",BLEND_MODES2[BLEND_MODES2.SRC_ATOP=23]="SRC_ATOP",BLEND_MODES2[BLEND_MODES2.DST_OVER=24]="DST_OVER",BLEND_MODES2[BLEND_MODES2.DST_IN=25]="DST_IN",BLEND_MODES2[BLEND_MODES2.DST_OUT=26]="DST_OUT",BLEND_MODES2[BLEND_MODES2.DST_ATOP=27]="DST_ATOP",BLEND_MODES2[BLEND_MODES2.ERASE=26]="ERASE",BLEND_MODES2[BLEND_MODES2.SUBTRACT=28]="SUBTRACT",BLEND_MODES2[BLEND_MODES2.XOR=29]="XOR",BLEND_MODES2))(BLEND_MODES||{}),DRAW_MODES=(DRAW_MODES2=>(DRAW_MODES2[DRAW_MODES2.POINTS=0]="POINTS",DRAW_MODES2[DRAW_MODES2.LINES=1]="LINES",DRAW_MODES2[DRAW_MODES2.LINE_LOOP=2]="LINE_LOOP",DRAW_MODES2[DRAW_MODES2.LINE_STRIP=3]="LINE_STRIP",DRAW_MODES2[DRAW_MODES2.TRIANGLES=4]="TRIANGLES",DRAW_MODES2[DRAW_MODES2.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",DRAW_MODES2[DRAW_MODES2.TRIANGLE_FAN=6]="TRIANGLE_FAN",DRAW_MODES2))(DRAW_MODES||{}),FORMATS=(FORMATS2=>(FORMATS2[FORMATS2.RGBA=6408]="RGBA",FORMATS2[FORMATS2.RGB=6407]="RGB",FORMATS2[FORMATS2.RG=33319]="RG",FORMATS2[FORMATS2.RED=6403]="RED",FORMATS2[FORMATS2.RGBA_INTEGER=36249]="RGBA_INTEGER",FORMATS2[FORMATS2.RGB_INTEGER=36248]="RGB_INTEGER",FORMATS2[FORMATS2.RG_INTEGER=33320]="RG_INTEGER",FORMATS2[FORMATS2.RED_INTEGER=36244]="RED_INTEGER",FORMATS2[FORMATS2.ALPHA=6406]="ALPHA",FORMATS2[FORMATS2.LUMINANCE=6409]="LUMINANCE",FORMATS2[FORMATS2.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",FORMATS2[FORMATS2.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",FORMATS2[FORMATS2.DEPTH_STENCIL=34041]="DEPTH_STENCIL",FORMATS2))(FORMATS||{}),TARGETS=(TARGETS2=>(TARGETS2[TARGETS2.TEXTURE_2D=3553]="TEXTURE_2D",TARGETS2[TARGETS2.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",TARGETS2[TARGETS2.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",TARGETS2[TARGETS2.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",TARGETS2[TARGETS2.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",TARGETS2[TARGETS2.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",TARGETS2[TARGETS2.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",TARGETS2[TARGETS2.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",TARGETS2[TARGETS2.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",TARGETS2))(TARGETS||{}),TYPES=(TYPES2=>(TYPES2[TYPES2.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",TYPES2[TYPES2.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",TYPES2[TYPES2.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",TYPES2[TYPES2.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",TYPES2[TYPES2.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",TYPES2[TYPES2.UNSIGNED_INT=5125]="UNSIGNED_INT",TYPES2[TYPES2.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",TYPES2[TYPES2.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",TYPES2[TYPES2.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",TYPES2[TYPES2.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",TYPES2[TYPES2.BYTE=5120]="BYTE",TYPES2[TYPES2.SHORT=5122]="SHORT",TYPES2[TYPES2.INT=5124]="INT",TYPES2[TYPES2.FLOAT=5126]="FLOAT",TYPES2[TYPES2.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",TYPES2[TYPES2.HALF_FLOAT=36193]="HALF_FLOAT",TYPES2))(TYPES||{}),SAMPLER_TYPES=(SAMPLER_TYPES2=>(SAMPLER_TYPES2[SAMPLER_TYPES2.FLOAT=0]="FLOAT",SAMPLER_TYPES2[SAMPLER_TYPES2.INT=1]="INT",SAMPLER_TYPES2[SAMPLER_TYPES2.UINT=2]="UINT",SAMPLER_TYPES2))(SAMPLER_TYPES||{}),SCALE_MODES=(SCALE_MODES2=>(SCALE_MODES2[SCALE_MODES2.NEAREST=0]="NEAREST",SCALE_MODES2[SCALE_MODES2.LINEAR=1]="LINEAR",SCALE_MODES2))(SCALE_MODES||{}),WRAP_MODES=(WRAP_MODES2=>(WRAP_MODES2[WRAP_MODES2.CLAMP=33071]="CLAMP",WRAP_MODES2[WRAP_MODES2.REPEAT=10497]="REPEAT",WRAP_MODES2[WRAP_MODES2.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",WRAP_MODES2))(WRAP_MODES||{}),MIPMAP_MODES=(MIPMAP_MODES2=>(MIPMAP_MODES2[MIPMAP_MODES2.OFF=0]="OFF",MIPMAP_MODES2[MIPMAP_MODES2.POW2=1]="POW2",MIPMAP_MODES2[MIPMAP_MODES2.ON=2]="ON",MIPMAP_MODES2[MIPMAP_MODES2.ON_MANUAL=3]="ON_MANUAL",MIPMAP_MODES2))(MIPMAP_MODES||{}),ALPHA_MODES=(ALPHA_MODES2=>(ALPHA_MODES2[ALPHA_MODES2.NPM=0]="NPM",ALPHA_MODES2[ALPHA_MODES2.UNPACK=1]="UNPACK",ALPHA_MODES2[ALPHA_MODES2.PMA=2]="PMA",ALPHA_MODES2[ALPHA_MODES2.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ALPHA_MODES2[ALPHA_MODES2.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ALPHA_MODES2[ALPHA_MODES2.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",ALPHA_MODES2))(ALPHA_MODES||{}),CLEAR_MODES=(CLEAR_MODES2=>(CLEAR_MODES2[CLEAR_MODES2.NO=0]="NO",CLEAR_MODES2[CLEAR_MODES2.YES=1]="YES",CLEAR_MODES2[CLEAR_MODES2.AUTO=2]="AUTO",CLEAR_MODES2[CLEAR_MODES2.BLEND=0]="BLEND",CLEAR_MODES2[CLEAR_MODES2.CLEAR=1]="CLEAR",CLEAR_MODES2[CLEAR_MODES2.BLIT=2]="BLIT",CLEAR_MODES2))(CLEAR_MODES||{}),GC_MODES=(GC_MODES2=>(GC_MODES2[GC_MODES2.AUTO=0]="AUTO",GC_MODES2[GC_MODES2.MANUAL=1]="MANUAL",GC_MODES2))(GC_MODES||{}),PRECISION=(PRECISION2=>(PRECISION2.LOW="lowp",PRECISION2.MEDIUM="mediump",PRECISION2.HIGH="highp",PRECISION2))(PRECISION||{}),MASK_TYPES=(MASK_TYPES2=>(MASK_TYPES2[MASK_TYPES2.NONE=0]="NONE",MASK_TYPES2[MASK_TYPES2.SCISSOR=1]="SCISSOR",MASK_TYPES2[MASK_TYPES2.STENCIL=2]="STENCIL",MASK_TYPES2[MASK_TYPES2.SPRITE=3]="SPRITE",MASK_TYPES2[MASK_TYPES2.COLOR=4]="COLOR",MASK_TYPES2))(MASK_TYPES||{}),COLOR_MASK_BITS=(COLOR_MASK_BITS2=>(COLOR_MASK_BITS2[COLOR_MASK_BITS2.RED=1]="RED",COLOR_MASK_BITS2[COLOR_MASK_BITS2.GREEN=2]="GREEN",COLOR_MASK_BITS2[COLOR_MASK_BITS2.BLUE=4]="BLUE",COLOR_MASK_BITS2[COLOR_MASK_BITS2.ALPHA=8]="ALPHA",COLOR_MASK_BITS2))(COLOR_MASK_BITS||{}),MSAA_QUALITY=(MSAA_QUALITY2=>(MSAA_QUALITY2[MSAA_QUALITY2.NONE=0]="NONE",MSAA_QUALITY2[MSAA_QUALITY2.LOW=2]="LOW",MSAA_QUALITY2[MSAA_QUALITY2.MEDIUM=4]="MEDIUM",MSAA_QUALITY2[MSAA_QUALITY2.HIGH=8]="HIGH",MSAA_QUALITY2))(MSAA_QUALITY||{}),BUFFER_TYPE=(BUFFER_TYPE2=>(BUFFER_TYPE2[BUFFER_TYPE2.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",BUFFER_TYPE2[BUFFER_TYPE2.ARRAY_BUFFER=34962]="ARRAY_BUFFER",BUFFER_TYPE2[BUFFER_TYPE2.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",BUFFER_TYPE2))(BUFFER_TYPE||{});const BrowserAdapter={createCanvas:(width,height)=>{const canvas=document.createElement("canvas");return canvas.width=width,canvas.height=height,canvas},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var _a2;return(_a2=document.baseURI)!=null?_a2:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(url2,options)=>fetch(url2,options),parseXML:xml=>new DOMParser().parseFromString(xml,"text/xml")},settings={ADAPTER:BrowserAdapter,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(navigator2){return typeof navigator2!="undefined"&&navigator2.platform==="MacIntel"&&typeof navigator2.maxTouchPoints=="number"&&navigator2.maxTouchPoints>1&&typeof MSStream=="undefined"};function createMatch(userAgent){return function(regex){return regex.test(userAgent)}}function isMobile$1(param){var nav={userAgent:"",platform:"",maxTouchPoints:0};!param&&typeof navigator!="undefined"?nav={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof param=="string"?nav.userAgent=param:param&&param.userAgent&&(nav={userAgent:param.userAgent,platform:param.platform,maxTouchPoints:param.maxTouchPoints||0});var userAgent=nav.userAgent,tmp=userAgent.split("[FBAN");typeof tmp[1]!="undefined"&&(userAgent=tmp[0]),tmp=userAgent.split("Twitter"),typeof tmp[1]!="undefined"&&(userAgent=tmp[0]);var match=createMatch(userAgent),result={apple:{phone:match(appleIphone)&&!match(windowsPhone),ipod:match(appleIpod),tablet:!match(appleIphone)&&(match(appleTablet)||isAppleTabletOnIos13(nav))&&!match(windowsPhone),universal:match(appleUniversal),device:(match(appleIphone)||match(appleIpod)||match(appleTablet)||match(appleUniversal)||isAppleTabletOnIos13(nav))&&!match(windowsPhone)},amazon:{phone:match(amazonPhone),tablet:!match(amazonPhone)&&match(amazonTablet),device:match(amazonPhone)||match(amazonTablet)},android:{phone:!match(windowsPhone)&&match(amazonPhone)||!match(windowsPhone)&&match(androidPhone),tablet:!match(windowsPhone)&&!match(amazonPhone)&&!match(androidPhone)&&(match(amazonTablet)||match(androidTablet)),device:!match(windowsPhone)&&(match(amazonPhone)||match(amazonTablet)||match(androidPhone)||match(androidTablet))||match(/\bokhttp\b/i)},windows:{phone:match(windowsPhone),tablet:match(windowsTablet),device:match(windowsPhone)||match(windowsTablet)},other:{blackberry:match(otherBlackBerry),blackberry10:match(otherBlackBerry10),opera:match(otherOpera),firefox:match(otherFirefox),chrome:match(otherChrome),device:match(otherBlackBerry)||match(otherBlackBerry10)||match(otherOpera)||match(otherFirefox)||match(otherChrome)},any:!1,phone:!1,tablet:!1};return result.any=result.apple.device||result.android.device||result.windows.device||result.other.device,result.phone=result.apple.phone||result.android.phone||result.windows.phone,result.tablet=result.apple.tablet||result.android.tablet||result.windows.tablet,result}var _a;const isMobile=((_a=isMobile$1.default)!=null?_a:isMobile$1)(globalThis.navigator);settings.RETINA_PREFIX=/@([0-9\.]+)x/,settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getDefaultExportFromCjs(x2){return x2&&x2.__esModule&&Object.prototype.hasOwnProperty.call(x2,"default")?x2.default:x2}function getDefaultExportFromNamespaceIfPresent(n2){return n2&&Object.prototype.hasOwnProperty.call(n2,"default")?n2.default:n2}function getDefaultExportFromNamespaceIfNotNamed(n2){return n2&&Object.prototype.hasOwnProperty.call(n2,"default")&&Object.keys(n2).length===1?n2.default:n2}function getAugmentedNamespace(n2){if(n2.__esModule)return n2;var f2=n2.default;if(typeof f2=="function"){var a2=function a3(){if(this instanceof a3){var args=[null];args.push.apply(args,arguments);var Ctor=Function.bind.apply(f2,args);return new Ctor}return f2.apply(this,arguments)};a2.prototype=f2.prototype}else a2={};return Object.defineProperty(a2,"__esModule",{value:!0}),Object.keys(n2).forEach(function(k2){var d2=Object.getOwnPropertyDescriptor(n2,k2);Object.defineProperty(a2,k2,d2.get?d2:{enumerable:!0,get:function(){return n2[k2]}})}),a2}var eventemitter3$1={exports:{}},eventemitter3=eventemitter3$1.exports;(function(module){"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}Object.create&&(Events.prototype=Object.create(null),new Events().__proto__||(prefix=!1));function EE(fn,context2,once){this.fn=fn,this.context=context2,this.once=once||!1}function addListener(emitter,event,fn,context2,once){if(typeof fn!="function")throw new TypeError("The listener must be a function");var listener=new EE(fn,context2||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){--emitter._eventsCount===0?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter2(){this._events=new Events,this._eventsCount=0}EventEmitter2.prototype.eventNames=function(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter2.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i2=0,l2=handlers.length,ee=new Array(l2);i2<l2;i2++)ee[i2]=handlers[i2].fn;return ee},EventEmitter2.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter2.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var listeners=this._events[evt],len=arguments.length,args,i2;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i2=1,args=new Array(len-1);i2<len;i2++)args[i2-1]=arguments[i2];listeners.fn.apply(listeners.context,args)}else{var length=listeners.length,j2;for(i2=0;i2<length;i2++)switch(listeners[i2].once&&this.removeListener(event,listeners[i2].fn,void 0,!0),len){case 1:listeners[i2].fn.call(listeners[i2].context);break;case 2:listeners[i2].fn.call(listeners[i2].context,a1);break;case 3:listeners[i2].fn.call(listeners[i2].context,a1,a2);break;case 4:listeners[i2].fn.call(listeners[i2].context,a1,a2,a3);break;default:if(!args)for(j2=1,args=new Array(len-1);j2<len;j2++)args[j2-1]=arguments[j2];listeners[i2].fn.apply(listeners[i2].context,args)}}return!0},EventEmitter2.prototype.on=function(event,fn,context2){return addListener(this,event,fn,context2,!1)},EventEmitter2.prototype.once=function(event,fn,context2){return addListener(this,event,fn,context2,!0)},EventEmitter2.prototype.removeListener=function(event,fn,context2,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn===fn&&(!once||listeners.once)&&(!context2||listeners.context===context2)&&clearEvent(this,evt);else{for(var i2=0,events=[],length=listeners.length;i2<length;i2++)(listeners[i2].fn!==fn||once&&!listeners[i2].once||context2&&listeners[i2].context!==context2)&&events.push(listeners[i2]);events.length?this._events[evt]=events.length===1?events[0]:events:clearEvent(this,evt)}return this},EventEmitter2.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter2.prototype.off=EventEmitter2.prototype.removeListener,EventEmitter2.prototype.addListener=EventEmitter2.prototype.on,EventEmitter2.prefixed=prefix,EventEmitter2.EventEmitter=EventEmitter2,module.exports=EventEmitter2})(eventemitter3$1);var eventemitter3Exports=eventemitter3$1.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports),earcut$2={exports:{}},earcut_1=earcut$2.exports;earcut$2.exports=earcut;var _default=earcut$2.exports.default=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;var minX,minY,maxX,maxY,x2,y2,invSize;if(hasHoles&&(outerNode=eliminateHoles(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i2=dim;i2<outerLen;i2+=dim)x2=data[i2],y2=data[i2+1],x2<minX&&(minX=x2),y2<minY&&(minY=y2),x2>maxX&&(maxX=x2),y2>maxY&&(maxY=y2);invSize=Math.max(maxX-minX,maxY-minY),invSize=invSize!==0?32767/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize,0),triangles}function linkedList(data,start,end,dim,clockwise){var i2,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i2=start;i2<end;i2+=dim)last=insertNode(i2,data[i2],data[i2+1],last);else for(i2=end-dim;i2>=start;i2-=dim)last=insertNode(i2,data[i2],data[i2+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var p2=start,again;do if(again=!1,!p2.steiner&&(equals(p2,p2.next)||area(p2.prev,p2,p2.next)===0)){if(removeNode(p2),p2=end=p2.prev,p2===p2.next)break;again=!0}else p2=p2.next;while(again||p2!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&indexCurve(ear,minX,minY,invSize);for(var stop=ear,prev,next;ear.prev!==ear.next;){if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){triangles.push(prev.i/dim|0),triangles.push(ear.i/dim|0),triangles.push(next.i/dim|0),removeNode(ear),ear=next.next,stop=next.next;continue}if(ear=next,ear===stop){pass?pass===1?(ear=cureLocalIntersections(filterPoints(ear),triangles,dim),earcutLinked(ear,triangles,dim,minX,minY,invSize,2)):pass===2&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}}function isEar(ear){var a2=ear.prev,b2=ear,c2=ear.next;if(area(a2,b2,c2)>=0)return!1;for(var ax=a2.x,bx=b2.x,cx=c2.x,ay=a2.y,by=b2.y,cy=c2.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,p2=c2.next;p2!==a2;){if(p2.x>=x0&&p2.x<=x1&&p2.y>=y0&&p2.y<=y1&&pointInTriangle(ax,ay,bx,by,cx,cy,p2.x,p2.y)&&area(p2.prev,p2,p2.next)>=0)return!1;p2=p2.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a2=ear.prev,b2=ear,c2=ear.next;if(area(a2,b2,c2)>=0)return!1;for(var ax=a2.x,bx=b2.x,cx=c2.x,ay=a2.y,by=b2.y,cy=c2.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,minZ=zOrder(x0,y0,minX,minY,invSize),maxZ=zOrder(x1,y1,minX,minY,invSize),p2=ear.prevZ,n2=ear.nextZ;p2&&p2.z>=minZ&&n2&&n2.z<=maxZ;){if(p2.x>=x0&&p2.x<=x1&&p2.y>=y0&&p2.y<=y1&&p2!==a2&&p2!==c2&&pointInTriangle(ax,ay,bx,by,cx,cy,p2.x,p2.y)&&area(p2.prev,p2,p2.next)>=0||(p2=p2.prevZ,n2.x>=x0&&n2.x<=x1&&n2.y>=y0&&n2.y<=y1&&n2!==a2&&n2!==c2&&pointInTriangle(ax,ay,bx,by,cx,cy,n2.x,n2.y)&&area(n2.prev,n2,n2.next)>=0))return!1;n2=n2.nextZ}for(;p2&&p2.z>=minZ;){if(p2.x>=x0&&p2.x<=x1&&p2.y>=y0&&p2.y<=y1&&p2!==a2&&p2!==c2&&pointInTriangle(ax,ay,bx,by,cx,cy,p2.x,p2.y)&&area(p2.prev,p2,p2.next)>=0)return!1;p2=p2.prevZ}for(;n2&&n2.z<=maxZ;){if(n2.x>=x0&&n2.x<=x1&&n2.y>=y0&&n2.y<=y1&&n2!==a2&&n2!==c2&&pointInTriangle(ax,ay,bx,by,cx,cy,n2.x,n2.y)&&area(n2.prev,n2,n2.next)>=0)return!1;n2=n2.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p2=start;do{var a2=p2.prev,b2=p2.next.next;!equals(a2,b2)&&intersects(a2,p2,p2.next,b2)&&locallyInside(a2,b2)&&locallyInside(b2,a2)&&(triangles.push(a2.i/dim|0),triangles.push(p2.i/dim|0),triangles.push(b2.i/dim|0),removeNode(p2),removeNode(p2.next),p2=start=b2),p2=p2.next}while(p2!==start);return filterPoints(p2)}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a2=start;do{for(var b2=a2.next.next;b2!==a2.prev;){if(a2.i!==b2.i&&isValidDiagonal(a2,b2)){var c2=splitPolygon(a2,b2);a2=filterPoints(a2,a2.next),c2=filterPoints(c2,c2.next),earcutLinked(a2,triangles,dim,minX,minY,invSize,0),earcutLinked(c2,triangles,dim,minX,minY,invSize,0);return}b2=b2.next}a2=a2.next}while(a2!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i2,len,start,end,list;for(i2=0,len=holeIndices.length;i2<len;i2++)start=holeIndices[i2]*dim,end=i2<len-1?holeIndices[i2+1]*dim:data.length,list=linkedList(data,start,end,dim,!1),list===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i2=0;i2<queue.length;i2++)outerNode=eliminateHole(queue[i2],outerNode);return outerNode}function compareX(a2,b2){return a2.x-b2.x}function eliminateHole(hole,outerNode){var bridge=findHoleBridge(hole,outerNode);if(!bridge)return outerNode;var bridgeReverse=splitPolygon(bridge,hole);return filterPoints(bridgeReverse,bridgeReverse.next),filterPoints(bridge,bridge.next)}function findHoleBridge(hole,outerNode){var p2=outerNode,hx=hole.x,hy=hole.y,qx=-1/0,m2;do{if(hy<=p2.y&&hy>=p2.next.y&&p2.next.y!==p2.y){var x2=p2.x+(hy-p2.y)*(p2.next.x-p2.x)/(p2.next.y-p2.y);if(x2<=hx&&x2>qx&&(qx=x2,m2=p2.x<p2.next.x?p2:p2.next,x2===hx))return m2}p2=p2.next}while(p2!==outerNode);if(!m2)return null;var stop=m2,mx=m2.x,my=m2.y,tanMin=1/0,tan;p2=m2;do hx>=p2.x&&p2.x>=mx&&hx!==p2.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p2.x,p2.y)&&(tan=Math.abs(hy-p2.y)/(hx-p2.x),locallyInside(p2,hole)&&(tan<tanMin||tan===tanMin&&(p2.x>m2.x||p2.x===m2.x&&sectorContainsSector(m2,p2)))&&(m2=p2,tanMin=tan)),p2=p2.next;while(p2!==stop);return m2}function sectorContainsSector(m2,p2){return area(m2.prev,m2,p2.prev)<0&&area(p2.next,m2,m2.next)<0}function indexCurve(start,minX,minY,invSize){var p2=start;do p2.z===0&&(p2.z=zOrder(p2.x,p2.y,minX,minY,invSize)),p2.prevZ=p2.prev,p2.nextZ=p2.next,p2=p2.next;while(p2!==start);p2.prevZ.nextZ=null,p2.prevZ=null,sortLinked(p2)}function sortLinked(list){var i2,p2,q,e2,tail,numMerges,pSize,qSize,inSize=1;do{for(p2=list,list=null,tail=null,numMerges=0;p2;){for(numMerges++,q=p2,pSize=0,i2=0;i2<inSize&&(pSize++,q=q.nextZ,!!q);i2++);for(qSize=inSize;pSize>0||qSize>0&&q;)pSize!==0&&(qSize===0||!q||p2.z<=q.z)?(e2=p2,p2=p2.nextZ,pSize--):(e2=q,q=q.nextZ,qSize--),tail?tail.nextZ=e2:list=e2,e2.prevZ=tail,tail=e2;p2=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}function zOrder(x2,y2,minX,minY,invSize){return x2=(x2-minX)*invSize|0,y2=(y2-minY)*invSize|0,x2=(x2|x2<<8)&16711935,x2=(x2|x2<<4)&252645135,x2=(x2|x2<<2)&858993459,x2=(x2|x2<<1)&1431655765,y2=(y2|y2<<8)&16711935,y2=(y2|y2<<4)&252645135,y2=(y2|y2<<2)&858993459,y2=(y2|y2<<1)&1431655765,x2|y2<<1}function getLeftmost(start){var p2=start,leftmost=start;do(p2.x<leftmost.x||p2.x===leftmost.x&&p2.y<leftmost.y)&&(leftmost=p2),p2=p2.next;while(p2!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)>=(ax-px)*(cy-py)&&(ax-px)*(by-py)>=(bx-px)*(ay-py)&&(bx-px)*(cy-py)>=(cx-px)*(by-py)}function isValidDiagonal(a2,b2){return a2.next.i!==b2.i&&a2.prev.i!==b2.i&&!intersectsPolygon(a2,b2)&&(locallyInside(a2,b2)&&locallyInside(b2,a2)&&middleInside(a2,b2)&&(area(a2.prev,a2,b2.prev)||area(a2,b2.prev,b2))||equals(a2,b2)&&area(a2.prev,a2,a2.next)>0&&area(b2.prev,b2,b2.next)>0)}function area(p2,q,r2){return(q.y-p2.y)*(r2.x-q.x)-(q.x-p2.x)*(r2.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){var o1=sign$1(area(p1,q1,p2)),o2=sign$1(area(p1,q1,q2)),o3=sign$1(area(p2,q2,p1)),o4=sign$1(area(p2,q2,q1));return!!(o1!==o2&&o3!==o4||o1===0&&onSegment(p1,p2,q1)||o2===0&&onSegment(p1,q2,q1)||o3===0&&onSegment(p2,p1,q2)||o4===0&&onSegment(p2,q1,q2))}function onSegment(p2,q,r2){return q.x<=Math.max(p2.x,r2.x)&&q.x>=Math.min(p2.x,r2.x)&&q.y<=Math.max(p2.y,r2.y)&&q.y>=Math.min(p2.y,r2.y)}function sign$1(num){return num>0?1:num<0?-1:0}function intersectsPolygon(a2,b2){var p2=a2;do{if(p2.i!==a2.i&&p2.next.i!==a2.i&&p2.i!==b2.i&&p2.next.i!==b2.i&&intersects(p2,p2.next,a2,b2))return!0;p2=p2.next}while(p2!==a2);return!1}function locallyInside(a2,b2){return area(a2.prev,a2,a2.next)<0?area(a2,b2,a2.next)>=0&&area(a2,a2.prev,b2)>=0:area(a2,b2,a2.prev)<0||area(a2,a2.next,b2)<0}function middleInside(a2,b2){var p2=a2,inside=!1,px=(a2.x+b2.x)/2,py=(a2.y+b2.y)/2;do p2.y>py!=p2.next.y>py&&p2.next.y!==p2.y&&px<(p2.next.x-p2.x)*(py-p2.y)/(p2.next.y-p2.y)+p2.x&&(inside=!inside),p2=p2.next;while(p2!==a2);return inside}function splitPolygon(a2,b2){var a22=new Node(a2.i,a2.x,a2.y),b22=new Node(b2.i,b2.x,b2.y),an=a2.next,bp=b2.prev;return a2.next=b2,b2.prev=a2,a22.next=an,an.prev=a22,b22.next=a22,a22.prev=b22,bp.next=b22,b22.prev=bp,b22}function insertNode(i2,x2,y2,last){var p2=new Node(i2,x2,y2);return last?(p2.next=last.next,p2.prev=last,last.next.prev=p2,last.next=p2):(p2.prev=p2,p2.next=p2),p2}function removeNode(p2){p2.next.prev=p2.prev,p2.prev.next=p2.next,p2.prevZ&&(p2.prevZ.nextZ=p2.nextZ),p2.nextZ&&(p2.nextZ.prevZ=p2.prevZ)}function Node(i2,x2,y2){this.i=i2,this.x=x2,this.y=y2,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i2=0,len=holeIndices.length;i2<len;i2++){var start=holeIndices[i2]*dim,end=i2<len-1?holeIndices[i2+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}var trianglesArea=0;for(i2=0;i2<triangles.length;i2+=3){var a2=triangles[i2]*dim,b2=triangles[i2+1]*dim,c2=triangles[i2+2]*dim;trianglesArea+=Math.abs((data[a2]-data[c2])*(data[b2+1]-data[a2+1])-(data[a2]-data[b2])*(data[c2+1]-data[a2+1]))}return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/polygonArea)};function signedArea(data,start,end,dim){for(var sum=0,i2=start,j2=end-dim;i2<end;i2+=dim)sum+=(data[j2]-data[i2])*(data[i2+1]+data[j2+1]),j2=i2;return sum}earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i2=0;i2<data.length;i2++){for(var j2=0;j2<data[i2].length;j2++)for(var d2=0;d2<dim;d2++)result.vertices.push(data[i2][j2][d2]);i2>0&&(holeIndex+=data[i2-1].length,result.holes.push(holeIndex))}return result};var earcutExports=earcut$2.exports,earcut$1=getDefaultExportFromCjs(earcutExports),url$1={},punycode$3={exports:{}};var punycode$1=punycode$3.exports;(function(module,exports2){(function(root){var freeExports=exports2&&!exports2.nodeType&&exports2,freeModule=module&&!module.nodeType&&module,freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)&&(root=freeGlobal);var punycode2,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map2(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map2(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var output=[],counter=0,length=string.length,value,extra;counter<length;)value=string.charCodeAt(counter++),value>=55296&&value<=56319&&counter<length?(extra=string.charCodeAt(counter++),(extra&64512)==56320?output.push(((value&1023)<<10)+(extra&1023)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map2(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|value&1023),output+=stringFromCharCode(value),output}).join("")}function basicToDigit(codePoint){return codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k2=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k2+=base)delta=floor(delta/baseMinusTMin);return floor(k2+(baseMinusTMin+1)*delta/(delta+skew))}function decode2(input){var output=[],inputLength=input.length,out,i2=0,n2=initialN,bias=initialBias,basic,j2,index,oldi,w2,k2,digit,t2,baseMinusT;for(basic=input.lastIndexOf(delimiter),basic<0&&(basic=0),j2=0;j2<basic;++j2)input.charCodeAt(j2)>=128&&error("not-basic"),output.push(input.charCodeAt(j2));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i2,w2=1,k2=base;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=base||digit>floor((maxInt-i2)/w2))&&error("overflow"),i2+=digit*w2,t2=k2<=bias?tMin:k2>=bias+tMax?tMax:k2-bias,!(digit<t2);k2+=base)baseMinusT=base-t2,w2>floor(maxInt/baseMinusT)&&error("overflow"),w2*=baseMinusT;out=output.length+1,bias=adapt(i2-oldi,out,oldi==0),floor(i2/out)>maxInt-n2&&error("overflow"),n2+=floor(i2/out),i2%=out,output.splice(i2++,0,n2)}return ucs2encode(output)}function encode2(input){var n2,delta,handledCPCount,basicLength,bias,j2,m2,q,k2,t2,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;for(input=ucs2decode(input),inputLength=input.length,n2=initialN,delta=0,bias=initialBias,j2=0;j2<inputLength;++j2)currentValue=input[j2],currentValue<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m2=maxInt,j2=0;j2<inputLength;++j2)currentValue=input[j2],currentValue>=n2&&currentValue<m2&&(m2=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m2-n2>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m2-n2)*handledCPCountPlusOne,n2=m2,j2=0;j2<inputLength;++j2)if(currentValue=input[j2],currentValue<n2&&++delta>maxInt&&error("overflow"),currentValue==n2){for(q=delta,k2=base;t2=k2<=bias?tMin:k2>=bias+tMax?tMax:k2-bias,!(q<t2);k2+=base)qMinusT=q-t2,baseMinusT=base-t2,output.push(stringFromCharCode(digitToBasic(t2+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n2}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode2(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode2(string):string})}if(punycode2={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode2,encode:encode2,toASCII,toUnicode},freeExports&&freeModule){if(module.exports==freeExports)freeModule.exports=punycode2;else for(key in punycode2)punycode2.hasOwnProperty(key)&&(freeExports[key]=punycode2[key]);}else root.punycode=punycode2})(commonjsGlobal)})(punycode$3,punycode$3.exports);var punycodeExports=punycode$3.exports,punycode$2=getDefaultExportFromCjs(punycodeExports),util$1={isString:function(arg){return typeof arg=="string"},isObject:function(arg){return typeof arg=="object"&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}},util$2=getDefaultExportFromCjs(util$1),querystring$1={};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var decode$1=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if(typeof qs!="string"||qs.length===0)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&typeof options.maxKeys=="number"&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i2=0;i2<len;++i2){var x2=qs[i2].replace(regexp,"%20"),idx=x2.indexOf(eq),kstr,vstr,k2,v2;idx>=0?(kstr=x2.substr(0,idx),vstr=x2.substr(idx+1)):(kstr=x2,vstr=""),k2=decodeURIComponent(kstr),v2=decodeURIComponent(vstr),hasOwnProperty(obj,k2)?Array.isArray(obj[k2])?obj[k2].push(v2):obj[k2]=[obj[k2],v2]:obj[k2]=v2}return obj},decode$2=getDefaultExportFromCjs(decode$1),stringifyPrimitive=function(v2){switch(typeof v2){case"string":return v2;case"boolean":return v2?"true":"false";case"number":return isFinite(v2)?v2:"";default:return""}},encode$1=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",obj===null&&(obj=void 0),typeof obj=="object"?Object.keys(obj).map(function(k2){var ks=encodeURIComponent(stringifyPrimitive(k2))+eq;return Array.isArray(obj[k2])?obj[k2].map(function(v2){return ks+encodeURIComponent(stringifyPrimitive(v2))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k2]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""},encode$2=getDefaultExportFromCjs(encode$1),stringify,parse$1,decode=querystring$1.decode=parse$1=querystring$1.parse=decode$1,encode=querystring$1.encode=stringify=querystring$1.stringify=encode$1,punycode=punycodeExports,util=util$1,parse=url$1.parse=urlParse,resolve=url$1.resolve=urlResolve,resolveObject=url$1.resolveObject=urlResolveObject,format=url$1.format=urlFormat,Url_1=url$1.Url=Url;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">","\"","`"," ","\r",`
`,"\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=querystring$1;function urlParse(url2,parseQueryString,slashesDenoteHost){if(url2&&util.isObject(url2)&&url2 instanceof Url)return url2;var u2=new Url;return u2.parse(url2,parseQueryString,slashesDenoteHost),u2}Url.prototype.parse=function(url2,parseQueryString,slashesDenoteHost){if(!util.isString(url2))throw new TypeError("Parameter 'url' must be a string, not "+typeof url2);var queryIndex=url2.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url2.indexOf("#")?"?":"#",uSplit=url2.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/"),url2=uSplit.join(splitter);var rest=url2;if(rest=rest.trim(),!slashesDenoteHost&&url2.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],parseQueryString?this.query=querystring.parse(this.search.substr(1)):this.query=this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";slashes&&!(proto&&hostlessProtocol[proto])&&(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i2=0;i2<hostEndingChars.length;i2++){var hec=rest.indexOf(hostEndingChars[i2]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}var auth,atSign;hostEnd===-1?atSign=rest.lastIndexOf("@"):atSign=rest.lastIndexOf("@",hostEnd),atSign!==-1&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i2=0;i2<nonHostChars.length;i2++){var hec=rest.indexOf(nonHostChars[i2]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}hostEnd===-1&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i2=0,l2=hostparts.length;i2<l2;i2++){var part=hostparts[i2];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j2=0,k2=part.length;j2<k2;j2++)part.charCodeAt(j2)>127?newpart+="x":newpart+=part[j2];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i2),notHost=hostparts.slice(i2+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p2=this.port?":"+this.port:"",h2=this.hostname||"";this.host=h2+p2,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),rest[0]!=="/"&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i2=0,l2=autoEscape.length;i2<l2;i2++){var ae=autoEscape[i2];if(rest.indexOf(ae)!==-1){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");hash!==-1&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(qm!==-1?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p2=this.pathname||"",s2=this.search||"";this.path=p2+s2}return this.href=this.format(),this};function urlFormat(obj){return util.isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&protocol.substr(-1)!==":"&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&pathname.charAt(0)!=="/"&&(pathname="/"+pathname)):host||(host=""),hash&&hash.charAt(0)!=="#"&&(hash="#"+hash),search&&search.charAt(0)!=="?"&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()};function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,relative.href==="")return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];rkey!=="protocol"&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v2=0;v2<keys.length;v2++){var k2=keys[v2];result[k2]=relative[k2]}return result.href=result.format(),result}if(result.protocol=relative.protocol,!relative.host&&!hostlessProtocol[relative.protocol]){for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),relPath[0]!==""&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}else result.pathname=relative.pathname;if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p2=result.pathname||"",s2=result.search||"";result.path=p2+s2}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(srcPath[0]===""?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(relPath[0]===""?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")),isRelAbs)result.host=relative.host||relative.host===""?relative.host:result.host,result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,(!util.isNull(result.pathname)||!util.isNull(result.search))&&(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="",up=0,i2=srcPath.length;i2>=0;i2--)last=srcPath[i2],last==="."?srcPath.splice(i2,1):last===".."?(srcPath.splice(i2,1),up++):up&&(srcPath.splice(i2,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")&&srcPath.unshift(""),hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"&&srcPath.push("");var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),(!util.isNull(result.pathname)||!util.isNull(result.search))&&(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],port!==":"&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)};const warnings={};function deprecation$1(version,message,ignoreDepth=3){if(warnings[message])return;let stack=new Error().stack;typeof stack=="undefined"?console.warn("PixiJS Deprecation Warning: ",`${message}
Deprecated since v${version}`):(stack=stack.split(`
`).splice(ignoreDepth).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${message}
Deprecated since v${version}`),console.warn(stack),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${message}
Deprecated since v${version}`),console.warn(stack))),warnings[message]=!0}const url={get parse(){return deprecation$1("7.3.0","utils.url.parse is deprecated, use native URL API instead."),parse},get format(){return deprecation$1("7.3.0","utils.url.format is deprecated, use native URL API instead."),format},get resolve(){return deprecation$1("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),resolve}};function assertPath(path2){if(typeof path2!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(path2)}`)}function removeUrlParams(url2){return url2.split("?")[0].split("#")[0]}function escapeRegExp(string){return string.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function replaceAll(str,find,replace){return str.replace(new RegExp(escapeRegExp(find),"g"),replace)}function normalizeStringPosix(path2,allowAboveRoot){let res="",lastSegmentLength=0,lastSlash=-1,dots=0,code=-1;for(let i2=0;i2<=path2.length;++i2){if(i2<path2.length)code=path2.charCodeAt(i2);else{if(code===47)break;code=47}if(code===47){if(!(lastSlash===i2-1||dots===1))if(lastSlash!==i2-1&&dots===2){if(res.length<2||lastSegmentLength!==2||res.charCodeAt(res.length-1)!==46||res.charCodeAt(res.length-2)!==46){if(res.length>2){const lastSlashIndex=res.lastIndexOf("/");if(lastSlashIndex!==res.length-1){lastSlashIndex===-1?(res="",lastSegmentLength=0):(res=res.slice(0,lastSlashIndex),lastSegmentLength=res.length-1-res.lastIndexOf("/")),lastSlash=i2,dots=0;continue}}else if(res.length===2||res.length===1){res="",lastSegmentLength=0,lastSlash=i2,dots=0;continue}}allowAboveRoot&&(res.length>0?res+="/..":res="..",lastSegmentLength=2)}else res.length>0?res+=`/${path2.slice(lastSlash+1,i2)}`:res=path2.slice(lastSlash+1,i2),lastSegmentLength=i2-lastSlash-1;lastSlash=i2,dots=0}else code===46&&dots!==-1?++dots:dots=-1}return res}const path={toPosix(path2){return replaceAll(path2,"\\","/")},isUrl(path2){return /^https?:/.test(this.toPosix(path2))},isDataUrl(path2){return /^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(path2)},isBlobUrl(path2){return path2.startsWith("blob:")},hasProtocol(path2){return /^[^/:]+:/.test(this.toPosix(path2))},getProtocol(path2){assertPath(path2),path2=this.toPosix(path2);const matchFile=/^file:\/\/\//.exec(path2);if(matchFile)return matchFile[0];const matchProtocol=/^[^/:]+:\/{0,2}/.exec(path2);return matchProtocol?matchProtocol[0]:""},toAbsolute(url2,customBaseUrl,customRootUrl){if(assertPath(url2),this.isDataUrl(url2)||this.isBlobUrl(url2))return url2;const baseUrl=removeUrlParams(this.toPosix(customBaseUrl!=null?customBaseUrl:settings.ADAPTER.getBaseUrl())),rootUrl=removeUrlParams(this.toPosix(customRootUrl!=null?customRootUrl:this.rootname(baseUrl)));return url2=this.toPosix(url2),url2.startsWith("/")?path.join(rootUrl,url2.slice(1)):this.isAbsolute(url2)?url2:this.join(baseUrl,url2)},normalize(path2){if(assertPath(path2),path2.length===0)return".";if(this.isDataUrl(path2)||this.isBlobUrl(path2))return path2;path2=this.toPosix(path2);let protocol="";const isAbsolute=path2.startsWith("/");this.hasProtocol(path2)&&(protocol=this.rootname(path2),path2=path2.slice(protocol.length));const trailingSeparator=path2.endsWith("/");return path2=normalizeStringPosix(path2,!1),path2.length>0&&trailingSeparator&&(path2+="/"),isAbsolute?`/${path2}`:protocol+path2},isAbsolute(path2){return assertPath(path2),path2=this.toPosix(path2),this.hasProtocol(path2)?!0:path2.startsWith("/")},join(...segments){var _a2;if(segments.length===0)return".";let joined;for(let i2=0;i2<segments.length;++i2){const arg=segments[i2];if(assertPath(arg),arg.length>0)if(joined===void 0)joined=arg;else{const prevArg=(_a2=segments[i2-1])!=null?_a2:"";this.joinExtensions.includes(this.extname(prevArg).toLowerCase())?joined+=`/../${arg}`:joined+=`/${arg}`}}return joined===void 0?".":this.normalize(joined)},dirname(path2){if(assertPath(path2),path2.length===0)return".";path2=this.toPosix(path2);let code=path2.charCodeAt(0);const hasRoot=code===47;let end=-1,matchedSlash=!0;const proto=this.getProtocol(path2),origpath=path2;path2=path2.slice(proto.length);for(let i2=path2.length-1;i2>=1;--i2)if(code=path2.charCodeAt(i2),code===47){if(!matchedSlash){end=i2;break}}else matchedSlash=!1;return end===-1?hasRoot?"/":this.isUrl(origpath)?proto+path2:proto:hasRoot&&end===1?"//":proto+path2.slice(0,end)},rootname(path2){assertPath(path2),path2=this.toPosix(path2);let root="";if(path2.startsWith("/")?root="/":root=this.getProtocol(path2),this.isUrl(path2)){const index=path2.indexOf("/",root.length);index!==-1?root=path2.slice(0,index):root=path2,root.endsWith("/")||(root+="/")}return root},basename(path2,ext){assertPath(path2),ext&&assertPath(ext),path2=removeUrlParams(this.toPosix(path2));let start=0,end=-1,matchedSlash=!0,i2;if(ext!==void 0&&ext.length>0&&ext.length<=path2.length){if(ext.length===path2.length&&ext===path2)return"";let extIdx=ext.length-1,firstNonSlashEnd=-1;for(i2=path2.length-1;i2>=0;--i2){const code=path2.charCodeAt(i2);if(code===47){if(!matchedSlash){start=i2+1;break}}else firstNonSlashEnd===-1&&(matchedSlash=!1,firstNonSlashEnd=i2+1),extIdx>=0&&(code===ext.charCodeAt(extIdx)?--extIdx===-1&&(end=i2):(extIdx=-1,end=firstNonSlashEnd))}return start===end?end=firstNonSlashEnd:end===-1&&(end=path2.length),path2.slice(start,end)}for(i2=path2.length-1;i2>=0;--i2)if(path2.charCodeAt(i2)===47){if(!matchedSlash){start=i2+1;break}}else end===-1&&(matchedSlash=!1,end=i2+1);return end===-1?"":path2.slice(start,end)},extname(path2){assertPath(path2),path2=removeUrlParams(this.toPosix(path2));let startDot=-1,startPart=0,end=-1,matchedSlash=!0,preDotState=0;for(let i2=path2.length-1;i2>=0;--i2){const code=path2.charCodeAt(i2);if(code===47){if(!matchedSlash){startPart=i2+1;break}continue}end===-1&&(matchedSlash=!1,end=i2+1),code===46?startDot===-1?startDot=i2:preDotState!==1&&(preDotState=1):startDot!==-1&&(preDotState=-1)}return startDot===-1||end===-1||preDotState===0||preDotState===1&&startDot===end-1&&startDot===startPart+1?"":path2.slice(startDot,end)},parse(path2){assertPath(path2);const ret={root:"",dir:"",base:"",ext:"",name:""};if(path2.length===0)return ret;path2=removeUrlParams(this.toPosix(path2));let code=path2.charCodeAt(0);const isAbsolute=this.isAbsolute(path2);let start;const protocol="";ret.root=this.rootname(path2),isAbsolute||this.hasProtocol(path2)?start=1:start=0;let startDot=-1,startPart=0,end=-1,matchedSlash=!0,i2=path2.length-1,preDotState=0;for(;i2>=start;--i2){if(code=path2.charCodeAt(i2),code===47){if(!matchedSlash){startPart=i2+1;break}continue}end===-1&&(matchedSlash=!1,end=i2+1),code===46?startDot===-1?startDot=i2:preDotState!==1&&(preDotState=1):startDot!==-1&&(preDotState=-1)}return startDot===-1||end===-1||preDotState===0||preDotState===1&&startDot===end-1&&startDot===startPart+1?end!==-1&&(startPart===0&&isAbsolute?ret.base=ret.name=path2.slice(1,end):ret.base=ret.name=path2.slice(startPart,end)):(startPart===0&&isAbsolute?(ret.name=path2.slice(1,startDot),ret.base=path2.slice(1,end)):(ret.name=path2.slice(startPart,startDot),ret.base=path2.slice(startPart,end)),ret.ext=path2.slice(startDot,end)),ret.dir=this.dirname(path2),protocol&&(ret.dir=protocol+ret.dir),ret},sep:"/",delimiter:":",joinExtensions:[".html"]};let promise;async function detectVideoAlphaMode(){return promise!=null||(promise=(async()=>{var _a2;const gl=document.createElement("canvas").getContext("webgl");if(!gl)return ALPHA_MODES.UNPACK;const video=await new Promise(resolve2=>{const video2=document.createElement("video");video2.onloadeddata=()=>resolve2(video2),video2.onerror=()=>resolve2(null),video2.autoplay=!1,video2.crossOrigin="anonymous",video2.preload="auto",video2.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",video2.load()});if(!video)return ALPHA_MODES.UNPACK;const texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);const framebuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0),gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,gl.NONE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,video);const pixel=new Uint8Array(4);return gl.readPixels(0,0,1,1,gl.RGBA,gl.UNSIGNED_BYTE,pixel),gl.deleteFramebuffer(framebuffer),gl.deleteTexture(texture),(_a2=gl.getExtension("WEBGL_lose_context"))==null||_a2.loseContext(),pixel[0]<=pixel[3]?ALPHA_MODES.PMA:ALPHA_MODES.UNPACK})()),promise}function skipHello(){deprecation$1("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function sayHello(){deprecation$1("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}let supported;function isWebGLSupported(){return typeof supported=="undefined"&&(supported=function(){var _a2;const contextOptions={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!settings.ADAPTER.getWebGLRenderingContext())return!1;const canvas=settings.ADAPTER.createCanvas();let gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions);const success=!!((_a2=gl==null?void 0:gl.getContextAttributes())!=null&&_a2.stencil);if(gl){const loseContext=gl.getExtension("WEBGL_lose_context");loseContext&&loseContext.loseContext()}return gl=null,success}catch(e2){return!1}}()),supported}var r={grad:0.9,turn:360,rad:360/(2*Math.PI)},t=function(r2){return typeof r2=="string"?r2.length>0:typeof r2=="number"},n=function(r2,t2,n2){return t2===void 0&&(t2=0),n2===void 0&&(n2=Math.pow(10,t2)),Math.round(n2*r2)/n2+0},e=function(r2,t2,n2){return t2===void 0&&(t2=0),n2===void 0&&(n2=1),r2>n2?n2:r2>t2?r2:t2},u=function(r2){return(r2=isFinite(r2)?r2%360:0)>0?r2:r2+360},a=function(r2){return{r:e(r2.r,0,255),g:e(r2.g,0,255),b:e(r2.b,0,255),a:e(r2.a)}},o=function(r2){return{r:n(r2.r),g:n(r2.g),b:n(r2.b),a:n(r2.a,3)}},i=/^#([0-9a-f]{3,8})$/i,s=function(r2){var t2=r2.toString(16);return t2.length<2?"0"+t2:t2},h=function(r2){var t2=r2.r,n2=r2.g,e2=r2.b,u2=r2.a,a2=Math.max(t2,n2,e2),o2=a2-Math.min(t2,n2,e2),i2=o2?a2===t2?(n2-e2)/o2:a2===n2?2+(e2-t2)/o2:4+(t2-n2)/o2:0;return{h:60*(i2<0?i2+6:i2),s:a2?o2/a2*100:0,v:a2/255*100,a:u2}},b=function(r2){var t2=r2.h,n2=r2.s,e2=r2.v,u2=r2.a;t2=t2/360*6,n2/=100,e2/=100;var a2=Math.floor(t2),o2=e2*(1-n2),i2=e2*(1-(t2-a2)*n2),s2=e2*(1-(1-t2+a2)*n2),h2=a2%6;return{r:255*[e2,i2,o2,o2,s2,e2][h2],g:255*[s2,e2,e2,i2,o2,o2][h2],b:255*[o2,o2,s2,e2,e2,i2][h2],a:u2}},g=function(r2){return{h:u(r2.h),s:e(r2.s,0,100),l:e(r2.l,0,100),a:e(r2.a)}},d=function(r2){return{h:n(r2.h),s:n(r2.s),l:n(r2.l),a:n(r2.a,3)}},f=function(r2){return b((n2=(t2=r2).s,{h:t2.h,s:(n2*=((e2=t2.l)<50?e2:100-e2)/100)>0?2*n2/(e2+n2)*100:0,v:e2+n2,a:t2.a}));var t2,n2,e2},c=function(r2){return{h:(t2=h(r2)).h,s:(u2=(200-(n2=t2.s))*(e2=t2.v)/100)>0&&u2<200?n2*e2/100/(u2<=100?u2:200-u2)*100:0,l:u2/2,a:t2.a};var t2,n2,e2,u2},l=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,p=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,v=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,y={string:[[function(r2){var t2=i.exec(r2);return t2?(r2=t2[1]).length<=4?{r:parseInt(r2[0]+r2[0],16),g:parseInt(r2[1]+r2[1],16),b:parseInt(r2[2]+r2[2],16),a:r2.length===4?n(parseInt(r2[3]+r2[3],16)/255,2):1}:r2.length===6||r2.length===8?{r:parseInt(r2.substr(0,2),16),g:parseInt(r2.substr(2,2),16),b:parseInt(r2.substr(4,2),16),a:r2.length===8?n(parseInt(r2.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r2){var t2=v.exec(r2)||m.exec(r2);return t2?t2[2]!==t2[4]||t2[4]!==t2[6]?null:a({r:Number(t2[1])/(t2[2]?100/255:1),g:Number(t2[3])/(t2[4]?100/255:1),b:Number(t2[5])/(t2[6]?100/255:1),a:t2[7]===void 0?1:Number(t2[7])/(t2[8]?100:1)}):null},"rgb"],[function(t2){var n2=l.exec(t2)||p.exec(t2);if(!n2)return null;var e2,u2,a2=g({h:(e2=n2[1],u2=n2[2],u2===void 0&&(u2="deg"),Number(e2)*(r[u2]||1)),s:Number(n2[3]),l:Number(n2[4]),a:n2[5]===void 0?1:Number(n2[5])/(n2[6]?100:1)});return f(a2)},"hsl"]],object:[[function(r2){var n2=r2.r,e2=r2.g,u2=r2.b,o2=r2.a,i2=o2===void 0?1:o2;return t(n2)&&t(e2)&&t(u2)?a({r:Number(n2),g:Number(e2),b:Number(u2),a:Number(i2)}):null},"rgb"],[function(r2){var n2=r2.h,e2=r2.s,u2=r2.l,a2=r2.a,o2=a2===void 0?1:a2;if(!t(n2)||!t(e2)||!t(u2))return null;var i2=g({h:Number(n2),s:Number(e2),l:Number(u2),a:Number(o2)});return f(i2)},"hsl"],[function(r2){var n2=r2.h,a2=r2.s,o2=r2.v,i2=r2.a,s2=i2===void 0?1:i2;if(!t(n2)||!t(a2)||!t(o2))return null;var h2=function(r3){return{h:u(r3.h),s:e(r3.s,0,100),v:e(r3.v,0,100),a:e(r3.a)}}({h:Number(n2),s:Number(a2),v:Number(o2),a:Number(s2)});return b(h2)},"hsv"]]},N=function(r2,t2){for(var n2=0;n2<t2.length;n2++){var e2=t2[n2][0](r2);if(e2)return[e2,t2[n2][1]]}return[null,void 0]},x=function(r2){return typeof r2=="string"?N(r2.trim(),y.string):typeof r2=="object"&&r2!==null?N(r2,y.object):[null,void 0]},I=function(r2){return x(r2)[1]},M=function(r2,t2){var n2=c(r2);return{h:n2.h,s:e(n2.s+100*t2,0,100),l:n2.l,a:n2.a}},H=function(r2){return(299*r2.r+587*r2.g+114*r2.b)/1e3/255},$=function(r2,t2){var n2=c(r2);return{h:n2.h,s:n2.s,l:e(n2.l+100*t2,0,100),a:n2.a}},j=function(){function r2(r3){this.parsed=x(r3)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r2.prototype.isValid=function(){return this.parsed!==null},r2.prototype.brightness=function(){return n(H(this.rgba),2)},r2.prototype.isDark=function(){return H(this.rgba)<0.5},r2.prototype.isLight=function(){return H(this.rgba)>=0.5},r2.prototype.toHex=function(){return r3=o(this.rgba),t2=r3.r,e2=r3.g,u2=r3.b,i2=(a2=r3.a)<1?s(n(255*a2)):"","#"+s(t2)+s(e2)+s(u2)+i2;var r3,t2,e2,u2,a2,i2},r2.prototype.toRgb=function(){return o(this.rgba)},r2.prototype.toRgbString=function(){return r3=o(this.rgba),t2=r3.r,n2=r3.g,e2=r3.b,(u2=r3.a)<1?"rgba("+t2+", "+n2+", "+e2+", "+u2+")":"rgb("+t2+", "+n2+", "+e2+")";var r3,t2,n2,e2,u2},r2.prototype.toHsl=function(){return d(c(this.rgba))},r2.prototype.toHslString=function(){return r3=d(c(this.rgba)),t2=r3.h,n2=r3.s,e2=r3.l,(u2=r3.a)<1?"hsla("+t2+", "+n2+"%, "+e2+"%, "+u2+")":"hsl("+t2+", "+n2+"%, "+e2+"%)";var r3,t2,n2,e2,u2},r2.prototype.toHsv=function(){return r3=h(this.rgba),{h:n(r3.h),s:n(r3.s),v:n(r3.v),a:n(r3.a,3)};var r3},r2.prototype.invert=function(){return w({r:255-(r3=this.rgba).r,g:255-r3.g,b:255-r3.b,a:r3.a});var r3},r2.prototype.saturate=function(r3){return r3===void 0&&(r3=0.1),w(M(this.rgba,r3))},r2.prototype.desaturate=function(r3){return r3===void 0&&(r3=0.1),w(M(this.rgba,-r3))},r2.prototype.grayscale=function(){return w(M(this.rgba,-1))},r2.prototype.lighten=function(r3){return r3===void 0&&(r3=0.1),w($(this.rgba,r3))},r2.prototype.darken=function(r3){return r3===void 0&&(r3=0.1),w($(this.rgba,-r3))},r2.prototype.rotate=function(r3){return r3===void 0&&(r3=15),this.hue(this.hue()+r3)},r2.prototype.alpha=function(r3){return typeof r3=="number"?w({r:(t2=this.rgba).r,g:t2.g,b:t2.b,a:r3}):n(this.rgba.a,3);var t2},r2.prototype.hue=function(r3){var t2=c(this.rgba);return typeof r3=="number"?w({h:r3,s:t2.s,l:t2.l,a:t2.a}):n(t2.h)},r2.prototype.isEqual=function(r3){return this.toHex()===w(r3).toHex()},r2}(),w=function(r2){return r2 instanceof j?r2:new j(r2)},S=[],k=function(r2){r2.forEach(function(r3){S.indexOf(r3)<0&&(r3(j,y),S.push(r3))})},E=function(){return new j({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()})};function namesPlugin(e2,f2){var a2={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r2={};for(var d2 in a2)r2[a2[d2]]=d2;var l2={};e2.prototype.toName=function(f3){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var d3,i2,n2=r2[this.toHex()];if(n2)return n2;if(f3!=null&&f3.closest){var o2=this.toRgb(),t2=1/0,b2="black";if(!l2.length)for(var c2 in a2)l2[c2]=new e2(a2[c2]).toRgb();for(var g2 in a2){var u2=(d3=o2,i2=l2[g2],Math.pow(d3.r-i2.r,2)+Math.pow(d3.g-i2.g,2)+Math.pow(d3.b-i2.b,2));u2<t2&&(t2=u2,b2=g2)}return b2}},f2.string.push([function(f3){var r3=f3.toLowerCase(),d3=r3==="transparent"?"#0000":a2[r3];return d3?new e2(d3).toRgb():null},"name"])}var __defProp$e=Object.defineProperty,__getOwnPropSymbols$f=Object.getOwnPropertySymbols,__hasOwnProp$f=Object.prototype.hasOwnProperty,__propIsEnum$f=Object.prototype.propertyIsEnumerable,__defNormalProp$e=(obj,key,value)=>key in obj?__defProp$e(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$e=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$f.call(b2,prop)&&__defNormalProp$e(a2,prop,b2[prop]);if(__getOwnPropSymbols$f)for(var prop of __getOwnPropSymbols$f(b2))__propIsEnum$f.call(b2,prop)&&__defNormalProp$e(a2,prop,b2[prop]);return a2};k([namesPlugin]);const _Color=class _Color2{constructor(value=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=value}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(value){return this.value=value,this}set value(value){if(value instanceof _Color2)this._value=this.cloneSource(value._value),this._int=value._int,this._components.set(value._components);else{if(value===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,value))&&(this.normalize(value),this._value=this.cloneSource(value))}}get value(){return this._value}cloneSource(value){return typeof value=="string"||typeof value=="number"||value instanceof Number||value===null?value:Array.isArray(value)||ArrayBuffer.isView(value)?value.slice(0):typeof value=="object"&&value!==null?__spreadValues$e({},value):value}isSourceEqual(value1,value2){const type1=typeof value1;if(type1!==typeof value2)return!1;if(type1==="number"||type1==="string"||value1 instanceof Number)return value1===value2;if(Array.isArray(value1)&&Array.isArray(value2)||ArrayBuffer.isView(value1)&&ArrayBuffer.isView(value2))return value1.length!==value2.length?!1:value1.every((v2,i2)=>v2===value2[i2]);if(value1!==null&&value2!==null){const keys1=Object.keys(value1),keys2=Object.keys(value2);return keys1.length!==keys2.length?!1:keys1.every(key=>value1[key]===value2[key])}return value1===value2}toRgba(){const[r2,g2,b2,a2]=this._components;return{r:r2,g:g2,b:b2,a:a2}}toRgb(){const[r2,g2,b2]=this._components;return{r:r2,g:g2,b:b2}}toRgbaString(){const[r2,g2,b2]=this.toUint8RgbArray();return`rgba(${r2},${g2},${b2},${this.alpha})`}toUint8RgbArray(out){const[r2,g2,b2]=this._components;return out=out!=null?out:[],out[0]=Math.round(r2*255),out[1]=Math.round(g2*255),out[2]=Math.round(b2*255),out}toRgbArray(out){out=out!=null?out:[];const[r2,g2,b2]=this._components;return out[0]=r2,out[1]=g2,out[2]=b2,out}toNumber(){return this._int}toLittleEndianNumber(){const value=this._int;return(value>>16)+(value&65280)+((value&255)<<16)}multiply(value){const[r2,g2,b2,a2]=_Color2.temp.setValue(value)._components;return this._components[0]*=r2,this._components[1]*=g2,this._components[2]*=b2,this._components[3]*=a2,this.refreshInt(),this._value=null,this}premultiply(alpha,applyToRGB=!0){return applyToRGB&&(this._components[0]*=alpha,this._components[1]*=alpha,this._components[2]*=alpha),this._components[3]=alpha,this.refreshInt(),this._value=null,this}toPremultiplied(alpha,applyToRGB=!0){if(alpha===1)return(255<<24)+this._int;if(alpha===0)return applyToRGB?0:this._int;let r2=this._int>>16&255,g2=this._int>>8&255,b2=this._int&255;return applyToRGB&&(r2=r2*alpha+0.5|0,g2=g2*alpha+0.5|0,b2=b2*alpha+0.5|0),(alpha*255<<24)+(r2<<16)+(g2<<8)+b2}toHex(){const hexString=this._int.toString(16);return`#${"000000".substring(0,6-hexString.length)+hexString}`}toHexa(){const alphaString=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-alphaString.length)+alphaString}setAlpha(alpha){return this._components[3]=this._clamp(alpha),this}round(steps){const[r2,g2,b2]=this._components;return this._components[0]=Math.round(r2*steps)/steps,this._components[1]=Math.round(g2*steps)/steps,this._components[2]=Math.round(b2*steps)/steps,this.refreshInt(),this._value=null,this}toArray(out){out=out!=null?out:[];const[r2,g2,b2,a2]=this._components;return out[0]=r2,out[1]=g2,out[2]=b2,out[3]=a2,out}normalize(value){let r2,g2,b2,a2;if((typeof value=="number"||value instanceof Number)&&value>=0&&value<=16777215){const int=value;r2=(int>>16&255)/255,g2=(int>>8&255)/255,b2=(int&255)/255,a2=1}else if((Array.isArray(value)||value instanceof Float32Array)&&value.length>=3&&value.length<=4)value=this._clamp(value),[r2,g2,b2,a2=1]=value;else if((value instanceof Uint8Array||value instanceof Uint8ClampedArray)&&value.length>=3&&value.length<=4)value=this._clamp(value,0,255),[r2,g2,b2,a2=255]=value,r2/=255,g2/=255,b2/=255,a2/=255;else if(typeof value=="string"||typeof value=="object"){if(typeof value=="string"){const match=_Color2.HEX_PATTERN.exec(value);match&&(value=`#${match[2]}`)}const color=w(value);color.isValid()&&(({r:r2,g:g2,b:b2,a:a2}=color.rgba),r2/=255,g2/=255,b2/=255)}if(r2!==void 0)this._components[0]=r2,this._components[1]=g2,this._components[2]=b2,this._components[3]=a2,this.refreshInt();else throw new Error(`Unable to convert color ${value}`)}refreshInt(){this._clamp(this._components);const[r2,g2,b2]=this._components;this._int=(r2*255<<16)+(g2*255<<8)+(b2*255|0)}_clamp(value,min=0,max=1){return typeof value=="number"?Math.min(Math.max(value,min),max):(value.forEach((v2,i2)=>{value[i2]=Math.min(Math.max(v2,min),max)}),value)}};_Color.shared=new _Color,_Color.temp=new _Color,_Color.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Color=_Color;function hex2rgb(hex,out=[]){return deprecation$1("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),Color.shared.setValue(hex).toRgbArray(out)}function hex2string(hex){return deprecation$1("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Color.shared.setValue(hex).toHex()}function string2hex(string){return deprecation$1("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),Color.shared.setValue(string).toNumber()}function rgb2hex(rgb){return deprecation$1("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Color.shared.setValue(rgb).toNumber()}function mapPremultipliedBlendModes(){const pm=[],npm=[];for(let i2=0;i2<32;i2++)pm[i2]=i2,npm[i2]=i2;pm[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL,pm[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD,pm[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN,npm[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM,npm[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM,npm[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;const array=[];return array.push(npm),array.push(pm),array}const premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(blendMode,premultiplied){return premultiplyBlendMode[premultiplied?1:0][blendMode]}function premultiplyRgba(rgb,alpha,out,premultiply=!0){return deprecation$1("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),Color.shared.setValue(rgb).premultiply(alpha,premultiply).toArray(out!=null?out:new Float32Array(4))}function premultiplyTint(tint,alpha){return deprecation$1("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),Color.shared.setValue(tint).toPremultiplied(alpha)}function premultiplyTintToRgba(tint,alpha,out,premultiply=!0){return deprecation$1("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),Color.shared.setValue(tint).premultiply(alpha,premultiply).toArray(out!=null?out:new Float32Array(4))}const DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function createIndicesForQuads(size,outBuffer=null){const totalIndices=size*6;if(outBuffer=outBuffer||new Uint16Array(totalIndices),outBuffer.length!==totalIndices)throw new Error(`Out buffer length is incorrect, got ${outBuffer.length} and expected ${totalIndices}`);for(let i2=0,j2=0;i2<totalIndices;i2+=6,j2+=4)outBuffer[i2+0]=j2+0,outBuffer[i2+1]=j2+1,outBuffer[i2+2]=j2+2,outBuffer[i2+3]=j2+0,outBuffer[i2+4]=j2+2,outBuffer[i2+5]=j2+3;return outBuffer}function getBufferType(array){if(array.BYTES_PER_ELEMENT===4)return array instanceof Float32Array?"Float32Array":array instanceof Uint32Array?"Uint32Array":"Int32Array";if(array.BYTES_PER_ELEMENT===2){if(array instanceof Uint16Array)return"Uint16Array"}else if(array.BYTES_PER_ELEMENT===1&&array instanceof Uint8Array)return"Uint8Array";return null}const map$2={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays$1(arrays,sizes){let outSize=0,stride=0;const views={};for(let i2=0;i2<arrays.length;i2++)stride+=sizes[i2],outSize+=arrays[i2].length;const buffer=new ArrayBuffer(outSize*4);let out=null,littleOffset=0;for(let i2=0;i2<arrays.length;i2++){const size=sizes[i2],array=arrays[i2],type=getBufferType(array);views[type]||(views[type]=new map$2[type](buffer)),out=views[type];for(let j2=0;j2<array.length;j2++){const indexStart=(j2/size|0)*stride+littleOffset,index=j2%size;out[indexStart+index]=array[j2]}littleOffset+=size}return new Float32Array(buffer)}function nextPow2(v2){return v2+=v2===0?1:0,--v2,v2|=v2>>>1,v2|=v2>>>2,v2|=v2>>>4,v2|=v2>>>8,v2|=v2>>>16,v2+1}function isPow2(v2){return!(v2&v2-1)&&!!v2}function log2(v2){let r2=(v2>65535?1:0)<<4;v2>>>=r2;let shift=(v2>255?1:0)<<3;return v2>>>=shift,r2|=shift,shift=(v2>15?1:0)<<2,v2>>>=shift,r2|=shift,shift=(v2>3?1:0)<<1,v2>>>=shift,r2|=shift,r2|v2>>1}function removeItems(arr,startIdx,removeCount){const length=arr.length;let i2;if(startIdx>=length||removeCount===0)return;removeCount=startIdx+removeCount>length?length-startIdx:removeCount;const len=length-removeCount;for(i2=startIdx;i2<len;++i2)arr[i2]=arr[i2+removeCount];arr.length=len}function sign(n2){return n2===0?0:n2<0?-1:1}let nextUid=0;function uid(){return++nextUid}const _BoundingBox=class{constructor(left,top,right,bottom){this.left=left,this.top=top,this.right=right,this.bottom=bottom}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};_BoundingBox.EMPTY=new _BoundingBox(0,0,0,0);let BoundingBox=_BoundingBox;const ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);function destroyTextureCache(){let key;for(key in TextureCache)TextureCache[key].destroy();for(key in BaseTextureCache)BaseTextureCache[key].destroy()}function clearTextureCache(){let key;for(key in TextureCache)delete TextureCache[key];for(key in BaseTextureCache)delete BaseTextureCache[key]}class CanvasRenderTarget{constructor(width,height,resolution){this._canvas=settings.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=resolution||settings.RESOLUTION,this.resize(width,height)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(desiredWidth,desiredHeight){this._checkDestroyed(),this._canvas.width=Math.round(desiredWidth*this.resolution),this._canvas.height=Math.round(desiredHeight*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(val){this._checkDestroyed(),this._canvas.width=Math.round(val)}get height(){return this._checkDestroyed(),this._canvas.height}set height(val){this._checkDestroyed(),this._canvas.height=Math.round(val)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function checkRow(data,width,y2){for(let x2=0,index=4*y2*width;x2<width;++x2,index+=4)if(data[index+3]!==0)return!1;return!0}function checkColumn(data,width,x2,top,bottom){const stride=4*width;for(let y2=top,index=top*stride+4*x2;y2<=bottom;++y2,index+=stride)if(data[index+3]!==0)return!1;return!0}function getCanvasBoundingBox(canvas){const{width,height}=canvas,context2=canvas.getContext("2d",{willReadFrequently:!0});if(context2===null)throw new TypeError("Failed to get canvas 2D context");const data=context2.getImageData(0,0,width,height).data;let left=0,top=0,right=width-1,bottom=height-1;for(;top<height&&checkRow(data,width,top);)++top;if(top===height)return BoundingBox.EMPTY;for(;checkRow(data,width,bottom);)--bottom;for(;checkColumn(data,width,left,top,bottom);)++left;for(;checkColumn(data,width,right,top,bottom);)--right;return++right,++bottom,new BoundingBox(left,top,right,bottom)}function trimCanvas(canvas){const boundingBox=getCanvasBoundingBox(canvas),{width,height}=boundingBox;let data=null;if(!boundingBox.isEmpty()){const context2=canvas.getContext("2d");if(context2===null)throw new TypeError("Failed to get canvas 2D context");data=context2.getImageData(boundingBox.left,boundingBox.top,width,height)}return{width,height,data}}function decomposeDataUri(dataUri){const dataUriMatch=DATA_URI.exec(dataUri);if(dataUriMatch)return{mediaType:dataUriMatch[1]?dataUriMatch[1].toLowerCase():void 0,subType:dataUriMatch[2]?dataUriMatch[2].toLowerCase():void 0,charset:dataUriMatch[3]?dataUriMatch[3].toLowerCase():void 0,encoding:dataUriMatch[4]?dataUriMatch[4].toLowerCase():void 0,data:dataUriMatch[5]}}function determineCrossOrigin(url2,loc=globalThis.location){if(url2.startsWith("data:"))return"";loc=loc||globalThis.location;const parsedUrl=new URL(url2,document.baseURI);return parsedUrl.hostname!==loc.hostname||parsedUrl.port!==loc.port||parsedUrl.protocol!==loc.protocol?"anonymous":""}function getResolutionOfUrl(url2,defaultValue2=1){var _a2;const resolution=(_a2=settings.RETINA_PREFIX)==null?void 0:_a2.exec(url2);return resolution?parseFloat(resolution[1]):defaultValue2}var utils={__proto__:null,BaseTextureCache,BoundingBox,CanvasRenderTarget,DATA_URI,EventEmitter,ProgramCache,TextureCache,clearTextureCache,correctBlendMode,createIndicesForQuads,decomposeDataUri,deprecation:deprecation$1,destroyTextureCache,detectVideoAlphaMode,determineCrossOrigin,earcut:earcut$1,getBufferType,getCanvasBoundingBox,getResolutionOfUrl,hex2rgb,hex2string,interleaveTypedArrays:interleaveTypedArrays$1,isMobile,isPow2,isWebGLSupported,log2,nextPow2,path,premultiplyBlendMode,premultiplyRgba,premultiplyTint,premultiplyTintToRgba,removeItems,rgb2hex,sayHello,sign,skipHello,string2hex,trimCanvas,uid,url},__defProp$d=Object.defineProperty,__defProps$4=Object.defineProperties,__getOwnPropDescs$4=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$e=Object.getOwnPropertySymbols,__hasOwnProp$e=Object.prototype.hasOwnProperty,__propIsEnum$e=Object.prototype.propertyIsEnumerable,__defNormalProp$d=(obj,key,value)=>key in obj?__defProp$d(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$d=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$e.call(b2,prop)&&__defNormalProp$d(a2,prop,b2[prop]);if(__getOwnPropSymbols$e)for(var prop of __getOwnPropSymbols$e(b2))__propIsEnum$e.call(b2,prop)&&__defNormalProp$d(a2,prop,b2[prop]);return a2},__spreadProps$4=(a2,b2)=>__defProps$4(a2,__getOwnPropDescs$4(b2)),ExtensionType=(ExtensionType2=>(ExtensionType2.Renderer="renderer",ExtensionType2.Application="application",ExtensionType2.RendererSystem="renderer-webgl-system",ExtensionType2.RendererPlugin="renderer-webgl-plugin",ExtensionType2.CanvasRendererSystem="renderer-canvas-system",ExtensionType2.CanvasRendererPlugin="renderer-canvas-plugin",ExtensionType2.Asset="asset",ExtensionType2.LoadParser="load-parser",ExtensionType2.ResolveParser="resolve-parser",ExtensionType2.CacheParser="cache-parser",ExtensionType2.DetectionParser="detection-parser",ExtensionType2))(ExtensionType||{});const normalizeExtension=ext=>{if(typeof ext=="function"||typeof ext=="object"&&ext.extension){if(!ext.extension)throw new Error("Extension class must have an extension object");const metadata=typeof ext.extension!="object"?{type:ext.extension}:ext.extension;ext=__spreadProps$4(__spreadValues$d({},metadata),{ref:ext})}if(typeof ext=="object")ext=__spreadValues$d({},ext);else throw new Error("Invalid extension type");return typeof ext.type=="string"&&(ext.type=[ext.type]),ext},normalizePriority=(ext,defaultPriority)=>{var _a2;return(_a2=normalizeExtension(ext).priority)!=null?_a2:defaultPriority},extensions$1={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...extensions2){return extensions2.map(normalizeExtension).forEach(ext=>{ext.type.forEach(type=>{var _a2,_b;return(_b=(_a2=this._removeHandlers)[type])==null?void 0:_b.call(_a2,ext)})}),this},add(...extensions2){return extensions2.map(normalizeExtension).forEach(ext=>{ext.type.forEach(type=>{const handlers=this._addHandlers,queue=this._queue;handlers[type]?handlers[type](ext):(queue[type]=queue[type]||[],queue[type].push(ext))})}),this},handle(type,onAdd,onRemove){const addHandlers=this._addHandlers,removeHandlers=this._removeHandlers;if(addHandlers[type]||removeHandlers[type])throw new Error(`Extension type ${type} already has a handler`);addHandlers[type]=onAdd,removeHandlers[type]=onRemove;const queue=this._queue;return queue[type]&&(queue[type].forEach(ext=>onAdd(ext)),delete queue[type]),this},handleByMap(type,map2){return this.handle(type,extension=>{map2[extension.name]=extension.ref},extension=>{delete map2[extension.name]})},handleByList(type,list,defaultPriority=-1){return this.handle(type,extension=>{list.includes(extension.ref)||(list.push(extension.ref),list.sort((a2,b2)=>normalizePriority(b2,defaultPriority)-normalizePriority(a2,defaultPriority)))},extension=>{const index=list.indexOf(extension.ref);index!==-1&&list.splice(index,1)})}};class ViewableBuffer{constructor(sizeOrBuffer){typeof sizeOrBuffer=="number"?this.rawBinaryData=new ArrayBuffer(sizeOrBuffer):sizeOrBuffer instanceof Uint8Array?this.rawBinaryData=sizeOrBuffer.buffer:this.rawBinaryData=sizeOrBuffer,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(type){return this[`${type}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(type){switch(type){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${type} isn't a valid view type`)}}}const fragTemplate$1=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc(maxIfs){let src="";for(let i2=0;i2<maxIfs;++i2)i2>0&&(src+=`
else `),i2<maxIfs-1&&(src+=`if(test == ${i2}.0){}`);return src}function checkMaxIfStatementsInShader(maxIfs,gl){if(maxIfs===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const shader=gl.createShader(gl.FRAGMENT_SHADER);for(;;){const fragmentSrc=fragTemplate$1.replace(/%forloop%/gi,generateIfTestSrc(maxIfs));if(gl.shaderSource(shader,fragmentSrc),gl.compileShader(shader),!gl.getShaderParameter(shader,gl.COMPILE_STATUS))maxIfs=maxIfs/2|0;else break}return maxIfs}const BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5;class State{constructor(){this.data=0,this.blendMode=BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<BLEND$1)}set blend(value){!!(this.data&1<<BLEND$1)!==value&&(this.data^=1<<BLEND$1)}get offsets(){return!!(this.data&1<<OFFSET$1)}set offsets(value){!!(this.data&1<<OFFSET$1)!==value&&(this.data^=1<<OFFSET$1)}get culling(){return!!(this.data&1<<CULLING$1)}set culling(value){!!(this.data&1<<CULLING$1)!==value&&(this.data^=1<<CULLING$1)}get depthTest(){return!!(this.data&1<<DEPTH_TEST$1)}set depthTest(value){!!(this.data&1<<DEPTH_TEST$1)!==value&&(this.data^=1<<DEPTH_TEST$1)}get depthMask(){return!!(this.data&1<<DEPTH_MASK$1)}set depthMask(value){!!(this.data&1<<DEPTH_MASK$1)!==value&&(this.data^=1<<DEPTH_MASK$1)}get clockwiseFrontFace(){return!!(this.data&1<<WINDING$1)}set clockwiseFrontFace(value){!!(this.data&1<<WINDING$1)!==value&&(this.data^=1<<WINDING$1)}get blendMode(){return this._blendMode}set blendMode(value){this.blend=value!==BLEND_MODES.NONE,this._blendMode=value}get polygonOffset(){return this._polygonOffset}set polygonOffset(value){this.offsets=!!value,this._polygonOffset=value}static for2d(){const state=new State;return state.depthTest=!1,state.blend=!0,state}}State.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const INSTALLED=[];function autoDetectResource(source,options){if(!source)return null;let extension="";if(typeof source=="string"){const result=/\.(\w{3,4})(?:$|\?|#)/i.exec(source);result&&(extension=result[1].toLowerCase())}for(let i2=INSTALLED.length-1;i2>=0;--i2){const ResourcePlugin=INSTALLED[i2];if(ResourcePlugin.test&&ResourcePlugin.test(source,extension))return new ResourcePlugin(source,options)}throw new Error("Unrecognized source type to auto-detect Resource")}class Runner{constructor(name){this.items=[],this._name=name,this._aliasCount=0}emit(a0,a1,a2,a3,a4,a5,a6,a7){if(arguments.length>8)throw new Error("max arguments reached");const{name,items}=this;this._aliasCount++;for(let i2=0,len=items.length;i2<len;i2++)items[i2][name](a0,a1,a2,a3,a4,a5,a6,a7);return items===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(item){return item[this._name]&&(this.ensureNonAliasedItems(),this.remove(item),this.items.push(item)),this}remove(item){const index=this.items.indexOf(item);return index!==-1&&(this.ensureNonAliasedItems(),this.items.splice(index,1)),this}contains(item){return this.items.includes(item)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});class Resource{constructor(width=0,height=0){this._width=width,this._height=height,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}bind(baseTexture){this.onResize.add(baseTexture),this.onUpdate.add(baseTexture),this.onError.add(baseTexture),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(baseTexture){this.onResize.remove(baseTexture),this.onUpdate.remove(baseTexture),this.onError.remove(baseTexture)}resize(width,height){(width!==this._width||height!==this._height)&&(this._width=width,this._height=height,this.onResize.emit(width,height))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(_renderer,_baseTexture,_glTexture){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(_source,_extension){return!1}}class BufferResource extends Resource{constructor(source,options){var _a2;const{width,height}=options||{};if(!width||!height)throw new Error("BufferResource width or height invalid");super(width,height),this.data=source,this.unpackAlignment=(_a2=options.unpackAlignment)!=null?_a2:4}upload(renderer,baseTexture,glTexture){const gl=renderer.gl;gl.pixelStorei(gl.UNPACK_ALIGNMENT,this.unpackAlignment),gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES.UNPACK);const width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data)),!0}dispose(){this.data=null}static test(source){return source===null||source instanceof Int8Array||source instanceof Uint8Array||source instanceof Uint8ClampedArray||source instanceof Int16Array||source instanceof Uint16Array||source instanceof Int32Array||source instanceof Uint32Array||source instanceof Float32Array}}var __defProp$c=Object.defineProperty,__getOwnPropSymbols$d=Object.getOwnPropertySymbols,__hasOwnProp$d=Object.prototype.hasOwnProperty,__propIsEnum$d=Object.prototype.propertyIsEnumerable,__defNormalProp$c=(obj,key,value)=>key in obj?__defProp$c(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$c=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$d.call(b2,prop)&&__defNormalProp$c(a2,prop,b2[prop]);if(__getOwnPropSymbols$d)for(var prop of __getOwnPropSymbols$d(b2))__propIsEnum$d.call(b2,prop)&&__defNormalProp$c(a2,prop,b2[prop]);return a2};const defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,alphaMode:ALPHA_MODES.NPM},_BaseTexture=class _BaseTexture2 extends EventEmitter{constructor(resource=null,options=null){super(),options=Object.assign({},_BaseTexture2.defaultOptions,options);const{alphaMode,mipmap,anisotropicLevel,scaleMode,width,height,wrapMode,format:format2,type,target,resolution,resourceOptions}=options;resource&&!(resource instanceof Resource)&&(resource=autoDetectResource(resource,resourceOptions),resource.internal=!0),this.resolution=resolution||settings.RESOLUTION,this.width=Math.round((width||0)*this.resolution)/this.resolution,this.height=Math.round((height||0)*this.resolution)/this.resolution,this._mipmap=mipmap,this.anisotropicLevel=anisotropicLevel,this._wrapMode=wrapMode,this._scaleMode=scaleMode,this.format=format2,this.type=type,this.target=target,this.alphaMode=alphaMode,this.uid=uid(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=width>0&&height>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(resource)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(value){this._mipmap!==value&&(this._mipmap=value,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(value){this._scaleMode!==value&&(this._scaleMode=value,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(value){this._wrapMode!==value&&(this._wrapMode=value,this.dirtyStyleId++)}setStyle(scaleMode,mipmap){let dirty;return scaleMode!==void 0&&scaleMode!==this.scaleMode&&(this.scaleMode=scaleMode,dirty=!0),mipmap!==void 0&&mipmap!==this.mipmap&&(this.mipmap=mipmap,dirty=!0),dirty&&this.dirtyStyleId++,this}setSize(desiredWidth,desiredHeight,resolution){return resolution=resolution||this.resolution,this.setRealSize(desiredWidth*resolution,desiredHeight*resolution,resolution)}setRealSize(realWidth,realHeight,resolution){return this.resolution=resolution||this.resolution,this.width=Math.round(realWidth)/this.resolution,this.height=Math.round(realHeight)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)}setResolution(resolution){const oldResolution=this.resolution;return oldResolution===resolution?this:(this.resolution=resolution,this.valid&&(this.width=Math.round(this.width*oldResolution)/resolution,this.height=Math.round(this.height*oldResolution)/resolution,this.emit("update",this)),this._refreshPOT(),this)}setResource(resource){if(this.resource===resource)return this;if(this.resource)throw new Error("Resource can be set only once");return resource.bind(this),this.resource=resource,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(event){this.emit("error",this,event)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),_BaseTexture2.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(source,options,strict=settings.STRICT_TEXTURE_CACHE){const isFrame=typeof source=="string";let cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){const prefix=(options==null?void 0:options.pixiIdPrefix)||"pixiid";source._pixiId=`${prefix}_${uid()}`}cacheId=source._pixiId}let baseTexture=BaseTextureCache[cacheId];if(isFrame&&strict&&!baseTexture)throw new Error(`The cacheId "${cacheId}" does not exist in BaseTextureCache.`);return baseTexture||(baseTexture=new _BaseTexture2(source,options),baseTexture.cacheId=cacheId,_BaseTexture2.addToCache(baseTexture,cacheId)),baseTexture}static fromBuffer(buffer,width,height,options){buffer=buffer||new Float32Array(width*height*4);const resource=new BufferResource(buffer,__spreadValues$c({width,height},options==null?void 0:options.resourceOptions));let format2,type;return buffer instanceof Float32Array?(format2=FORMATS.RGBA,type=TYPES.FLOAT):buffer instanceof Int32Array?(format2=FORMATS.RGBA_INTEGER,type=TYPES.INT):buffer instanceof Uint32Array?(format2=FORMATS.RGBA_INTEGER,type=TYPES.UNSIGNED_INT):buffer instanceof Int16Array?(format2=FORMATS.RGBA_INTEGER,type=TYPES.SHORT):buffer instanceof Uint16Array?(format2=FORMATS.RGBA_INTEGER,type=TYPES.UNSIGNED_SHORT):buffer instanceof Int8Array?(format2=FORMATS.RGBA,type=TYPES.BYTE):(format2=FORMATS.RGBA,type=TYPES.UNSIGNED_BYTE),resource.internal=!0,new _BaseTexture2(resource,Object.assign({},defaultBufferOptions,{type,format:format2},options))}static addToCache(baseTexture,id){id&&(baseTexture.textureCacheIds.includes(id)||baseTexture.textureCacheIds.push(id),BaseTextureCache[id]&&BaseTextureCache[id]!==baseTexture&&console.warn(`BaseTexture added to the cache with an id [${id}] that already had an entry`),BaseTextureCache[id]=baseTexture)}static removeFromCache(baseTexture){if(typeof baseTexture=="string"){const baseTextureFromCache=BaseTextureCache[baseTexture];if(baseTextureFromCache){const index=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);return index>-1&&baseTextureFromCache.textureCacheIds.splice(index,1),delete BaseTextureCache[baseTexture],baseTextureFromCache}}else if(baseTexture!=null&&baseTexture.textureCacheIds){for(let i2=0;i2<baseTexture.textureCacheIds.length;++i2)delete BaseTextureCache[baseTexture.textureCacheIds[i2]];return baseTexture.textureCacheIds.length=0,baseTexture}return null}};_BaseTexture.defaultOptions={mipmap:MIPMAP_MODES.POW2,anisotropicLevel:0,scaleMode:SCALE_MODES.LINEAR,wrapMode:WRAP_MODES.CLAMP,alphaMode:ALPHA_MODES.UNPACK,target:TARGETS.TEXTURE_2D,format:FORMATS.RGBA,type:TYPES.UNSIGNED_BYTE},_BaseTexture._globalBatch=0;let BaseTexture=_BaseTexture;class BatchDrawCall{constructor(){this.texArray=null,this.blend=0,this.type=DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}}let UID$4=0;class Buffer{constructor(data,_static=!0,index=!1){this.data=data||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=index,this.static=_static,this.id=UID$4++,this.disposeRunner=new Runner("disposeBuffer")}update(data){data instanceof Array&&(data=new Float32Array(data)),this.data=data||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(value){this.type=value?BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:BUFFER_TYPE.ARRAY_BUFFER}get index(){return this.type===BUFFER_TYPE.ELEMENT_ARRAY_BUFFER}static from(data){return data instanceof Array&&(data=new Float32Array(data)),new Buffer(data)}}class Attribute{constructor(buffer,size=0,normalized=!1,type=TYPES.FLOAT,stride,start,instance,divisor=1){this.buffer=buffer,this.size=size,this.normalized=normalized,this.type=type,this.stride=stride,this.start=start,this.instance=instance,this.divisor=divisor}destroy(){this.buffer=null}static from(buffer,size,normalized,type,stride){return new Attribute(buffer,size,normalized,type,stride)}}const map$1={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(arrays,sizes){let outSize=0,stride=0;const views={};for(let i2=0;i2<arrays.length;i2++)stride+=sizes[i2],outSize+=arrays[i2].length;const buffer=new ArrayBuffer(outSize*4);let out=null,littleOffset=0;for(let i2=0;i2<arrays.length;i2++){const size=sizes[i2],array=arrays[i2],type=getBufferType(array);views[type]||(views[type]=new map$1[type](buffer)),out=views[type];for(let j2=0;j2<array.length;j2++){const indexStart=(j2/size|0)*stride+littleOffset,index=j2%size;out[indexStart+index]=array[j2]}littleOffset+=size}return new Float32Array(buffer)}const byteSizeMap$1={5126:4,5123:2,5121:1};let UID$3=0;const map={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Geometry{constructor(buffers=[],attributes={}){this.buffers=buffers,this.indexBuffer=null,this.attributes=attributes,this.glVertexArrayObjects={},this.id=UID$3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}addAttribute(id,buffer,size=0,normalized=!1,type,stride,start,instance=!1){if(!buffer)throw new Error("You must pass a buffer when creating an attribute");buffer instanceof Buffer||(buffer instanceof Array&&(buffer=new Float32Array(buffer)),buffer=new Buffer(buffer));const ids=id.split("|");if(ids.length>1){for(let i2=0;i2<ids.length;i2++)this.addAttribute(ids[i2],buffer,size,normalized,type);return this}let bufferIndex=this.buffers.indexOf(buffer);return bufferIndex===-1&&(this.buffers.push(buffer),bufferIndex=this.buffers.length-1),this.attributes[id]=new Attribute(bufferIndex,size,normalized,type,stride,start,instance),this.instanced=this.instanced||instance,this}getAttribute(id){return this.attributes[id]}getBuffer(id){return this.buffers[this.getAttribute(id).buffer]}addIndex(buffer){return buffer instanceof Buffer||(buffer instanceof Array&&(buffer=new Uint16Array(buffer)),buffer=new Buffer(buffer)),buffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=buffer,this.buffers.includes(buffer)||this.buffers.push(buffer),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const arrays=[],sizes=[],interleavedBuffer=new Buffer;let i2;for(i2 in this.attributes){const attribute=this.attributes[i2],buffer=this.buffers[attribute.buffer];arrays.push(buffer.data),sizes.push(attribute.size*byteSizeMap$1[attribute.type]/4),attribute.buffer=0}for(interleavedBuffer.data=interleaveTypedArrays(arrays,sizes),i2=0;i2<this.buffers.length;i2++)this.buffers[i2]!==this.indexBuffer&&this.buffers[i2].destroy();return this.buffers=[interleavedBuffer],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const i2 in this.attributes){const attribute=this.attributes[i2];return this.buffers[attribute.buffer].data.length/(attribute.stride/4||attribute.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const geometry=new Geometry;for(let i2=0;i2<this.buffers.length;i2++)geometry.buffers[i2]=new Buffer(this.buffers[i2].data.slice(0));for(const i2 in this.attributes){const attrib=this.attributes[i2];geometry.attributes[i2]=new Attribute(attrib.buffer,attrib.size,attrib.normalized,attrib.type,attrib.stride,attrib.start,attrib.instance)}return this.indexBuffer&&(geometry.indexBuffer=geometry.buffers[this.buffers.indexOf(this.indexBuffer)],geometry.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),geometry}static merge(geometries){const geometryOut=new Geometry,arrays=[],sizes=[],offsets=[];let geometry;for(let i2=0;i2<geometries.length;i2++){geometry=geometries[i2];for(let j2=0;j2<geometry.buffers.length;j2++)sizes[j2]=sizes[j2]||0,sizes[j2]+=geometry.buffers[j2].data.length,offsets[j2]=0}for(let i2=0;i2<geometry.buffers.length;i2++)arrays[i2]=new map[getBufferType(geometry.buffers[i2].data)](sizes[i2]),geometryOut.buffers[i2]=new Buffer(arrays[i2]);for(let i2=0;i2<geometries.length;i2++){geometry=geometries[i2];for(let j2=0;j2<geometry.buffers.length;j2++)arrays[j2].set(geometry.buffers[j2].data,offsets[j2]),offsets[j2]+=geometry.buffers[j2].data.length}if(geometryOut.attributes=geometry.attributes,geometry.indexBuffer){geometryOut.indexBuffer=geometryOut.buffers[geometry.buffers.indexOf(geometry.indexBuffer)],geometryOut.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;let offset=0,stride=0,offset2=0,bufferIndexToCount=0;for(let i2=0;i2<geometry.buffers.length;i2++)if(geometry.buffers[i2]!==geometry.indexBuffer){bufferIndexToCount=i2;break}for(const i2 in geometry.attributes){const attribute=geometry.attributes[i2];(attribute.buffer|0)===bufferIndexToCount&&(stride+=attribute.size*byteSizeMap$1[attribute.type]/4)}for(let i2=0;i2<geometries.length;i2++){const indexBufferData=geometries[i2].indexBuffer.data;for(let j2=0;j2<indexBufferData.length;j2++)geometryOut.indexBuffer.data[j2+offset2]+=offset;offset+=geometries[i2].buffers[bufferIndexToCount].data.length/stride,offset2+=indexBufferData.length}}return geometryOut}}class BatchGeometry extends Geometry{constructor(_static=!1){super(),this._buffer=new Buffer(null,_static,!1),this._indexBuffer=new Buffer(null,_static,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aColor",this._buffer,4,!0,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,TYPES.FLOAT).addIndex(this._indexBuffer)}}const PI_2=Math.PI*2,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180;var SHAPES=(SHAPES2=>(SHAPES2[SHAPES2.POLY=0]="POLY",SHAPES2[SHAPES2.RECT=1]="RECT",SHAPES2[SHAPES2.CIRC=2]="CIRC",SHAPES2[SHAPES2.ELIP=3]="ELIP",SHAPES2[SHAPES2.RREC=4]="RREC",SHAPES2))(SHAPES||{});class Point{constructor(x2=0,y2=0){this.x=0,this.y=0,this.x=x2,this.y=y2}clone(){return new Point(this.x,this.y)}copyFrom(p2){return this.set(p2.x,p2.y),this}copyTo(p2){return p2.set(this.x,this.y),p2}equals(p2){return p2.x===this.x&&p2.y===this.y}set(x2=0,y2=x2){return this.x=x2,this.y=y2,this}}Point.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const tempPoints$1=[new Point,new Point,new Point,new Point];class Rectangle{constructor(x2=0,y2=0,width=0,height=0){this.x=Number(x2),this.y=Number(y2),this.width=Number(width),this.height=Number(height),this.type=SHAPES.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Rectangle(0,0,0,0)}clone(){return new Rectangle(this.x,this.y,this.width,this.height)}copyFrom(rectangle){return this.x=rectangle.x,this.y=rectangle.y,this.width=rectangle.width,this.height=rectangle.height,this}copyTo(rectangle){return rectangle.x=this.x,rectangle.y=this.y,rectangle.width=this.width,rectangle.height=this.height,rectangle}contains(x2,y2){return this.width<=0||this.height<=0?!1:x2>=this.x&&x2<this.x+this.width&&y2>=this.y&&y2<this.y+this.height}intersects(other,transform){if(!transform){const x02=this.x<other.x?other.x:this.x;if((this.right>other.right?other.right:this.right)<=x02)return!1;const y02=this.y<other.y?other.y:this.y;return(this.bottom>other.bottom?other.bottom:this.bottom)>y02}const x0=this.left,x1=this.right,y0=this.top,y1=this.bottom;if(x1<=x0||y1<=y0)return!1;const lt=tempPoints$1[0].set(other.left,other.top),lb=tempPoints$1[1].set(other.left,other.bottom),rt=tempPoints$1[2].set(other.right,other.top),rb=tempPoints$1[3].set(other.right,other.bottom);if(rt.x<=lt.x||lb.y<=lt.y)return!1;const s2=Math.sign(transform.a*transform.d-transform.b*transform.c);if(s2===0||(transform.apply(lt,lt),transform.apply(lb,lb),transform.apply(rt,rt),transform.apply(rb,rb),Math.max(lt.x,lb.x,rt.x,rb.x)<=x0||Math.min(lt.x,lb.x,rt.x,rb.x)>=x1||Math.max(lt.y,lb.y,rt.y,rb.y)<=y0||Math.min(lt.y,lb.y,rt.y,rb.y)>=y1))return!1;const nx=s2*(lb.y-lt.y),ny=s2*(lt.x-lb.x),n00=nx*x0+ny*y0,n10=nx*x1+ny*y0,n01=nx*x0+ny*y1,n11=nx*x1+ny*y1;if(Math.max(n00,n10,n01,n11)<=nx*lt.x+ny*lt.y||Math.min(n00,n10,n01,n11)>=nx*rb.x+ny*rb.y)return!1;const mx=s2*(lt.y-rt.y),my=s2*(rt.x-lt.x),m00=mx*x0+my*y0,m10=mx*x1+my*y0,m01=mx*x0+my*y1,m11=mx*x1+my*y1;return!(Math.max(m00,m10,m01,m11)<=mx*lt.x+my*lt.y||Math.min(m00,m10,m01,m11)>=mx*rb.x+my*rb.y)}pad(paddingX=0,paddingY=paddingX){return this.x-=paddingX,this.y-=paddingY,this.width+=paddingX*2,this.height+=paddingY*2,this}fit(rectangle){const x1=Math.max(this.x,rectangle.x),x2=Math.min(this.x+this.width,rectangle.x+rectangle.width),y1=Math.max(this.y,rectangle.y),y2=Math.min(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=Math.max(x2-x1,0),this.y=y1,this.height=Math.max(y2-y1,0),this}ceil(resolution=1,eps=1e-3){const x2=Math.ceil((this.x+this.width-eps)*resolution)/resolution,y2=Math.ceil((this.y+this.height-eps)*resolution)/resolution;return this.x=Math.floor((this.x+eps)*resolution)/resolution,this.y=Math.floor((this.y+eps)*resolution)/resolution,this.width=x2-this.x,this.height=y2-this.y,this}enlarge(rectangle){const x1=Math.min(this.x,rectangle.x),x2=Math.max(this.x+this.width,rectangle.x+rectangle.width),y1=Math.min(this.y,rectangle.y),y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=x2-x1,this.y=y1,this.height=y2-y1,this}}Rectangle.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Circle{constructor(x2=0,y2=0,radius=0){this.x=x2,this.y=y2,this.radius=radius,this.type=SHAPES.CIRC}clone(){return new Circle(this.x,this.y,this.radius)}contains(x2,y2){if(this.radius<=0)return!1;const r2=this.radius*this.radius;let dx=this.x-x2,dy=this.y-y2;return dx*=dx,dy*=dy,dx+dy<=r2}getBounds(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Circle.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Ellipse{constructor(x2=0,y2=0,halfWidth=0,halfHeight=0){this.x=x2,this.y=y2,this.width=halfWidth,this.height=halfHeight,this.type=SHAPES.ELIP}clone(){return new Ellipse(this.x,this.y,this.width,this.height)}contains(x2,y2){if(this.width<=0||this.height<=0)return!1;let normx=(x2-this.x)/this.width,normy=(y2-this.y)/this.height;return normx*=normx,normy*=normy,normx+normy<=1}getBounds(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)}}Ellipse.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Polygon{constructor(...points){let flat=Array.isArray(points[0])?points[0]:points;if(typeof flat[0]!="number"){const p2=[];for(let i2=0,il=flat.length;i2<il;i2++)p2.push(flat[i2].x,flat[i2].y);flat=p2}this.points=flat,this.type=SHAPES.POLY,this.closeStroke=!0}clone(){const points=this.points.slice(),polygon=new Polygon(points);return polygon.closeStroke=this.closeStroke,polygon}contains(x2,y2){let inside=!1;const length=this.points.length/2;for(let i2=0,j2=length-1;i2<length;j2=i2++){const xi=this.points[i2*2],yi=this.points[i2*2+1],xj=this.points[j2*2],yj=this.points[j2*2+1];yi>y2!=yj>y2&&x2<(xj-xi)*((y2-yi)/(yj-yi))+xi&&(inside=!inside)}return inside}}Polygon.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((pointsDesc,currentPoint)=>`${pointsDesc}, ${currentPoint}`,"")}]`};class RoundedRectangle{constructor(x2=0,y2=0,width=0,height=0,radius=20){this.x=x2,this.y=y2,this.width=width,this.height=height,this.radius=radius,this.type=SHAPES.RREC}clone(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)}contains(x2,y2){if(this.width<=0||this.height<=0)return!1;if(x2>=this.x&&x2<=this.x+this.width&&y2>=this.y&&y2<=this.y+this.height){const radius=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(y2>=this.y+radius&&y2<=this.y+this.height-radius||x2>=this.x+radius&&x2<=this.x+this.width-radius)return!0;let dx=x2-(this.x+radius),dy=y2-(this.y+radius);const radius2=radius*radius;if(dx*dx+dy*dy<=radius2||(dx=x2-(this.x+this.width-radius),dx*dx+dy*dy<=radius2)||(dy=y2-(this.y+this.height-radius),dx*dx+dy*dy<=radius2)||(dx=x2-(this.x+radius),dx*dx+dy*dy<=radius2))return!0}return!1}}RoundedRectangle.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Matrix{constructor(a2=1,b2=0,c2=0,d2=1,tx=0,ty=0){this.array=null,this.a=a2,this.b=b2,this.c=c2,this.d=d2,this.tx=tx,this.ty=ty}fromArray(array){this.a=array[0],this.b=array[1],this.c=array[3],this.d=array[4],this.tx=array[2],this.ty=array[5]}set(a2,b2,c2,d2,tx,ty){return this.a=a2,this.b=b2,this.c=c2,this.d=d2,this.tx=tx,this.ty=ty,this}toArray(transpose,out){this.array||(this.array=new Float32Array(9));const array=out||this.array;return transpose?(array[0]=this.a,array[1]=this.b,array[2]=0,array[3]=this.c,array[4]=this.d,array[5]=0,array[6]=this.tx,array[7]=this.ty,array[8]=1):(array[0]=this.a,array[1]=this.c,array[2]=this.tx,array[3]=this.b,array[4]=this.d,array[5]=this.ty,array[6]=0,array[7]=0,array[8]=1),array}apply(pos,newPos){newPos=newPos||new Point;const x2=pos.x,y2=pos.y;return newPos.x=this.a*x2+this.c*y2+this.tx,newPos.y=this.b*x2+this.d*y2+this.ty,newPos}applyInverse(pos,newPos){newPos=newPos||new Point;const id=1/(this.a*this.d+this.c*-this.b),x2=pos.x,y2=pos.y;return newPos.x=this.d*id*x2+-this.c*id*y2+(this.ty*this.c-this.tx*this.d)*id,newPos.y=this.a*id*y2+-this.b*id*x2+(-this.ty*this.a+this.tx*this.b)*id,newPos}translate(x2,y2){return this.tx+=x2,this.ty+=y2,this}scale(x2,y2){return this.a*=x2,this.d*=y2,this.c*=x2,this.b*=y2,this.tx*=x2,this.ty*=y2,this}rotate(angle){const cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this}append(matrix){const a1=this.a,b1=this.b,c1=this.c,d1=this.d;return this.a=matrix.a*a1+matrix.b*c1,this.b=matrix.a*b1+matrix.b*d1,this.c=matrix.c*a1+matrix.d*c1,this.d=matrix.c*b1+matrix.d*d1,this.tx=matrix.tx*a1+matrix.ty*c1+this.tx,this.ty=matrix.tx*b1+matrix.ty*d1+this.ty,this}setTransform(x2,y2,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){return this.a=Math.cos(rotation+skewY)*scaleX,this.b=Math.sin(rotation+skewY)*scaleX,this.c=-Math.sin(rotation-skewX)*scaleY,this.d=Math.cos(rotation-skewX)*scaleY,this.tx=x2-(pivotX*this.a+pivotY*this.c),this.ty=y2-(pivotX*this.b+pivotY*this.d),this}prepend(matrix){const tx1=this.tx;if(matrix.a!==1||matrix.b!==0||matrix.c!==0||matrix.d!==1){const a1=this.a,c1=this.c;this.a=a1*matrix.a+this.b*matrix.c,this.b=a1*matrix.b+this.b*matrix.d,this.c=c1*matrix.a+this.d*matrix.c,this.d=c1*matrix.b+this.d*matrix.d}return this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty,this}decompose(transform){const a2=this.a,b2=this.b,c2=this.c,d2=this.d,pivot=transform.pivot,skewX=-Math.atan2(-c2,d2),skewY=Math.atan2(b2,a2),delta=Math.abs(skewX+skewY);return delta<1e-5||Math.abs(PI_2-delta)<1e-5?(transform.rotation=skewY,transform.skew.x=transform.skew.y=0):(transform.rotation=0,transform.skew.x=skewX,transform.skew.y=skewY),transform.scale.x=Math.sqrt(a2*a2+b2*b2),transform.scale.y=Math.sqrt(c2*c2+d2*d2),transform.position.x=this.tx+(pivot.x*a2+pivot.y*c2),transform.position.y=this.ty+(pivot.x*b2+pivot.y*d2),transform}invert(){const a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n2=a1*d1-b1*c1;return this.a=d1/n2,this.b=-b1/n2,this.c=-c1/n2,this.d=a1/n2,this.tx=(c1*this.ty-d1*tx1)/n2,this.ty=-(a1*this.ty-b1*tx1)/n2,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const matrix=new Matrix;return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix}copyTo(matrix){return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix}copyFrom(matrix){return this.a=matrix.a,this.b=matrix.b,this.c=matrix.c,this.d=matrix.d,this.tx=matrix.tx,this.ty=matrix.ty,this}static get IDENTITY(){return new Matrix}static get TEMP_MATRIX(){return new Matrix}}Matrix.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(let i2=0;i2<16;i2++){const row=[];rotationCayley.push(row);for(let j2=0;j2<16;j2++){const _ux=signum(ux[i2]*ux[j2]+vx[i2]*uy[j2]),_uy=signum(uy[i2]*ux[j2]+vy[i2]*uy[j2]),_vx=signum(ux[i2]*vx[j2]+vx[i2]*vy[j2]),_vy=signum(uy[i2]*vx[j2]+vy[i2]*vy[j2]);for(let k2=0;k2<16;k2++)if(ux[k2]===_ux&&uy[k2]===_uy&&vx[k2]===_vx&&vy[k2]===_vy){row.push(k2);break}}}for(let i2=0;i2<16;i2++){const mat=new Matrix;mat.set(ux[i2],uy[i2],vx[i2],vy[i2],0,0),rotationMatrices.push(mat)}}init();const groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:ind=>ux[ind],uY:ind=>uy[ind],vX:ind=>vx[ind],vY:ind=>vy[ind],inv:rotation=>rotation&8?rotation&15:-rotation&7,add:(rotationSecond,rotationFirst)=>rotationCayley[rotationSecond][rotationFirst],sub:(rotationSecond,rotationFirst)=>rotationCayley[rotationSecond][groupD8.inv(rotationFirst)],rotate180:rotation=>rotation^4,isVertical:rotation=>(rotation&3)===2,byDirection:(dx,dy)=>Math.abs(dx)*2<=Math.abs(dy)?dy>=0?groupD8.S:groupD8.N:Math.abs(dy)*2<=Math.abs(dx)?dx>0?groupD8.E:groupD8.W:dy>0?dx>0?groupD8.SE:groupD8.SW:dx>0?groupD8.NE:groupD8.NW,matrixAppendRotationInv:(matrix,rotation,tx=0,ty=0)=>{const mat=rotationMatrices[groupD8.inv(rotation)];mat.tx=tx,mat.ty=ty,matrix.append(mat)}};class ObservablePoint{constructor(cb,scope,x2=0,y2=0){this._x=x2,this._y=y2,this.cb=cb,this.scope=scope}clone(cb=this.cb,scope=this.scope){return new ObservablePoint(cb,scope,this._x,this._y)}set(x2=0,y2=x2){return(this._x!==x2||this._y!==y2)&&(this._x=x2,this._y=y2,this.cb.call(this.scope)),this}copyFrom(p2){return(this._x!==p2.x||this._y!==p2.y)&&(this._x=p2.x,this._y=p2.y,this.cb.call(this.scope)),this}copyTo(p2){return p2.set(this._x,this._y),p2}equals(p2){return p2.x===this._x&&p2.y===this._y}get x(){return this._x}set x(value){this._x!==value&&(this._x=value,this.cb.call(this.scope))}get y(){return this._y}set y(value){this._y!==value&&(this._y=value,this.cb.call(this.scope))}}ObservablePoint.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const _Transform=class{constructor(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const lt=this.localTransform;this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(parentTransform){const lt=this.localTransform;if(this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==parentTransform._worldID){const pt=parentTransform.worldTransform,wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c,wt.b=lt.a*pt.b+lt.b*pt.d,wt.c=lt.c*pt.a+lt.d*pt.c,wt.d=lt.c*pt.b+lt.d*pt.d,wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx,wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty,this._parentID=parentTransform._worldID,this._worldID++}}setFromMatrix(matrix){matrix.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(value){this._rotation!==value&&(this._rotation=value,this.updateSkew())}};_Transform.IDENTITY=new _Transform;let Transform=_Transform;Transform.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var defaultFragment$2=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex$3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function compileShader(gl,type,src){const shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),shader}function booleanArray(size){const array=new Array(size);for(let i2=0;i2<array.length;i2++)array[i2]=!1;return array}function defaultValue(type,size){switch(type){case"float":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"uvec2":return new Uint32Array(2*size);case"uvec3":return new Uint32Array(3*size);case"uvec4":return new Uint32Array(4*size);case"bool":return!1;case"bvec2":return booleanArray(2*size);case"bvec3":return booleanArray(3*size);case"bvec4":return booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const uniformParsers=[{test:data=>data.type==="float"&&data.size===1&&!data.isArray,code:name=>`
            if(uv["${name}"] !== ud["${name}"].value)
            {
                ud["${name}"].value = uv["${name}"]
                gl.uniform1f(ud["${name}"].location, uv["${name}"])
            }
            `},{test:(data,uniform)=>(data.type==="sampler2D"||data.type==="samplerCube"||data.type==="sampler2DArray")&&data.size===1&&!data.isArray&&(uniform==null||uniform.castToBaseTexture!==void 0),code:name=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${name}"], t);

            if(ud["${name}"].value !== t)
            {
                ud["${name}"].value = t;
                gl.uniform1i(ud["${name}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(data,uniform)=>data.type==="mat3"&&data.size===1&&!data.isArray&&uniform.a!==void 0,code:name=>`
            gl.uniformMatrix3fv(ud["${name}"].location, false, uv["${name}"].toArray(true));
            `,codeUbo:name=>`
                var ${name}_matrix = uv.${name}.toArray(true);

                data[offset] = ${name}_matrix[0];
                data[offset+1] = ${name}_matrix[1];
                data[offset+2] = ${name}_matrix[2];
        
                data[offset + 4] = ${name}_matrix[3];
                data[offset + 5] = ${name}_matrix[4];
                data[offset + 6] = ${name}_matrix[5];
        
                data[offset + 8] = ${name}_matrix[6];
                data[offset + 9] = ${name}_matrix[7];
                data[offset + 10] = ${name}_matrix[8];
            `},{test:(data,uniform)=>data.type==="vec2"&&data.size===1&&!data.isArray&&uniform.x!==void 0,code:name=>`
                cv = ud["${name}"].value;
                v = uv["${name}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${name}"].location, v.x, v.y);
                }`,codeUbo:name=>`
                v = uv.${name};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:data=>data.type==="vec2"&&data.size===1&&!data.isArray,code:name=>`
                cv = ud["${name}"].value;
                v = uv["${name}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${name}"].location, v[0], v[1]);
                }
            `},{test:(data,uniform)=>data.type==="vec4"&&data.size===1&&!data.isArray&&uniform.width!==void 0,code:name=>`
                cv = ud["${name}"].value;
                v = uv["${name}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${name}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:name=>`
                    v = uv.${name};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(data,uniform)=>data.type==="vec4"&&data.size===1&&!data.isArray&&uniform.red!==void 0,code:name=>`
                cv = ud["${name}"].value;
                v = uv["${name}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${name}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:name=>`
                    v = uv.${name};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(data,uniform)=>data.type==="vec3"&&data.size===1&&!data.isArray&&uniform.red!==void 0,code:name=>`
                cv = ud["${name}"].value;
                v = uv["${name}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${name}"].location, v.red, v.green, v.blue)
                }`,codeUbo:name=>`
                    v = uv.${name};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:data=>data.type==="vec4"&&data.size===1&&!data.isArray,code:name=>`
                cv = ud["${name}"].value;
                v = uv["${name}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${name}"].location, v[0], v[1], v[2], v[3])
                }`}],GLSL_TO_SINGLE_SETTERS_CACHED={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(group,uniformData){var _a2;const funcFragments=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const i2 in group.uniforms){const data=uniformData[i2];if(!data){((_a2=group.uniforms[i2])==null?void 0:_a2.group)===!0&&(group.uniforms[i2].ubo?funcFragments.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i2}, '${i2}');
                    `):funcFragments.push(`
                        renderer.shader.syncUniformGroup(uv.${i2}, syncData);
                    `));continue}const uniform=group.uniforms[i2];let parsed=!1;for(let j2=0;j2<uniformParsers.length;j2++)if(uniformParsers[j2].test(data,uniform)){funcFragments.push(uniformParsers[j2].code(i2,uniform)),parsed=!0;break}if(!parsed){const template=(data.size===1&&!data.isArray?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[data.type].replace("location",`ud["${i2}"].location`);funcFragments.push(`
            cu = ud["${i2}"];
            cv = cu.value;
            v = uv["${i2}"];
            ${template};`)}}return new Function("ud","uv","renderer","syncData",funcFragments.join(`
`))}const unknownContext={};let context=unknownContext;function getTestContext(){if(context===unknownContext||context!=null&&context.isContextLost()){const canvas=settings.ADAPTER.createCanvas();let gl;settings.PREFER_ENV>=ENV.WEBGL2&&(gl=canvas.getContext("webgl2",{})),gl||(gl=canvas.getContext("webgl",{})||canvas.getContext("experimental-webgl",{}),gl?gl.getExtension("WEBGL_draw_buffers"):gl=null),context=gl}return context}let maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;const gl=getTestContext();if(gl&&gl.getShaderPrecisionFormat){const shaderFragment=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);shaderFragment&&(maxFragmentPrecision=shaderFragment.precision?PRECISION.HIGH:PRECISION.MEDIUM)}}return maxFragmentPrecision}function logPrettyShaderError(gl,shader){const shaderSrc=gl.getShaderSource(shader).split(`
`).map((line,index)=>`${index}: ${line}`),shaderLog=gl.getShaderInfoLog(shader),splitShader=shaderLog.split(`
`),dedupe={},lineNumbers=splitShader.map(line=>parseFloat(line.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(n2=>n2&&!dedupe[n2]?(dedupe[n2]=!0,!0):!1),logArgs=[""];lineNumbers.forEach(number=>{shaderSrc[number-1]=`%c${shaderSrc[number-1]}%c`,logArgs.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const fragmentSourceToLog=shaderSrc.join(`
`);logArgs[0]=fragmentSourceToLog,console.error(shaderLog),console.groupCollapsed("click to view full shader code"),console.warn(...logArgs),console.groupEnd()}function logProgramError(gl,program,vertexShader,fragmentShader){gl.getProgramParameter(program,gl.LINK_STATUS)||(gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)||logPrettyShaderError(gl,vertexShader),gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)||logPrettyShaderError(gl,fragmentShader),console.error("PixiJS Error: Could not initialize shader."),gl.getProgramInfoLog(program)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program)))}const GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(type){return GLSL_TO_SIZE[type]}let GL_TABLE=null;const GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(gl,type){if(!GL_TABLE){const typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(let i2=0;i2<typeNames.length;++i2){const tn=typeNames[i2];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]}function setPrecision(src,requestedPrecision,maxSupportedPrecision){if(src.substring(0,9)!=="precision"){let precision=requestedPrecision;return requestedPrecision===PRECISION.HIGH&&maxSupportedPrecision!==PRECISION.HIGH&&(precision=PRECISION.MEDIUM),`precision ${precision} float;
${src}`}else if(maxSupportedPrecision!==PRECISION.HIGH&&src.substring(0,15)==="precision highp")return src.replace("precision highp","precision mediump");return src}let unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval=="boolean")return unsafeEval;try{unsafeEval=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch(e2){unsafeEval=!1}return unsafeEval}let UID$2=0;const nameCache={},_Program=class _Program2{constructor(vertexSrc,fragmentSrc,name="pixi-shader",extra={}){this.extra={},this.id=UID$2++,this.vertexSrc=vertexSrc||_Program2.defaultVertexSrc,this.fragmentSrc=fragmentSrc||_Program2.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=extra,this.vertexSrc.substring(0,8)!=="#version"&&(name=name.replace(/\s+/g,"-"),nameCache[name]?(nameCache[name]++,name+=`-${nameCache[name]}`):nameCache[name]=1,this.vertexSrc=`#define SHADER_NAME ${name}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${name}
${this.fragmentSrc}`,this.vertexSrc=setPrecision(this.vertexSrc,_Program2.defaultVertexPrecision,PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,_Program2.defaultFragmentPrecision,getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return defaultVertex$3}static get defaultFragmentSrc(){return defaultFragment$2}static from(vertexSrc,fragmentSrc,name){const key=vertexSrc+fragmentSrc;let program=ProgramCache[key];return program||(ProgramCache[key]=program=new _Program2(vertexSrc,fragmentSrc,name)),program}};_Program.defaultVertexPrecision=PRECISION.HIGH,_Program.defaultFragmentPrecision=isMobile.apple.device?PRECISION.HIGH:PRECISION.MEDIUM;let Program=_Program,UID$1=0;class UniformGroup{constructor(uniforms,isStatic,isUbo){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$1++,this.static=!!isStatic,this.ubo=!!isUbo,uniforms instanceof Buffer?(this.buffer=uniforms,this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=uniforms,this.ubo&&(this.buffer=new Buffer(new Float32Array(1)),this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(name,uniforms,_static){if(!this.ubo)this.uniforms[name]=new UniformGroup(uniforms,_static);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(uniforms,_static,_ubo){return new UniformGroup(uniforms,_static,_ubo)}static uboFrom(uniforms,_static){return new UniformGroup(uniforms,_static!=null?_static:!0,!0)}}class Shader{constructor(program,uniforms){this.uniformBindCount=0,this.program=program,uniforms?uniforms instanceof UniformGroup?this.uniformGroup=uniforms:this.uniformGroup=new UniformGroup(uniforms):this.uniformGroup=new UniformGroup({}),this.disposeRunner=new Runner("disposeShader")}checkUniformExists(name,group){if(group.uniforms[name])return!0;for(const i2 in group.uniforms){const uniform=group.uniforms[i2];if(uniform.group===!0&&this.checkUniformExists(name,uniform))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(vertexSrc,fragmentSrc,uniforms){const program=Program.from(vertexSrc,fragmentSrc);return new Shader(program,uniforms)}}class BatchShaderGenerator{constructor(vertexSrc,fragTemplate2){if(this.vertexSrc=vertexSrc,this.fragTemplate=fragTemplate2,this.programCache={},this.defaultGroupCache={},!fragTemplate2.includes("%count%"))throw new Error("Fragment template must contain \"%count%\".");if(!fragTemplate2.includes("%forloop%"))throw new Error("Fragment template must contain \"%forloop%\".")}generateShader(maxTextures){if(!this.programCache[maxTextures]){const sampleValues=new Int32Array(maxTextures);for(let i2=0;i2<maxTextures;i2++)sampleValues[i2]=i2;this.defaultGroupCache[maxTextures]=UniformGroup.from({uSamplers:sampleValues},!0);let fragmentSrc=this.fragTemplate;fragmentSrc=fragmentSrc.replace(/%count%/gi,`${maxTextures}`),fragmentSrc=fragmentSrc.replace(/%forloop%/gi,this.generateSampleSrc(maxTextures)),this.programCache[maxTextures]=new Program(this.vertexSrc,fragmentSrc)}const uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[maxTextures]};return new Shader(this.programCache[maxTextures],uniforms)}generateSampleSrc(maxTextures){let src="";src+=`
`,src+=`
`;for(let i2=0;i2<maxTextures;i2++)i2>0&&(src+=`
else `),i2<maxTextures-1&&(src+=`if(vTextureId < ${i2}.5)`),src+=`
{`,src+=`
	color = texture2D(uSamplers[${i2}], vTextureCoord);`,src+=`
}`;return src+=`
`,src+=`
`,src}}class BatchTextureArray{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let i2=0;i2<this.count;i2++)this.elements[i2]=null;this.count=0}}function canUploadSameBuffer(){return!isMobile.apple.device}function maxRecommendedTextures(max){let allowMax=!0;const navigator2=settings.ADAPTER.getNavigator();if(isMobile.tablet||isMobile.phone){if(isMobile.apple.device){const match=navigator2.userAgent.match(/OS (\d+)_(\d+)?/);match&&parseInt(match[1],10)<11&&(allowMax=!1)}if(isMobile.android.device){const match=navigator2.userAgent.match(/Android\s([0-9.]*)/);match&&parseInt(match[1],10)<7&&(allowMax=!1)}}return allowMax?max:4}class ObjectRenderer{constructor(renderer){this.renderer=renderer}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(_object){}}var defaultFragment$1=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,defaultVertex$2=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const _BatchRenderer=class _BatchRenderer2 extends ObjectRenderer{constructor(renderer){super(renderer),this.setShaderGenerator(),this.geometryClass=BatchGeometry,this.vertexSize=6,this.state=State.for2d(),this.size=_BatchRenderer2.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),renderer.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var _a2;return this._defaultMaxTextures=(_a2=this._defaultMaxTextures)!=null?_a2:maxRecommendedTextures(32),this._defaultMaxTextures}static set defaultMaxTextures(value){this._defaultMaxTextures=value}static get canUploadSameBuffer(){var _a2;return this._canUploadSameBuffer=(_a2=this._canUploadSameBuffer)!=null?_a2:canUploadSameBuffer(),this._canUploadSameBuffer}static set canUploadSameBuffer(value){this._canUploadSameBuffer=value}get MAX_TEXTURES(){return deprecation$1("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return defaultVertex$2}static get defaultFragmentTemplate(){return defaultFragment$1}setShaderGenerator({vertex:vertex2=_BatchRenderer2.defaultVertexSrc,fragment:fragment2=_BatchRenderer2.defaultFragmentTemplate}={}){this.shaderGenerator=new BatchShaderGenerator(vertex2,fragment2)}contextChange(){const gl=this.renderer.gl;settings.PREFER_ENV===ENV.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),_BatchRenderer2.defaultMaxTextures),this.maxTextures=checkMaxIfStatementsInShader(this.maxTextures,gl)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let i2=0;i2<this._packedGeometryPoolSize;i2++)this._packedGeometries[i2]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool,_textureArrayPool}=_BatchRenderer2,MAX_SPRITES=this.size/4,MAX_TA=Math.floor(MAX_SPRITES/this.maxTextures)+1;for(;_drawCallPool.length<MAX_SPRITES;)_drawCallPool.push(new BatchDrawCall);for(;_textureArrayPool.length<MAX_TA;)_textureArrayPool.push(new BatchTextureArray);for(let i2=0;i2<this.maxTextures;i2++)this._tempBoundTextures[i2]=null}onPrerender(){this._flushId=0}render(element){element._texture.valid&&(this._vertexCount+element.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=element.vertexData.length/2,this._indexCount+=element.indices.length,this._bufferedTextures[this._bufferSize]=element._texture.baseTexture,this._bufferedElements[this._bufferSize++]=element)}buildTexturesAndDrawCalls(){const{_bufferedTextures:textures,maxTextures}=this,textureArrays=_BatchRenderer2._textureArrayPool,batch=this.renderer.batch,boundTextures=this._tempBoundTextures,touch=this.renderer.textureGC.count;let TICK=++BaseTexture._globalBatch,countTexArrays=0,texArray=textureArrays[0],start=0;batch.copyBoundTextures(boundTextures,maxTextures);for(let i2=0;i2<this._bufferSize;++i2){const tex=textures[i2];textures[i2]=null,tex._batchEnabled!==TICK&&(texArray.count>=maxTextures&&(batch.boundArray(texArray,boundTextures,TICK,maxTextures),this.buildDrawCalls(texArray,start,i2),start=i2,texArray=textureArrays[++countTexArrays],++TICK),tex._batchEnabled=TICK,tex.touched=touch,texArray.elements[texArray.count++]=tex)}texArray.count>0&&(batch.boundArray(texArray,boundTextures,TICK,maxTextures),this.buildDrawCalls(texArray,start,this._bufferSize),++countTexArrays,++TICK);for(let i2=0;i2<boundTextures.length;i2++)boundTextures[i2]=null;BaseTexture._globalBatch=TICK}buildDrawCalls(texArray,start,finish){const{_bufferedElements:elements,_attributeBuffer,_indexBuffer,vertexSize}=this,drawCalls=_BatchRenderer2._drawCallPool;let dcIndex=this._dcIndex,aIndex=this._aIndex,iIndex=this._iIndex,drawCall=drawCalls[dcIndex];drawCall.start=this._iIndex,drawCall.texArray=texArray;for(let i2=start;i2<finish;++i2){const sprite=elements[i2],tex=sprite._texture.baseTexture,spriteBlendMode=premultiplyBlendMode[tex.alphaMode?1:0][sprite.blendMode];elements[i2]=null,start<i2&&drawCall.blend!==spriteBlendMode&&(drawCall.size=iIndex-drawCall.start,start=i2,drawCall=drawCalls[++dcIndex],drawCall.texArray=texArray,drawCall.start=iIndex),this.packInterleavedGeometry(sprite,_attributeBuffer,_indexBuffer,aIndex,iIndex),aIndex+=sprite.vertexData.length/2*vertexSize,iIndex+=sprite.indices.length,drawCall.blend=spriteBlendMode}start<finish&&(drawCall.size=iIndex-drawCall.start,++dcIndex),this._dcIndex=dcIndex,this._aIndex=aIndex,this._iIndex=iIndex}bindAndClearTexArray(texArray){const textureSystem=this.renderer.texture;for(let j2=0;j2<texArray.count;j2++)textureSystem.bind(texArray.elements[j2],texArray.ids[j2]),texArray.elements[j2]=null;texArray.count=0}updateGeometry(){const{_packedGeometries:packedGeometries,_attributeBuffer:attributeBuffer,_indexBuffer:indexBuffer}=this;_BatchRenderer2.canUploadSameBuffer?(packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,packedGeometries[this._flushId]=new this.geometryClass),packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.bind(packedGeometries[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const dcCount=this._dcIndex,{gl,state:stateSystem}=this.renderer,drawCalls=_BatchRenderer2._drawCallPool;let curTexArray=null;for(let i2=0;i2<dcCount;i2++){const{texArray,type,size,start,blend}=drawCalls[i2];curTexArray!==texArray&&(curTexArray=texArray,this.bindAndClearTexArray(texArray)),this.state.blendMode=blend,stateSystem.set(this.state),gl.drawElements(type,size,gl.UNSIGNED_SHORT,start*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),_BatchRenderer2.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i2=0;i2<this._packedGeometryPoolSize;i2++)this._packedGeometries[i2]&&this._packedGeometries[i2].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(size){const roundedP2=nextPow2(Math.ceil(size/8)),roundedSizeIndex=log2(roundedP2),roundedSize=roundedP2*8;this._aBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);let buffer=this._aBuffers[roundedSize];return buffer||(this._aBuffers[roundedSize]=buffer=new ViewableBuffer(roundedSize*this.vertexSize*4)),buffer}getIndexBuffer(size){const roundedP2=nextPow2(Math.ceil(size/12)),roundedSizeIndex=log2(roundedP2),roundedSize=roundedP2*12;this._iBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);let buffer=this._iBuffers[roundedSizeIndex];return buffer||(this._iBuffers[roundedSizeIndex]=buffer=new Uint16Array(roundedSize)),buffer}packInterleavedGeometry(element,attributeBuffer,indexBuffer,aIndex,iIndex){const{uint32View,float32View}=attributeBuffer,packedVertices=aIndex/this.vertexSize,uvs=element.uvs,indicies=element.indices,vertexData=element.vertexData,textureId=element._texture.baseTexture._batchLocation,alpha=Math.min(element.worldAlpha,1),argb=Color.shared.setValue(element._tintRGB).toPremultiplied(alpha,element._texture.baseTexture.alphaMode>0);for(let i2=0;i2<vertexData.length;i2+=2)float32View[aIndex++]=vertexData[i2],float32View[aIndex++]=vertexData[i2+1],float32View[aIndex++]=uvs[i2],float32View[aIndex++]=uvs[i2+1],uint32View[aIndex++]=argb,float32View[aIndex++]=textureId;for(let i2=0;i2<indicies.length;i2++)indexBuffer[iIndex++]=packedVertices+indicies[i2]}};_BatchRenderer.defaultBatchSize=4096,_BatchRenderer.extension={name:"batch",type:ExtensionType.RendererPlugin},_BatchRenderer._drawCallPool=[],_BatchRenderer._textureArrayPool=[];let BatchRenderer=_BatchRenderer;extensions$1.add(BatchRenderer);var defaultFragment=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,defaultVertex$1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const _Filter=class _Filter2 extends Shader{constructor(vertexSrc,fragmentSrc,uniforms){const program=Program.from(vertexSrc||_Filter2.defaultVertexSrc,fragmentSrc||_Filter2.defaultFragmentSrc);super(program,uniforms),this.padding=0,this.resolution=_Filter2.defaultResolution,this.multisample=_Filter2.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new State}apply(filterManager,input,output,clearMode,_currentState){filterManager.applyFilter(this,input,output,clearMode)}get blendMode(){return this.state.blendMode}set blendMode(value){this.state.blendMode=value}get resolution(){return this._resolution}set resolution(value){this._resolution=value}static get defaultVertexSrc(){return defaultVertex$1}static get defaultFragmentSrc(){return defaultFragment}};_Filter.defaultResolution=1,_Filter.defaultMultisample=MSAA_QUALITY.NONE;let Filter=_Filter;class BackgroundSystem{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Color(0),this.alpha=1}init(options){this.clearBeforeRender=options.clearBeforeRender;const{backgroundColor,background,backgroundAlpha}=options,color=background!=null?background:backgroundColor;color!==void 0&&(this.color=color),this.alpha=backgroundAlpha}get color(){return this._backgroundColor.value}set color(value){this._backgroundColor.setValue(value)}get alpha(){return this._backgroundColor.alpha}set alpha(value){this._backgroundColor.setAlpha(value)}get backgroundColor(){return this._backgroundColor}destroy(){}}BackgroundSystem.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},BackgroundSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"background"},extensions$1.add(BackgroundSystem);class BatchSystem{constructor(renderer){this.renderer=renderer,this.emptyRenderer=new ObjectRenderer(renderer),this.currentRenderer=this.emptyRenderer}setObjectRenderer(objectRenderer){this.currentRenderer!==objectRenderer&&(this.currentRenderer.stop(),this.currentRenderer=objectRenderer,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(arr,maxTextures){const{boundTextures}=this.renderer.texture;for(let i2=maxTextures-1;i2>=0;--i2)arr[i2]=boundTextures[i2]||null,arr[i2]&&(arr[i2]._batchLocation=i2)}boundArray(texArray,boundTextures,batchId,maxTextures){const{elements,ids,count}=texArray;let j2=0;for(let i2=0;i2<count;i2++){const tex=elements[i2],loc=tex._batchLocation;if(loc>=0&&loc<maxTextures&&boundTextures[loc]===tex){ids[i2]=loc;continue}for(;j2<maxTextures;){const bound=boundTextures[j2];if(bound&&bound._batchEnabled===batchId&&bound._batchLocation===j2){j2++;continue}ids[i2]=j2,tex._batchLocation=j2,boundTextures[j2]=tex;break}}}destroy(){this.renderer=null}}BatchSystem.extension={type:ExtensionType.RendererSystem,name:"batch"},extensions$1.add(BatchSystem);let CONTEXT_UID_COUNTER=0;class ContextSystem{constructor(renderer){this.renderer=renderer,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(gl){this.gl=gl,this.renderer.gl=gl,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++}init(options){if(options.context)this.initFromContext(options.context);else{const alpha=this.renderer.background.alpha<1,premultipliedAlpha=options.premultipliedAlpha;this.preserveDrawingBuffer=options.preserveDrawingBuffer,this.useContextAlpha=options.useContextAlpha,this.powerPreference=options.powerPreference,this.initFromOptions({alpha,premultipliedAlpha,antialias:options.antialias,stencil:!0,preserveDrawingBuffer:options.preserveDrawingBuffer,powerPreference:options.powerPreference})}}initFromContext(gl){this.gl=gl,this.validateContext(gl),this.renderer.gl=gl,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(gl);const view=this.renderer.view;view.addEventListener!==void 0&&(view.addEventListener("webglcontextlost",this.handleContextLost,!1),view.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(options){const gl=this.createContext(this.renderer.view,options);this.initFromContext(gl)}createContext(canvas,options){let gl;if(settings.PREFER_ENV>=ENV.WEBGL2&&(gl=canvas.getContext("webgl2",options)),gl)this.webGLVersion=2;else if(this.webGLVersion=1,gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options),!gl)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=gl,this.getExtensions(),this.gl}getExtensions(){const{gl}=this,common={loseContext:gl.getExtension("WEBGL_lose_context"),anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,common,{drawBuffers:gl.getExtension("WEBGL_draw_buffers"),depthTexture:gl.getExtension("WEBGL_depth_texture"),vertexArrayObject:gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:gl.getExtension("OES_element_index_uint"),floatTexture:gl.getExtension("OES_texture_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),textureHalfFloat:gl.getExtension("OES_texture_half_float"),textureHalfFloatLinear:gl.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,common,{colorBufferFloat:gl.getExtension("EXT_color_buffer_float")})}handleContextLost(event){event.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const view=this.renderer.view;this.renderer=null,view.removeEventListener!==void 0&&(view.removeEventListener("webglcontextlost",this.handleContextLost),view.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(gl){const attributes=gl.getContextAttributes(),isWebGl2="WebGL2RenderingContext"in globalThis&&gl instanceof globalThis.WebGL2RenderingContext;isWebGl2&&(this.webGLVersion=2),attributes&&!attributes.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const hasuint32=isWebGl2||!!gl.getExtension("OES_element_index_uint");this.supports.uint32Indices=hasuint32,hasuint32||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}ContextSystem.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},ContextSystem.extension={type:ExtensionType.RendererSystem,name:"context"},extensions$1.add(ContextSystem);class Framebuffer{constructor(width,height){if(this.width=Math.round(width),this.height=Math.round(height),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(index=0,texture){return this.colorTextures[index]=texture||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(texture){return this.depthTexture=texture||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(width,height){if(width=Math.round(width),height=Math.round(height),!width||!height)throw new Error("Framebuffer width and height must not be zero");if(!(width===this.width&&height===this.height)){this.width=width,this.height=height,this.dirtyId++,this.dirtySize++;for(let i2=0;i2<this.colorTextures.length;i2++){const texture=this.colorTextures[i2],resolution=texture.resolution;texture.setSize(width/resolution,height/resolution)}if(this.depthTexture){const resolution=this.depthTexture.resolution;this.depthTexture.setSize(width/resolution,height/resolution)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class BaseRenderTexture extends BaseTexture{constructor(options={}){var _a2,_b,_c;if(typeof options=="number"){const width=arguments[0],height=arguments[1],scaleMode=arguments[2],resolution=arguments[3];options={width,height,scaleMode,resolution}}options.width=(_a2=options.width)!=null?_a2:100,options.height=(_b=options.height)!=null?_b:100,(_c=options.multisample)!=null||(options.multisample=MSAA_QUALITY.NONE),super(null,options),this.mipmap=MIPMAP_MODES.OFF,this.valid=!0,this._clear=new Color([0,0,0,0]),this.framebuffer=new Framebuffer(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=options.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(value){this._clear.setValue(value)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(value){this.framebuffer.multisample=value}resize(desiredWidth,desiredHeight){this.framebuffer.resize(desiredWidth*this.resolution,desiredHeight*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class BaseImageResource extends Resource{constructor(source){const sourceAny=source,width=sourceAny.naturalWidth||sourceAny.videoWidth||sourceAny.width,height=sourceAny.naturalHeight||sourceAny.videoHeight||sourceAny.height;super(width,height),this.source=source,this.noSubImage=!1}static crossOrigin(element,url2,crossorigin){crossorigin===void 0&&!url2.startsWith("data:")?element.crossOrigin=determineCrossOrigin(url2):crossorigin!==!1&&(element.crossOrigin=typeof crossorigin=="string"?crossorigin:"anonymous")}upload(renderer,baseTexture,glTexture,source){const gl=renderer.gl,width=baseTexture.realWidth,height=baseTexture.realHeight;if(source=source||this.source,typeof HTMLImageElement!="undefined"&&source instanceof HTMLImageElement){if(!source.complete||source.naturalWidth===0)return!1}else if(typeof HTMLVideoElement!="undefined"&&source instanceof HTMLVideoElement&&source.readyState<=1)return!1;return gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===ALPHA_MODES.UNPACK),!this.noSubImage&&baseTexture.target===gl.TEXTURE_2D&&glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,baseTexture.format,glTexture.type,source):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,baseTexture.format,glTexture.type,source)),!0}update(){if(this.destroyed)return;const source=this.source,width=source.naturalWidth||source.videoWidth||source.width,height=source.naturalHeight||source.videoHeight||source.height;this.resize(width,height),super.update()}dispose(){this.source=null}}class ImageResource extends BaseImageResource{constructor(source,options){var _a2;if(options=options||{},typeof source=="string"){const imageElement=new Image;BaseImageResource.crossOrigin(imageElement,source,options.crossorigin),imageElement.src=source,source=imageElement}super(source),!source.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=source.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((_a2=options.createBitmap)!=null?_a2:settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof options.alphaMode=="number"?options.alphaMode:null,this.bitmap=null,this._load=null,options.autoLoad!==!1&&this.load()}load(createBitmap){return this._load?this._load:(createBitmap!==void 0&&(this.createBitmap=createBitmap),this._load=new Promise((resolve2,reject)=>{const source=this.source;this.url=source.src;const completed=()=>{this.destroyed||(source.onload=null,source.onerror=null,this.update(),this._load=null,this.createBitmap?resolve2(this.process()):resolve2(this))};source.complete&&source.src?completed():(source.onload=completed,source.onerror=event=>{reject(event),this.onError.emit(event)})}),this._load)}process(){const source=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const createImageBitmap2=globalThis.createImageBitmap,cors=!source.crossOrigin||source.crossOrigin==="anonymous";return this._process=fetch(source.src,{mode:cors?"cors":"no-cors"}).then(r2=>r2.blob()).then(blob=>createImageBitmap2(blob,0,0,source.width,source.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"})).then(bitmap=>this.destroyed?Promise.reject():(this.bitmap=bitmap,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(renderer,baseTexture,glTexture){if(typeof this.alphaMode=="number"&&(baseTexture.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(renderer,baseTexture,glTexture);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(renderer,baseTexture,glTexture,this.bitmap),!this.preserveBitmap){let flag=!0;const glTextures=baseTexture._glTextures;for(const key in glTextures){const otherTex=glTextures[key];if(otherTex!==glTexture&&otherTex.dirtyId!==baseTexture.dirtyId){flag=!1;break}}flag&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(source){return typeof HTMLImageElement!="undefined"&&(typeof source=="string"||source instanceof HTMLImageElement)}}class TextureUvs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(frame,baseFrame,rotate){const tw=baseFrame.width,th=baseFrame.height;if(rotate){const w2=frame.width/2/tw,h2=frame.height/2/th,cX=frame.x/tw+w2,cY=frame.y/th+h2;rotate=groupD8.add(rotate,groupD8.NW),this.x0=cX+w2*groupD8.uX(rotate),this.y0=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x1=cX+w2*groupD8.uX(rotate),this.y1=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x2=cX+w2*groupD8.uX(rotate),this.y2=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x3=cX+w2*groupD8.uX(rotate),this.y3=cY+h2*groupD8.uY(rotate)}else this.x0=frame.x/tw,this.y0=frame.y/th,this.x1=(frame.x+frame.width)/tw,this.y1=frame.y/th,this.x2=(frame.x+frame.width)/tw,this.y2=(frame.y+frame.height)/th,this.x3=frame.x/tw,this.y3=(frame.y+frame.height)/th;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}TextureUvs.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const DEFAULT_UVS=new TextureUvs;function removeAllHandlers(tex){tex.destroy=function(){},tex.on=function(){},tex.once=function(){},tex.emit=function(){}}class Texture extends EventEmitter{constructor(baseTexture,frame,orig,trim,rotate,anchor,borders){if(super(),this.noFrame=!1,frame||(this.noFrame=!0,frame=new Rectangle(0,0,1,1)),baseTexture instanceof Texture&&(baseTexture=baseTexture.baseTexture),this.baseTexture=baseTexture,this._frame=frame,this.trim=trim,this.valid=!1,this.destroyed=!1,this._uvs=DEFAULT_UVS,this.uvMatrix=null,this.orig=orig||frame,this._rotate=Number(rotate||0),rotate===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=anchor?new Point(anchor.x,anchor.y):new Point(0,0),this.defaultBorders=borders,this._updateID=0,this.textureCacheIds=[],baseTexture.valid?this.noFrame?baseTexture.valid&&this.onBaseTextureUpdated(baseTexture):this.frame=frame:baseTexture.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&baseTexture.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(baseTexture){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=baseTexture.width,this._frame.height=baseTexture.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(destroyBase){if(this.baseTexture){if(destroyBase){const{resource}=this.baseTexture;resource!=null&&resource.url&&TextureCache[resource.url]&&Texture.removeFromCache(resource.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var _a2;const clonedFrame=this._frame.clone(),clonedOrig=this._frame===this.orig?clonedFrame:this.orig.clone(),clonedTexture=new Texture(this.baseTexture,!this.noFrame&&clonedFrame,clonedOrig,(_a2=this.trim)==null?void 0:_a2.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(clonedTexture._frame=clonedFrame),clonedTexture}updateUvs(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(source,options={},strict=settings.STRICT_TEXTURE_CACHE){const isFrame=typeof source=="string";let cacheId=null;if(isFrame)cacheId=source;else if(source instanceof BaseTexture){if(!source.cacheId){const prefix=(options==null?void 0:options.pixiIdPrefix)||"pixiid";source.cacheId=`${prefix}-${uid()}`,BaseTexture.addToCache(source,source.cacheId)}cacheId=source.cacheId}else{if(!source._pixiId){const prefix=(options==null?void 0:options.pixiIdPrefix)||"pixiid";source._pixiId=`${prefix}_${uid()}`}cacheId=source._pixiId}let texture=TextureCache[cacheId];if(isFrame&&strict&&!texture)throw new Error(`The cacheId "${cacheId}" does not exist in TextureCache.`);return!texture&&!(source instanceof BaseTexture)?(options.resolution||(options.resolution=getResolutionOfUrl(source)),texture=new Texture(new BaseTexture(source,options)),texture.baseTexture.cacheId=cacheId,BaseTexture.addToCache(texture.baseTexture,cacheId),Texture.addToCache(texture,cacheId)):!texture&&source instanceof BaseTexture&&(texture=new Texture(source),Texture.addToCache(texture,cacheId)),texture}static fromURL(url2,options){const resourceOptions=Object.assign({autoLoad:!1},options==null?void 0:options.resourceOptions),texture=Texture.from(url2,Object.assign({resourceOptions},options),!1),resource=texture.baseTexture.resource;return texture.baseTexture.valid?Promise.resolve(texture):resource.load().then(()=>Promise.resolve(texture))}static fromBuffer(buffer,width,height,options){return new Texture(BaseTexture.fromBuffer(buffer,width,height,options))}static fromLoader(source,imageUrl,name,options){const baseTexture=new BaseTexture(source,Object.assign({scaleMode:BaseTexture.defaultOptions.scaleMode,resolution:getResolutionOfUrl(imageUrl)},options)),{resource}=baseTexture;resource instanceof ImageResource&&(resource.url=imageUrl);const texture=new Texture(baseTexture);return name||(name=imageUrl),BaseTexture.addToCache(texture.baseTexture,name),Texture.addToCache(texture,name),name!==imageUrl&&(BaseTexture.addToCache(texture.baseTexture,imageUrl),Texture.addToCache(texture,imageUrl)),texture.baseTexture.valid?Promise.resolve(texture):new Promise(resolve2=>{texture.baseTexture.once("loaded",()=>resolve2(texture))})}static addToCache(texture,id){id&&(texture.textureCacheIds.includes(id)||texture.textureCacheIds.push(id),TextureCache[id]&&TextureCache[id]!==texture&&console.warn(`Texture added to the cache with an id [${id}] that already had an entry`),TextureCache[id]=texture)}static removeFromCache(texture){if(typeof texture=="string"){const textureFromCache=TextureCache[texture];if(textureFromCache){const index=textureFromCache.textureCacheIds.indexOf(texture);return index>-1&&textureFromCache.textureCacheIds.splice(index,1),delete TextureCache[texture],textureFromCache}}else if(texture!=null&&texture.textureCacheIds){for(let i2=0;i2<texture.textureCacheIds.length;++i2)TextureCache[texture.textureCacheIds[i2]]===texture&&delete TextureCache[texture.textureCacheIds[i2]];return texture.textureCacheIds.length=0,texture}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(frame){this._frame=frame,this.noFrame=!1;const{x:x2,y:y2,width,height}=frame,xNotFit=x2+width>this.baseTexture.width,yNotFit=y2+height>this.baseTexture.height;if(xNotFit||yNotFit){const relationship=xNotFit&&yNotFit?"and":"or",errorX=`X: ${x2} + ${width} = ${x2+width} > ${this.baseTexture.width}`,errorY=`Y: ${y2} + ${height} = ${y2+height} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${errorX} ${relationship} ${errorY}`)}this.valid=width&&height&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=frame),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(rotate){this._rotate=rotate,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Texture._EMPTY||(Texture._EMPTY=new Texture(new BaseTexture()),removeAllHandlers(Texture._EMPTY),removeAllHandlers(Texture._EMPTY.baseTexture)),Texture._EMPTY}static get WHITE(){if(!Texture._WHITE){const canvas=settings.ADAPTER.createCanvas(16,16),context2=canvas.getContext("2d");canvas.width=16,canvas.height=16,context2.fillStyle="white",context2.fillRect(0,0,16,16),Texture._WHITE=new Texture(BaseTexture.from(canvas)),removeAllHandlers(Texture._WHITE),removeAllHandlers(Texture._WHITE.baseTexture)}return Texture._WHITE}}class RenderTexture extends Texture{constructor(baseRenderTexture,frame){super(baseRenderTexture,frame),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(value){this.framebuffer.multisample=value}resize(desiredWidth,desiredHeight,resizeBaseTexture=!0){const resolution=this.baseTexture.resolution,width=Math.round(desiredWidth*resolution)/resolution,height=Math.round(desiredHeight*resolution)/resolution;this.valid=width>0&&height>0,this._frame.width=this.orig.width=width,this._frame.height=this.orig.height=height,resizeBaseTexture&&this.baseTexture.resize(width,height),this.updateUvs()}setResolution(resolution){const{baseTexture}=this;baseTexture.resolution!==resolution&&(baseTexture.setResolution(resolution),this.resize(baseTexture.width,baseTexture.height,!1))}static create(options){return new RenderTexture(new BaseRenderTexture(options))}}class RenderTexturePool{constructor(textureOptions){this.texturePool={},this.textureOptions=textureOptions||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(realWidth,realHeight,multisample=MSAA_QUALITY.NONE){const baseRenderTexture=new BaseRenderTexture(Object.assign({width:realWidth,height:realHeight,resolution:1,multisample},this.textureOptions));return new RenderTexture(baseRenderTexture)}getOptimalTexture(minWidth,minHeight,resolution=1,multisample=MSAA_QUALITY.NONE){let key;minWidth=Math.max(Math.ceil(minWidth*resolution-1e-6),1),minHeight=Math.max(Math.ceil(minHeight*resolution-1e-6),1),!this.enableFullScreen||minWidth!==this._pixelsWidth||minHeight!==this._pixelsHeight?(minWidth=nextPow2(minWidth),minHeight=nextPow2(minHeight),key=((minWidth&65535)<<16|minHeight&65535)>>>0,multisample>1&&(key+=multisample*4294967296)):key=multisample>1?-multisample:-1,this.texturePool[key]||(this.texturePool[key]=[]);let renderTexture=this.texturePool[key].pop();return renderTexture||(renderTexture=this.createTexture(minWidth,minHeight,multisample)),renderTexture.filterPoolKey=key,renderTexture.setResolution(resolution),renderTexture}getFilterTexture(input,resolution,multisample){const filterTexture=this.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||MSAA_QUALITY.NONE);return filterTexture.filterFrame=input.filterFrame,filterTexture}returnTexture(renderTexture){const key=renderTexture.filterPoolKey;renderTexture.filterFrame=null,this.texturePool[key].push(renderTexture)}returnFilterTexture(renderTexture){this.returnTexture(renderTexture)}clear(destroyTextures){if(destroyTextures=destroyTextures!==!1,destroyTextures)for(const i2 in this.texturePool){const textures=this.texturePool[i2];if(textures)for(let j2=0;j2<textures.length;j2++)textures[j2].destroy(!0)}this.texturePool={}}setScreenSize(size){if(!(size.width===this._pixelsWidth&&size.height===this._pixelsHeight)){this.enableFullScreen=size.width>0&&size.height>0;for(const i2 in this.texturePool){if(!(Number(i2)<0))continue;const textures=this.texturePool[i2];if(textures)for(let j2=0;j2<textures.length;j2++)textures[j2].destroy(!0);this.texturePool[i2]=[]}this._pixelsWidth=size.width,this._pixelsHeight=size.height}}}RenderTexturePool.SCREEN_KEY=-1;class Quad extends Geometry{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class QuadUv extends Geometry{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Buffer(this.vertices),this.uvBuffer=new Buffer(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(targetTextureFrame,destinationFrame){let x2=0,y2=0;return this.uvs[0]=x2,this.uvs[1]=y2,this.uvs[2]=x2+destinationFrame.width/targetTextureFrame.width,this.uvs[3]=y2,this.uvs[4]=x2+destinationFrame.width/targetTextureFrame.width,this.uvs[5]=y2+destinationFrame.height/targetTextureFrame.height,this.uvs[6]=x2,this.uvs[7]=y2+destinationFrame.height/targetTextureFrame.height,x2=destinationFrame.x,y2=destinationFrame.y,this.vertices[0]=x2,this.vertices[1]=y2,this.vertices[2]=x2+destinationFrame.width,this.vertices[3]=y2,this.vertices[4]=x2+destinationFrame.width,this.vertices[5]=y2+destinationFrame.height,this.vertices[6]=x2,this.vertices[7]=y2+destinationFrame.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class FilterState{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=MSAA_QUALITY.NONE,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const tempPoints=[new Point,new Point,new Point,new Point],tempMatrix$4=new Matrix;class FilterSystem{constructor(renderer){this.renderer=renderer,this.defaultFilterStack=[{}],this.texturePool=new RenderTexturePool,this.statePool=[],this.quad=new Quad,this.quadUv=new QuadUv,this.tempRect=new Rectangle,this.activeState={},this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(target,filters2){var _a2,_b,_c,_d;const renderer=this.renderer,filterStack=this.defaultFilterStack,state=this.statePool.pop()||new FilterState,renderTextureSystem=renderer.renderTexture;let currentResolution,currentMultisample;if(renderTextureSystem.current){const renderTexture=renderTextureSystem.current;currentResolution=renderTexture.resolution,currentMultisample=renderTexture.multisample}else currentResolution=renderer.resolution,currentMultisample=renderer.multisample;let resolution=filters2[0].resolution||currentResolution,multisample=(_a2=filters2[0].multisample)!=null?_a2:currentMultisample,padding=filters2[0].padding,autoFit=filters2[0].autoFit,legacy=(_b=filters2[0].legacy)!=null?_b:!0;for(let i2=1;i2<filters2.length;i2++){const filter=filters2[i2];resolution=Math.min(resolution,filter.resolution||currentResolution),multisample=Math.min(multisample,(_c=filter.multisample)!=null?_c:currentMultisample),padding=this.useMaxPadding?Math.max(padding,filter.padding):padding+filter.padding,autoFit=autoFit&&filter.autoFit,legacy=legacy||((_d=filter.legacy)!=null?_d:!0)}filterStack.length===1&&(this.defaultFilterStack[0].renderTexture=renderTextureSystem.current),filterStack.push(state),state.resolution=resolution,state.multisample=multisample,state.legacy=legacy,state.target=target,state.sourceFrame.copyFrom(target.filterArea||target.getBounds(!0)),state.sourceFrame.pad(padding);const sourceFrameProjected=this.tempRect.copyFrom(renderTextureSystem.sourceFrame);renderer.projection.transform&&this.transformAABB(tempMatrix$4.copyFrom(renderer.projection.transform).invert(),sourceFrameProjected),autoFit?(state.sourceFrame.fit(sourceFrameProjected),(state.sourceFrame.width<=0||state.sourceFrame.height<=0)&&(state.sourceFrame.width=0,state.sourceFrame.height=0)):state.sourceFrame.intersects(sourceFrameProjected)||(state.sourceFrame.width=0,state.sourceFrame.height=0),this.roundFrame(state.sourceFrame,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform),state.renderTexture=this.getOptimalFilterTexture(state.sourceFrame.width,state.sourceFrame.height,resolution,multisample),state.filters=filters2,state.destinationFrame.width=state.renderTexture.width,state.destinationFrame.height=state.renderTexture.height;const destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=state.sourceFrame.width,destinationFrame.height=state.sourceFrame.height,state.renderTexture.filterFrame=state.sourceFrame,state.bindingSourceFrame.copyFrom(renderTextureSystem.sourceFrame),state.bindingDestinationFrame.copyFrom(renderTextureSystem.destinationFrame),state.transform=renderer.projection.transform,renderer.projection.transform=null,renderTextureSystem.bind(state.renderTexture,state.sourceFrame,destinationFrame),renderer.framebuffer.clear(0,0,0,0)}pop(){const filterStack=this.defaultFilterStack,state=filterStack.pop(),filters2=state.filters;this.activeState=state;const globalUniforms=this.globalUniforms.uniforms;globalUniforms.outputFrame=state.sourceFrame,globalUniforms.resolution=state.resolution;const inputSize=globalUniforms.inputSize,inputPixel=globalUniforms.inputPixel,inputClamp=globalUniforms.inputClamp;if(inputSize[0]=state.destinationFrame.width,inputSize[1]=state.destinationFrame.height,inputSize[2]=1/inputSize[0],inputSize[3]=1/inputSize[1],inputPixel[0]=Math.round(inputSize[0]*state.resolution),inputPixel[1]=Math.round(inputSize[1]*state.resolution),inputPixel[2]=1/inputPixel[0],inputPixel[3]=1/inputPixel[1],inputClamp[0]=0.5*inputPixel[2],inputClamp[1]=0.5*inputPixel[3],inputClamp[2]=state.sourceFrame.width*inputSize[2]-0.5*inputPixel[2],inputClamp[3]=state.sourceFrame.height*inputSize[3]-0.5*inputPixel[3],state.legacy){const filterArea=globalUniforms.filterArea;filterArea[0]=state.destinationFrame.width,filterArea[1]=state.destinationFrame.height,filterArea[2]=state.sourceFrame.x,filterArea[3]=state.sourceFrame.y,globalUniforms.filterClamp=globalUniforms.inputClamp}this.globalUniforms.update();const lastState=filterStack[filterStack.length-1];if(this.renderer.framebuffer.blit(),filters2.length===1)filters2[0].apply(this,state.renderTexture,lastState.renderTexture,CLEAR_MODES.BLEND,state),this.returnFilterTexture(state.renderTexture);else{let flip=state.renderTexture,flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution);flop.filterFrame=flip.filterFrame;let i2=0;for(i2=0;i2<filters2.length-1;++i2){i2===1&&state.multisample>1&&(flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution),flop.filterFrame=flip.filterFrame),filters2[i2].apply(this,flip,flop,CLEAR_MODES.CLEAR,state);const t2=flip;flip=flop,flop=t2}filters2[i2].apply(this,flip,lastState.renderTexture,CLEAR_MODES.BLEND,state),i2>1&&state.multisample>1&&this.returnFilterTexture(state.renderTexture),this.returnFilterTexture(flip),this.returnFilterTexture(flop)}state.clear(),this.statePool.push(state)}bindAndClear(filterTexture,clearMode=CLEAR_MODES.CLEAR){const{renderTexture:renderTextureSystem,state:stateSystem}=this.renderer;if(filterTexture===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,filterTexture!=null&&filterTexture.filterFrame){const destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=filterTexture.filterFrame.width,destinationFrame.height=filterTexture.filterFrame.height,renderTextureSystem.bind(filterTexture,filterTexture.filterFrame,destinationFrame)}else filterTexture!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?renderTextureSystem.bind(filterTexture):this.renderer.renderTexture.bind(filterTexture,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const autoClear=stateSystem.stateId&1||this.forceClear;(clearMode===CLEAR_MODES.CLEAR||clearMode===CLEAR_MODES.BLIT&&autoClear)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(filter,input,output,clearMode){const renderer=this.renderer;renderer.state.set(filter.state),this.bindAndClear(output,clearMode),filter.uniforms.uSampler=input,filter.uniforms.filterGlobals=this.globalUniforms,renderer.shader.bind(filter),filter.legacy=!!filter.program.attributeData.aTextureCoord,filter.legacy?(this.quadUv.map(input._frame,input.filterFrame),renderer.geometry.bind(this.quadUv),renderer.geometry.draw(DRAW_MODES.TRIANGLES)):(renderer.geometry.bind(this.quad),renderer.geometry.draw(DRAW_MODES.TRIANGLE_STRIP))}calculateSpriteMatrix(outputMatrix,sprite){const{sourceFrame,destinationFrame}=this.activeState,{orig}=sprite._texture,mappedMatrix=outputMatrix.set(destinationFrame.width,0,0,destinationFrame.height,sourceFrame.x,sourceFrame.y),worldTransform=sprite.worldTransform.copyTo(Matrix.TEMP_MATRIX);return worldTransform.invert(),mappedMatrix.prepend(worldTransform),mappedMatrix.scale(1/orig.width,1/orig.height),mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y),mappedMatrix}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(minWidth,minHeight,resolution=1,multisample=MSAA_QUALITY.NONE){return this.texturePool.getOptimalTexture(minWidth,minHeight,resolution,multisample)}getFilterTexture(input,resolution,multisample){if(typeof input=="number"){const swap=input;input=resolution,resolution=swap}input=input||this.activeState.renderTexture;const filterTexture=this.texturePool.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||MSAA_QUALITY.NONE);return filterTexture.filterFrame=input.filterFrame,filterTexture}returnFilterTexture(renderTexture){this.texturePool.returnTexture(renderTexture)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(matrix,rect){const lt=tempPoints[0],lb=tempPoints[1],rt=tempPoints[2],rb=tempPoints[3];lt.set(rect.left,rect.top),lb.set(rect.left,rect.bottom),rt.set(rect.right,rect.top),rb.set(rect.right,rect.bottom),matrix.apply(lt,lt),matrix.apply(lb,lb),matrix.apply(rt,rt),matrix.apply(rb,rb);const x0=Math.min(lt.x,lb.x,rt.x,rb.x),y0=Math.min(lt.y,lb.y,rt.y,rb.y),x1=Math.max(lt.x,lb.x,rt.x,rb.x),y1=Math.max(lt.y,lb.y,rt.y,rb.y);rect.x=x0,rect.y=y0,rect.width=x1-x0,rect.height=y1-y0}roundFrame(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){if(!(frame.width<=0||frame.height<=0||bindingSourceFrame.width<=0||bindingSourceFrame.height<=0)){if(transform){const{a:a2,b:b2,c:c2,d:d2}=transform;if((Math.abs(b2)>1e-4||Math.abs(c2)>1e-4)&&(Math.abs(a2)>1e-4||Math.abs(d2)>1e-4))return}transform=transform?tempMatrix$4.copyFrom(transform):tempMatrix$4.identity(),transform.translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y),this.transformAABB(transform,frame),frame.ceil(resolution),this.transformAABB(transform.invert(),frame)}}}FilterSystem.extension={type:ExtensionType.RendererSystem,name:"filter"},extensions$1.add(FilterSystem);class GLFramebuffer{constructor(framebuffer){this.framebuffer=framebuffer,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const tempRectangle=new Rectangle;class FramebufferSystem{constructor(renderer){this.renderer=renderer,this.managedFramebuffers=[],this.unknownFramebuffer=new Framebuffer(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const gl=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let nativeDrawBuffersExtension=this.renderer.context.extensions.drawBuffers,nativeDepthTextureExtension=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(nativeDrawBuffersExtension=null,nativeDepthTextureExtension=null),nativeDrawBuffersExtension?gl.drawBuffers=activeTextures=>nativeDrawBuffersExtension.drawBuffersWEBGL(activeTextures):(this.hasMRT=!1,gl.drawBuffers=()=>{}),nativeDepthTextureExtension||(this.writeDepthTexture=!1)}else this.msaaSamples=gl.getInternalformatParameter(gl.RENDERBUFFER,gl.RGBA8,gl.SAMPLES)}bind(framebuffer,frame,mipLevel=0){const{gl}=this;if(framebuffer){const fbo=framebuffer.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(framebuffer);this.current!==framebuffer&&(this.current=framebuffer,gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.framebuffer)),fbo.mipLevel!==mipLevel&&(framebuffer.dirtyId++,framebuffer.dirtyFormat++,fbo.mipLevel=mipLevel),fbo.dirtyId!==framebuffer.dirtyId&&(fbo.dirtyId=framebuffer.dirtyId,fbo.dirtyFormat!==framebuffer.dirtyFormat?(fbo.dirtyFormat=framebuffer.dirtyFormat,fbo.dirtySize=framebuffer.dirtySize,this.updateFramebuffer(framebuffer,mipLevel)):fbo.dirtySize!==framebuffer.dirtySize&&(fbo.dirtySize=framebuffer.dirtySize,this.resizeFramebuffer(framebuffer)));for(let i2=0;i2<framebuffer.colorTextures.length;i2++){const tex=framebuffer.colorTextures[i2];this.renderer.texture.unbind(tex.parentTextureArray||tex)}if(framebuffer.depthTexture&&this.renderer.texture.unbind(framebuffer.depthTexture),frame){const mipWidth=frame.width>>mipLevel,mipHeight=frame.height>>mipLevel,scale=mipWidth/frame.width;this.setViewport(frame.x*scale,frame.y*scale,mipWidth,mipHeight)}else{const mipWidth=framebuffer.width>>mipLevel,mipHeight=framebuffer.height>>mipLevel;this.setViewport(0,0,mipWidth,mipHeight)}}else this.current&&(this.current=null,gl.bindFramebuffer(gl.FRAMEBUFFER,null)),frame?this.setViewport(frame.x,frame.y,frame.width,frame.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(x2,y2,width,height){const v2=this.viewport;x2=Math.round(x2),y2=Math.round(y2),width=Math.round(width),height=Math.round(height),(v2.width!==width||v2.height!==height||v2.x!==x2||v2.y!==y2)&&(v2.x=x2,v2.y=y2,v2.width=width,v2.height=height,this.gl.viewport(x2,y2,width,height))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(r2,g2,b2,a2,mask=BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH){const{gl}=this;gl.clearColor(r2,g2,b2,a2),gl.clear(mask)}initFramebuffer(framebuffer){const{gl}=this,fbo=new GLFramebuffer(gl.createFramebuffer());return fbo.multisample=this.detectSamples(framebuffer.multisample),framebuffer.glFramebuffers[this.CONTEXT_UID]=fbo,this.managedFramebuffers.push(framebuffer),framebuffer.disposeRunner.add(this),fbo}resizeFramebuffer(framebuffer){const{gl}=this,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(fbo.stencil){gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil);let stencilFormat;this.renderer.context.webGLVersion===1?stencilFormat=gl.DEPTH_STENCIL:framebuffer.depth&&framebuffer.stencil?stencilFormat=gl.DEPTH24_STENCIL8:framebuffer.depth?stencilFormat=gl.DEPTH_COMPONENT24:stencilFormat=gl.STENCIL_INDEX8,fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,stencilFormat,framebuffer.width,framebuffer.height):gl.renderbufferStorage(gl.RENDERBUFFER,stencilFormat,framebuffer.width,framebuffer.height)}const colorTextures=framebuffer.colorTextures;let count=colorTextures.length;gl.drawBuffers||(count=Math.min(count,1));for(let i2=0;i2<count;i2++){const texture=colorTextures[i2],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0),i2===0&&fbo.msaaBuffer&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,parentTexture._glTextures[this.CONTEXT_UID].internalFormat,framebuffer.width,framebuffer.height))}framebuffer.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(framebuffer.depthTexture,0)}updateFramebuffer(framebuffer,mipLevel){const{gl}=this,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],colorTextures=framebuffer.colorTextures;let count=colorTextures.length;gl.drawBuffers||(count=Math.min(count,1)),fbo.multisample>1&&this.canMultisampleFramebuffer(framebuffer)?fbo.msaaBuffer=fbo.msaaBuffer||gl.createRenderbuffer():fbo.msaaBuffer&&(gl.deleteRenderbuffer(fbo.msaaBuffer),fbo.msaaBuffer=null,fbo.blitFramebuffer&&(fbo.blitFramebuffer.dispose(),fbo.blitFramebuffer=null));const activeTextures=[];for(let i2=0;i2<count;i2++){const texture=colorTextures[i2],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0),i2===0&&fbo.msaaBuffer?(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,parentTexture._glTextures[this.CONTEXT_UID].internalFormat,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,fbo.msaaBuffer)):(gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i2,texture.target,parentTexture._glTextures[this.CONTEXT_UID].texture,mipLevel),activeTextures.push(gl.COLOR_ATTACHMENT0+i2))}if(activeTextures.length>1&&gl.drawBuffers(activeTextures),framebuffer.depthTexture&&this.writeDepthTexture){const depthTexture=framebuffer.depthTexture;this.renderer.texture.bind(depthTexture,0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,depthTexture._glTextures[this.CONTEXT_UID].texture,mipLevel)}if((framebuffer.stencil||framebuffer.depth)&&!(framebuffer.depthTexture&&this.writeDepthTexture)){fbo.stencil=fbo.stencil||gl.createRenderbuffer();let stencilAttachment,stencilFormat;this.renderer.context.webGLVersion===1?(stencilAttachment=gl.DEPTH_STENCIL_ATTACHMENT,stencilFormat=gl.DEPTH_STENCIL):framebuffer.depth&&framebuffer.stencil?(stencilAttachment=gl.DEPTH_STENCIL_ATTACHMENT,stencilFormat=gl.DEPTH24_STENCIL8):framebuffer.depth?(stencilAttachment=gl.DEPTH_ATTACHMENT,stencilFormat=gl.DEPTH_COMPONENT24):(stencilAttachment=gl.STENCIL_ATTACHMENT,stencilFormat=gl.STENCIL_INDEX8),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,stencilFormat,framebuffer.width,framebuffer.height):gl.renderbufferStorage(gl.RENDERBUFFER,stencilFormat,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,stencilAttachment,gl.RENDERBUFFER,fbo.stencil)}else fbo.stencil&&(gl.deleteRenderbuffer(fbo.stencil),fbo.stencil=null)}canMultisampleFramebuffer(framebuffer){return this.renderer.context.webGLVersion!==1&&framebuffer.colorTextures.length<=1&&!framebuffer.depthTexture}detectSamples(samples){const{msaaSamples}=this;let res=MSAA_QUALITY.NONE;if(samples<=1||msaaSamples===null)return res;for(let i2=0;i2<msaaSamples.length;i2++)if(msaaSamples[i2]<=samples){res=msaaSamples[i2];break}return res===1&&(res=MSAA_QUALITY.NONE),res}blit(framebuffer,sourcePixels,destPixels){const{current,renderer,gl,CONTEXT_UID}=this;if(renderer.context.webGLVersion!==2||!current)return;const fbo=current.glFramebuffers[CONTEXT_UID];if(!fbo)return;if(!framebuffer){if(!fbo.msaaBuffer)return;const colorTexture=current.colorTextures[0];if(!colorTexture)return;fbo.blitFramebuffer||(fbo.blitFramebuffer=new Framebuffer(current.width,current.height),fbo.blitFramebuffer.addColorTexture(0,colorTexture)),framebuffer=fbo.blitFramebuffer,framebuffer.colorTextures[0]!==colorTexture&&(framebuffer.colorTextures[0]=colorTexture,framebuffer.dirtyId++,framebuffer.dirtyFormat++),(framebuffer.width!==current.width||framebuffer.height!==current.height)&&(framebuffer.width=current.width,framebuffer.height=current.height,framebuffer.dirtyId++,framebuffer.dirtySize++)}sourcePixels||(sourcePixels=tempRectangle,sourcePixels.width=current.width,sourcePixels.height=current.height),destPixels||(destPixels=sourcePixels);const sameSize=sourcePixels.width===destPixels.width&&sourcePixels.height===destPixels.height;this.bind(framebuffer),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,fbo.framebuffer),gl.blitFramebuffer(sourcePixels.left,sourcePixels.top,sourcePixels.right,sourcePixels.bottom,destPixels.left,destPixels.top,destPixels.right,destPixels.bottom,gl.COLOR_BUFFER_BIT,sameSize?gl.NEAREST:gl.LINEAR),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,framebuffer.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(framebuffer,contextLost){const fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],gl=this.gl;if(!fbo)return;delete framebuffer.glFramebuffers[this.CONTEXT_UID];const index=this.managedFramebuffers.indexOf(framebuffer);index>=0&&this.managedFramebuffers.splice(index,1),framebuffer.disposeRunner.remove(this),contextLost||(gl.deleteFramebuffer(fbo.framebuffer),fbo.msaaBuffer&&gl.deleteRenderbuffer(fbo.msaaBuffer),fbo.stencil&&gl.deleteRenderbuffer(fbo.stencil)),fbo.blitFramebuffer&&this.disposeFramebuffer(fbo.blitFramebuffer,contextLost)}disposeAll(contextLost){const list=this.managedFramebuffers;this.managedFramebuffers=[];for(let i2=0;i2<list.length;i2++)this.disposeFramebuffer(list[i2],contextLost)}forceStencil(){const framebuffer=this.current;if(!framebuffer)return;const fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(!fbo||fbo.stencil&&framebuffer.stencil)return;framebuffer.stencil=!0;const w2=framebuffer.width,h2=framebuffer.height,gl=this.gl,stencil=fbo.stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil);let stencilAttachment,stencilFormat;this.renderer.context.webGLVersion===1?(stencilAttachment=gl.DEPTH_STENCIL_ATTACHMENT,stencilFormat=gl.DEPTH_STENCIL):framebuffer.depth?(stencilAttachment=gl.DEPTH_STENCIL_ATTACHMENT,stencilFormat=gl.DEPTH24_STENCIL8):(stencilAttachment=gl.STENCIL_ATTACHMENT,stencilFormat=gl.STENCIL_INDEX8),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,stencilFormat,w2,h2):gl.renderbufferStorage(gl.RENDERBUFFER,stencilFormat,w2,h2),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,stencilAttachment,gl.RENDERBUFFER,stencil)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle}destroy(){this.renderer=null}}FramebufferSystem.extension={type:ExtensionType.RendererSystem,name:"framebuffer"},extensions$1.add(FramebufferSystem);const byteSizeMap={5126:4,5123:2,5121:1};class GeometrySystem{constructor(renderer){this.renderer=renderer,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const gl=this.gl=this.renderer.gl,context2=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,context2.webGLVersion!==2){let nativeVaoExtension=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(nativeVaoExtension=null),nativeVaoExtension?(gl.createVertexArray=()=>nativeVaoExtension.createVertexArrayOES(),gl.bindVertexArray=vao=>nativeVaoExtension.bindVertexArrayOES(vao),gl.deleteVertexArray=vao=>nativeVaoExtension.deleteVertexArrayOES(vao)):(this.hasVao=!1,gl.createVertexArray=()=>null,gl.bindVertexArray=()=>null,gl.deleteVertexArray=()=>null)}if(context2.webGLVersion!==2){const instanceExt=gl.getExtension("ANGLE_instanced_arrays");instanceExt?(gl.vertexAttribDivisor=(a2,b2)=>instanceExt.vertexAttribDivisorANGLE(a2,b2),gl.drawElementsInstanced=(a2,b2,c2,d2,e2)=>instanceExt.drawElementsInstancedANGLE(a2,b2,c2,d2,e2),gl.drawArraysInstanced=(a2,b2,c2,d2)=>instanceExt.drawArraysInstancedANGLE(a2,b2,c2,d2)):this.hasInstance=!1}this.canUseUInt32ElementIndex=context2.webGLVersion===2||!!context2.extensions.uint32ElementIndex}bind(geometry,shader){shader=shader||this.renderer.shader.shader;const{gl}=this;let vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],incRefCount=!1;vaos||(this.managedGeometries[geometry.id]=geometry,geometry.disposeRunner.add(this),geometry.glVertexArrayObjects[this.CONTEXT_UID]=vaos={},incRefCount=!0);const vao=vaos[shader.program.id]||this.initGeometryVao(geometry,shader,incRefCount);this._activeGeometry=geometry,this._activeVao!==vao&&(this._activeVao=vao,this.hasVao?gl.bindVertexArray(vao):this.activateVao(geometry,shader.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const geometry=this._activeGeometry,bufferSystem=this.renderer.buffer;for(let i2=0;i2<geometry.buffers.length;i2++){const buffer=geometry.buffers[i2];bufferSystem.update(buffer)}}checkCompatibility(geometry,program){const geometryAttributes=geometry.attributes,shaderAttributes=program.attributeData;for(const j2 in shaderAttributes)if(!geometryAttributes[j2])throw new Error(`shader and geometry incompatible, geometry missing the "${j2}" attribute`)}getSignature(geometry,program){const attribs=geometry.attributes,shaderAttributes=program.attributeData,strings=["g",geometry.id];for(const i2 in attribs)shaderAttributes[i2]&&strings.push(i2,shaderAttributes[i2].location);return strings.join("-")}initGeometryVao(geometry,shader,incRefCount=!0){const gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,bufferSystem=this.renderer.buffer,program=shader.program;program.glPrograms[CONTEXT_UID]||this.renderer.shader.generateProgram(shader),this.checkCompatibility(geometry,program);const signature=this.getSignature(geometry,program),vaoObjectHash=geometry.glVertexArrayObjects[this.CONTEXT_UID];let vao=vaoObjectHash[signature];if(vao)return vaoObjectHash[program.id]=vao,vao;const buffers=geometry.buffers,attributes=geometry.attributes,tempStride={},tempStart={};for(const j2 in buffers)tempStride[j2]=0,tempStart[j2]=0;for(const j2 in attributes)!attributes[j2].size&&program.attributeData[j2]?attributes[j2].size=program.attributeData[j2].size:attributes[j2].size||console.warn(`PIXI Geometry attribute '${j2}' size cannot be determined (likely the bound shader does not have the attribute)`),tempStride[attributes[j2].buffer]+=attributes[j2].size*byteSizeMap[attributes[j2].type];for(const j2 in attributes){const attribute=attributes[j2],attribSize=attribute.size;attribute.stride===void 0&&(tempStride[attribute.buffer]===attribSize*byteSizeMap[attribute.type]?attribute.stride=0:attribute.stride=tempStride[attribute.buffer]),attribute.start===void 0&&(attribute.start=tempStart[attribute.buffer],tempStart[attribute.buffer]+=attribSize*byteSizeMap[attribute.type])}vao=gl.createVertexArray(),gl.bindVertexArray(vao);for(let i2=0;i2<buffers.length;i2++){const buffer=buffers[i2];bufferSystem.bind(buffer),incRefCount&&buffer._glBuffers[CONTEXT_UID].refCount++}return this.activateVao(geometry,program),vaoObjectHash[program.id]=vao,vaoObjectHash[signature]=vao,gl.bindVertexArray(null),bufferSystem.unbind(BUFFER_TYPE.ARRAY_BUFFER),vao}disposeGeometry(geometry,contextLost){var _a2;if(!this.managedGeometries[geometry.id])return;delete this.managedGeometries[geometry.id];const vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],gl=this.gl,buffers=geometry.buffers,bufferSystem=(_a2=this.renderer)==null?void 0:_a2.buffer;if(geometry.disposeRunner.remove(this),!!vaos){if(bufferSystem)for(let i2=0;i2<buffers.length;i2++){const buf=buffers[i2]._glBuffers[this.CONTEXT_UID];buf&&(buf.refCount--,buf.refCount===0&&!contextLost&&bufferSystem.dispose(buffers[i2],contextLost))}if(!contextLost){for(const vaoId in vaos)if(vaoId[0]==="g"){const vao=vaos[vaoId];this._activeVao===vao&&this.unbind(),gl.deleteVertexArray(vao)}}delete geometry.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(contextLost){const all=Object.keys(this.managedGeometries);for(let i2=0;i2<all.length;i2++)this.disposeGeometry(this.managedGeometries[all[i2]],contextLost)}activateVao(geometry,program){const gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,bufferSystem=this.renderer.buffer,buffers=geometry.buffers,attributes=geometry.attributes;geometry.indexBuffer&&bufferSystem.bind(geometry.indexBuffer);let lastBuffer=null;for(const j2 in attributes){const attribute=attributes[j2],buffer=buffers[attribute.buffer],glBuffer=buffer._glBuffers[CONTEXT_UID];if(program.attributeData[j2]){lastBuffer!==glBuffer&&(bufferSystem.bind(buffer),lastBuffer=glBuffer);const location=program.attributeData[j2].location;if(gl.enableVertexAttribArray(location),gl.vertexAttribPointer(location,attribute.size,attribute.type||gl.FLOAT,attribute.normalized,attribute.stride,attribute.start),attribute.instance)if(this.hasInstance)gl.vertexAttribDivisor(location,attribute.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(type,size,start,instanceCount){const{gl}=this,geometry=this._activeGeometry;if(geometry.indexBuffer){const byteSize=geometry.indexBuffer.data.BYTES_PER_ELEMENT,glType=byteSize===2?gl.UNSIGNED_SHORT:gl.UNSIGNED_INT;byteSize===2||byteSize===4&&this.canUseUInt32ElementIndex?geometry.instanced?gl.drawElementsInstanced(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize,instanceCount||1):gl.drawElements(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize):console.warn("unsupported index buffer type: uint32")}else geometry.instanced?gl.drawArraysInstanced(type,start,size||geometry.getSize(),instanceCount||1):gl.drawArrays(type,start,size||geometry.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}GeometrySystem.extension={type:ExtensionType.RendererSystem,name:"geometry"},extensions$1.add(GeometrySystem);const tempMat$1=new Matrix;class TextureMatrix{constructor(texture,clampMargin){this._texture=texture,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof clampMargin=="undefined"?0.5:clampMargin,this.isSimple=!1}get texture(){return this._texture}set texture(value){this._texture=value,this._textureID=-1}multiplyUvs(uvs,out){out===void 0&&(out=uvs);const mat=this.mapCoord;for(let i2=0;i2<uvs.length;i2+=2){const x2=uvs[i2],y2=uvs[i2+1];out[i2]=x2*mat.a+y2*mat.c+mat.tx,out[i2+1]=x2*mat.b+y2*mat.d+mat.ty}return out}update(forceUpdate){const tex=this._texture;if(!tex||!tex.valid||!forceUpdate&&this._textureID===tex._updateID)return!1;this._textureID=tex._updateID,this._updateID++;const uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);const orig=tex.orig,trim=tex.trim;trim&&(tempMat$1.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height),this.mapCoord.append(tempMat$1));const texBase=tex.baseTexture,frame=this.uClampFrame,margin=this.clampMargin/texBase.resolution,offset=this.clampOffset;return frame[0]=(tex._frame.x+margin+offset)/texBase.width,frame[1]=(tex._frame.y+margin+offset)/texBase.height,frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width,frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height,this.uClampOffset[0]=offset/texBase.realWidth,this.uClampOffset[1]=offset/texBase.realHeight,this.isSimple=tex._frame.width===texBase.width&&tex._frame.height===texBase.height&&tex.rotate===0,!0}}var fragment$7=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,vertex$4=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class SpriteMaskFilter extends Filter{constructor(vertexSrc,fragmentSrc,uniforms){let sprite=null;typeof vertexSrc!="string"&&fragmentSrc===void 0&&uniforms===void 0&&(sprite=vertexSrc,vertexSrc=void 0,fragmentSrc=void 0,uniforms=void 0),super(vertexSrc||vertex$4,fragmentSrc||fragment$7,uniforms),this.maskSprite=sprite,this.maskMatrix=new Matrix}get maskSprite(){return this._maskSprite}set maskSprite(value){this._maskSprite=value,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(filterManager,input,output,clearMode){const maskSprite=this._maskSprite,tex=maskSprite._texture;tex.valid&&(tex.uvMatrix||(tex.uvMatrix=new TextureMatrix(tex,0)),tex.uvMatrix.update(),this.uniforms.npmAlpha=tex.baseTexture.alphaMode?0:1,this.uniforms.mask=tex,this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.uvMatrix.mapCoord),this.uniforms.alpha=maskSprite.worldAlpha,this.uniforms.maskClamp=tex.uvMatrix.uClampFrame,filterManager.applyFilter(this,input,output,clearMode))}}class MaskData{constructor(maskObject=null){this.type=MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=maskObject||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Filter.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(value){value?this._filters?this._filters[0]=value:this._filters=[value]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(maskAbove){maskAbove?(this._stencilCounter=maskAbove._stencilCounter,this._scissorCounter=maskAbove._scissorCounter,this._scissorRect=maskAbove._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class MaskSystem{constructor(renderer){this.renderer=renderer,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(maskStack){this.maskStack=maskStack,this.renderer.scissor.setMaskStack(maskStack),this.renderer.stencil.setMaskStack(maskStack)}push(target,maskDataOrTarget){let maskData=maskDataOrTarget;if(!maskData.isMaskData){const d2=this.maskDataPool.pop()||new MaskData;d2.pooled=!0,d2.maskObject=maskDataOrTarget,maskData=d2}const maskAbove=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(maskData.copyCountersOrReset(maskAbove),maskData._colorMask=maskAbove?maskAbove._colorMask:15,maskData.autoDetect&&this.detect(maskData),maskData._target=target,maskData.type!==MASK_TYPES.SPRITE&&this.maskStack.push(maskData),maskData.enabled)switch(maskData.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.push(maskData);break;case MASK_TYPES.STENCIL:this.renderer.stencil.push(maskData);break;case MASK_TYPES.SPRITE:maskData.copyCountersOrReset(null),this.pushSpriteMask(maskData);break;case MASK_TYPES.COLOR:this.pushColorMask(maskData);break;default:break}maskData.type===MASK_TYPES.SPRITE&&this.maskStack.push(maskData)}pop(target){const maskData=this.maskStack.pop();if(!(!maskData||maskData._target!==target)){if(maskData.enabled)switch(maskData.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop(maskData);break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(maskData.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask(maskData);break;case MASK_TYPES.COLOR:this.popColorMask(maskData);break;default:break}if(maskData.reset(),maskData.pooled&&this.maskDataPool.push(maskData),this.maskStack.length!==0){const maskCurrent=this.maskStack[this.maskStack.length-1];maskCurrent.type===MASK_TYPES.SPRITE&&maskCurrent._filters&&(maskCurrent._filters[0].maskSprite=maskCurrent.maskObject)}}}detect(maskData){const maskObject=maskData.maskObject;maskObject?maskObject.isSprite?maskData.type=MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(maskData)?maskData.type=MASK_TYPES.SCISSOR:maskData.type=MASK_TYPES.STENCIL:maskData.type=MASK_TYPES.COLOR}pushSpriteMask(maskData){const{maskObject}=maskData,target=maskData._target;let alphaMaskFilter=maskData._filters;alphaMaskFilter||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex],alphaMaskFilter||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter])),alphaMaskFilter[0].resolution=maskData.resolution,alphaMaskFilter[0].multisample=maskData.multisample,alphaMaskFilter[0].maskSprite=maskObject;const stashFilterArea=target.filterArea;target.filterArea=maskObject.getBounds(!0),this.renderer.filter.push(target,alphaMaskFilter),target.filterArea=stashFilterArea,maskData._filters||this.alphaMaskIndex++}popSpriteMask(maskData){this.renderer.filter.pop(),maskData._filters?maskData._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(maskData){const currColorMask=maskData._colorMask,nextColorMask=maskData._colorMask=currColorMask&maskData.colorMask;nextColorMask!==currColorMask&&this.renderer.gl.colorMask((nextColorMask&1)!==0,(nextColorMask&2)!==0,(nextColorMask&4)!==0,(nextColorMask&8)!==0)}popColorMask(maskData){const currColorMask=maskData._colorMask,nextColorMask=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;nextColorMask!==currColorMask&&this.renderer.gl.colorMask((nextColorMask&1)!==0,(nextColorMask&2)!==0,(nextColorMask&4)!==0,(nextColorMask&8)!==0)}destroy(){this.renderer=null}}MaskSystem.extension={type:ExtensionType.RendererSystem,name:"mask"},extensions$1.add(MaskSystem);class AbstractMaskSystem{constructor(renderer){this.renderer=renderer,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(maskStack){const{gl}=this.renderer,curStackLen=this.getStackLength();this.maskStack=maskStack;const newStackLen=this.getStackLength();newStackLen!==curStackLen&&(newStackLen===0?gl.disable(this.glConst):(gl.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const tempMatrix$3=new Matrix,rectPool=[],_ScissorSystem=class _ScissorSystem2 extends AbstractMaskSystem{constructor(renderer){super(renderer),this.glConst=settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._scissorCounter:0}calcScissorRect(maskData){var _a2;if(maskData._scissorRectLocal)return;const prevData=maskData._scissorRect,{maskObject}=maskData,{renderer}=this,renderTextureSystem=renderer.renderTexture,rect=maskObject.getBounds(!0,(_a2=rectPool.pop())!=null?_a2:new Rectangle);this.roundFrameToPixels(rect,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform),prevData&&rect.fit(prevData),maskData._scissorRectLocal=rect}static isMatrixRotated(matrix){if(!matrix)return!1;const{a:a2,b:b2,c:c2,d:d2}=matrix;return(Math.abs(b2)>1e-4||Math.abs(c2)>1e-4)&&(Math.abs(a2)>1e-4||Math.abs(d2)>1e-4)}testScissor(maskData){const{maskObject}=maskData;if(!maskObject.isFastRect||!maskObject.isFastRect()||_ScissorSystem2.isMatrixRotated(maskObject.worldTransform)||_ScissorSystem2.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(maskData);const rect=maskData._scissorRectLocal;return rect.width>0&&rect.height>0}roundFrameToPixels(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){_ScissorSystem2.isMatrixRotated(transform)||(transform=transform?tempMatrix$3.copyFrom(transform):tempMatrix$3.identity(),transform.translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y),this.renderer.filter.transformAABB(transform,frame),frame.fit(bindingDestinationFrame),frame.x=Math.round(frame.x*resolution),frame.y=Math.round(frame.y*resolution),frame.width=Math.round(frame.width*resolution),frame.height=Math.round(frame.height*resolution))}push(maskData){maskData._scissorRectLocal||this.calcScissorRect(maskData);const{gl}=this.renderer;maskData._scissorRect||gl.enable(gl.SCISSOR_TEST),maskData._scissorCounter++,maskData._scissorRect=maskData._scissorRectLocal,this._useCurrent()}pop(maskData){const{gl}=this.renderer;maskData&&rectPool.push(maskData._scissorRectLocal),this.getStackLength()>0?this._useCurrent():gl.disable(gl.SCISSOR_TEST)}_useCurrent(){const rect=this.maskStack[this.maskStack.length-1]._scissorRect;let y2;this.renderer.renderTexture.current?y2=rect.y:y2=this.renderer.height-rect.height-rect.y,this.renderer.gl.scissor(rect.x,y2,rect.width,rect.height)}};_ScissorSystem.extension={type:ExtensionType.RendererSystem,name:"scissor"};let ScissorSystem=_ScissorSystem;extensions$1.add(ScissorSystem);class StencilSystem extends AbstractMaskSystem{constructor(renderer){super(renderer),this.glConst=settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._stencilCounter:0}push(maskData){const maskObject=maskData.maskObject,{gl}=this.renderer,prevMaskCount=maskData._stencilCounter;prevMaskCount===0&&(this.renderer.framebuffer.forceStencil(),gl.clearStencil(0),gl.clear(gl.STENCIL_BUFFER_BIT),gl.enable(gl.STENCIL_TEST)),maskData._stencilCounter++;const colorMask=maskData._colorMask;colorMask!==0&&(maskData._colorMask=0,gl.colorMask(!1,!1,!1,!1)),gl.stencilFunc(gl.EQUAL,prevMaskCount,4294967295),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),maskObject.renderable=!1,colorMask!==0&&(maskData._colorMask=colorMask,gl.colorMask((colorMask&1)!==0,(colorMask&2)!==0,(colorMask&4)!==0,(colorMask&8)!==0)),this._useCurrent()}pop(maskObject){const gl=this.renderer.gl;if(this.getStackLength()===0)gl.disable(gl.STENCIL_TEST);else{const maskData=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,colorMask=maskData?maskData._colorMask:15;colorMask!==0&&(maskData._colorMask=0,gl.colorMask(!1,!1,!1,!1)),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),maskObject.renderable=!1,colorMask!==0&&(maskData._colorMask=colorMask,gl.colorMask((colorMask&1)!==0,(colorMask&2)!==0,(colorMask&4)!==0,(colorMask&8)!==0)),this._useCurrent()}}_useCurrent(){const gl=this.renderer.gl;gl.stencilFunc(gl.EQUAL,this.getStackLength(),4294967295),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)}}StencilSystem.extension={type:ExtensionType.RendererSystem,name:"stencil"},extensions$1.add(StencilSystem);class PluginSystem{constructor(renderer){this.renderer=renderer,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return deprecation$1("7.0.0","renderer.plugins.extract has moved to renderer.extract"),renderer.extract}},prepare:{enumerable:!1,get(){return deprecation$1("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),renderer.prepare}},interaction:{enumerable:!1,get(){return deprecation$1("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),renderer.events}}})}init(){const staticMap=this.rendererPlugins;for(const o2 in staticMap)this.plugins[o2]=new staticMap[o2](this.renderer)}destroy(){for(const o2 in this.plugins)this.plugins[o2].destroy(),this.plugins[o2]=null}}PluginSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_plugin"},extensions$1.add(PluginSystem);class ProjectionSystem{constructor(renderer){this.renderer=renderer,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Matrix,this.transform=null}update(destinationFrame,sourceFrame,resolution,root){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame,this.sourceFrame=sourceFrame||this.sourceFrame||destinationFrame,this.calculateProjection(this.destinationFrame,this.sourceFrame,resolution,root),this.transform&&this.projectionMatrix.append(this.transform);const renderer=this.renderer;renderer.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,renderer.globalUniforms.update(),renderer.shader.shader&&renderer.shader.syncUniformGroup(renderer.shader.shader.uniforms.globals)}calculateProjection(_destinationFrame,sourceFrame,_resolution,root){const pm=this.projectionMatrix,sign2=root?-1:1;pm.identity(),pm.a=1/sourceFrame.width*2,pm.d=sign2*(1/sourceFrame.height*2),pm.tx=-1-sourceFrame.x*pm.a,pm.ty=-sign2-sourceFrame.y*pm.d}setTransform(_matrix){}destroy(){this.renderer=null}}ProjectionSystem.extension={type:ExtensionType.RendererSystem,name:"projection"},extensions$1.add(ProjectionSystem);var __getOwnPropSymbols$c=Object.getOwnPropertySymbols,__hasOwnProp$c=Object.prototype.hasOwnProperty,__propIsEnum$c=Object.prototype.propertyIsEnumerable,__objRest$1=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$c.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(source!=null&&__getOwnPropSymbols$c)for(var prop of __getOwnPropSymbols$c(source))exclude.indexOf(prop)<0&&__propIsEnum$c.call(source,prop)&&(target[prop]=source[prop]);return target};const tempTransform=new Transform,tempRect$1=new Rectangle;class GenerateTextureSystem{constructor(renderer){this.renderer=renderer,this._tempMatrix=new Matrix}generateTexture(displayObject,options){var _b;const _a2=options||{},{region:manualRegion}=_a2,textureOptions=__objRest$1(_a2,["region"]),region=(manualRegion==null?void 0:manualRegion.copyTo(tempRect$1))||displayObject.getLocalBounds(tempRect$1,!0),resolution=textureOptions.resolution||this.renderer.resolution;region.width=Math.max(region.width,1/resolution),region.height=Math.max(region.height,1/resolution),textureOptions.width=region.width,textureOptions.height=region.height,textureOptions.resolution=resolution,(_b=textureOptions.multisample)!=null||(textureOptions.multisample=this.renderer.multisample);const renderTexture=RenderTexture.create(textureOptions);this._tempMatrix.tx=-region.x,this._tempMatrix.ty=-region.y;const transform=displayObject.transform;return displayObject.transform=tempTransform,this.renderer.render(displayObject,{renderTexture,transform:this._tempMatrix,skipUpdateTransform:!!displayObject.parent,blit:!0}),displayObject.transform=transform,renderTexture}destroy(){}}GenerateTextureSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"textureGenerator"},extensions$1.add(GenerateTextureSystem);const tempRect=new Rectangle,tempRect2=new Rectangle;class RenderTextureSystem{constructor(renderer){this.renderer=renderer,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.viewportFrame=new Rectangle}contextChange(){var _a2;const attributes=(_a2=this.renderer)==null?void 0:_a2.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(attributes&&attributes.alpha&&attributes.premultipliedAlpha)}bind(renderTexture=null,sourceFrame,destinationFrame){const renderer=this.renderer;this.current=renderTexture;let baseTexture,framebuffer,resolution;renderTexture?(baseTexture=renderTexture.baseTexture,resolution=baseTexture.resolution,sourceFrame||(tempRect.width=renderTexture.frame.width,tempRect.height=renderTexture.frame.height,sourceFrame=tempRect),destinationFrame||(tempRect2.x=renderTexture.frame.x,tempRect2.y=renderTexture.frame.y,tempRect2.width=sourceFrame.width,tempRect2.height=sourceFrame.height,destinationFrame=tempRect2),framebuffer=baseTexture.framebuffer):(resolution=renderer.resolution,sourceFrame||(tempRect.width=renderer._view.screen.width,tempRect.height=renderer._view.screen.height,sourceFrame=tempRect),destinationFrame||(destinationFrame=tempRect,destinationFrame.width=sourceFrame.width,destinationFrame.height=sourceFrame.height));const viewportFrame=this.viewportFrame;viewportFrame.x=destinationFrame.x*resolution,viewportFrame.y=destinationFrame.y*resolution,viewportFrame.width=destinationFrame.width*resolution,viewportFrame.height=destinationFrame.height*resolution,renderTexture||(viewportFrame.y=renderer.view.height-(viewportFrame.y+viewportFrame.height)),viewportFrame.ceil(),this.renderer.framebuffer.bind(framebuffer,viewportFrame),this.renderer.projection.update(destinationFrame,sourceFrame,resolution,!framebuffer),renderTexture?this.renderer.mask.setMaskStack(baseTexture.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(sourceFrame),this.destinationFrame.copyFrom(destinationFrame)}clear(clearColor,mask){const fallbackColor=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,color=Color.shared.setValue(clearColor||fallbackColor);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&color.premultiply(color.alpha);const destinationFrame=this.destinationFrame,baseFrame=this.current?this.current.baseTexture:this.renderer._view.screen,clearMask=destinationFrame.width!==baseFrame.width||destinationFrame.height!==baseFrame.height;if(clearMask){let{x:x2,y:y2,width,height}=this.viewportFrame;x2=Math.round(x2),y2=Math.round(y2),width=Math.round(width),height=Math.round(height),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(x2,y2,width,height)}this.renderer.framebuffer.clear(color.red,color.green,color.blue,color.alpha,mask),clearMask&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}RenderTextureSystem.extension={type:ExtensionType.RendererSystem,name:"renderTexture"},extensions$1.add(RenderTextureSystem);class IGLUniformData{}class GLProgram{constructor(program,uniformData){this.program=program,this.uniformData=uniformData,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function getAttributeData(program,gl){const attributes={},totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(let i2=0;i2<totalAttributes;i2++){const attribData=gl.getActiveAttrib(program,i2);if(attribData.name.startsWith("gl_"))continue;const type=mapType(gl,attribData.type),data={type,name:attribData.name,size:mapSize(type),location:gl.getAttribLocation(program,attribData.name)};attributes[attribData.name]=data}return attributes}function getUniformData(program,gl){const uniforms={},totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(let i2=0;i2<totalUniforms;i2++){const uniformData=gl.getActiveUniform(program,i2),name=uniformData.name.replace(/\[.*?\]$/,""),isArray=!!uniformData.name.match(/\[.*?\]$/),type=mapType(gl,uniformData.type);uniforms[name]={name,index:i2,type,size:uniformData.size,isArray,value:defaultValue(type,uniformData.size)}}return uniforms}function generateProgram(gl,program){var _a2;const glVertShader=compileShader(gl,gl.VERTEX_SHADER,program.vertexSrc),glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,program.fragmentSrc),webGLProgram=gl.createProgram();gl.attachShader(webGLProgram,glVertShader),gl.attachShader(webGLProgram,glFragShader);const transformFeedbackVaryings=(_a2=program.extra)==null?void 0:_a2.transformFeedbackVaryings;if(transformFeedbackVaryings&&(typeof gl.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):gl.transformFeedbackVaryings(webGLProgram,transformFeedbackVaryings.names,transformFeedbackVaryings.bufferMode==="separate"?gl.SEPARATE_ATTRIBS:gl.INTERLEAVED_ATTRIBS)),gl.linkProgram(webGLProgram),gl.getProgramParameter(webGLProgram,gl.LINK_STATUS)||logProgramError(gl,webGLProgram,glVertShader,glFragShader),program.attributeData=getAttributeData(webGLProgram,gl),program.uniformData=getUniformData(webGLProgram,gl),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(program.vertexSrc)){const keys=Object.keys(program.attributeData);keys.sort((a2,b2)=>a2>b2?1:-1);for(let i2=0;i2<keys.length;i2++)program.attributeData[keys[i2]].location=i2,gl.bindAttribLocation(webGLProgram,i2,keys[i2]);gl.linkProgram(webGLProgram)}gl.deleteShader(glVertShader),gl.deleteShader(glFragShader);const uniformData={};for(const i2 in program.uniformData){const data=program.uniformData[i2];uniformData[i2]={location:gl.getUniformLocation(webGLProgram,i2),value:defaultValue(data.type,data.size)}}return new GLProgram(webGLProgram,uniformData)}function uboUpdate(_ud,_uv,_renderer,_syncData,buffer){_renderer.buffer.update(buffer)}const UBO_TO_SINGLE_SETTERS={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function createUBOElements(uniformData){const uboElements=uniformData.map(data=>({data,offset:0,dataLen:0,dirty:0}));let size=0,chunkSize=0,offset=0;for(let i2=0;i2<uboElements.length;i2++){const uboElement=uboElements[i2];if(size=GLSL_TO_STD40_SIZE[uboElement.data.type],uboElement.data.size>1&&(size=Math.max(size,16)*uboElement.data.size),uboElement.dataLen=size,chunkSize%size!==0&&chunkSize<16){const lineUpValue=chunkSize%size%16;chunkSize+=lineUpValue,offset+=lineUpValue}chunkSize+size>16?(offset=Math.ceil(offset/16)*16,uboElement.offset=offset,offset+=size,chunkSize=size):(uboElement.offset=offset,chunkSize+=size,offset+=size)}return offset=Math.ceil(offset/16)*16,{uboElements,size:offset}}function getUBOData(uniforms,uniformData){const usedUniformDatas=[];for(const i2 in uniforms)uniformData[i2]&&usedUniformDatas.push(uniformData[i2]);return usedUniformDatas.sort((a2,b2)=>a2.index-b2.index),usedUniformDatas}function generateUniformBufferSync(group,uniformData){if(!group.autoManage)return{size:0,syncFunc:uboUpdate};const usedUniformDatas=getUBOData(group.uniforms,uniformData),{uboElements,size}=createUBOElements(usedUniformDatas),funcFragments=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let i2=0;i2<uboElements.length;i2++){const uboElement=uboElements[i2],uniform=group.uniforms[uboElement.data.name],name=uboElement.data.name;let parsed=!1;for(let j2=0;j2<uniformParsers.length;j2++){const uniformParser=uniformParsers[j2];if(uniformParser.codeUbo&&uniformParser.test(uboElement.data,uniform)){funcFragments.push(`offset = ${uboElement.offset/4};`,uniformParsers[j2].codeUbo(uboElement.data.name,uniform)),parsed=!0;break}}if(!parsed)if(uboElement.data.size>1){const size2=mapSize(uboElement.data.type),rowSize=Math.max(GLSL_TO_STD40_SIZE[uboElement.data.type]/16,1),elementSize=size2/rowSize,remainder=(4-elementSize%4)%4;funcFragments.push(`
                cv = ud.${name}.value;
                v = uv.${name};
                offset = ${uboElement.offset/4};

                t = 0;

                for(var i=0; i < ${uboElement.data.size*rowSize}; i++)
                {
                    for(var j = 0; j < ${elementSize}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${remainder};
                }

                `)}else{const template=UBO_TO_SINGLE_SETTERS[uboElement.data.type];funcFragments.push(`
                cv = ud.${name}.value;
                v = uv.${name};
                offset = ${uboElement.offset/4};
                ${template};
                `)}}return funcFragments.push(`
       renderer.buffer.update(buffer);
    `),{size,syncFunc:new Function("ud","uv","renderer","syncData","buffer",funcFragments.join(`
`))}}let UID=0;const defaultSyncData={textureCount:0,uboCount:0};class ShaderSystem{constructor(renderer){this.destroyed=!1,this.renderer=renderer,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=UID++}systemCheck(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(gl){this.gl=gl,this.reset()}bind(shader,dontSync){shader.disposeRunner.add(this),shader.uniforms.globals=this.renderer.globalUniforms;const program=shader.program,glProgram=program.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(shader);return this.shader=shader,this.program!==program&&(this.program=program,this.gl.useProgram(glProgram.program)),dontSync||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(shader.uniformGroup,defaultSyncData)),glProgram}setUniforms(uniforms){const shader=this.shader.program,glProgram=shader.glPrograms[this.renderer.CONTEXT_UID];shader.syncUniforms(glProgram.uniformData,uniforms,this.renderer)}syncUniformGroup(group,syncData){const glProgram=this.getGlProgram();(!group.static||group.dirtyId!==glProgram.uniformDirtyGroups[group.id])&&(glProgram.uniformDirtyGroups[group.id]=group.dirtyId,this.syncUniforms(group,glProgram,syncData))}syncUniforms(group,glProgram,syncData){(group.syncUniforms[this.shader.program.id]||this.createSyncGroups(group))(glProgram.uniformData,group.uniforms,this.renderer,syncData)}createSyncGroups(group){const id=this.getSignature(group,this.shader.program.uniformData,"u");return this.cache[id]||(this.cache[id]=generateUniformsSync(group,this.shader.program.uniformData)),group.syncUniforms[this.shader.program.id]=this.cache[id],group.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(group,name){const glProgram=this.getGlProgram();if(!group.static||group.dirtyId!==0||!glProgram.uniformGroups[group.id]){group.dirtyId=0;const syncFunc=glProgram.uniformGroups[group.id]||this.createSyncBufferGroup(group,glProgram,name);group.buffer.update(),syncFunc(glProgram.uniformData,group.uniforms,this.renderer,defaultSyncData,group.buffer)}this.renderer.buffer.bindBufferBase(group.buffer,glProgram.uniformBufferBindings[name])}createSyncBufferGroup(group,glProgram,name){const{gl}=this.renderer;this.renderer.buffer.bind(group.buffer);const uniformBlockIndex=this.gl.getUniformBlockIndex(glProgram.program,name);glProgram.uniformBufferBindings[name]=this.shader.uniformBindCount,gl.uniformBlockBinding(glProgram.program,uniformBlockIndex,this.shader.uniformBindCount),this.shader.uniformBindCount++;const id=this.getSignature(group,this.shader.program.uniformData,"ubo");let uboData=this._uboCache[id];if(uboData||(uboData=this._uboCache[id]=generateUniformBufferSync(group,this.shader.program.uniformData)),group.autoManage){const data=new Float32Array(uboData.size/4);group.buffer.update(data)}return glProgram.uniformGroups[group.id]=uboData.syncFunc,glProgram.uniformGroups[group.id]}getSignature(group,uniformData,preFix){const uniforms=group.uniforms,strings=[`${preFix}-`];for(const i2 in uniforms)strings.push(i2),uniformData[i2]&&strings.push(uniformData[i2].type);return strings.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(shader){const gl=this.gl,program=shader.program,glProgram=generateProgram(gl,program);return program.glPrograms[this.renderer.CONTEXT_UID]=glProgram,glProgram}reset(){this.program=null,this.shader=null}disposeShader(shader){this.shader===shader&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ShaderSystem.extension={type:ExtensionType.RendererSystem,name:"shader"},extensions$1.add(ShaderSystem);class StartupSystem{constructor(renderer){this.renderer=renderer}run(options){const{renderer}=this;renderer.runners.init.emit(renderer.options),options.hello&&console.log(`PixiJS 7.3.3 - ${renderer.rendererLogId} - https://pixijs.com`),renderer.resize(renderer.screen.width,renderer.screen.height)}destroy(){}}StartupSystem.defaultOptions={hello:!1},StartupSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"startup"},extensions$1.add(StartupSystem);function mapWebGLBlendModesToPixi(gl,array=[]){return array[BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.ADD]=[gl.ONE,gl.ONE],array[BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.NONE]=[0,0],array[BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE],array[BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.SRC_IN]=[gl.DST_ALPHA,gl.ZERO],array[BLEND_MODES.SRC_OUT]=[gl.ONE_MINUS_DST_ALPHA,gl.ZERO],array[BLEND_MODES.SRC_ATOP]=[gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.DST_OVER]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE],array[BLEND_MODES.DST_IN]=[gl.ZERO,gl.SRC_ALPHA],array[BLEND_MODES.DST_OUT]=[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.DST_ATOP]=[gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA],array[BLEND_MODES.XOR]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[BLEND_MODES.SUBTRACT]=[gl.ONE,gl.ONE,gl.ONE,gl.ONE,gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD],array}const BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,_StateSystem=class _StateSystem2{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[BLEND]=this.setBlend,this.map[OFFSET]=this.setOffset,this.map[CULLING]=this.setCullFace,this.map[DEPTH_TEST]=this.setDepthTest,this.map[WINDING]=this.setFrontFace,this.map[DEPTH_MASK]=this.setDepthMask,this.checks=[],this.defaultState=new State,this.defaultState.blend=!0}contextChange(gl){this.gl=gl,this.blendModes=mapWebGLBlendModesToPixi(gl),this.set(this.defaultState),this.reset()}set(state){if(state=state||this.defaultState,this.stateId!==state.data){let diff=this.stateId^state.data,i2=0;for(;diff;)diff&1&&this.map[i2].call(this,!!(state.data&1<<i2)),diff=diff>>1,i2++;this.stateId=state.data}for(let i2=0;i2<this.checks.length;i2++)this.checks[i2](this,state)}forceState(state){state=state||this.defaultState;for(let i2=0;i2<this.map.length;i2++)this.map[i2].call(this,!!(state.data&1<<i2));for(let i2=0;i2<this.checks.length;i2++)this.checks[i2](this,state);this.stateId=state.data}setBlend(value){this.updateCheck(_StateSystem2.checkBlendMode,value),this.gl[value?"enable":"disable"](this.gl.BLEND)}setOffset(value){this.updateCheck(_StateSystem2.checkPolygonOffset,value),this.gl[value?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(value){this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(value){this.gl.depthMask(value)}setCullFace(value){this.gl[value?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(value){this.gl.frontFace(this.gl[value?"CW":"CCW"])}setBlendMode(value){if(value===this.blendMode)return;this.blendMode=value;const mode=this.blendModes[value],gl=this.gl;mode.length===2?gl.blendFunc(mode[0],mode[1]):gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3]),mode.length===6?(this._blendEq=!0,gl.blendEquationSeparate(mode[4],mode[5])):this._blendEq&&(this._blendEq=!1,gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD))}setPolygonOffset(value,scale){this.gl.polygonOffset(value,scale)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(func,value){const index=this.checks.indexOf(func);value&&index===-1?this.checks.push(func):!value&&index!==-1&&this.checks.splice(index,1)}static checkBlendMode(system,state){system.setBlendMode(state.blendMode)}static checkPolygonOffset(system,state){system.setPolygonOffset(1,state.polygonOffset)}destroy(){this.gl=null}};_StateSystem.extension={type:ExtensionType.RendererSystem,name:"state"};let StateSystem=_StateSystem;extensions$1.add(StateSystem);class SystemManager extends EventEmitter{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(config){var _a2;this.addRunners(...config.runners);const priority=((_a2=config.priority)!=null?_a2:[]).filter(key=>config.systems[key]),orderByPriority=[...priority,...Object.keys(config.systems).filter(key=>!priority.includes(key))];for(const i2 of orderByPriority)this.addSystem(config.systems[i2],i2)}addRunners(...runnerIds){runnerIds.forEach(runnerId=>{this.runners[runnerId]=new Runner(runnerId)})}addSystem(ClassRef,name){const system=new ClassRef(this);if(this[name])throw new Error(`Whoops! The name "${name}" is already in use`);this[name]=system,this._systemsHash[name]=system;for(const i2 in this.runners)this.runners[i2].add(system);return this}emitWithCustomOptions(runner,options){const systemHashKeys=Object.keys(this._systemsHash);runner.items.forEach(system=>{const systemName=systemHashKeys.find(systemId=>this._systemsHash[systemId]===system);system[runner.name](options[systemName])})}destroy(){Object.values(this.runners).forEach(runner=>{runner.destroy()}),this._systemsHash={}}}const _TextureGCSystem=class _TextureGCSystem2{constructor(renderer){this.renderer=renderer,this.count=0,this.checkCount=0,this.maxIdle=_TextureGCSystem2.defaultMaxIdle,this.checkCountMax=_TextureGCSystem2.defaultCheckCountMax,this.mode=_TextureGCSystem2.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const tm=this.renderer.texture,managedTextures=tm.managedTextures;let wasRemoved=!1;for(let i2=0;i2<managedTextures.length;i2++){const texture=managedTextures[i2];texture.resource&&this.count-texture.touched>this.maxIdle&&(tm.destroyTexture(texture,!0),managedTextures[i2]=null,wasRemoved=!0)}if(wasRemoved){let j2=0;for(let i2=0;i2<managedTextures.length;i2++)managedTextures[i2]!==null&&(managedTextures[j2++]=managedTextures[i2]);managedTextures.length=j2}}unload(displayObject){const tm=this.renderer.texture,texture=displayObject._texture;texture&&!texture.framebuffer&&tm.destroyTexture(texture);for(let i2=displayObject.children.length-1;i2>=0;i2--)this.unload(displayObject.children[i2])}destroy(){this.renderer=null}};_TextureGCSystem.defaultMode=GC_MODES.AUTO,_TextureGCSystem.defaultMaxIdle=3600,_TextureGCSystem.defaultCheckCountMax=600,_TextureGCSystem.extension={type:ExtensionType.RendererSystem,name:"textureGC"};let TextureGCSystem=_TextureGCSystem;extensions$1.add(TextureGCSystem);class GLTexture{constructor(texture){this.texture=texture,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=TYPES.UNSIGNED_BYTE,this.internalFormat=FORMATS.RGBA,this.samplerType=0}}function mapInternalFormatToSamplerType(gl){let table;return"WebGL2RenderingContext"in globalThis&&gl instanceof globalThis.WebGL2RenderingContext?table={[gl.RGB]:SAMPLER_TYPES.FLOAT,[gl.RGBA]:SAMPLER_TYPES.FLOAT,[gl.ALPHA]:SAMPLER_TYPES.FLOAT,[gl.LUMINANCE]:SAMPLER_TYPES.FLOAT,[gl.LUMINANCE_ALPHA]:SAMPLER_TYPES.FLOAT,[gl.R8]:SAMPLER_TYPES.FLOAT,[gl.R8_SNORM]:SAMPLER_TYPES.FLOAT,[gl.RG8]:SAMPLER_TYPES.FLOAT,[gl.RG8_SNORM]:SAMPLER_TYPES.FLOAT,[gl.RGB8]:SAMPLER_TYPES.FLOAT,[gl.RGB8_SNORM]:SAMPLER_TYPES.FLOAT,[gl.RGB565]:SAMPLER_TYPES.FLOAT,[gl.RGBA4]:SAMPLER_TYPES.FLOAT,[gl.RGB5_A1]:SAMPLER_TYPES.FLOAT,[gl.RGBA8]:SAMPLER_TYPES.FLOAT,[gl.RGBA8_SNORM]:SAMPLER_TYPES.FLOAT,[gl.RGB10_A2]:SAMPLER_TYPES.FLOAT,[gl.RGB10_A2UI]:SAMPLER_TYPES.FLOAT,[gl.SRGB8]:SAMPLER_TYPES.FLOAT,[gl.SRGB8_ALPHA8]:SAMPLER_TYPES.FLOAT,[gl.R16F]:SAMPLER_TYPES.FLOAT,[gl.RG16F]:SAMPLER_TYPES.FLOAT,[gl.RGB16F]:SAMPLER_TYPES.FLOAT,[gl.RGBA16F]:SAMPLER_TYPES.FLOAT,[gl.R32F]:SAMPLER_TYPES.FLOAT,[gl.RG32F]:SAMPLER_TYPES.FLOAT,[gl.RGB32F]:SAMPLER_TYPES.FLOAT,[gl.RGBA32F]:SAMPLER_TYPES.FLOAT,[gl.R11F_G11F_B10F]:SAMPLER_TYPES.FLOAT,[gl.RGB9_E5]:SAMPLER_TYPES.FLOAT,[gl.R8I]:SAMPLER_TYPES.INT,[gl.R8UI]:SAMPLER_TYPES.UINT,[gl.R16I]:SAMPLER_TYPES.INT,[gl.R16UI]:SAMPLER_TYPES.UINT,[gl.R32I]:SAMPLER_TYPES.INT,[gl.R32UI]:SAMPLER_TYPES.UINT,[gl.RG8I]:SAMPLER_TYPES.INT,[gl.RG8UI]:SAMPLER_TYPES.UINT,[gl.RG16I]:SAMPLER_TYPES.INT,[gl.RG16UI]:SAMPLER_TYPES.UINT,[gl.RG32I]:SAMPLER_TYPES.INT,[gl.RG32UI]:SAMPLER_TYPES.UINT,[gl.RGB8I]:SAMPLER_TYPES.INT,[gl.RGB8UI]:SAMPLER_TYPES.UINT,[gl.RGB16I]:SAMPLER_TYPES.INT,[gl.RGB16UI]:SAMPLER_TYPES.UINT,[gl.RGB32I]:SAMPLER_TYPES.INT,[gl.RGB32UI]:SAMPLER_TYPES.UINT,[gl.RGBA8I]:SAMPLER_TYPES.INT,[gl.RGBA8UI]:SAMPLER_TYPES.UINT,[gl.RGBA16I]:SAMPLER_TYPES.INT,[gl.RGBA16UI]:SAMPLER_TYPES.UINT,[gl.RGBA32I]:SAMPLER_TYPES.INT,[gl.RGBA32UI]:SAMPLER_TYPES.UINT,[gl.DEPTH_COMPONENT16]:SAMPLER_TYPES.FLOAT,[gl.DEPTH_COMPONENT24]:SAMPLER_TYPES.FLOAT,[gl.DEPTH_COMPONENT32F]:SAMPLER_TYPES.FLOAT,[gl.DEPTH_STENCIL]:SAMPLER_TYPES.FLOAT,[gl.DEPTH24_STENCIL8]:SAMPLER_TYPES.FLOAT,[gl.DEPTH32F_STENCIL8]:SAMPLER_TYPES.FLOAT}:table={[gl.RGB]:SAMPLER_TYPES.FLOAT,[gl.RGBA]:SAMPLER_TYPES.FLOAT,[gl.ALPHA]:SAMPLER_TYPES.FLOAT,[gl.LUMINANCE]:SAMPLER_TYPES.FLOAT,[gl.LUMINANCE_ALPHA]:SAMPLER_TYPES.FLOAT,[gl.DEPTH_STENCIL]:SAMPLER_TYPES.FLOAT},table}function mapTypeAndFormatToInternalFormat(gl){let table;return"WebGL2RenderingContext"in globalThis&&gl instanceof globalThis.WebGL2RenderingContext?table={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:gl.RGBA8,[FORMATS.RGB]:gl.RGB8,[FORMATS.RG]:gl.RG8,[FORMATS.RED]:gl.R8,[FORMATS.RGBA_INTEGER]:gl.RGBA8UI,[FORMATS.RGB_INTEGER]:gl.RGB8UI,[FORMATS.RG_INTEGER]:gl.RG8UI,[FORMATS.RED_INTEGER]:gl.R8UI,[FORMATS.ALPHA]:gl.ALPHA,[FORMATS.LUMINANCE]:gl.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:gl.LUMINANCE_ALPHA},[TYPES.BYTE]:{[FORMATS.RGBA]:gl.RGBA8_SNORM,[FORMATS.RGB]:gl.RGB8_SNORM,[FORMATS.RG]:gl.RG8_SNORM,[FORMATS.RED]:gl.R8_SNORM,[FORMATS.RGBA_INTEGER]:gl.RGBA8I,[FORMATS.RGB_INTEGER]:gl.RGB8I,[FORMATS.RG_INTEGER]:gl.RG8I,[FORMATS.RED_INTEGER]:gl.R8I},[TYPES.UNSIGNED_SHORT]:{[FORMATS.RGBA_INTEGER]:gl.RGBA16UI,[FORMATS.RGB_INTEGER]:gl.RGB16UI,[FORMATS.RG_INTEGER]:gl.RG16UI,[FORMATS.RED_INTEGER]:gl.R16UI,[FORMATS.DEPTH_COMPONENT]:gl.DEPTH_COMPONENT16},[TYPES.SHORT]:{[FORMATS.RGBA_INTEGER]:gl.RGBA16I,[FORMATS.RGB_INTEGER]:gl.RGB16I,[FORMATS.RG_INTEGER]:gl.RG16I,[FORMATS.RED_INTEGER]:gl.R16I},[TYPES.UNSIGNED_INT]:{[FORMATS.RGBA_INTEGER]:gl.RGBA32UI,[FORMATS.RGB_INTEGER]:gl.RGB32UI,[FORMATS.RG_INTEGER]:gl.RG32UI,[FORMATS.RED_INTEGER]:gl.R32UI,[FORMATS.DEPTH_COMPONENT]:gl.DEPTH_COMPONENT24},[TYPES.INT]:{[FORMATS.RGBA_INTEGER]:gl.RGBA32I,[FORMATS.RGB_INTEGER]:gl.RGB32I,[FORMATS.RG_INTEGER]:gl.RG32I,[FORMATS.RED_INTEGER]:gl.R32I},[TYPES.FLOAT]:{[FORMATS.RGBA]:gl.RGBA32F,[FORMATS.RGB]:gl.RGB32F,[FORMATS.RG]:gl.RG32F,[FORMATS.RED]:gl.R32F,[FORMATS.DEPTH_COMPONENT]:gl.DEPTH_COMPONENT32F},[TYPES.HALF_FLOAT]:{[FORMATS.RGBA]:gl.RGBA16F,[FORMATS.RGB]:gl.RGB16F,[FORMATS.RG]:gl.RG16F,[FORMATS.RED]:gl.R16F},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:gl.RGB565},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:gl.RGBA4},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:gl.RGB5_A1},[TYPES.UNSIGNED_INT_2_10_10_10_REV]:{[FORMATS.RGBA]:gl.RGB10_A2,[FORMATS.RGBA_INTEGER]:gl.RGB10_A2UI},[TYPES.UNSIGNED_INT_10F_11F_11F_REV]:{[FORMATS.RGB]:gl.R11F_G11F_B10F},[TYPES.UNSIGNED_INT_5_9_9_9_REV]:{[FORMATS.RGB]:gl.RGB9_E5},[TYPES.UNSIGNED_INT_24_8]:{[FORMATS.DEPTH_STENCIL]:gl.DEPTH24_STENCIL8},[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[FORMATS.DEPTH_STENCIL]:gl.DEPTH32F_STENCIL8}}:table={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:gl.RGBA,[FORMATS.RGB]:gl.RGB,[FORMATS.ALPHA]:gl.ALPHA,[FORMATS.LUMINANCE]:gl.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:gl.LUMINANCE_ALPHA},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:gl.RGB},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:gl.RGBA},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:gl.RGBA}},table}class TextureSystem{constructor(renderer){this.renderer=renderer,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new BaseTexture,this.hasIntegerTextures=!1}contextChange(){const gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=mapTypeAndFormatToInternalFormat(gl),this.samplerTypes=mapInternalFormatToSamplerType(gl);const maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=maxTextures;for(let i2=0;i2<maxTextures;i2++)this.boundTextures[i2]=null;this.emptyTextures={};const emptyTexture2D=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_2D,emptyTexture2D.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[gl.TEXTURE_2D]=emptyTexture2D,this.emptyTextures[gl.TEXTURE_CUBE_MAP]=new GLTexture(gl.createTexture()),gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.emptyTextures[gl.TEXTURE_CUBE_MAP].texture);for(let i2=0;i2<6;i2++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+i2,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR);for(let i2=0;i2<this.boundTextures.length;i2++)this.bind(null,i2)}bind(texture,location=0){const{gl}=this;if(texture=texture==null?void 0:texture.castToBaseTexture(),texture!=null&&texture.valid&&!texture.parentTextureArray){texture.touched=this.renderer.textureGC.count;const glTexture=texture._glTextures[this.CONTEXT_UID]||this.initTexture(texture);this.boundTextures[location]!==texture&&(this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),gl.bindTexture(texture.target,glTexture.texture)),glTexture.dirtyId!==texture.dirtyId?(this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),this.updateTexture(texture)):glTexture.dirtyStyleId!==texture.dirtyStyleId&&this.updateTextureStyle(texture),this.boundTextures[location]=texture}else this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[gl.TEXTURE_2D].texture),this.boundTextures[location]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let i2=0;i2<this.boundTextures.length;i2++)this.boundTextures[i2]=this.unknownTexture}unbind(texture){const{gl,boundTextures}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let i2=0;i2<boundTextures.length;i2++)boundTextures[i2]===this.unknownTexture&&this.bind(null,i2)}for(let i2=0;i2<boundTextures.length;i2++)boundTextures[i2]===texture&&(this.currentLocation!==i2&&(gl.activeTexture(gl.TEXTURE0+i2),this.currentLocation=i2),gl.bindTexture(texture.target,this.emptyTextures[texture.target].texture),boundTextures[i2]=null)}ensureSamplerType(maxTextures){const{boundTextures,hasIntegerTextures,CONTEXT_UID}=this;if(hasIntegerTextures)for(let i2=maxTextures-1;i2>=0;--i2){const tex=boundTextures[i2];tex&&tex._glTextures[CONTEXT_UID].samplerType!==SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(tex)}}initTexture(texture){const glTexture=new GLTexture(this.gl.createTexture());return glTexture.dirtyId=-1,texture._glTextures[this.CONTEXT_UID]=glTexture,this.managedTextures.push(texture),texture.on("dispose",this.destroyTexture,this),glTexture}initTextureType(texture,glTexture){var _a2,_b,_c;glTexture.internalFormat=(_b=(_a2=this.internalFormats[texture.type])==null?void 0:_a2[texture.format])!=null?_b:texture.format,glTexture.samplerType=(_c=this.samplerTypes[glTexture.internalFormat])!=null?_c:SAMPLER_TYPES.FLOAT,this.webGLVersion===2&&texture.type===TYPES.HALF_FLOAT?glTexture.type=this.gl.HALF_FLOAT:glTexture.type=texture.type}updateTexture(texture){var _a2;const glTexture=texture._glTextures[this.CONTEXT_UID];if(!glTexture)return;const renderer=this.renderer;if(this.initTextureType(texture,glTexture),(_a2=texture.resource)!=null&&_a2.upload(renderer,texture,glTexture))glTexture.samplerType!==SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{const width=texture.realWidth,height=texture.realHeight,gl=renderer.gl;(glTexture.width!==width||glTexture.height!==height||glTexture.dirtyId<0)&&(glTexture.width=width,glTexture.height=height,gl.texImage2D(texture.target,0,glTexture.internalFormat,width,height,0,texture.format,glTexture.type,null))}texture.dirtyStyleId!==glTexture.dirtyStyleId&&this.updateTextureStyle(texture),glTexture.dirtyId=texture.dirtyId}destroyTexture(texture,skipRemove){const{gl}=this;if(texture=texture.castToBaseTexture(),texture._glTextures[this.CONTEXT_UID]&&(this.unbind(texture),gl.deleteTexture(texture._glTextures[this.CONTEXT_UID].texture),texture.off("dispose",this.destroyTexture,this),delete texture._glTextures[this.CONTEXT_UID],!skipRemove)){const i2=this.managedTextures.indexOf(texture);i2!==-1&&removeItems(this.managedTextures,i2,1)}}updateTextureStyle(texture){var _a2;const glTexture=texture._glTextures[this.CONTEXT_UID];glTexture&&((texture.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!texture.isPowerOfTwo?glTexture.mipmap=!1:glTexture.mipmap=texture.mipmap>=1,this.webGLVersion!==2&&!texture.isPowerOfTwo?glTexture.wrapMode=WRAP_MODES.CLAMP:glTexture.wrapMode=texture.wrapMode,(_a2=texture.resource)!=null&&_a2.style(this.renderer,texture,glTexture)||this.setStyle(texture,glTexture),glTexture.dirtyStyleId=texture.dirtyStyleId)}setStyle(texture,glTexture){const gl=this.gl;if(glTexture.mipmap&&texture.mipmap!==MIPMAP_MODES.ON_MANUAL&&gl.generateMipmap(texture.target),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_S,glTexture.wrapMode),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_T,glTexture.wrapMode),glTexture.mipmap){gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST);const anisotropicExt=this.renderer.context.extensions.anisotropicFiltering;if(anisotropicExt&&texture.anisotropicLevel>0&&texture.scaleMode===SCALE_MODES.LINEAR){const level=Math.min(texture.anisotropicLevel,gl.getParameter(anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT));gl.texParameterf(texture.target,anisotropicExt.TEXTURE_MAX_ANISOTROPY_EXT,level)}}else gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);gl.texParameteri(texture.target,gl.TEXTURE_MAG_FILTER,texture.scaleMode===SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST)}destroy(){this.renderer=null}}TextureSystem.extension={type:ExtensionType.RendererSystem,name:"texture"},extensions$1.add(TextureSystem);class TransformFeedbackSystem{constructor(renderer){this.renderer=renderer}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(transformFeedback){const{gl,CONTEXT_UID}=this,glTransformFeedback=transformFeedback._glTransformFeedbacks[CONTEXT_UID]||this.createGLTransformFeedback(transformFeedback);gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,glTransformFeedback)}unbind(){const{gl}=this;gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(drawMode,shader){const{gl,renderer}=this;shader&&renderer.shader.bind(shader),gl.beginTransformFeedback(drawMode)}endTransformFeedback(){const{gl}=this;gl.endTransformFeedback()}createGLTransformFeedback(tf){const{gl,renderer,CONTEXT_UID}=this,glTransformFeedback=gl.createTransformFeedback();tf._glTransformFeedbacks[CONTEXT_UID]=glTransformFeedback,gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,glTransformFeedback);for(let i2=0;i2<tf.buffers.length;i2++){const buffer=tf.buffers[i2];buffer&&(renderer.buffer.update(buffer),buffer._glBuffers[CONTEXT_UID].refCount++,gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER,i2,buffer._glBuffers[CONTEXT_UID].buffer||null))}return gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK,null),tf.disposeRunner.add(this),glTransformFeedback}disposeTransformFeedback(tf,contextLost){const glTF=tf._glTransformFeedbacks[this.CONTEXT_UID],gl=this.gl;tf.disposeRunner.remove(this);const bufferSystem=this.renderer.buffer;if(bufferSystem)for(let i2=0;i2<tf.buffers.length;i2++){const buffer=tf.buffers[i2];if(!buffer)continue;const buf=buffer._glBuffers[this.CONTEXT_UID];buf&&(buf.refCount--,buf.refCount===0&&!contextLost&&bufferSystem.dispose(buffer,contextLost))}glTF&&(contextLost||gl.deleteTransformFeedback(glTF),delete tf._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}TransformFeedbackSystem.extension={type:ExtensionType.RendererSystem,name:"transformFeedback"},extensions$1.add(TransformFeedbackSystem);class ViewSystem{constructor(renderer){this.renderer=renderer}init(options){this.screen=new Rectangle(0,0,options.width,options.height),this.element=options.view||settings.ADAPTER.createCanvas(),this.resolution=options.resolution||settings.RESOLUTION,this.autoDensity=!!options.autoDensity}resizeView(desiredScreenWidth,desiredScreenHeight){this.element.width=Math.round(desiredScreenWidth*this.resolution),this.element.height=Math.round(desiredScreenHeight*this.resolution);const screenWidth=this.element.width/this.resolution,screenHeight=this.element.height/this.resolution;this.screen.width=screenWidth,this.screen.height=screenHeight,this.autoDensity&&(this.element.style.width=`${screenWidth}px`,this.element.style.height=`${screenHeight}px`),this.renderer.emit("resize",screenWidth,screenHeight),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(removeView){var _a2;removeView&&((_a2=this.element.parentNode)==null||_a2.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}ViewSystem.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},ViewSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_view"},extensions$1.add(ViewSystem);var __defProp$b=Object.defineProperty,__getOwnPropSymbols$b=Object.getOwnPropertySymbols,__hasOwnProp$b=Object.prototype.hasOwnProperty,__propIsEnum$b=Object.prototype.propertyIsEnumerable,__defNormalProp$b=(obj,key,value)=>key in obj?__defProp$b(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$b=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$b.call(b2,prop)&&__defNormalProp$b(a2,prop,b2[prop]);if(__getOwnPropSymbols$b)for(var prop of __getOwnPropSymbols$b(b2))__propIsEnum$b.call(b2,prop)&&__defNormalProp$b(a2,prop,b2[prop]);return a2};settings.PREFER_ENV=ENV.WEBGL2,settings.STRICT_TEXTURE_CACHE=!1,settings.RENDER_OPTIONS=__spreadValues$b(__spreadValues$b(__spreadValues$b(__spreadValues$b({},ContextSystem.defaultOptions),BackgroundSystem.defaultOptions),ViewSystem.defaultOptions),StartupSystem.defaultOptions),Object.defineProperties(settings,{WRAP_MODE:{get(){return BaseTexture.defaultOptions.wrapMode},set(value){deprecation$1("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),BaseTexture.defaultOptions.wrapMode=value}},SCALE_MODE:{get(){return BaseTexture.defaultOptions.scaleMode},set(value){deprecation$1("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),BaseTexture.defaultOptions.scaleMode=value}},MIPMAP_TEXTURES:{get(){return BaseTexture.defaultOptions.mipmap},set(value){deprecation$1("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),BaseTexture.defaultOptions.mipmap=value}},ANISOTROPIC_LEVEL:{get(){return BaseTexture.defaultOptions.anisotropicLevel},set(value){deprecation$1("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),BaseTexture.defaultOptions.anisotropicLevel=value}},FILTER_RESOLUTION:{get(){return deprecation$1("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Filter.defaultResolution},set(value){Filter.defaultResolution=value}},FILTER_MULTISAMPLE:{get(){return deprecation$1("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Filter.defaultMultisample},set(value){Filter.defaultMultisample=value}},SPRITE_MAX_TEXTURES:{get(){return BatchRenderer.defaultMaxTextures},set(value){deprecation$1("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),BatchRenderer.defaultMaxTextures=value}},SPRITE_BATCH_SIZE:{get(){return BatchRenderer.defaultBatchSize},set(value){deprecation$1("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),BatchRenderer.defaultBatchSize=value}},CAN_UPLOAD_SAME_BUFFER:{get(){return BatchRenderer.canUploadSameBuffer},set(value){deprecation$1("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),BatchRenderer.canUploadSameBuffer=value}},GC_MODE:{get(){return TextureGCSystem.defaultMode},set(value){deprecation$1("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),TextureGCSystem.defaultMode=value}},GC_MAX_IDLE:{get(){return TextureGCSystem.defaultMaxIdle},set(value){deprecation$1("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),TextureGCSystem.defaultMaxIdle=value}},GC_MAX_CHECK_COUNT:{get(){return TextureGCSystem.defaultCheckCountMax},set(value){deprecation$1("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),TextureGCSystem.defaultCheckCountMax=value}},PRECISION_VERTEX:{get(){return Program.defaultVertexPrecision},set(value){deprecation$1("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Program.defaultVertexPrecision=value}},PRECISION_FRAGMENT:{get(){return Program.defaultFragmentPrecision},set(value){deprecation$1("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Program.defaultFragmentPrecision=value}}});var UPDATE_PRIORITY=(UPDATE_PRIORITY2=>(UPDATE_PRIORITY2[UPDATE_PRIORITY2.INTERACTION=50]="INTERACTION",UPDATE_PRIORITY2[UPDATE_PRIORITY2.HIGH=25]="HIGH",UPDATE_PRIORITY2[UPDATE_PRIORITY2.NORMAL=0]="NORMAL",UPDATE_PRIORITY2[UPDATE_PRIORITY2.LOW=-25]="LOW",UPDATE_PRIORITY2[UPDATE_PRIORITY2.UTILITY=-50]="UTILITY",UPDATE_PRIORITY2))(UPDATE_PRIORITY||{});class TickerListener{constructor(fn,context2=null,priority=0,once=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=fn,this.context=context2,this.priority=priority,this.once=once}match(fn,context2=null){return this.fn===fn&&this.context===context2}emit(deltaTime){this.fn&&(this.context?this.fn.call(this.context,deltaTime):this.fn(deltaTime));const redirect=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),redirect}connect(previous){this.previous=previous,previous.next&&(previous.next.previous=this),this.next=previous.next,previous.next=this}destroy(hard=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const redirect=this.next;return this.next=hard?null:redirect,this.previous=null,redirect}}const _Ticker=class _Ticker2{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/_Ticker2.targetFPMS,this.elapsedMS=1/_Ticker2.targetFPMS,this._tick=time=>{this._requestId=null,this.started&&(this.update(time),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(fn,context2,priority=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(fn,context2,priority))}addOnce(fn,context2,priority=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(fn,context2,priority,!0))}_addListener(listener){let current=this._head.next,previous=this._head;if(!current)listener.connect(previous);else{for(;current;){if(listener.priority>current.priority){listener.connect(previous);break}previous=current,current=current.next}listener.previous||listener.connect(previous)}return this._startIfPossible(),this}remove(fn,context2){let listener=this._head.next;for(;listener;)listener.match(fn,context2)?listener=listener.destroy():listener=listener.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let count=0,current=this._head;for(;current=current.next;)count++;return count}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let listener=this._head.next;for(;listener;)listener=listener.destroy(!0);this._head.destroy(),this._head=null}}update(currentTime=performance.now()){let elapsedMS;if(currentTime>this.lastTime){if(elapsedMS=this.elapsedMS=currentTime-this.lastTime,elapsedMS>this._maxElapsedMS&&(elapsedMS=this._maxElapsedMS),elapsedMS*=this.speed,this._minElapsedMS){const delta=currentTime-this._lastFrame|0;if(delta<this._minElapsedMS)return;this._lastFrame=currentTime-delta%this._minElapsedMS}this.deltaMS=elapsedMS,this.deltaTime=this.deltaMS*_Ticker2.targetFPMS;const head=this._head;let listener=head.next;for(;listener;)listener=listener.emit(this.deltaTime);head.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=currentTime}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(fps){const minFPS=Math.min(this.maxFPS,fps),minFPMS=Math.min(Math.max(0,minFPS)/1e3,_Ticker2.targetFPMS);this._maxElapsedMS=1/minFPMS}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(fps){if(fps===0)this._minElapsedMS=0;else{const maxFPS=Math.max(this.minFPS,fps);this._minElapsedMS=1/(maxFPS/1e3)}}static get shared(){if(!_Ticker2._shared){const shared=_Ticker2._shared=new _Ticker2;shared.autoStart=!0,shared._protected=!0}return _Ticker2._shared}static get system(){if(!_Ticker2._system){const system=_Ticker2._system=new _Ticker2;system.autoStart=!0,system._protected=!0}return _Ticker2._system}};_Ticker.targetFPMS=0.06;let Ticker=_Ticker;Object.defineProperties(settings,{TARGET_FPMS:{get(){return Ticker.targetFPMS},set(value){deprecation$1("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ticker.targetFPMS=value}}});class TickerPlugin{static init(options){options=Object.assign({autoStart:!0,sharedTicker:!1},options),Object.defineProperty(this,"ticker",{set(ticker){this._ticker&&this._ticker.remove(this.render,this),this._ticker=ticker,ticker&&ticker.add(this.render,this,UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=options.sharedTicker?Ticker.shared:new Ticker,options.autoStart&&this.start()}static destroy(){if(this._ticker){const oldTicker=this._ticker;this.ticker=null,oldTicker.destroy()}}}TickerPlugin.extension=ExtensionType.Application,extensions$1.add(TickerPlugin);const renderers=[];extensions$1.handleByList(ExtensionType.Renderer,renderers);function autoDetectRenderer(options){for(const RendererType of renderers)if(RendererType.test(options))return new RendererType(options);throw new Error("Unable to auto-detect a suitable renderer.")}var $defaultVertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,$defaultFilterVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const defaultVertex=$defaultVertex,defaultFilterVertex=$defaultFilterVertex;class MultisampleSystem{constructor(renderer){this.renderer=renderer}contextChange(gl){let samples;if(this.renderer.context.webGLVersion===1){const framebuffer=gl.getParameter(gl.FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.FRAMEBUFFER,null),samples=gl.getParameter(gl.SAMPLES),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)}else{const framebuffer=gl.getParameter(gl.DRAW_FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null),samples=gl.getParameter(gl.SAMPLES),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,framebuffer)}samples>=MSAA_QUALITY.HIGH?this.multisample=MSAA_QUALITY.HIGH:samples>=MSAA_QUALITY.MEDIUM?this.multisample=MSAA_QUALITY.MEDIUM:samples>=MSAA_QUALITY.LOW?this.multisample=MSAA_QUALITY.LOW:this.multisample=MSAA_QUALITY.NONE}destroy(){}}MultisampleSystem.extension={type:ExtensionType.RendererSystem,name:"_multisample"},extensions$1.add(MultisampleSystem);class GLBuffer{constructor(buffer){this.buffer=buffer||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class BufferSystem{constructor(renderer){this.renderer=renderer,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(buffer){const{gl,CONTEXT_UID}=this,glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);gl.bindBuffer(buffer.type,glBuffer.buffer)}unbind(type){const{gl}=this;gl.bindBuffer(type,null)}bindBufferBase(buffer,index){const{gl,CONTEXT_UID}=this;if(this.boundBufferBases[index]!==buffer){const glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);this.boundBufferBases[index]=buffer,gl.bindBufferBase(gl.UNIFORM_BUFFER,index,glBuffer.buffer)}}bindBufferRange(buffer,index,offset){const{gl,CONTEXT_UID}=this;offset=offset||0;const glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);gl.bindBufferRange(gl.UNIFORM_BUFFER,index||0,glBuffer.buffer,offset*256,256)}update(buffer){const{gl,CONTEXT_UID}=this,glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);if(buffer._updateID!==glBuffer.updateID)if(glBuffer.updateID=buffer._updateID,gl.bindBuffer(buffer.type,glBuffer.buffer),glBuffer.byteLength>=buffer.data.byteLength)gl.bufferSubData(buffer.type,0,buffer.data);else{const drawType=buffer.static?gl.STATIC_DRAW:gl.DYNAMIC_DRAW;glBuffer.byteLength=buffer.data.byteLength,gl.bufferData(buffer.type,buffer.data,drawType)}}dispose(buffer,contextLost){if(!this.managedBuffers[buffer.id])return;delete this.managedBuffers[buffer.id];const glBuffer=buffer._glBuffers[this.CONTEXT_UID],gl=this.gl;buffer.disposeRunner.remove(this),glBuffer&&(contextLost||gl.deleteBuffer(glBuffer.buffer),delete buffer._glBuffers[this.CONTEXT_UID])}disposeAll(contextLost){const all=Object.keys(this.managedBuffers);for(let i2=0;i2<all.length;i2++)this.dispose(this.managedBuffers[all[i2]],contextLost)}createGLBuffer(buffer){const{CONTEXT_UID,gl}=this;return buffer._glBuffers[CONTEXT_UID]=new GLBuffer(gl.createBuffer()),this.managedBuffers[buffer.id]=buffer,buffer.disposeRunner.add(this),buffer._glBuffers[CONTEXT_UID]}}BufferSystem.extension={type:ExtensionType.RendererSystem,name:"buffer"},extensions$1.add(BufferSystem);class ObjectRendererSystem{constructor(renderer){this.renderer=renderer}render(displayObject,options){const renderer=this.renderer;let renderTexture,clear,transform,skipUpdateTransform;if(options&&(renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform),this.renderingToScreen=!renderTexture,renderer.runners.prerender.emit(),renderer.emit("prerender"),renderer.projection.transform=transform,!renderer.context.isLost){if(renderTexture||(this.lastObjectRendered=displayObject),!skipUpdateTransform){const cacheParent=displayObject.enableTempParent();displayObject.updateTransform(),displayObject.disableTempParent(cacheParent)}renderer.renderTexture.bind(renderTexture),renderer.batch.currentRenderer.start(),(clear!=null?clear:renderer.background.clearBeforeRender)&&renderer.renderTexture.clear(),displayObject.render(renderer),renderer.batch.currentRenderer.flush(),renderTexture&&(options.blit&&renderer.framebuffer.blit(),renderTexture.baseTexture.update()),renderer.runners.postrender.emit(),renderer.projection.transform=null,renderer.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ObjectRendererSystem.extension={type:ExtensionType.RendererSystem,name:"objectRenderer"},extensions$1.add(ObjectRendererSystem);const _Renderer=class _Renderer2 extends SystemManager{constructor(options){super(),this.type=RENDERER_TYPE.WEBGL,options=Object.assign({},settings.RENDER_OPTIONS,options),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0);const systemConfig={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:_Renderer2.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(systemConfig),"useContextAlpha"in options&&(deprecation$1("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),options.premultipliedAlpha=options.useContextAlpha&&options.useContextAlpha!=="notMultiplied",options.backgroundAlpha=options.useContextAlpha===!1?1:options.backgroundAlpha),this._plugin.rendererPlugins=_Renderer2.__plugins,this.options=options,this.startup.run(this.options)}static test(options){return options!=null&&options.forceCanvas?!1:isWebGLSupported()}render(displayObject,options){this.objectRenderer.render(displayObject,options)}resize(desiredScreenWidth,desiredScreenHeight){this._view.resizeView(desiredScreenWidth,desiredScreenHeight)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(removeView=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:removeView}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(value){this._view.resolution=value,this.runners.resolutionChange.emit(value)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return deprecation$1("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return deprecation$1("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return deprecation$1("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return deprecation$1("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(value){deprecation$1("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=value}get backgroundAlpha(){return deprecation$1("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(value){deprecation$1("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=value}get powerPreference(){return deprecation$1("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(displayObject,options){return this.textureGenerator.generateTexture(displayObject,options)}};_Renderer.extension={type:ExtensionType.Renderer,priority:1},_Renderer.__plugins={},_Renderer.__systems={};let Renderer=_Renderer;extensions$1.handleByMap(ExtensionType.RendererPlugin,Renderer.__plugins),extensions$1.handleByMap(ExtensionType.RendererSystem,Renderer.__systems),extensions$1.add(Renderer);class AbstractMultiResource extends Resource{constructor(length,options){const{width,height}=options||{};super(width,height),this.items=[],this.itemDirtyIds=[];for(let i2=0;i2<length;i2++){const partTexture=new BaseTexture;this.items.push(partTexture),this.itemDirtyIds.push(-2)}this.length=length,this._load=null,this.baseTexture=null}initFromArray(resources,options){for(let i2=0;i2<this.length;i2++)resources[i2]&&(resources[i2].castToBaseTexture?this.addBaseTextureAt(resources[i2].castToBaseTexture(),i2):resources[i2]instanceof Resource?this.addResourceAt(resources[i2],i2):this.addResourceAt(autoDetectResource(resources[i2],options),i2))}dispose(){for(let i2=0,len=this.length;i2<len;i2++)this.items[i2].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(resource,index){if(!this.items[index])throw new Error(`Index ${index} is out of bounds`);return resource.valid&&!this.valid&&this.resize(resource.width,resource.height),this.items[index].setResource(resource),this}bind(baseTexture){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(baseTexture);for(let i2=0;i2<this.length;i2++)this.items[i2].parentTextureArray=baseTexture,this.items[i2].on("update",baseTexture.update,baseTexture)}unbind(baseTexture){super.unbind(baseTexture);for(let i2=0;i2<this.length;i2++)this.items[i2].parentTextureArray=null,this.items[i2].off("update",baseTexture.update,baseTexture)}load(){if(this._load)return this._load;const promises=this.items.map(item=>item.resource).filter(item=>item).map(item=>item.load());return this._load=Promise.all(promises).then(()=>{const{realWidth,realHeight}=this.items[0];return this.resize(realWidth,realHeight),this.update(),Promise.resolve(this)}),this._load}}class ArrayResource extends AbstractMultiResource{constructor(source,options){const{width,height}=options||{};let urls,length;Array.isArray(source)?(urls=source,length=source.length):length=source,super(length,{width,height}),urls&&this.initFromArray(urls,options)}addBaseTextureAt(baseTexture,index){if(baseTexture.resource)this.addResourceAt(baseTexture.resource,index);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(baseTexture){super.bind(baseTexture),baseTexture.target=TARGETS.TEXTURE_2D_ARRAY}upload(renderer,texture,glTexture){const{length,itemDirtyIds,items}=this,{gl}=renderer;glTexture.dirtyId<0&&gl.texImage3D(gl.TEXTURE_2D_ARRAY,0,glTexture.internalFormat,this._width,this._height,length,0,texture.format,glTexture.type,null);for(let i2=0;i2<length;i2++){const item=items[i2];itemDirtyIds[i2]<item.dirtyId&&(itemDirtyIds[i2]=item.dirtyId,item.valid&&gl.texSubImage3D(gl.TEXTURE_2D_ARRAY,0,0,0,i2,item.resource.width,item.resource.height,1,texture.format,glTexture.type,item.resource.source))}return!0}}class CanvasResource extends BaseImageResource{constructor(source){super(source)}static test(source){const{OffscreenCanvas:OffscreenCanvas2}=globalThis;return OffscreenCanvas2&&source instanceof OffscreenCanvas2?!0:globalThis.HTMLCanvasElement&&source instanceof HTMLCanvasElement}}const _CubeResource=class _CubeResource2 extends AbstractMultiResource{constructor(source,options){const{width,height,autoLoad,linkBaseTexture}=options||{};if(source&&source.length!==_CubeResource2.SIDES)throw new Error(`Invalid length. Got ${source.length}, expected 6`);super(6,{width,height});for(let i2=0;i2<_CubeResource2.SIDES;i2++)this.items[i2].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+i2;this.linkBaseTexture=linkBaseTexture!==!1,source&&this.initFromArray(source,options),autoLoad!==!1&&this.load()}bind(baseTexture){super.bind(baseTexture),baseTexture.target=TARGETS.TEXTURE_CUBE_MAP}addBaseTextureAt(baseTexture,index,linkBaseTexture){if(linkBaseTexture===void 0&&(linkBaseTexture=this.linkBaseTexture),!this.items[index])throw new Error(`Index ${index} is out of bounds`);if(!this.linkBaseTexture||baseTexture.parentTextureArray||Object.keys(baseTexture._glTextures).length>0){if(baseTexture.resource)this.addResourceAt(baseTexture.resource,index);else throw new Error("CubeResource does not support copying of renderTexture.");}else baseTexture.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+index,baseTexture.parentTextureArray=this.baseTexture,this.items[index]=baseTexture;return baseTexture.valid&&!this.valid&&this.resize(baseTexture.realWidth,baseTexture.realHeight),this.items[index]=baseTexture,this}upload(renderer,_baseTexture,glTexture){const dirty=this.itemDirtyIds;for(let i2=0;i2<_CubeResource2.SIDES;i2++){const side=this.items[i2];(dirty[i2]<side.dirtyId||glTexture.dirtyId<_baseTexture.dirtyId)&&(side.valid&&side.resource?(side.resource.upload(renderer,side,glTexture),dirty[i2]=side.dirtyId):dirty[i2]<-1&&(renderer.gl.texImage2D(side.target,0,glTexture.internalFormat,_baseTexture.realWidth,_baseTexture.realHeight,0,_baseTexture.format,glTexture.type,null),dirty[i2]=-1))}return!0}static test(source){return Array.isArray(source)&&source.length===_CubeResource2.SIDES}};_CubeResource.SIDES=6;let CubeResource=_CubeResource;class ImageBitmapResource extends BaseImageResource{constructor(source,options){var _a2,_b;options=options||{};let baseSource,url2,ownsImageBitmap;typeof source=="string"?(baseSource=ImageBitmapResource.EMPTY,url2=source,ownsImageBitmap=!0):(baseSource=source,url2=null,ownsImageBitmap=!1),super(baseSource),this.url=url2,this.crossOrigin=(_a2=options.crossOrigin)!=null?_a2:!0,this.alphaMode=typeof options.alphaMode=="number"?options.alphaMode:null,this.ownsImageBitmap=(_b=options.ownsImageBitmap)!=null?_b:ownsImageBitmap,this._load=null,options.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(resolve2,reject)=>{if(this.url===null){resolve2(this);return}try{const response=await settings.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const imageBlob=await response.blob();if(this.destroyed)return;const imageBitmap=await createImageBitmap(imageBlob,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"});if(this.destroyed){imageBitmap.close();return}this.source=imageBitmap,this.update(),resolve2(this)}catch(e2){if(this.destroyed)return;reject(e2),this.onError.emit(e2)}}),this._load)}upload(renderer,baseTexture,glTexture){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(baseTexture.alphaMode=this.alphaMode),super.upload(renderer,baseTexture,glTexture)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(source){return!!globalThis.createImageBitmap&&typeof ImageBitmap!="undefined"&&(typeof source=="string"||source instanceof ImageBitmap)}static get EMPTY(){var _a2;return ImageBitmapResource._EMPTY=(_a2=ImageBitmapResource._EMPTY)!=null?_a2:settings.ADAPTER.createCanvas(0,0),ImageBitmapResource._EMPTY}}const _SVGResource=class _SVGResource2 extends BaseImageResource{constructor(sourceBase64,options){options=options||{},super(settings.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=sourceBase64,this.scale=options.scale||1,this._overrideWidth=options.width,this._overrideHeight=options.height,this._resolve=null,this._crossorigin=options.crossorigin,this._load=null,options.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(resolve2=>{if(this._resolve=()=>{this.update(),resolve2(this)},_SVGResource2.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const tempImage=new Image;BaseImageResource.crossOrigin(tempImage,this.svg,this._crossorigin),tempImage.src=this.svg,tempImage.onerror=event=>{this._resolve&&(tempImage.onerror=null,this.onError.emit(event))},tempImage.onload=()=>{if(!this._resolve)return;const svgWidth=tempImage.width,svgHeight=tempImage.height;if(!svgWidth||!svgHeight)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let width=svgWidth*this.scale,height=svgHeight*this.scale;(this._overrideWidth||this._overrideHeight)&&(width=this._overrideWidth||this._overrideHeight/svgHeight*svgWidth,height=this._overrideHeight||this._overrideWidth/svgWidth*svgHeight),width=Math.round(width),height=Math.round(height);const canvas=this.source;canvas.width=width,canvas.height=height,canvas._pixiId=`canvas_${uid()}`,canvas.getContext("2d").drawImage(tempImage,0,0,svgWidth,svgHeight,0,0,width,height),this._resolve(),this._resolve=null}}static getSize(svgString){const sizeMatch=_SVGResource2.SVG_SIZE.exec(svgString),size={};return sizeMatch&&(size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3])),size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]))),size}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(source,extension){return extension==="svg"||typeof source=="string"&&source.startsWith("data:image/svg+xml")||typeof source=="string"&&_SVGResource2.SVG_XML.test(source)}};_SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,_SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let SVGResource=_SVGResource;const _VideoResource=class _VideoResource2 extends BaseImageResource{constructor(source,options){if(options=options||{},!(source instanceof HTMLVideoElement)){const videoElement=document.createElement("video");options.autoLoad!==!1&&videoElement.setAttribute("preload","auto"),options.playsinline!==!1&&(videoElement.setAttribute("webkit-playsinline",""),videoElement.setAttribute("playsinline","")),options.muted===!0&&(videoElement.setAttribute("muted",""),videoElement.muted=!0),options.loop===!0&&videoElement.setAttribute("loop",""),options.autoPlay!==!1&&videoElement.setAttribute("autoplay",""),typeof source=="string"&&(source=[source]);const firstSrc=source[0].src||source[0];BaseImageResource.crossOrigin(videoElement,firstSrc,options.crossorigin);for(let i2=0;i2<source.length;++i2){const sourceElement=document.createElement("source");let{src,mime}=source[i2];if(src=src||source[i2],src.startsWith("data:"))mime=src.slice(5,src.indexOf(";"));else if(!src.startsWith("blob:")){const baseSrc=src.split("?").shift().toLowerCase(),ext=baseSrc.slice(baseSrc.lastIndexOf(".")+1);mime=mime||_VideoResource2.MIME_TYPES[ext]||`video/${ext}`}sourceElement.src=src,mime&&(sourceElement.type=mime),videoElement.appendChild(sourceElement)}source=videoElement}super(source),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=options.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=options.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),options.autoLoad!==!1&&this.load()}update(_deltaTime=0){if(!this.destroyed){if(this._updateFPS){const elapsedMS=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-elapsedMS)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const source=this.source;return(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0),source.addEventListener("play",this._onPlayStart),source.addEventListener("pause",this._onPlayStop),source.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(source.addEventListener("canplay",this._onCanPlay),source.addEventListener("canplaythrough",this._onCanPlay),source.addEventListener("error",this._onError,!0)),this._load=new Promise((resolve2,reject)=>{this.valid?resolve2(this):(this._resolve=resolve2,this._reject=reject,source.load())}),this._load}_onError(event){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(event),this._reject&&(this._reject(event),this._reject=null,this._resolve=null)}_isSourcePlaying(){const source=this.source;return!source.paused&&!source.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const source=this.source;source.removeEventListener("canplay",this._onCanPlay),source.removeEventListener("canplaythrough",this._onCanPlay);const valid=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!valid&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&source.play()}dispose(){this._configureAutoUpdate();const source=this.source;source&&(source.removeEventListener("play",this._onPlayStart),source.removeEventListener("pause",this._onPlayStop),source.removeEventListener("seeked",this._onSeeked),source.removeEventListener("canplay",this._onCanPlay),source.removeEventListener("canplaythrough",this._onCanPlay),source.removeEventListener("error",this._onError,!0),source.pause(),source.src="",source.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(value){value!==this._autoUpdate&&(this._autoUpdate=value,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(value){value!==this._updateFPS&&(this._updateFPS=value,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(source,extension){return globalThis.HTMLVideoElement&&source instanceof HTMLVideoElement||_VideoResource2.TYPES.includes(extension)}};_VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],_VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let VideoResource=_VideoResource;INSTALLED.push(ImageBitmapResource,ImageResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);class TransformFeedback{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new Runner("disposeTransformFeedback")}bindBuffer(index,buffer){this.buffers[index]=buffer}destroy(){this.disposeRunner.emit(this,!1)}}const VERSION="7.3.3";BaseTexture.prototype.getDrawableSource=function(){const resource=this.resource;return resource?resource.bitmap||resource.source:null},BaseRenderTexture.prototype._canvasRenderTarget=null,Texture.prototype.patternCache=null,Texture.prototype.tintCache=null;let canUseNewCanvasBlendModesValue;function createColoredCanvas(color){const canvas=settings.ADAPTER.createCanvas(6,1),context2=canvas.getContext("2d");return context2.fillStyle=color,context2.fillRect(0,0,6,1),canvas}function canUseNewCanvasBlendModes(){if(typeof document=="undefined")return!1;if(canUseNewCanvasBlendModesValue!==void 0)return canUseNewCanvasBlendModesValue;const magenta=createColoredCanvas("#ff00ff"),yellow=createColoredCanvas("#ffff00"),context2=settings.ADAPTER.createCanvas(6,1).getContext("2d");context2.globalCompositeOperation="multiply",context2.drawImage(magenta,0,0),context2.drawImage(yellow,2,0);const imageData=context2.getImageData(2,0,1,1);if(!imageData)canUseNewCanvasBlendModesValue=!1;else{const data=imageData.data;canUseNewCanvasBlendModesValue=data[0]===255&&data[1]===0&&data[2]===0}return canUseNewCanvasBlendModesValue}function mapCanvasBlendModesToPixi(array=[]){return canUseNewCanvasBlendModes()?(array[BLEND_MODES.NORMAL]="source-over",array[BLEND_MODES.ADD]="lighter",array[BLEND_MODES.MULTIPLY]="multiply",array[BLEND_MODES.SCREEN]="screen",array[BLEND_MODES.OVERLAY]="overlay",array[BLEND_MODES.DARKEN]="darken",array[BLEND_MODES.LIGHTEN]="lighten",array[BLEND_MODES.COLOR_DODGE]="color-dodge",array[BLEND_MODES.COLOR_BURN]="color-burn",array[BLEND_MODES.HARD_LIGHT]="hard-light",array[BLEND_MODES.SOFT_LIGHT]="soft-light",array[BLEND_MODES.DIFFERENCE]="difference",array[BLEND_MODES.EXCLUSION]="exclusion",array[BLEND_MODES.HUE]="hue",array[BLEND_MODES.SATURATION]="saturation",array[BLEND_MODES.COLOR]="color",array[BLEND_MODES.LUMINOSITY]="luminosity"):(array[BLEND_MODES.NORMAL]="source-over",array[BLEND_MODES.ADD]="lighter",array[BLEND_MODES.MULTIPLY]="source-over",array[BLEND_MODES.SCREEN]="source-over",array[BLEND_MODES.OVERLAY]="source-over",array[BLEND_MODES.DARKEN]="source-over",array[BLEND_MODES.LIGHTEN]="source-over",array[BLEND_MODES.COLOR_DODGE]="source-over",array[BLEND_MODES.COLOR_BURN]="source-over",array[BLEND_MODES.HARD_LIGHT]="source-over",array[BLEND_MODES.SOFT_LIGHT]="source-over",array[BLEND_MODES.DIFFERENCE]="source-over",array[BLEND_MODES.EXCLUSION]="source-over",array[BLEND_MODES.HUE]="source-over",array[BLEND_MODES.SATURATION]="source-over",array[BLEND_MODES.COLOR]="source-over",array[BLEND_MODES.LUMINOSITY]="source-over"),array[BLEND_MODES.NORMAL_NPM]=array[BLEND_MODES.NORMAL],array[BLEND_MODES.ADD_NPM]=array[BLEND_MODES.ADD],array[BLEND_MODES.SCREEN_NPM]=array[BLEND_MODES.SCREEN],array[BLEND_MODES.SRC_IN]="source-in",array[BLEND_MODES.SRC_OUT]="source-out",array[BLEND_MODES.SRC_ATOP]="source-atop",array[BLEND_MODES.DST_OVER]="destination-over",array[BLEND_MODES.DST_IN]="destination-in",array[BLEND_MODES.DST_OUT]="destination-out",array[BLEND_MODES.DST_ATOP]="destination-atop",array[BLEND_MODES.XOR]="xor",array[BLEND_MODES.SUBTRACT]="source-over",array}const tempMatrix$2=new Matrix;class CanvasContextSystem{constructor(renderer){this.activeResolution=1,this.smoothProperty="imageSmoothingEnabled",this.blendModes=mapCanvasBlendModesToPixi(),this._activeBlendMode=null,this._projTransform=null,this._outerBlend=!1,this.renderer=renderer}init(){const alpha=this.renderer.background.alpha<1;if(this.rootContext=this.renderer.view.getContext("2d",{alpha}),this.activeContext=this.rootContext,!this.rootContext.imageSmoothingEnabled){const rc=this.rootContext;rc.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":rc.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":rc.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":rc.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")}}setContextTransform(transform,roundPixels,localResolution){let mat=transform;const proj=this._projTransform,contextResolution=this.activeResolution;localResolution=localResolution||contextResolution,proj&&(mat=tempMatrix$2,mat.copyFrom(transform),mat.prepend(proj)),roundPixels?this.activeContext.setTransform(mat.a*localResolution,mat.b*localResolution,mat.c*localResolution,mat.d*localResolution,mat.tx*contextResolution|0,mat.ty*contextResolution|0):this.activeContext.setTransform(mat.a*localResolution,mat.b*localResolution,mat.c*localResolution,mat.d*localResolution,mat.tx*contextResolution,mat.ty*contextResolution)}clear(clearColor,alpha){const{activeContext:context2,renderer}=this,fillColor=clearColor?Color.shared.setValue(clearColor):this.renderer.background.backgroundColor;context2.clearRect(0,0,renderer.width,renderer.height),clearColor&&(context2.globalAlpha=alpha!=null?alpha:this.renderer.background.alpha,context2.fillStyle=fillColor.toHex(),context2.fillRect(0,0,renderer.width,renderer.height),context2.globalAlpha=1)}setBlendMode(blendMode,readyForOuterBlend){const outerBlend=blendMode===BLEND_MODES.SRC_IN||blendMode===BLEND_MODES.SRC_OUT||blendMode===BLEND_MODES.DST_IN||blendMode===BLEND_MODES.DST_ATOP;!readyForOuterBlend&&outerBlend&&(blendMode=BLEND_MODES.NORMAL),this._activeBlendMode!==blendMode&&(this._activeBlendMode=blendMode,this._outerBlend=outerBlend,this.activeContext.globalCompositeOperation=this.blendModes[blendMode])}resize(){this.smoothProperty&&(this.rootContext[this.smoothProperty]=BaseTexture.defaultOptions.scaleMode===SCALE_MODES.LINEAR)}invalidateBlendMode(){this._activeBlendMode=this.blendModes.indexOf(this.activeContext.globalCompositeOperation)}destroy(){this.renderer=null,this.rootContext=null,this.activeContext=null,this.smoothProperty=null}}CanvasContextSystem.extension={type:ExtensionType.CanvasRendererSystem,name:"canvasContext"},extensions$1.add(CanvasContextSystem);class CanvasMaskSystem{constructor(renderer){this._foundShapes=[],this.renderer=renderer}pushMask(maskData){const renderer=this.renderer,maskObject=maskData.maskObject||maskData;renderer.canvasContext.activeContext.save();const foundShapes=this._foundShapes;if(this.recursiveFindShapes(maskObject,foundShapes),foundShapes.length>0){const context2=renderer.canvasContext.activeContext;context2.beginPath();for(let i2=0;i2<foundShapes.length;i2++){const shape=foundShapes[i2],transform=shape.transform.worldTransform;this.renderer.canvasContext.setContextTransform(transform),this.renderGraphicsShape(shape)}foundShapes.length=0,context2.clip()}}recursiveFindShapes(container,out){container.geometry&&container.geometry.graphicsData&&out.push(container);const{children}=container;if(children)for(let i2=0;i2<children.length;i2++)this.recursiveFindShapes(children[i2],out)}renderGraphicsShape(graphics){graphics.finishPoly();const context2=this.renderer.canvasContext.activeContext,graphicsData=graphics.geometry.graphicsData,len=graphicsData.length;if(len!==0)for(let i2=0;i2<len;i2++){const data=graphicsData[i2],shape=data.shape;if(shape.type===SHAPES.POLY){let points=shape.points;const holes=data.holes;let outerArea,innerArea,px,py;context2.moveTo(points[0],points[1]);for(let j2=1;j2<points.length/2;j2++)context2.lineTo(points[j2*2],points[j2*2+1]);if(holes.length>0){outerArea=0,px=points[0],py=points[1];for(let j2=2;j2+2<points.length;j2+=2)outerArea+=(points[j2]-px)*(points[j2+3]-py)-(points[j2+2]-px)*(points[j2+1]-py);for(let k2=0;k2<holes.length;k2++)if(points=holes[k2].shape.points,!!points){innerArea=0,px=points[0],py=points[1];for(let j2=2;j2+2<points.length;j2+=2)innerArea+=(points[j2]-px)*(points[j2+3]-py)-(points[j2+2]-px)*(points[j2+1]-py);if(innerArea*outerArea<0){context2.moveTo(points[0],points[1]);for(let j2=2;j2<points.length;j2+=2)context2.lineTo(points[j2],points[j2+1])}else{context2.moveTo(points[points.length-2],points[points.length-1]);for(let j2=points.length-4;j2>=0;j2-=2)context2.lineTo(points[j2],points[j2+1])}holes[k2].shape.closeStroke&&context2.closePath()}}points[0]===points[points.length-2]&&points[1]===points[points.length-1]&&context2.closePath()}else if(shape.type===SHAPES.RECT)context2.rect(shape.x,shape.y,shape.width,shape.height),context2.closePath();else if(shape.type===SHAPES.CIRC)context2.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context2.closePath();else if(shape.type===SHAPES.ELIP){const w2=shape.width*2,h2=shape.height*2,x2=shape.x-w2/2,y2=shape.y-h2/2,kappa=0.5522848,ox=w2/2*kappa,oy=h2/2*kappa,xe=x2+w2,ye=y2+h2,xm=x2+w2/2,ym=y2+h2/2;context2.moveTo(x2,ym),context2.bezierCurveTo(x2,ym-oy,xm-ox,y2,xm,y2),context2.bezierCurveTo(xm+ox,y2,xe,ym-oy,xe,ym),context2.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context2.bezierCurveTo(xm-ox,ye,x2,ym+oy,x2,ym),context2.closePath()}else if(shape.type===SHAPES.RREC){const rx=shape.x,ry=shape.y,width=shape.width,height=shape.height;let radius=shape.radius;const maxRadius=Math.min(width,height)/2;radius=radius>maxRadius?maxRadius:radius,context2.moveTo(rx,ry+radius),context2.lineTo(rx,ry+height-radius),context2.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context2.lineTo(rx+width-radius,ry+height),context2.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context2.lineTo(rx+width,ry+radius),context2.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context2.lineTo(rx+radius,ry),context2.quadraticCurveTo(rx,ry,rx,ry+radius),context2.closePath()}}}popMask(renderer){renderer.canvasContext.activeContext.restore(),renderer.canvasContext.invalidateBlendMode()}destroy(){}}CanvasMaskSystem.extension={type:ExtensionType.CanvasRendererSystem,name:"mask"},extensions$1.add(CanvasMaskSystem);class CanvasObjectRendererSystem{constructor(renderer){this.renderer=renderer}render(displayObject,options){const renderer=this.renderer;if(!renderer.view)return;const _context=renderer.canvasContext;let renderTexture,clear,transform,skipUpdateTransform;options&&(renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform),this.renderingToScreen=!renderTexture,renderer.emit("prerender");const rootResolution=renderer.resolution;renderTexture?(renderTexture=renderTexture.castToBaseTexture(),renderTexture._canvasRenderTarget||(renderTexture._canvasRenderTarget=new CanvasRenderTarget(renderTexture.width,renderTexture.height,renderTexture.resolution),renderTexture.resource=new CanvasResource(renderTexture._canvasRenderTarget.canvas),renderTexture.valid=!0),_context.activeContext=renderTexture._canvasRenderTarget.context,renderer.canvasContext.activeResolution=renderTexture._canvasRenderTarget.resolution):(_context.activeContext=_context.rootContext,_context.activeResolution=rootResolution);const context2D=_context.activeContext;if(_context._projTransform=transform||null,renderTexture||(this.lastObjectRendered=displayObject),!skipUpdateTransform){const cacheParent=displayObject.enableTempParent();displayObject.updateTransform(),displayObject.disableTempParent(cacheParent)}if(context2D.save(),context2D.setTransform(1,0,0,1,0,0),context2D.globalAlpha=1,_context._activeBlendMode=BLEND_MODES.NORMAL,_context._outerBlend=!1,context2D.globalCompositeOperation=_context.blendModes[BLEND_MODES.NORMAL],clear!=null?clear:renderer.background.clearBeforeRender)if(this.renderingToScreen){context2D.clearRect(0,0,renderer.width,renderer.height);const background=renderer.background;background.alpha>0&&(context2D.globalAlpha=background.backgroundColor.alpha,context2D.fillStyle=background.backgroundColor.toHex(),context2D.fillRect(0,0,renderer.width,renderer.height),context2D.globalAlpha=1)}else renderTexture=renderTexture,renderTexture._canvasRenderTarget.clear(),renderTexture.clear.alpha>0&&(context2D.globalAlpha=renderTexture.clear.alpha,context2D.fillStyle=renderTexture.clear.toHex(),context2D.fillRect(0,0,renderTexture.realWidth,renderTexture.realHeight),context2D.globalAlpha=1);const tempContext=_context.activeContext;_context.activeContext=context2D,displayObject.renderCanvas(renderer),_context.activeContext=tempContext,context2D.restore(),_context.activeResolution=rootResolution,_context._projTransform=null,renderer.emit("postrender")}destroy(){this.lastObjectRendered=null,this.render=null}}CanvasObjectRendererSystem.extension={type:ExtensionType.CanvasRendererSystem,name:"objectRenderer"},extensions$1.add(CanvasObjectRendererSystem);const{deprecation}=utils,_CanvasRenderer=class _CanvasRenderer2 extends SystemManager{constructor(options){super(),this.type=RENDERER_TYPE.CANVAS,this.rendererLogId="Canvas",options=Object.assign({},settings.RENDER_OPTIONS,options);const systemConfig={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:_CanvasRenderer2.__systems,priority:["textureGenerator","background","_view","_plugin","startup","mask","canvasContext","objectRenderer"]};this.setup(systemConfig),"useContextAlpha"in options&&(deprecation("7.0.0","options.useContextAlpha is deprecated, use options.backgroundAlpha instead"),options.backgroundAlpha=options.useContextAlpha===!1?1:options.backgroundAlpha),this._plugin.rendererPlugins=_CanvasRenderer2.__plugins,this.options=options,this.startup.run(this.options)}static test(){return!0}generateTexture(displayObject,options){return this.textureGenerator.generateTexture(displayObject,options)}reset(){}render(displayObject,options){this.objectRenderer.render(displayObject,options)}clear(){this.canvasContext.clear()}destroy(removeView){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:removeView}),super.destroy()}get plugins(){return this._plugin.plugins}resize(desiredScreenWidth,desiredScreenHeight){this._view.resizeView(desiredScreenWidth,desiredScreenHeight)}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(value){this._view.resolution=value,this.runners.resolutionChange.emit(value)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get clearBeforeRender(){return this.background.clearBeforeRender}get blendModes(){return deprecation("7.0.0","renderer.blendModes has been deprecated, please use renderer.canvasContext.blendModes instead"),this.canvasContext.blendModes}get maskManager(){return deprecation("7.0.0","renderer.maskManager has been deprecated, please use renderer.mask instead"),this.mask}get refresh(){return deprecation("7.0.0","renderer.refresh has been deprecated"),!0}get rootContext(){return deprecation("7.0.0","renderer.rootContext has been deprecated, please use renderer.canvasContext.rootContext instead"),this.canvasContext.rootContext}get context(){return deprecation("7.0.0","renderer.context has been deprecated, please use renderer.canvasContext.activeContext instead"),this.canvasContext.activeContext}get smoothProperty(){return deprecation("7.0.0","renderer.smoothProperty has been deprecated, please use renderer.canvasContext.smoothProperty instead"),this.canvasContext.smoothProperty}setBlendMode(blendMode,readyForOuterBlend){deprecation("7.0.0","renderer.setBlendMode has been deprecated, use renderer.canvasContext.setBlendMode instead"),this.canvasContext.setBlendMode(blendMode,readyForOuterBlend)}invalidateBlendMode(){deprecation("7.0.0","renderer.invalidateBlendMode has been deprecated, use renderer.canvasContext.invalidateBlendMode instead"),this.canvasContext.invalidateBlendMode()}setContextTransform(transform,roundPixels,localResolution){deprecation("7.0.0","renderer.setContextTransform has been deprecated, use renderer.canvasContext.setContextTransform instead"),this.canvasContext.setContextTransform(transform,roundPixels,localResolution)}get backgroundColor(){return deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(value){deprecation("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=value}get backgroundAlpha(){return deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(value){deprecation("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=value}get preserveDrawingBuffer(){return deprecation("7.0.0","renderer.preserveDrawingBuffer has been deprecated"),!1}get useContextAlpha(){return deprecation("7.0.0","renderer.useContextAlpha has been deprecated"),!1}};_CanvasRenderer.extension={type:ExtensionType.Renderer,priority:0},_CanvasRenderer.__plugins={},_CanvasRenderer.__systems={};let CanvasRenderer=_CanvasRenderer;extensions$1.handleByMap(ExtensionType.CanvasRendererPlugin,CanvasRenderer.__plugins),extensions$1.handleByMap(ExtensionType.CanvasRendererSystem,CanvasRenderer.__systems),extensions$1.add(CanvasRenderer);const canvasUtils={canvas:null,getTintedCanvas:(sprite,color)=>{const texture=sprite.texture,stringColor=Color.shared.setValue(color).toHex();texture.tintCache=texture.tintCache||{};const cachedCanvas=texture.tintCache[stringColor];let canvas;if(cachedCanvas){if(cachedCanvas.tintId===texture._updateID)return texture.tintCache[stringColor];canvas=texture.tintCache[stringColor]}else canvas=settings.ADAPTER.createCanvas();if(canvasUtils.tintMethod(texture,color,canvas),canvas.tintId=texture._updateID,canvasUtils.convertTintToImage&&canvas.toDataURL!==void 0){const tintImage=new Image;tintImage.src=canvas.toDataURL(),texture.tintCache[stringColor]=tintImage}else texture.tintCache[stringColor]=canvas;return canvas},getTintedPattern:(texture,color)=>{const stringColor=Color.shared.setValue(color).toHex();texture.patternCache=texture.patternCache||{};let pattern=texture.patternCache[stringColor];return(pattern==null?void 0:pattern.tintId)===texture._updateID||(canvasUtils.canvas||(canvasUtils.canvas=settings.ADAPTER.createCanvas()),canvasUtils.tintMethod(texture,color,canvasUtils.canvas),pattern=canvasUtils.canvas.getContext("2d").createPattern(canvasUtils.canvas,"repeat"),pattern.tintId=texture._updateID,texture.patternCache[stringColor]=pattern),pattern},tintWithMultiply:(texture,color,canvas)=>{const context2=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context2.save(),context2.fillStyle=Color.shared.setValue(color).toHex(),context2.fillRect(0,0,crop.width,crop.height),context2.globalCompositeOperation="multiply";const source=texture.baseTexture.getDrawableSource();context2.drawImage(source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context2.globalCompositeOperation="destination-atop",context2.drawImage(source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context2.restore()},tintWithOverlay:(texture,color,canvas)=>{const context2=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context2.save(),context2.globalCompositeOperation="copy",context2.fillStyle=`#${`00000${(color|0).toString(16)}`.slice(-6)}`,context2.fillRect(0,0,crop.width,crop.height),context2.globalCompositeOperation="destination-atop",context2.drawImage(texture.baseTexture.getDrawableSource(),crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context2.restore()},tintWithPerPixel:(texture,color,canvas)=>{const context2=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context2.save(),context2.globalCompositeOperation="copy",context2.drawImage(texture.baseTexture.getDrawableSource(),crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context2.restore();const[r2,g2,b2]=Color.shared.setValue(color).toArray(),pixelData=context2.getImageData(0,0,crop.width,crop.height),pixels=pixelData.data;for(let i2=0;i2<pixels.length;i2+=4)pixels[i2+0]*=r2,pixels[i2+1]*=g2,pixels[i2+2]*=b2;context2.putImageData(pixelData,0,0)},roundColor:color=>(deprecation$1("7.3.0","PIXI.canvasUtils.roundColor is deprecated"),Color.shared.setValue(color).round(canvasUtils.cacheStepsPerColorChannel).toNumber()),cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:canUseNewCanvasBlendModes(),tintMethod:null};canvasUtils.tintMethod=canvasUtils.canUseMultiply?canvasUtils.tintWithMultiply:canvasUtils.tintWithPerPixel;class Bounds{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(rect){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:(rect=rect||new Rectangle(0,0,1,1),rect.x=this.minX,rect.y=this.minY,rect.width=this.maxX-this.minX,rect.height=this.maxY-this.minY,rect)}addPoint(point){this.minX=Math.min(this.minX,point.x),this.maxX=Math.max(this.maxX,point.x),this.minY=Math.min(this.minY,point.y),this.maxY=Math.max(this.maxY,point.y)}addPointMatrix(matrix,point){const{a:a2,b:b2,c:c2,d:d2,tx,ty}=matrix,x2=a2*point.x+c2*point.y+tx,y2=b2*point.x+d2*point.y+ty;this.minX=Math.min(this.minX,x2),this.maxX=Math.max(this.maxX,x2),this.minY=Math.min(this.minY,y2),this.maxY=Math.max(this.maxY,y2)}addQuad(vertices){let minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,x2=vertices[0],y2=vertices[1];minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY,x2=vertices[2],y2=vertices[3],minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY,x2=vertices[4],y2=vertices[5],minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY,x2=vertices[6],y2=vertices[7],minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY,this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY}addFrame(transform,x0,y0,x1,y1){this.addFrameMatrix(transform.worldTransform,x0,y0,x1,y1)}addFrameMatrix(matrix,x0,y0,x1,y1){const a2=matrix.a,b2=matrix.b,c2=matrix.c,d2=matrix.d,tx=matrix.tx,ty=matrix.ty;let minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,x2=a2*x0+c2*y0+tx,y2=b2*x0+d2*y0+ty;minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY,x2=a2*x1+c2*y0+tx,y2=b2*x1+d2*y0+ty,minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY,x2=a2*x0+c2*y1+tx,y2=b2*x0+d2*y1+ty,minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY,x2=a2*x1+c2*y1+tx,y2=b2*x1+d2*y1+ty,minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY,this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY}addVertexData(vertexData,beginOffset,endOffset){let minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;for(let i2=beginOffset;i2<endOffset;i2+=2){const x2=vertexData[i2],y2=vertexData[i2+1];minX=x2<minX?x2:minX,minY=y2<minY?y2:minY,maxX=x2>maxX?x2:maxX,maxY=y2>maxY?y2:maxY}this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY}addVertices(transform,vertices,beginOffset,endOffset){this.addVerticesMatrix(transform.worldTransform,vertices,beginOffset,endOffset)}addVerticesMatrix(matrix,vertices,beginOffset,endOffset,padX=0,padY=padX){const a2=matrix.a,b2=matrix.b,c2=matrix.c,d2=matrix.d,tx=matrix.tx,ty=matrix.ty;let minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;for(let i2=beginOffset;i2<endOffset;i2+=2){const rawX=vertices[i2],rawY=vertices[i2+1],x2=a2*rawX+c2*rawY+tx,y2=d2*rawY+b2*rawX+ty;minX=Math.min(minX,x2-padX),maxX=Math.max(maxX,x2+padX),minY=Math.min(minY,y2-padY),maxY=Math.max(maxY,y2+padY)}this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY}addBounds(bounds){const minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=bounds.minX<minX?bounds.minX:minX,this.minY=bounds.minY<minY?bounds.minY:minY,this.maxX=bounds.maxX>maxX?bounds.maxX:maxX,this.maxY=bounds.maxY>maxY?bounds.maxY:maxY}addBoundsMask(bounds,mask){const _minX=bounds.minX>mask.minX?bounds.minX:mask.minX,_minY=bounds.minY>mask.minY?bounds.minY:mask.minY,_maxX=bounds.maxX<mask.maxX?bounds.maxX:mask.maxX,_maxY=bounds.maxY<mask.maxY?bounds.maxY:mask.maxY;if(_minX<=_maxX&&_minY<=_maxY){const minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=_minX<minX?_minX:minX,this.minY=_minY<minY?_minY:minY,this.maxX=_maxX>maxX?_maxX:maxX,this.maxY=_maxY>maxY?_maxY:maxY}}addBoundsMatrix(bounds,matrix){this.addFrameMatrix(matrix,bounds.minX,bounds.minY,bounds.maxX,bounds.maxY)}addBoundsArea(bounds,area2){const _minX=bounds.minX>area2.x?bounds.minX:area2.x,_minY=bounds.minY>area2.y?bounds.minY:area2.y,_maxX=bounds.maxX<area2.x+area2.width?bounds.maxX:area2.x+area2.width,_maxY=bounds.maxY<area2.y+area2.height?bounds.maxY:area2.y+area2.height;if(_minX<=_maxX&&_minY<=_maxY){const minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=_minX<minX?_minX:minX,this.minY=_minY<minY?_minY:minY,this.maxX=_maxX>maxX?_maxX:maxX,this.maxY=_maxY>maxY?_maxY:maxY}}pad(paddingX=0,paddingY=paddingX){this.isEmpty()||(this.minX-=paddingX,this.maxX+=paddingX,this.minY-=paddingY,this.maxY+=paddingY)}addFramePad(x0,y0,x1,y1,padX,padY){x0-=padX,y0-=padY,x1+=padX,y1+=padY,this.minX=this.minX<x0?this.minX:x0,this.maxX=this.maxX>x1?this.maxX:x1,this.minY=this.minY<y0?this.minY:y0,this.maxY=this.maxY>y1?this.maxY:y1}}class DisplayObject extends EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Transform,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Bounds,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(source){const keys=Object.keys(source);for(let i2=0;i2<keys.length;++i2){const propertyName=keys[i2];Object.defineProperty(DisplayObject.prototype,propertyName,Object.getOwnPropertyDescriptor(source,propertyName))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(skipUpdate,rect){return skipUpdate||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),rect||(this._boundsRect||(this._boundsRect=new Rectangle),rect=this._boundsRect),this._bounds.getRectangle(rect)}getLocalBounds(rect){var _a2;rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);const transformRef=this.transform,parentRef=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(_a2=parentRef==null?void 0:parentRef.worldAlpha)!=null?_a2:1,this.transform=this._tempDisplayObjectParent.transform;const worldBounds=this._bounds,worldBoundsID=this._boundsID;this._bounds=this._localBounds;const bounds=this.getBounds(!1,rect);return this.parent=parentRef,this.transform=transformRef,this._bounds=worldBounds,this._bounds.updateID+=this._boundsID-worldBoundsID,bounds}toGlobal(position,point,skipUpdate=!1){return skipUpdate||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(position,point)}toLocal(position,from,point,skipUpdate){return from&&(position=from.toGlobal(position,point,skipUpdate)),skipUpdate||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(position,point)}setParent(container){if(!container||!container.addChild)throw new Error("setParent: Argument must be a Container");return container.addChild(this),container}removeFromParent(){var _a2;(_a2=this.parent)==null||_a2.removeChild(this)}setTransform(x2=0,y2=0,scaleX=1,scaleY=1,rotation=0,skewX=0,skewY=0,pivotX=0,pivotY=0){return this.position.x=x2,this.position.y=y2,this.scale.x=scaleX||1,this.scale.y=scaleY||1,this.rotation=rotation,this.skew.x=skewX,this.skew.y=skewY,this.pivot.x=pivotX,this.pivot.y=pivotY,this}destroy(_options){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent}enableTempParent(){const myParent=this.parent;return this.parent=this._tempDisplayObjectParent,myParent}disableTempParent(cacheParent){this.parent=cacheParent}get x(){return this.position.x}set x(value){this.transform.position.x=value}get y(){return this.position.y}set y(value){this.transform.position.y=value}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(value){this.transform.position.copyFrom(value)}get scale(){return this.transform.scale}set scale(value){this.transform.scale.copyFrom(value)}get pivot(){return this.transform.pivot}set pivot(value){this.transform.pivot.copyFrom(value)}get skew(){return this.transform.skew}set skew(value){this.transform.skew.copyFrom(value)}get rotation(){return this.transform.rotation}set rotation(value){this.transform.rotation=value}get angle(){return this.transform.rotation*RAD_TO_DEG}set angle(value){this.transform.rotation=value*DEG_TO_RAD}get zIndex(){return this._zIndex}set zIndex(value){this._zIndex!==value&&(this._zIndex=value,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let item=this;do{if(!item.visible)return!1;item=item.parent}while(item);return!0}get mask(){return this._mask}set mask(value){if(this._mask!==value){if(this._mask){const maskObject=this._mask.isMaskData?this._mask.maskObject:this._mask;maskObject&&(maskObject._maskRefCount--,maskObject._maskRefCount===0&&(maskObject.renderable=!0,maskObject.isMask=!1))}if(this._mask=value,this._mask){const maskObject=this._mask.isMaskData?this._mask.maskObject:this._mask;maskObject&&(maskObject._maskRefCount===0&&(maskObject.renderable=!1,maskObject.isMask=!0),maskObject._maskRefCount++)}}}}class TemporaryDisplayObject extends DisplayObject{constructor(){super(...arguments),this.sortDirty=null}}DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;const tempMatrix$1=new Matrix;function sortChildren(a2,b2){return a2.zIndex===b2.zIndex?a2._lastSortedIndex-b2._lastSortedIndex:a2.zIndex-b2.zIndex}const _Container=class _Container2 extends DisplayObject{constructor(){super(),this.children=[],this.sortableChildren=_Container2.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(_length){}addChild(...children){if(children.length>1)for(let i2=0;i2<children.length;i2++)this.addChild(children[i2]);else{const child=children[0];child.parent&&child.parent.removeChild(child),child.parent=this,this.sortDirty=!0,child.transform._parentID=-1,this.children.push(child),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",child,this,this.children.length-1),child.emit("added",this)}return children[0]}addChildAt(child,index){if(index<0||index>this.children.length)throw new Error(`${child}addChildAt: The index ${index} supplied is out of bounds ${this.children.length}`);return child.parent&&child.parent.removeChild(child),child.parent=this,this.sortDirty=!0,child.transform._parentID=-1,this.children.splice(index,0,child),this._boundsID++,this.onChildrenChange(index),child.emit("added",this),this.emit("childAdded",child,this,index),child}swapChildren(child,child2){if(child===child2)return;const index1=this.getChildIndex(child),index2=this.getChildIndex(child2);this.children[index1]=child2,this.children[index2]=child,this.onChildrenChange(index1<index2?index1:index2)}getChildIndex(child){const index=this.children.indexOf(child);if(index===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return index}setChildIndex(child,index){if(index<0||index>=this.children.length)throw new Error(`The index ${index} supplied is out of bounds ${this.children.length}`);const currentIndex=this.getChildIndex(child);removeItems(this.children,currentIndex,1),this.children.splice(index,0,child),this.onChildrenChange(index)}getChildAt(index){if(index<0||index>=this.children.length)throw new Error(`getChildAt: Index (${index}) does not exist.`);return this.children[index]}removeChild(...children){if(children.length>1)for(let i2=0;i2<children.length;i2++)this.removeChild(children[i2]);else{const child=children[0],index=this.children.indexOf(child);if(index===-1)return null;child.parent=null,child.transform._parentID=-1,removeItems(this.children,index,1),this._boundsID++,this.onChildrenChange(index),child.emit("removed",this),this.emit("childRemoved",child,this,index)}return children[0]}removeChildAt(index){const child=this.getChildAt(index);return child.parent=null,child.transform._parentID=-1,removeItems(this.children,index,1),this._boundsID++,this.onChildrenChange(index),child.emit("removed",this),this.emit("childRemoved",child,this,index),child}removeChildren(beginIndex=0,endIndex=this.children.length){const begin=beginIndex,end=endIndex,range=end-begin;let removed;if(range>0&&range<=end){removed=this.children.splice(begin,range);for(let i2=0;i2<removed.length;++i2)removed[i2].parent=null,removed[i2].transform&&(removed[i2].transform._parentID=-1);this._boundsID++,this.onChildrenChange(beginIndex);for(let i2=0;i2<removed.length;++i2)removed[i2].emit("removed",this),this.emit("childRemoved",removed[i2],this,i2);return removed}else if(range===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let sortRequired=!1;for(let i2=0,j2=this.children.length;i2<j2;++i2){const child=this.children[i2];child._lastSortedIndex=i2,!sortRequired&&child.zIndex!==0&&(sortRequired=!0)}sortRequired&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let i2=0,j2=this.children.length;i2<j2;++i2){const child=this.children[i2];child.visible&&child.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let i2=0;i2<this.children.length;i2++){const child=this.children[i2];if(!(!child.visible||!child.renderable))if(child.calculateBounds(),child._mask){const maskObject=child._mask.isMaskData?child._mask.maskObject:child._mask;maskObject?(maskObject.calculateBounds(),this._bounds.addBoundsMask(child._bounds,maskObject._bounds)):this._bounds.addBounds(child._bounds)}else child.filterArea?this._bounds.addBoundsArea(child._bounds,child.filterArea):this._bounds.addBounds(child._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(rect,skipChildrenUpdate=!1){const result=super.getLocalBounds(rect);if(!skipChildrenUpdate)for(let i2=0,j2=this.children.length;i2<j2;++i2){const child=this.children[i2];child.visible&&child.updateTransform()}return result}_calculateBounds(){}_renderWithCulling(renderer){const sourceFrame=renderer.renderTexture.sourceFrame;if(!(sourceFrame.width>0&&sourceFrame.height>0))return;let bounds,transform;this.cullArea?(bounds=this.cullArea,transform=this.worldTransform):this._render!==_Container2.prototype._render&&(bounds=this.getBounds(!0));const projectionTransform=renderer.projection.transform;if(projectionTransform&&(transform?(transform=tempMatrix$1.copyFrom(transform),transform.prepend(projectionTransform)):transform=projectionTransform),bounds&&sourceFrame.intersects(bounds,transform))this._render(renderer);else if(this.cullArea)return;for(let i2=0,j2=this.children.length;i2<j2;++i2){const child=this.children[i2],childCullable=child.cullable;child.cullable=childCullable||!this.cullArea,child.render(renderer),child.cullable=childCullable}}render(renderer){var _a2;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(_a2=this.filters)!=null&&_a2.length)this.renderAdvanced(renderer);else if(this.cullable)this._renderWithCulling(renderer);else{this._render(renderer);for(let i2=0,j2=this.children.length;i2<j2;++i2)this.children[i2].render(renderer)}}renderAdvanced(renderer){var _a2,_b,_c;const filters2=this.filters,mask=this._mask;if(filters2){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let i2=0;i2<filters2.length;i2++)filters2[i2].enabled&&this._enabledFilters.push(filters2[i2])}const flush=filters2&&((_a2=this._enabledFilters)==null?void 0:_a2.length)||mask&&(!mask.isMaskData||mask.enabled&&(mask.autoDetect||mask.type!==MASK_TYPES.NONE));if(flush&&renderer.batch.flush(),filters2&&(_b=this._enabledFilters)!=null&&_b.length&&renderer.filter.push(this,this._enabledFilters),mask&&renderer.mask.push(this,this._mask),this.cullable)this._renderWithCulling(renderer);else{this._render(renderer);for(let i2=0,j2=this.children.length;i2<j2;++i2)this.children[i2].render(renderer)}flush&&renderer.batch.flush(),mask&&renderer.mask.pop(this),filters2&&(_c=this._enabledFilters)!=null&&_c.length&&renderer.filter.pop()}_render(_renderer){}destroy(options){super.destroy(),this.sortDirty=!1;const destroyChildren=typeof options=="boolean"?options:options==null?void 0:options.children,oldChildren=this.removeChildren(0,this.children.length);if(destroyChildren)for(let i2=0;i2<oldChildren.length;++i2)oldChildren[i2].destroy(options)}get width(){return this.scale.x*this.getLocalBounds().width}set width(value){const width=this.getLocalBounds().width;width!==0?this.scale.x=value/width:this.scale.x=1,this._width=value}get height(){return this.scale.y*this.getLocalBounds().height}set height(value){const height=this.getLocalBounds().height;height!==0?this.scale.y=value/height:this.scale.y=1,this._height=value}};_Container.defaultSortableChildren=!1;let Container=_Container;Container.prototype.containerUpdateTransform=Container.prototype.updateTransform,Object.defineProperties(settings,{SORTABLE_CHILDREN:{get(){return Container.defaultSortableChildren},set(value){deprecation$1("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Container.defaultSortableChildren=value}}});const tempPoint$2=new Point,indices=new Uint16Array([0,1,2,0,2,3]);class Sprite extends Container{constructor(texture){super(),this._anchor=new ObservablePoint(this._onAnchorUpdate,this,texture?texture.defaultAnchor.x:0,texture?texture.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Color(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=BLEND_MODES.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=texture||Texture.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=indices,this.pluginName="batch",this.isSprite=!0,this._roundPixels=settings.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const texture=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===texture._updateID)return;this._textureID!==texture._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=texture._updateID;const wt=this.transform.worldTransform,a2=wt.a,b2=wt.b,c2=wt.c,d2=wt.d,tx=wt.tx,ty=wt.ty,vertexData=this.vertexData,trim=texture.trim,orig=texture.orig,anchor=this._anchor;let w0=0,w1=0,h0=0,h1=0;if(trim?(w1=trim.x-anchor._x*orig.width,w0=w1+trim.width,h1=trim.y-anchor._y*orig.height,h0=h1+trim.height):(w1=-anchor._x*orig.width,w0=w1+orig.width,h1=-anchor._y*orig.height,h0=h1+orig.height),vertexData[0]=a2*w1+c2*h1+tx,vertexData[1]=d2*h1+b2*w1+ty,vertexData[2]=a2*w0+c2*h1+tx,vertexData[3]=d2*h1+b2*w0+ty,vertexData[4]=a2*w0+c2*h0+tx,vertexData[5]=d2*h0+b2*w0+ty,vertexData[6]=a2*w1+c2*h0+tx,vertexData[7]=d2*h0+b2*w1+ty,this._roundPixels){const resolution=settings.RESOLUTION;for(let i2=0;i2<vertexData.length;++i2)vertexData[i2]=Math.round(vertexData[i2]*resolution)/resolution}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const texture=this._texture,vertexData=this.vertexTrimmedData,orig=texture.orig,anchor=this._anchor,wt=this.transform.worldTransform,a2=wt.a,b2=wt.b,c2=wt.c,d2=wt.d,tx=wt.tx,ty=wt.ty,w1=-anchor._x*orig.width,w0=w1+orig.width,h1=-anchor._y*orig.height,h0=h1+orig.height;if(vertexData[0]=a2*w1+c2*h1+tx,vertexData[1]=d2*h1+b2*w1+ty,vertexData[2]=a2*w0+c2*h1+tx,vertexData[3]=d2*h1+b2*w0+ty,vertexData[4]=a2*w0+c2*h0+tx,vertexData[5]=d2*h0+b2*w0+ty,vertexData[6]=a2*w1+c2*h0+tx,vertexData[7]=d2*h0+b2*w1+ty,this._roundPixels){const resolution=settings.RESOLUTION;for(let i2=0;i2<vertexData.length;++i2)vertexData[i2]=Math.round(vertexData[i2]*resolution)/resolution}}_render(renderer){this.calculateVertices(),renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this)}_calculateBounds(){const trim=this._texture.trim,orig=this._texture.orig;!trim||trim.width===orig.width&&trim.height===orig.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(rect){return this.children.length===0?(this._localBounds||(this._localBounds=new Bounds),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._localBounds.getRectangle(rect)):super.getLocalBounds.call(this,rect)}containsPoint(point){this.worldTransform.applyInverse(point,tempPoint$2);const width=this._texture.orig.width,height=this._texture.orig.height,x1=-width*this.anchor.x;let y1=0;return tempPoint$2.x>=x1&&tempPoint$2.x<x1+width&&(y1=-height*this.anchor.y,tempPoint$2.y>=y1&&tempPoint$2.y<y1+height)}destroy(options){if(super.destroy(options),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof options=="boolean"?options:options==null?void 0:options.texture){const destroyBaseTexture=typeof options=="boolean"?options:options==null?void 0:options.baseTexture;this._texture.destroy(!!destroyBaseTexture)}this._texture=null}static from(source,options){const texture=source instanceof Texture?source:Texture.from(source,options);return new Sprite(texture)}set roundPixels(value){this._roundPixels!==value&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=value}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(value){const s2=sign(this.scale.x)||1;this.scale.x=s2*value/this._texture.orig.width,this._width=value}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(value){const s2=sign(this.scale.y)||1;this.scale.y=s2*value/this._texture.orig.height,this._height=value}get anchor(){return this._anchor}set anchor(value){this._anchor.copyFrom(value)}get tint(){return this._tintColor.value}set tint(value){this._tintColor.setValue(value),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(value){this._texture!==value&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=value||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,value&&(value.baseTexture.valid?this._onTextureUpdate():value.once("update",this._onTextureUpdate,this)))}}const tempPoint$1=new Point;class TilingSprite extends Sprite{constructor(texture,width=100,height=100){super(texture),this.tileTransform=new Transform,this._width=width,this._height=height,this.uvMatrix=this.texture.uvMatrix||new TextureMatrix(texture),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(value){this.uvMatrix.clampMargin=value,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(value){this.tileTransform.scale.copyFrom(value)}get tilePosition(){return this.tileTransform.position}set tilePosition(value){this.tileTransform.position.copyFrom(value)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(renderer){const texture=this._texture;!texture||!texture.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this))}_calculateBounds(){const minX=this._width*-this._anchor._x,minY=this._height*-this._anchor._y,maxX=this._width*(1-this._anchor._x),maxY=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)}getLocalBounds(rect){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._bounds.getRectangle(rect)):super.getLocalBounds.call(this,rect)}containsPoint(point){this.worldTransform.applyInverse(point,tempPoint$1);const width=this._width,height=this._height,x1=-width*this.anchor._x;if(tempPoint$1.x>=x1&&tempPoint$1.x<x1+width){const y1=-height*this.anchor._y;if(tempPoint$1.y>=y1&&tempPoint$1.y<y1+height)return!0}return!1}destroy(options){super.destroy(options),this.tileTransform=null,this.uvMatrix=null}static from(source,options){const texture=source instanceof Texture?source:Texture.from(source,options);return new TilingSprite(texture,options.width,options.height)}get width(){return this._width}set width(value){this._width=value}get height(){return this._height}set height(value){this._height=value}}var gl2FragmentSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,gl2VertexSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl1FragmentSrc=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,gl1VertexSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,fragmentSimpleSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const tempMat=new Matrix;class TilingSpriteRenderer extends ObjectRenderer{constructor(renderer){super(renderer),renderer.runners.contextChange.add(this),this.quad=new QuadUv,this.state=State.for2d()}contextChange(){const renderer=this.renderer,uniforms={globals:renderer.globalUniforms};this.simpleShader=Shader.from(gl1VertexSrc,fragmentSimpleSrc,uniforms),this.shader=renderer.context.webGLVersion>1?Shader.from(gl2VertexSrc,gl2FragmentSrc,uniforms):Shader.from(gl1VertexSrc,gl1FragmentSrc,uniforms)}render(ts){const renderer=this.renderer,quad=this.quad;let vertices=quad.vertices;vertices[0]=vertices[6]=ts._width*-ts.anchor.x,vertices[1]=vertices[3]=ts._height*-ts.anchor.y,vertices[2]=vertices[4]=ts._width*(1-ts.anchor.x),vertices[5]=vertices[7]=ts._height*(1-ts.anchor.y);const anchorX=ts.uvRespectAnchor?ts.anchor.x:0,anchorY=ts.uvRespectAnchor?ts.anchor.y:0;vertices=quad.uvs,vertices[0]=vertices[6]=-anchorX,vertices[1]=vertices[3]=-anchorY,vertices[2]=vertices[4]=1-anchorX,vertices[5]=vertices[7]=1-anchorY,quad.invalidate();const tex=ts._texture,baseTex=tex.baseTexture,premultiplied=baseTex.alphaMode>0,lt=ts.tileTransform.localTransform,uv=ts.uvMatrix;let isSimple=baseTex.isPowerOfTwo&&tex.frame.width===baseTex.width&&tex.frame.height===baseTex.height;isSimple&&(baseTex._glTextures[renderer.CONTEXT_UID]?isSimple=baseTex.wrapMode!==WRAP_MODES.CLAMP:baseTex.wrapMode===WRAP_MODES.CLAMP&&(baseTex.wrapMode=WRAP_MODES.REPEAT));const shader=isSimple?this.simpleShader:this.shader,w2=tex.width,h2=tex.height,W=ts._width,H2=ts._height;tempMat.set(lt.a*w2/W,lt.b*w2/H2,lt.c*h2/W,lt.d*h2/H2,lt.tx/W,lt.ty/H2),tempMat.invert(),isSimple?tempMat.prepend(uv.mapCoord):(shader.uniforms.uMapCoord=uv.mapCoord.toArray(!0),shader.uniforms.uClampFrame=uv.uClampFrame,shader.uniforms.uClampOffset=uv.uClampOffset),shader.uniforms.uTransform=tempMat.toArray(!0),shader.uniforms.uColor=Color.shared.setValue(ts.tint).premultiply(ts.worldAlpha,premultiplied).toArray(shader.uniforms.uColor),shader.uniforms.translationMatrix=ts.transform.worldTransform.toArray(!0),shader.uniforms.uSampler=tex,renderer.shader.bind(shader),renderer.geometry.bind(quad),this.state.blendMode=correctBlendMode(ts.blendMode,premultiplied),renderer.state.set(this.state),renderer.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}TilingSpriteRenderer.extension={name:"tilingSprite",type:ExtensionType.RendererPlugin},extensions$1.add(TilingSpriteRenderer);const worldMatrix=new Matrix,patternMatrix=new Matrix,patternRect=[new Point,new Point,new Point,new Point];TilingSprite.prototype._renderCanvas=function(renderer){const texture=this._texture;if(!texture.baseTexture.valid)return;const context2=renderer.canvasContext.activeContext,transform=this.worldTransform,baseTexture=texture.baseTexture,source=baseTexture.getDrawableSource(),baseTextureResolution=baseTexture.resolution;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tintValue){this._textureID=this._texture._updateID;const tempCanvas=new CanvasRenderTarget(texture._frame.width,texture._frame.height,baseTextureResolution);this.tintValue!==16777215?(this._tintedCanvas=canvasUtils.getTintedCanvas(this,this.tintValue),tempCanvas.context.drawImage(this._tintedCanvas,0,0)):tempCanvas.context.drawImage(source,-texture._frame.x*baseTextureResolution,-texture._frame.y*baseTextureResolution),this._cachedTint=this.tintValue,this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context2.globalAlpha=this.worldAlpha,renderer.canvasContext.setBlendMode(this.blendMode),this.tileTransform.updateLocalTransform();const lt=this.tileTransform.localTransform,W=this._width,H2=this._height;worldMatrix.identity(),patternMatrix.copyFrom(lt),this.uvRespectAnchor||patternMatrix.translate(-this.anchor.x*W,-this.anchor.y*H2),patternMatrix.scale(1/baseTextureResolution,1/baseTextureResolution),worldMatrix.prepend(patternMatrix),worldMatrix.prepend(transform),renderer.canvasContext.setContextTransform(worldMatrix),context2.fillStyle=this._canvasPattern;const lx=this.anchor.x*-W,ly=this.anchor.y*-H2;patternRect[0].set(lx,ly),patternRect[1].set(lx+W,ly),patternRect[2].set(lx+W,ly+H2),patternRect[3].set(lx,ly+H2);for(let i2=0;i2<4;i2++)patternMatrix.applyInverse(patternRect[i2],patternRect[i2]);context2.beginPath(),context2.moveTo(patternRect[0].x,patternRect[0].y);for(let i2=1;i2<4;i2++)context2.lineTo(patternRect[i2].x,patternRect[i2].y);context2.closePath(),context2.fill()};class ParticleContainer extends Container{constructor(maxSize=1500,properties,batchSize=16384,autoResize=!1){super();const maxBatchSize=16384;batchSize>maxBatchSize&&(batchSize=maxBatchSize),this._properties=[!1,!0,!1,!1,!1],this._maxSize=maxSize,this._batchSize=batchSize,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=BLEND_MODES.NORMAL,this.autoResize=autoResize,this.roundPixels=!0,this.baseTexture=null,this.setProperties(properties),this._tintColor=new Color(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(properties){properties&&(this._properties[0]="vertices"in properties||"scale"in properties?!!properties.vertices||!!properties.scale:this._properties[0],this._properties[1]="position"in properties?!!properties.position:this._properties[1],this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2],this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3],this._properties[4]="tint"in properties||"alpha"in properties?!!properties.tint||!!properties.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(value){this._tintColor.setValue(value),this._tintColor.toRgbArray(this.tintRgb)}render(renderer){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),renderer.batch.setObjectRenderer(renderer.plugins.particle),renderer.plugins.particle.render(this))}onChildrenChange(smallestChildIndex){const bufferIndex=Math.floor(smallestChildIndex/this._batchSize);for(;this._bufferUpdateIDs.length<bufferIndex;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[bufferIndex]=++this._updateID}dispose(){if(this._buffers){for(let i2=0;i2<this._buffers.length;++i2)this._buffers[i2].destroy();this._buffers=null}}destroy(options){super.destroy(options),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class ParticleBuffer{constructor(properties,dynamicPropertyFlags,size){this.geometry=new Geometry,this.indexBuffer=null,this.size=size,this.dynamicProperties=[],this.staticProperties=[];for(let i2=0;i2<properties.length;++i2){let property=properties[i2];property={attributeName:property.attributeName,size:property.size,uploadFunction:property.uploadFunction,type:property.type||TYPES.FLOAT,offset:property.offset},dynamicPropertyFlags[i2]?this.dynamicProperties.push(property):this.staticProperties.push(property)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const geometry=this.geometry;let dynamicOffset=0;this.indexBuffer=new Buffer(createIndicesForQuads(this.size),!0,!0),geometry.addIndex(this.indexBuffer),this.dynamicStride=0;for(let i2=0;i2<this.dynamicProperties.length;++i2){const property=this.dynamicProperties[i2];property.offset=dynamicOffset,dynamicOffset+=property.size,this.dynamicStride+=property.size}const dynBuffer=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(dynBuffer),this.dynamicDataUint32=new Uint32Array(dynBuffer),this.dynamicBuffer=new Buffer(this.dynamicData,!1,!1);let staticOffset=0;this.staticStride=0;for(let i2=0;i2<this.staticProperties.length;++i2){const property=this.staticProperties[i2];property.offset=staticOffset,staticOffset+=property.size,this.staticStride+=property.size}const statBuffer=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(statBuffer),this.staticDataUint32=new Uint32Array(statBuffer),this.staticBuffer=new Buffer(this.staticData,!0,!1);for(let i2=0;i2<this.dynamicProperties.length;++i2){const property=this.dynamicProperties[i2];geometry.addAttribute(property.attributeName,this.dynamicBuffer,0,property.type===TYPES.UNSIGNED_BYTE,property.type,this.dynamicStride*4,property.offset*4)}for(let i2=0;i2<this.staticProperties.length;++i2){const property=this.staticProperties[i2];geometry.addAttribute(property.attributeName,this.staticBuffer,0,property.type===TYPES.UNSIGNED_BYTE,property.type,this.staticStride*4,property.offset*4)}}uploadDynamic(children,startIndex,amount){for(let i2=0;i2<this.dynamicProperties.length;i2++){const property=this.dynamicProperties[i2];property.uploadFunction(children,startIndex,amount,property.type===TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,property.offset)}this.dynamicBuffer._updateID++}uploadStatic(children,startIndex,amount){for(let i2=0;i2<this.staticProperties.length;i2++){const property=this.staticProperties[i2];property.uploadFunction(children,startIndex,amount,property.type===TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,property.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var fragment$6=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vertex$3=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class ParticleRenderer extends ObjectRenderer{constructor(renderer){super(renderer),this.shader=null,this.properties=null,this.tempMatrix=new Matrix,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Shader.from(vertex$3,fragment$6,{}),this.state=State.for2d()}render(container){const children=container.children,maxSize=container._maxSize,batchSize=container._batchSize,renderer=this.renderer;let totalChildren=children.length;if(totalChildren===0)return;totalChildren>maxSize&&!container.autoResize&&(totalChildren=maxSize);let buffers=container._buffers;buffers||(buffers=container._buffers=this.generateBuffers(container));const baseTexture=children[0]._texture.baseTexture,premultiplied=baseTexture.alphaMode>0;this.state.blendMode=correctBlendMode(container.blendMode,premultiplied),renderer.state.set(this.state);const gl=renderer.gl,m2=container.worldTransform.copyTo(this.tempMatrix);m2.prepend(renderer.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=m2.toArray(!0),this.shader.uniforms.uColor=Color.shared.setValue(container.tintRgb).premultiply(container.worldAlpha,premultiplied).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=baseTexture,this.renderer.shader.bind(this.shader);let updateStatic=!1;for(let i2=0,j2=0;i2<totalChildren;i2+=batchSize,j2+=1){let amount=totalChildren-i2;amount>batchSize&&(amount=batchSize),j2>=buffers.length&&buffers.push(this._generateOneMoreBuffer(container));const buffer=buffers[j2];buffer.uploadDynamic(children,i2,amount);const bid=container._bufferUpdateIDs[j2]||0;updateStatic=updateStatic||buffer._updateID<bid,updateStatic&&(buffer._updateID=container._updateID,buffer.uploadStatic(children,i2,amount)),renderer.geometry.bind(buffer.geometry),gl.drawElements(gl.TRIANGLES,amount*6,gl.UNSIGNED_SHORT,0)}}generateBuffers(container){const buffers=[],size=container._maxSize,batchSize=container._batchSize,dynamicPropertyFlags=container._properties;for(let i2=0;i2<size;i2+=batchSize)buffers.push(new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize));return buffers}_generateOneMoreBuffer(container){const batchSize=container._batchSize,dynamicPropertyFlags=container._properties;return new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize)}uploadVertices(children,startIndex,amount,array,stride,offset){let w0=0,w1=0,h0=0,h1=0;for(let i2=0;i2<amount;++i2){const sprite=children[startIndex+i2],texture=sprite._texture,sx=sprite.scale.x,sy=sprite.scale.y,trim=texture.trim,orig=texture.orig;trim?(w1=trim.x-sprite.anchor.x*orig.width,w0=w1+trim.width,h1=trim.y-sprite.anchor.y*orig.height,h0=h1+trim.height):(w0=orig.width*(1-sprite.anchor.x),w1=orig.width*-sprite.anchor.x,h0=orig.height*(1-sprite.anchor.y),h1=orig.height*-sprite.anchor.y),array[offset]=w1*sx,array[offset+1]=h1*sy,array[offset+stride]=w0*sx,array[offset+stride+1]=h1*sy,array[offset+stride*2]=w0*sx,array[offset+stride*2+1]=h0*sy,array[offset+stride*3]=w1*sx,array[offset+stride*3+1]=h0*sy,offset+=stride*4}}uploadPosition(children,startIndex,amount,array,stride,offset){for(let i2=0;i2<amount;i2++){const spritePosition=children[startIndex+i2].position;array[offset]=spritePosition.x,array[offset+1]=spritePosition.y,array[offset+stride]=spritePosition.x,array[offset+stride+1]=spritePosition.y,array[offset+stride*2]=spritePosition.x,array[offset+stride*2+1]=spritePosition.y,array[offset+stride*3]=spritePosition.x,array[offset+stride*3+1]=spritePosition.y,offset+=stride*4}}uploadRotation(children,startIndex,amount,array,stride,offset){for(let i2=0;i2<amount;i2++){const spriteRotation=children[startIndex+i2].rotation;array[offset]=spriteRotation,array[offset+stride]=spriteRotation,array[offset+stride*2]=spriteRotation,array[offset+stride*3]=spriteRotation,offset+=stride*4}}uploadUvs(children,startIndex,amount,array,stride,offset){for(let i2=0;i2<amount;++i2){const textureUvs=children[startIndex+i2]._texture._uvs;textureUvs?(array[offset]=textureUvs.x0,array[offset+1]=textureUvs.y0,array[offset+stride]=textureUvs.x1,array[offset+stride+1]=textureUvs.y1,array[offset+stride*2]=textureUvs.x2,array[offset+stride*2+1]=textureUvs.y2,array[offset+stride*3]=textureUvs.x3,array[offset+stride*3+1]=textureUvs.y3,offset+=stride*4):(array[offset]=0,array[offset+1]=0,array[offset+stride]=0,array[offset+stride+1]=0,array[offset+stride*2]=0,array[offset+stride*2+1]=0,array[offset+stride*3]=0,array[offset+stride*3+1]=0,offset+=stride*4)}}uploadTint(children,startIndex,amount,array,stride,offset){for(let i2=0;i2<amount;++i2){const sprite=children[startIndex+i2],result=Color.shared.setValue(sprite._tintRGB).toPremultiplied(sprite.alpha,sprite.texture.baseTexture.alphaMode>0);array[offset]=result,array[offset+stride]=result,array[offset+stride*2]=result,array[offset+stride*3]=result,offset+=stride*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ParticleRenderer.extension={name:"particle",type:ExtensionType.RendererPlugin},extensions$1.add(ParticleRenderer),ParticleContainer.prototype.renderCanvas=function(renderer){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable)return;const context2=renderer.canvasContext.activeContext,transform=this.worldTransform;let isRotated=!0,positionX=0,positionY=0,finalWidth=0,finalHeight=0;renderer.canvasContext.setBlendMode(this.blendMode),context2.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(let i2=0;i2<this.children.length;++i2){const child=this.children[i2];if(!child.visible||!child._texture.valid)continue;const frame=child._texture.frame;if(context2.globalAlpha=this.worldAlpha*child.alpha,child.rotation%(Math.PI*2)===0)isRotated&&(renderer.canvasContext.setContextTransform(transform,!1,1),isRotated=!1),positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+0.5,positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+0.5,finalWidth=frame.width*child.scale.x,finalHeight=frame.height*child.scale.y;else{isRotated||(isRotated=!0),child.displayObjectUpdateTransform();const childTransform=child.worldTransform;renderer.canvasContext.setContextTransform(childTransform,this.roundPixels,1),positionX=child.anchor.x*-frame.width+0.5,positionY=child.anchor.y*-frame.height+0.5,finalWidth=frame.width,finalHeight=frame.height}const resolution=child._texture.baseTexture.resolution,contextResolution=renderer.canvasContext.activeResolution;context2.drawImage(child._texture.baseTexture.getDrawableSource(),frame.x*resolution,frame.y*resolution,frame.width*resolution,frame.height*resolution,positionX*contextResolution,positionY*contextResolution,finalWidth*contextResolution,finalHeight*contextResolution)}},Container.prototype._renderCanvas=function(_renderer){},Container.prototype.renderCanvas=function(renderer){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){this._mask&&renderer.mask.pushMask(this._mask),this._renderCanvas(renderer);for(let i2=0,j2=this.children.length;i2<j2;++i2)this.children[i2].renderCanvas(renderer);this._mask&&renderer.mask.popMask(renderer)}},DisplayObject.prototype.renderCanvas=function(_renderer){};var TEXT_GRADIENT=(TEXT_GRADIENT2=>(TEXT_GRADIENT2[TEXT_GRADIENT2.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",TEXT_GRADIENT2[TEXT_GRADIENT2.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",TEXT_GRADIENT2))(TEXT_GRADIENT||{});const contextSettings={willReadFrequently:!0},_TextMetrics=class _TextMetrics2{static get experimentalLetterSpacingSupported(){let result=_TextMetrics2._experimentalLetterSpacingSupported;if(result!==void 0){const proto=settings.ADAPTER.getCanvasRenderingContext2D().prototype;result=_TextMetrics2._experimentalLetterSpacingSupported="letterSpacing"in proto||"textLetterSpacing"in proto}return result}constructor(text,style,width,height,lines,lineWidths,lineHeight,maxLineWidth,fontProperties){this.text=text,this.style=style,this.width=width,this.height=height,this.lines=lines,this.lineWidths=lineWidths,this.lineHeight=lineHeight,this.maxLineWidth=maxLineWidth,this.fontProperties=fontProperties}static measureText(text,style,wordWrap,canvas=_TextMetrics2._canvas){wordWrap=wordWrap==null?style.wordWrap:wordWrap;const font=style.toFontString(),fontProperties=_TextMetrics2.measureFont(font);fontProperties.fontSize===0&&(fontProperties.fontSize=style.fontSize,fontProperties.ascent=style.fontSize);const context2=canvas.getContext("2d",contextSettings);context2.font=font;const lines=(wordWrap?_TextMetrics2.wordWrap(text,style,canvas):text).split(/(?:\r\n|\r|\n)/),lineWidths=new Array(lines.length);let maxLineWidth=0;for(let i2=0;i2<lines.length;i2++){const lineWidth=_TextMetrics2._measureText(lines[i2],style.letterSpacing,context2);lineWidths[i2]=lineWidth,maxLineWidth=Math.max(maxLineWidth,lineWidth)}let width=maxLineWidth+style.strokeThickness;style.dropShadow&&(width+=style.dropShadowDistance);const lineHeight=style.lineHeight||fontProperties.fontSize+style.strokeThickness;let height=Math.max(lineHeight,fontProperties.fontSize+style.strokeThickness*2)+style.leading+(lines.length-1)*(lineHeight+style.leading);return style.dropShadow&&(height+=style.dropShadowDistance),new _TextMetrics2(text,style,width,height,lines,lineWidths,lineHeight+style.leading,maxLineWidth,fontProperties)}static _measureText(text,letterSpacing,context2){let useExperimentalLetterSpacing=!1;_TextMetrics2.experimentalLetterSpacingSupported&&(_TextMetrics2.experimentalLetterSpacing?(context2.letterSpacing=`${letterSpacing}px`,context2.textLetterSpacing=`${letterSpacing}px`,useExperimentalLetterSpacing=!0):(context2.letterSpacing="0px",context2.textLetterSpacing="0px"));let width=context2.measureText(text).width;return width>0&&(useExperimentalLetterSpacing?width-=letterSpacing:width+=(_TextMetrics2.graphemeSegmenter(text).length-1)*letterSpacing),width}static wordWrap(text,style,canvas=_TextMetrics2._canvas){const context2=canvas.getContext("2d",contextSettings);let width=0,line="",lines="";const cache=Object.create(null),{letterSpacing,whiteSpace}=style,collapseSpaces=_TextMetrics2.collapseSpaces(whiteSpace),collapseNewlines=_TextMetrics2.collapseNewlines(whiteSpace);let canPrependSpaces=!collapseSpaces;const wordWrapWidth=style.wordWrapWidth+letterSpacing,tokens=_TextMetrics2.tokenize(text);for(let i2=0;i2<tokens.length;i2++){let token=tokens[i2];if(_TextMetrics2.isNewline(token)){if(!collapseNewlines){lines+=_TextMetrics2.addLine(line),canPrependSpaces=!collapseSpaces,line="",width=0;continue}token=" "}if(collapseSpaces){const currIsBreakingSpace=_TextMetrics2.isBreakingSpace(token),lastIsBreakingSpace=_TextMetrics2.isBreakingSpace(line[line.length-1]);if(currIsBreakingSpace&&lastIsBreakingSpace)continue}const tokenWidth=_TextMetrics2.getFromCache(token,letterSpacing,cache,context2);if(tokenWidth>wordWrapWidth){if(line!==""&&(lines+=_TextMetrics2.addLine(line),line="",width=0),_TextMetrics2.canBreakWords(token,style.breakWords)){const characters=_TextMetrics2.wordWrapSplit(token);for(let j2=0;j2<characters.length;j2++){let char=characters[j2],lastChar=char,k2=1;for(;characters[j2+k2];){const nextChar=characters[j2+k2];if(!_TextMetrics2.canBreakChars(lastChar,nextChar,token,j2,style.breakWords))char+=nextChar;else break;lastChar=nextChar,k2++}j2+=k2-1;const characterWidth=_TextMetrics2.getFromCache(char,letterSpacing,cache,context2);characterWidth+width>wordWrapWidth&&(lines+=_TextMetrics2.addLine(line),canPrependSpaces=!1,line="",width=0),line+=char,width+=characterWidth}}else{line.length>0&&(lines+=_TextMetrics2.addLine(line),line="",width=0);const isLastToken=i2===tokens.length-1;lines+=_TextMetrics2.addLine(token,!isLastToken),canPrependSpaces=!1,line="",width=0}}else tokenWidth+width>wordWrapWidth&&(canPrependSpaces=!1,lines+=_TextMetrics2.addLine(line),line="",width=0),(line.length>0||!_TextMetrics2.isBreakingSpace(token)||canPrependSpaces)&&(line+=token,width+=tokenWidth)}return lines+=_TextMetrics2.addLine(line,!1),lines}static addLine(line,newLine=!0){return line=_TextMetrics2.trimRight(line),line=newLine?`${line}
`:line,line}static getFromCache(key,letterSpacing,cache,context2){let width=cache[key];return typeof width!="number"&&(width=_TextMetrics2._measureText(key,letterSpacing,context2)+letterSpacing,cache[key]=width),width}static collapseSpaces(whiteSpace){return whiteSpace==="normal"||whiteSpace==="pre-line"}static collapseNewlines(whiteSpace){return whiteSpace==="normal"}static trimRight(text){if(typeof text!="string")return"";for(let i2=text.length-1;i2>=0;i2--){const char=text[i2];if(!_TextMetrics2.isBreakingSpace(char))break;text=text.slice(0,-1)}return text}static isNewline(char){return typeof char!="string"?!1:_TextMetrics2._newlines.includes(char.charCodeAt(0))}static isBreakingSpace(char,_nextChar){return typeof char!="string"?!1:_TextMetrics2._breakingSpaces.includes(char.charCodeAt(0))}static tokenize(text){const tokens=[];let token="";if(typeof text!="string")return tokens;for(let i2=0;i2<text.length;i2++){const char=text[i2],nextChar=text[i2+1];if(_TextMetrics2.isBreakingSpace(char,nextChar)||_TextMetrics2.isNewline(char)){token!==""&&(tokens.push(token),token=""),tokens.push(char);continue}token+=char}return token!==""&&tokens.push(token),tokens}static canBreakWords(_token,breakWords){return breakWords}static canBreakChars(_char,_nextChar,_token,_index,_breakWords){return!0}static wordWrapSplit(token){return _TextMetrics2.graphemeSegmenter(token)}static measureFont(font){if(_TextMetrics2._fonts[font])return _TextMetrics2._fonts[font];const properties={ascent:0,descent:0,fontSize:0},canvas=_TextMetrics2._canvas,context2=_TextMetrics2._context;context2.font=font;const metricsString=_TextMetrics2.METRICS_STRING+_TextMetrics2.BASELINE_SYMBOL,width=Math.ceil(context2.measureText(metricsString).width);let baseline=Math.ceil(context2.measureText(_TextMetrics2.BASELINE_SYMBOL).width);const height=Math.ceil(_TextMetrics2.HEIGHT_MULTIPLIER*baseline);if(baseline=baseline*_TextMetrics2.BASELINE_MULTIPLIER|0,width===0||height===0)return _TextMetrics2._fonts[font]=properties,properties;canvas.width=width,canvas.height=height,context2.fillStyle="#f00",context2.fillRect(0,0,width,height),context2.font=font,context2.textBaseline="alphabetic",context2.fillStyle="#000",context2.fillText(metricsString,0,baseline);const imagedata=context2.getImageData(0,0,width,height).data,pixels=imagedata.length,line=width*4;let i2=0,idx=0,stop=!1;for(i2=0;i2<baseline;++i2){for(let j2=0;j2<line;j2+=4)if(imagedata[idx+j2]!==255){stop=!0;break}if(!stop)idx+=line;else break}for(properties.ascent=baseline-i2,idx=pixels-line,stop=!1,i2=height;i2>baseline;--i2){for(let j2=0;j2<line;j2+=4)if(imagedata[idx+j2]!==255){stop=!0;break}if(!stop)idx-=line;else break}return properties.descent=i2-baseline,properties.fontSize=properties.ascent+properties.descent,_TextMetrics2._fonts[font]=properties,properties}static clearMetrics(font=""){font?delete _TextMetrics2._fonts[font]:_TextMetrics2._fonts={}}static get _canvas(){if(!_TextMetrics2.__canvas){let canvas;try{const c2=new OffscreenCanvas(0,0),context2=c2.getContext("2d",contextSettings);if(context2!=null&&context2.measureText)return _TextMetrics2.__canvas=c2,c2;canvas=settings.ADAPTER.createCanvas()}catch(ex){canvas=settings.ADAPTER.createCanvas()}canvas.width=canvas.height=10,_TextMetrics2.__canvas=canvas}return _TextMetrics2.__canvas}static get _context(){return _TextMetrics2.__context||(_TextMetrics2.__context=_TextMetrics2._canvas.getContext("2d",contextSettings)),_TextMetrics2.__context}};_TextMetrics.METRICS_STRING="|\xC9q\xC5",_TextMetrics.BASELINE_SYMBOL="M",_TextMetrics.BASELINE_MULTIPLIER=1.4,_TextMetrics.HEIGHT_MULTIPLIER=2,_TextMetrics.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const segmenter=new Intl.Segmenter;return s2=>[...segmenter.segment(s2)].map(x2=>x2.segment)}return s2=>[...s2]})(),_TextMetrics.experimentalLetterSpacing=!1,_TextMetrics._fonts={},_TextMetrics._newlines=[10,13],_TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let TextMetrics=_TextMetrics;const genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],_TextStyle=class _TextStyle2{constructor(style){this.styleID=0,this.reset(),deepCopyProperties(this,style,style)}clone(){const clonedProperties={};return deepCopyProperties(clonedProperties,this,_TextStyle2.defaultStyle),new _TextStyle2(clonedProperties)}reset(){deepCopyProperties(this,_TextStyle2.defaultStyle,_TextStyle2.defaultStyle)}get align(){return this._align}set align(align){this._align!==align&&(this._align=align,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(breakWords){this._breakWords!==breakWords&&(this._breakWords=breakWords,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(dropShadow){this._dropShadow!==dropShadow&&(this._dropShadow=dropShadow,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(dropShadowAlpha){this._dropShadowAlpha!==dropShadowAlpha&&(this._dropShadowAlpha=dropShadowAlpha,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(dropShadowAngle){this._dropShadowAngle!==dropShadowAngle&&(this._dropShadowAngle=dropShadowAngle,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(dropShadowBlur){this._dropShadowBlur!==dropShadowBlur&&(this._dropShadowBlur=dropShadowBlur,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(dropShadowColor){const outputColor=getColor(dropShadowColor);this._dropShadowColor!==outputColor&&(this._dropShadowColor=outputColor,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(dropShadowDistance){this._dropShadowDistance!==dropShadowDistance&&(this._dropShadowDistance=dropShadowDistance,this.styleID++)}get fill(){return this._fill}set fill(fill){const outputColor=getColor(fill);this._fill!==outputColor&&(this._fill=outputColor,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(fillGradientType){this._fillGradientType!==fillGradientType&&(this._fillGradientType=fillGradientType,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(fillGradientStops){areArraysEqual(this._fillGradientStops,fillGradientStops)||(this._fillGradientStops=fillGradientStops,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(fontFamily){this.fontFamily!==fontFamily&&(this._fontFamily=fontFamily,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(fontSize){this._fontSize!==fontSize&&(this._fontSize=fontSize,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(fontStyle){this._fontStyle!==fontStyle&&(this._fontStyle=fontStyle,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(fontVariant){this._fontVariant!==fontVariant&&(this._fontVariant=fontVariant,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(fontWeight){this._fontWeight!==fontWeight&&(this._fontWeight=fontWeight,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(letterSpacing){this._letterSpacing!==letterSpacing&&(this._letterSpacing=letterSpacing,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(lineHeight){this._lineHeight!==lineHeight&&(this._lineHeight=lineHeight,this.styleID++)}get leading(){return this._leading}set leading(leading){this._leading!==leading&&(this._leading=leading,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(lineJoin){this._lineJoin!==lineJoin&&(this._lineJoin=lineJoin,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(miterLimit){this._miterLimit!==miterLimit&&(this._miterLimit=miterLimit,this.styleID++)}get padding(){return this._padding}set padding(padding){this._padding!==padding&&(this._padding=padding,this.styleID++)}get stroke(){return this._stroke}set stroke(stroke){const outputColor=getColor(stroke);this._stroke!==outputColor&&(this._stroke=outputColor,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(strokeThickness){this._strokeThickness!==strokeThickness&&(this._strokeThickness=strokeThickness,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(textBaseline){this._textBaseline!==textBaseline&&(this._textBaseline=textBaseline,this.styleID++)}get trim(){return this._trim}set trim(trim){this._trim!==trim&&(this._trim=trim,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(whiteSpace){this._whiteSpace!==whiteSpace&&(this._whiteSpace=whiteSpace,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(wordWrap){this._wordWrap!==wordWrap&&(this._wordWrap=wordWrap,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(wordWrapWidth){this._wordWrapWidth!==wordWrapWidth&&(this._wordWrapWidth=wordWrapWidth,this.styleID++)}toFontString(){const fontSizeString=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let fontFamilies=this.fontFamily;Array.isArray(this.fontFamily)||(fontFamilies=this.fontFamily.split(","));for(let i2=fontFamilies.length-1;i2>=0;i2--){let fontFamily=fontFamilies[i2].trim();!/([\"\'])[^\'\"]+\1/.test(fontFamily)&&!genericFontFamilies.includes(fontFamily)&&(fontFamily=`"${fontFamily}"`),fontFamilies[i2]=fontFamily}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${fontSizeString} ${fontFamilies.join(",")}`}};_TextStyle.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let TextStyle=_TextStyle;function getColor(color){const temp=Color.shared,format2=color2=>{const res=temp.setValue(color2);return res.alpha===1?res.toHex():res.toRgbaString()};return Array.isArray(color)?color.map(format2):format2(color)}function areArraysEqual(array1,array2){if(!Array.isArray(array1)||!Array.isArray(array2)||array1.length!==array2.length)return!1;for(let i2=0;i2<array1.length;++i2)if(array1[i2]!==array2[i2])return!1;return!0}function deepCopyProperties(target,source,propertyObj){for(const prop in propertyObj)Array.isArray(source[prop])?target[prop]=source[prop].slice():target[prop]=source[prop]}const defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},_Text=class _Text2 extends Sprite{constructor(text,style,canvas){var _a2;let ownCanvas=!1;canvas||(canvas=settings.ADAPTER.createCanvas(),ownCanvas=!0),canvas.width=3,canvas.height=3;const texture=Texture.from(canvas);texture.orig=new Rectangle,texture.trim=new Rectangle,super(texture),this._ownCanvas=ownCanvas,this.canvas=canvas,this.context=canvas.getContext("2d",{willReadFrequently:!0}),this._resolution=(_a2=_Text2.defaultResolution)!=null?_a2:settings.RESOLUTION,this._autoResolution=_Text2.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=text,this.style=style,this.localStyleID=-1}static get experimentalLetterSpacing(){return TextMetrics.experimentalLetterSpacing}static set experimentalLetterSpacing(value){deprecation$1("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),TextMetrics.experimentalLetterSpacing=value}updateText(respectDirty){const style=this._style;if(this.localStyleID!==style.styleID&&(this.dirty=!0,this.localStyleID=style.styleID),!this.dirty&&respectDirty)return;this._font=this._style.toFontString();const context2=this.context,measured=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),width=measured.width,height=measured.height,lines=measured.lines,lineHeight=measured.lineHeight,lineWidths=measured.lineWidths,maxLineWidth=measured.maxLineWidth,fontProperties=measured.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,width)+style.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,height)+style.padding*2)*this._resolution),context2.scale(this._resolution,this._resolution),context2.clearRect(0,0,this.canvas.width,this.canvas.height),context2.font=this._font,context2.lineWidth=style.strokeThickness,context2.textBaseline=style.textBaseline,context2.lineJoin=style.lineJoin,context2.miterLimit=style.miterLimit;let linePositionX,linePositionY;const passesCount=style.dropShadow?2:1;for(let i2=0;i2<passesCount;++i2){const isShadowPass=style.dropShadow&&i2===0,dsOffsetText=isShadowPass?Math.ceil(Math.max(1,height)+style.padding*2):0,dsOffsetShadow=dsOffsetText*this._resolution;if(isShadowPass){context2.fillStyle="black",context2.strokeStyle="black";const dropShadowColor=style.dropShadowColor,dropShadowBlur=style.dropShadowBlur*this._resolution,dropShadowDistance=style.dropShadowDistance*this._resolution;context2.shadowColor=Color.shared.setValue(dropShadowColor).setAlpha(style.dropShadowAlpha).toRgbaString(),context2.shadowBlur=dropShadowBlur,context2.shadowOffsetX=Math.cos(style.dropShadowAngle)*dropShadowDistance,context2.shadowOffsetY=Math.sin(style.dropShadowAngle)*dropShadowDistance+dsOffsetShadow}else context2.fillStyle=this._generateFillStyle(style,lines,measured),context2.strokeStyle=style.stroke,context2.shadowColor="black",context2.shadowBlur=0,context2.shadowOffsetX=0,context2.shadowOffsetY=0;let linePositionYShift=(lineHeight-fontProperties.fontSize)/2;lineHeight-fontProperties.fontSize<0&&(linePositionYShift=0);for(let i22=0;i22<lines.length;i22++)linePositionX=style.strokeThickness/2,linePositionY=style.strokeThickness/2+i22*lineHeight+fontProperties.ascent+linePositionYShift,style.align==="right"?linePositionX+=maxLineWidth-lineWidths[i22]:style.align==="center"&&(linePositionX+=(maxLineWidth-lineWidths[i22])/2),style.stroke&&style.strokeThickness&&this.drawLetterSpacing(lines[i22],linePositionX+style.padding,linePositionY+style.padding-dsOffsetText,!0),style.fill&&this.drawLetterSpacing(lines[i22],linePositionX+style.padding,linePositionY+style.padding-dsOffsetText)}this.updateTexture()}drawLetterSpacing(text,x2,y2,isStroke=!1){const letterSpacing=this._style.letterSpacing;let useExperimentalLetterSpacing=!1;if(TextMetrics.experimentalLetterSpacingSupported&&(TextMetrics.experimentalLetterSpacing?(this.context.letterSpacing=`${letterSpacing}px`,this.context.textLetterSpacing=`${letterSpacing}px`,useExperimentalLetterSpacing=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),letterSpacing===0||useExperimentalLetterSpacing){isStroke?this.context.strokeText(text,x2,y2):this.context.fillText(text,x2,y2);return}let currentPosition=x2;const stringArray=TextMetrics.graphemeSegmenter(text);let previousWidth=this.context.measureText(text).width,currentWidth=0;for(let i2=0;i2<stringArray.length;++i2){const currentChar=stringArray[i2];isStroke?this.context.strokeText(currentChar,currentPosition,y2):this.context.fillText(currentChar,currentPosition,y2);let textStr="";for(let j2=i2+1;j2<stringArray.length;++j2)textStr+=stringArray[j2];currentWidth=this.context.measureText(textStr).width,currentPosition+=previousWidth-currentWidth+letterSpacing,previousWidth=currentWidth}}updateTexture(){const canvas=this.canvas;if(this._style.trim){const trimmed=trimCanvas(canvas);trimmed.data&&(canvas.width=trimmed.width,canvas.height=trimmed.height,this.context.putImageData(trimmed.data,0,0))}const texture=this._texture,style=this._style,padding=style.trim?0:style.padding,baseTexture=texture.baseTexture;texture.trim.width=texture._frame.width=canvas.width/this._resolution,texture.trim.height=texture._frame.height=canvas.height/this._resolution,texture.trim.x=-padding,texture.trim.y=-padding,texture.orig.width=texture._frame.width-padding*2,texture.orig.height=texture._frame.height-padding*2,this._onTextureUpdate(),baseTexture.setRealSize(canvas.width,canvas.height,this._resolution),texture.updateUvs(),this.dirty=!1}_render(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),super._render(renderer)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(skipUpdate,rect){return this.updateText(!0),this._textureID===-1&&(skipUpdate=!1),super.getBounds(skipUpdate,rect)}getLocalBounds(rect){return this.updateText(!0),super.getLocalBounds.call(this,rect)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(style,lines,metrics){const fillStyle=style.fill;if(Array.isArray(fillStyle)){if(fillStyle.length===1)return fillStyle[0]}else return fillStyle;let gradient;const dropShadowCorrection=style.dropShadow?style.dropShadowDistance:0,padding=style.padding||0,width=this.canvas.width/this._resolution-dropShadowCorrection-padding*2,height=this.canvas.height/this._resolution-dropShadowCorrection-padding*2,fill=fillStyle.slice(),fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length){const lengthPlus1=fill.length+1;for(let i2=1;i2<lengthPlus1;++i2)fillGradientStops.push(i2/lengthPlus1)}if(fill.unshift(fillStyle[0]),fillGradientStops.unshift(0),fill.push(fillStyle[fillStyle.length-1]),fillGradientStops.push(1),style.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=this.context.createLinearGradient(width/2,padding,width/2,height+padding);const textHeight=metrics.fontProperties.fontSize+style.strokeThickness;for(let i2=0;i2<lines.length;i2++){const lastLineBottom=metrics.lineHeight*(i2-1)+textHeight,thisLineTop=metrics.lineHeight*i2;let thisLineGradientStart=thisLineTop;i2>0&&lastLineBottom>thisLineTop&&(thisLineGradientStart=(thisLineTop+lastLineBottom)/2);const thisLineBottom=thisLineTop+textHeight,nextLineTop=metrics.lineHeight*(i2+1);let thisLineGradientEnd=thisLineBottom;i2+1<lines.length&&nextLineTop<thisLineBottom&&(thisLineGradientEnd=(thisLineBottom+nextLineTop)/2);const gradStopLineHeight=(thisLineGradientEnd-thisLineGradientStart)/height;for(let j2=0;j2<fill.length;j2++){let lineStop=0;typeof fillGradientStops[j2]=="number"?lineStop=fillGradientStops[j2]:lineStop=j2/fill.length;let globalStop=Math.min(1,Math.max(0,thisLineGradientStart/height+lineStop*gradStopLineHeight));globalStop=Number(globalStop.toFixed(5)),gradient.addColorStop(globalStop,fill[j2])}}}else{gradient=this.context.createLinearGradient(padding,height/2,width+padding,height/2);const totalIterations=fill.length+1;let currentIteration=1;for(let i2=0;i2<fill.length;i2++){let stop;typeof fillGradientStops[i2]=="number"?stop=fillGradientStops[i2]:stop=currentIteration/totalIterations,gradient.addColorStop(stop,fill[i2]),currentIteration++}}return gradient}destroy(options){typeof options=="boolean"&&(options={children:options}),options=Object.assign({},defaultDestroyOptions,options),super.destroy(options),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(value){this.updateText(!0);const s2=sign(this.scale.x)||1;this.scale.x=s2*value/this._texture.orig.width,this._width=value}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(value){this.updateText(!0);const s2=sign(this.scale.y)||1;this.scale.y=s2*value/this._texture.orig.height,this._height=value}get style(){return this._style}set style(style){style=style||{},style instanceof TextStyle?this._style=style:this._style=new TextStyle(style),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(text){text=String(text==null?"":text),this._text!==text&&(this._text=text,this.dirty=!0)}get resolution(){return this._resolution}set resolution(value){this._autoResolution=!1,this._resolution!==value&&(this._resolution=value,this.dirty=!0)}};_Text.defaultAutoResolution=!0;let Text=_Text;Text.prototype._renderCanvas=function(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),Sprite.prototype._renderCanvas.call(this,renderer)};const _tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1,DisplayObject.prototype._cacheData=null,DisplayObject.prototype._cacheAsBitmapResolution=null,DisplayObject.prototype._cacheAsBitmapMultisample=null;class CacheData{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(resolution){resolution!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=resolution,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(multisample){multisample!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=multisample,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(value){if(this._cacheAsBitmap===value)return;this._cacheAsBitmap=value;let data;value?(this._cacheData||(this._cacheData=new CacheData),data=this._cacheData,data.originalRender=this.render,data.originalRenderCanvas=this.renderCanvas,data.originalUpdateTransform=this.updateTransform,data.originalCalculateBounds=this.calculateBounds,data.originalGetLocalBounds=this.getLocalBounds,data.originalDestroy=this.destroy,data.originalContainsPoint=this.containsPoint,data.originalMask=this._mask,data.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(data=this._cacheData,data.sprite&&this._destroyCachedDisplayObject(),this.render=data.originalRender,this.renderCanvas=data.originalRenderCanvas,this.calculateBounds=data.originalCalculateBounds,this.getLocalBounds=data.originalGetLocalBounds,this.destroy=data.originalDestroy,this.updateTransform=data.originalUpdateTransform,this.containsPoint=data.originalContainsPoint,this._mask=data.originalMask,this.filterArea=data.originalFilterArea)}}}),DisplayObject.prototype._renderCached=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(renderer),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(renderer))},DisplayObject.prototype._initCachedDisplayObject=function(renderer){var _a2,_b,_c;if((_a2=this._cacheData)!=null&&_a2.sprite)return;const cacheAlpha=this.alpha;this.alpha=1,renderer.batch.flush();const bounds=this.getLocalBounds(new Rectangle,!0);if((_b=this.filters)!=null&&_b.length){const padding=this.filters[0].padding;bounds.pad(padding)}const resolution=this.cacheAsBitmapResolution||renderer.resolution;bounds.ceil(resolution),bounds.width=Math.max(bounds.width,1/resolution),bounds.height=Math.max(bounds.height,1/resolution);const cachedRenderTexture=renderer.renderTexture.current,cachedSourceFrame=renderer.renderTexture.sourceFrame.clone(),cachedDestinationFrame=renderer.renderTexture.destinationFrame.clone(),cachedProjectionTransform=renderer.projection.transform,renderTexture=RenderTexture.create({width:bounds.width,height:bounds.height,resolution,multisample:(_c=this.cacheAsBitmapMultisample)!=null?_c:renderer.multisample}),textureCacheId=`cacheAsBitmap_${uid()}`;this._cacheData.textureCacheId=textureCacheId,BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId),Texture.addToCache(renderTexture,textureCacheId);const m2=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-bounds.x,-bounds.y);this.render=this._cacheData.originalRender,renderer.render(this,{renderTexture,clear:!0,transform:m2,skipUpdateTransform:!1}),renderer.framebuffer.blit(),renderer.projection.transform=cachedProjectionTransform,renderer.renderTexture.bind(cachedRenderTexture,cachedSourceFrame,cachedDestinationFrame),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=cacheAlpha;const cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform,cachedSprite.anchor.x=-(bounds.x/bounds.width),cachedSprite.anchor.y=-(bounds.y/bounds.height),cachedSprite.alpha=cacheAlpha,cachedSprite._bounds=this._bounds,this._cacheData.sprite=cachedSprite,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)},DisplayObject.prototype._renderCachedCanvas=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(renderer),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(renderer))},DisplayObject.prototype._initCachedDisplayObjectCanvas=function(renderer){var _a2;if((_a2=this._cacheData)!=null&&_a2.sprite)return;const bounds=this.getLocalBounds(new Rectangle,!0),cacheAlpha=this.alpha;this.alpha=1;const cachedRenderTarget=renderer.canvasContext.activeContext,cachedProjectionTransform=renderer._projTransform,resolution=this.cacheAsBitmapResolution||renderer.resolution;bounds.ceil(resolution),bounds.width=Math.max(bounds.width,1/resolution),bounds.height=Math.max(bounds.height,1/resolution);const renderTexture=RenderTexture.create({width:bounds.width,height:bounds.height,resolution}),textureCacheId=`cacheAsBitmap_${uid()}`;this._cacheData.textureCacheId=textureCacheId,BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId),Texture.addToCache(renderTexture,textureCacheId);const m2=_tempMatrix;this.transform.localTransform.copyTo(m2),m2.invert(),m2.tx-=bounds.x,m2.ty-=bounds.y,this.renderCanvas=this._cacheData.originalRenderCanvas,renderer.render(this,{renderTexture,clear:!0,transform:m2,skipUpdateTransform:!1}),renderer.canvasContext.activeContext=cachedRenderTarget,renderer._projTransform=cachedProjectionTransform,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=cacheAlpha;const cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform,cachedSprite.anchor.x=-(bounds.x/bounds.width),cachedSprite.anchor.y=-(bounds.y/bounds.height),cachedSprite.alpha=cacheAlpha,cachedSprite._bounds=this._bounds,this._cacheData.sprite=cachedSprite,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=renderer._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)},DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},DisplayObject.prototype._cacheAsBitmapDestroy=function(options){this.cacheAsBitmap=!1,this.destroy(options)},DisplayObject.prototype.name=null,Container.prototype.getChildByName=function(name,deep){for(let i2=0,j2=this.children.length;i2<j2;i2++)if(this.children[i2].name===name)return this.children[i2];if(deep)for(let i2=0,j2=this.children.length;i2<j2;i2++){const child=this.children[i2];if(!child.getChildByName)continue;const target=child.getChildByName(name,!0);if(target)return target}return null},DisplayObject.prototype.getGlobalPosition=function(point=new Point,skipUpdate=!1){return this.parent?this.parent.toGlobal(this.position,point,skipUpdate):(point.x=this.position.x,point.y=this.position.y),point};var fragment$5=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class AlphaFilter extends Filter{constructor(alpha=1){super(defaultVertex,fragment$5,{uAlpha:1}),this.alpha=alpha}get alpha(){return this.uniforms.uAlpha}set alpha(value){this.uniforms.uAlpha=value}}const GAUSSIAN_VALUES={5:[0.153388,0.221461,0.250301],7:[0.071303,0.131514,0.189879,0.214607],9:[0.028532,0.067234,0.124009,0.179044,0.20236],11:[93e-4,0.028002,0.065984,0.121703,0.175713,0.198596],13:[2406e-6,9255e-6,0.027867,0.065666,0.121117,0.174868,0.197641],15:[489e-6,2403e-6,9246e-6,0.02784,0.065602,0.120999,0.174697,0.197448]},fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function generateBlurFragSource(kernelSize){const kernel=GAUSSIAN_VALUES[kernelSize],halfLength=kernel.length;let fragSource=fragTemplate,blurLoop="";const template="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let value;for(let i2=0;i2<kernelSize;i2++){let blur=template.replace("%index%",i2.toString());value=i2,i2>=halfLength&&(value=kernelSize-i2-1),blur=blur.replace("%value%",kernel[value].toString()),blurLoop+=blur,blurLoop+=`
`}return fragSource=fragSource.replace("%blur%",blurLoop),fragSource=fragSource.replace("%size%",kernelSize.toString()),fragSource}const vertTemplate=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function generateBlurVertSource(kernelSize,x2){const halfLength=Math.ceil(kernelSize/2);let vertSource=vertTemplate,blurLoop="",template;x2?template="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":template="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let i2=0;i2<kernelSize;i2++){let blur=template.replace("%index%",i2.toString());blur=blur.replace("%sampleIndex%",`${i2-(halfLength-1)}.0`),blurLoop+=blur,blurLoop+=`
`}return vertSource=vertSource.replace("%blur%",blurLoop),vertSource=vertSource.replace("%size%",kernelSize.toString()),vertSource}class BlurFilterPass extends Filter{constructor(horizontal,strength=8,quality=4,resolution=Filter.defaultResolution,kernelSize=5){const vertSrc=generateBlurVertSource(kernelSize,horizontal),fragSrc=generateBlurFragSource(kernelSize);super(vertSrc,fragSrc),this.horizontal=horizontal,this.resolution=resolution,this._quality=0,this.quality=quality,this.blur=strength}apply(filterManager,input,output,clearMode){if(output?this.horizontal?this.uniforms.strength=1/output.width*(output.width/input.width):this.uniforms.strength=1/output.height*(output.height/input.height):this.horizontal?this.uniforms.strength=1/filterManager.renderer.width*(filterManager.renderer.width/input.width):this.uniforms.strength=1/filterManager.renderer.height*(filterManager.renderer.height/input.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)filterManager.applyFilter(this,input,output,clearMode);else{const renderTarget=filterManager.getFilterTexture(),renderer=filterManager.renderer;let flip=input,flop=renderTarget;this.state.blend=!1,filterManager.applyFilter(this,flip,flop,CLEAR_MODES.CLEAR);for(let i2=1;i2<this.passes-1;i2++){filterManager.bindAndClear(flip,CLEAR_MODES.BLIT),this.uniforms.uSampler=flop;const temp=flop;flop=flip,flip=temp,renderer.shader.bind(this),renderer.geometry.draw(5)}this.state.blend=!0,filterManager.applyFilter(this,flop,output,clearMode),filterManager.returnFilterTexture(renderTarget)}}get blur(){return this.strength}set blur(value){this.padding=1+Math.abs(value)*2,this.strength=value}get quality(){return this._quality}set quality(value){this._quality=value,this.passes=value}}class BlurFilter extends Filter{constructor(strength=8,quality=4,resolution=Filter.defaultResolution,kernelSize=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new BlurFilterPass(!0,strength,quality,resolution,kernelSize),this.blurYFilter=new BlurFilterPass(!1,strength,quality,resolution,kernelSize),this.resolution=resolution,this.quality=quality,this.blur=strength,this.repeatEdgePixels=!1}apply(filterManager,input,output,clearMode){const xStrength=Math.abs(this.blurXFilter.strength),yStrength=Math.abs(this.blurYFilter.strength);if(xStrength&&yStrength){const renderTarget=filterManager.getFilterTexture();this.blurXFilter.apply(filterManager,input,renderTarget,CLEAR_MODES.CLEAR),this.blurYFilter.apply(filterManager,renderTarget,output,clearMode),filterManager.returnFilterTexture(renderTarget)}else yStrength?this.blurYFilter.apply(filterManager,input,output,clearMode):this.blurXFilter.apply(filterManager,input,output,clearMode)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(value){this.blurXFilter.blur=this.blurYFilter.blur=value,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(value){this.blurXFilter.quality=this.blurYFilter.quality=value}get blurX(){return this.blurXFilter.blur}set blurX(value){this.blurXFilter.blur=value,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(value){this.blurYFilter.blur=value,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(value){this.blurYFilter.blendMode=value}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(value){this._repeatEdgePixels=value,this.updatePadding()}}var fragment$4=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ColorMatrixFilter extends Filter{constructor(){const uniforms={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(defaultFilterVertex,fragment$4,uniforms),this.alpha=1}_loadMatrix(matrix,multiply=!1){let newMatrix=matrix;multiply&&(this._multiply(newMatrix,this.uniforms.m,matrix),newMatrix=this._colorMatrix(newMatrix)),this.uniforms.m=newMatrix}_multiply(out,a2,b2){return out[0]=a2[0]*b2[0]+a2[1]*b2[5]+a2[2]*b2[10]+a2[3]*b2[15],out[1]=a2[0]*b2[1]+a2[1]*b2[6]+a2[2]*b2[11]+a2[3]*b2[16],out[2]=a2[0]*b2[2]+a2[1]*b2[7]+a2[2]*b2[12]+a2[3]*b2[17],out[3]=a2[0]*b2[3]+a2[1]*b2[8]+a2[2]*b2[13]+a2[3]*b2[18],out[4]=a2[0]*b2[4]+a2[1]*b2[9]+a2[2]*b2[14]+a2[3]*b2[19]+a2[4],out[5]=a2[5]*b2[0]+a2[6]*b2[5]+a2[7]*b2[10]+a2[8]*b2[15],out[6]=a2[5]*b2[1]+a2[6]*b2[6]+a2[7]*b2[11]+a2[8]*b2[16],out[7]=a2[5]*b2[2]+a2[6]*b2[7]+a2[7]*b2[12]+a2[8]*b2[17],out[8]=a2[5]*b2[3]+a2[6]*b2[8]+a2[7]*b2[13]+a2[8]*b2[18],out[9]=a2[5]*b2[4]+a2[6]*b2[9]+a2[7]*b2[14]+a2[8]*b2[19]+a2[9],out[10]=a2[10]*b2[0]+a2[11]*b2[5]+a2[12]*b2[10]+a2[13]*b2[15],out[11]=a2[10]*b2[1]+a2[11]*b2[6]+a2[12]*b2[11]+a2[13]*b2[16],out[12]=a2[10]*b2[2]+a2[11]*b2[7]+a2[12]*b2[12]+a2[13]*b2[17],out[13]=a2[10]*b2[3]+a2[11]*b2[8]+a2[12]*b2[13]+a2[13]*b2[18],out[14]=a2[10]*b2[4]+a2[11]*b2[9]+a2[12]*b2[14]+a2[13]*b2[19]+a2[14],out[15]=a2[15]*b2[0]+a2[16]*b2[5]+a2[17]*b2[10]+a2[18]*b2[15],out[16]=a2[15]*b2[1]+a2[16]*b2[6]+a2[17]*b2[11]+a2[18]*b2[16],out[17]=a2[15]*b2[2]+a2[16]*b2[7]+a2[17]*b2[12]+a2[18]*b2[17],out[18]=a2[15]*b2[3]+a2[16]*b2[8]+a2[17]*b2[13]+a2[18]*b2[18],out[19]=a2[15]*b2[4]+a2[16]*b2[9]+a2[17]*b2[14]+a2[18]*b2[19]+a2[19],out}_colorMatrix(matrix){const m2=new Float32Array(matrix);return m2[4]/=255,m2[9]/=255,m2[14]/=255,m2[19]/=255,m2}brightness(b2,multiply){const matrix=[b2,0,0,0,0,0,b2,0,0,0,0,0,b2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}tint(color,multiply){const[r2,g2,b2]=Color.shared.setValue(color).toArray(),matrix=[r2,0,0,0,0,0,g2,0,0,0,0,0,b2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}greyscale(scale,multiply){const matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}blackAndWhite(multiply){const matrix=[0.3,0.6,0.1,0,0,0.3,0.6,0.1,0,0,0.3,0.6,0.1,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}hue(rotation,multiply){rotation=(rotation||0)/180*Math.PI;const cosR=Math.cos(rotation),sinR=Math.sin(rotation),sqrt=Math.sqrt,w2=1/3,sqrW=sqrt(w2),a00=cosR+(1-cosR)*w2,a01=w2*(1-cosR)-sqrW*sinR,a02=w2*(1-cosR)+sqrW*sinR,a10=w2*(1-cosR)+sqrW*sinR,a11=cosR+w2*(1-cosR),a12=w2*(1-cosR)-sqrW*sinR,a20=w2*(1-cosR)-sqrW*sinR,a21=w2*(1-cosR)+sqrW*sinR,a22=cosR+w2*(1-cosR),matrix=[a00,a01,a02,0,0,a10,a11,a12,0,0,a20,a21,a22,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}contrast(amount,multiply){const v2=(amount||0)+1,o2=-0.5*(v2-1),matrix=[v2,0,0,0,o2,0,v2,0,0,o2,0,0,v2,0,o2,0,0,0,1,0];this._loadMatrix(matrix,multiply)}saturate(amount=0,multiply){const x2=amount*2/3+1,y2=(x2-1)*-0.5,matrix=[x2,y2,y2,0,0,y2,x2,y2,0,0,y2,y2,x2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}desaturate(){this.saturate(-1)}negative(multiply){const matrix=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}sepia(multiply){const matrix=[0.393,0.7689999,0.18899999,0,0,0.349,0.6859999,0.16799999,0,0,0.272,0.5339999,0.13099999,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}technicolor(multiply){const matrix=[1.9125277891456083,-0.8545344976951645,-0.09155508482755585,0,11.793603434377337,-0.3087833385928097,1.7658908555458428,-0.10601743074722245,0,-70.35205161461398,-0.231103377548616,-0.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(matrix,multiply)}polaroid(multiply){const matrix=[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}toBGR(multiply){const matrix=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}kodachrome(multiply){const matrix=[1.1285582396593525,-0.3967382283601348,-0.03992559172921793,0,63.72958762196502,-0.16404339962244616,1.0835251566291304,-0.05498805115633132,0,24.732407896706203,-0.16786010706155763,-0.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(matrix,multiply)}browni(multiply){const matrix=[0.5997023498159715,0.34553243048391263,-0.2708298674538042,0,47.43192855600873,-0.037703249837783157,0.8609577587992641,0.15059552388459913,0,-36.96841498319127,0.24113635128153335,-0.07441037908422492,0.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(matrix,multiply)}vintage(multiply){const matrix=[0.6279345635605994,0.3202183420819367,-0.03965408211312453,0,9.651285835294123,0.02578397704808868,0.6441188644374771,0.03259127616149294,0,7.462829176470591,0.0466055556782719,-0.0851232987247891,0.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(matrix,multiply)}colorTone(desaturation,toned,lightColor,darkColor,multiply){desaturation=desaturation||0.2,toned=toned||0.15,lightColor=lightColor||16770432,darkColor=darkColor||3375104;const temp=Color.shared,[lR,lG,lB]=temp.setValue(lightColor).toArray(),[dR,dG,dB]=temp.setValue(darkColor).toArray(),matrix=[0.3,0.59,0.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply)}night(intensity,multiply){intensity=intensity||0.1;const matrix=[intensity*-2,-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,intensity*2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}predator(amount,multiply){const matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,0.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,0.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply)}lsd(multiply){const matrix=[2,-0.4,0.5,0,0,-0.5,2,-0.4,0,0,-0.4,-0.5,3,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)}reset(){const matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(matrix,!1)}get matrix(){return this.uniforms.m}set matrix(value){this.uniforms.m=value}get alpha(){return this.uniforms.uAlpha}set alpha(value){this.uniforms.uAlpha=value}}ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;var fragment$3=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,vertex$2=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class DisplacementFilter extends Filter{constructor(sprite,scale){const maskMatrix=new Matrix;sprite.renderable=!1,super(vertex$2,fragment$3,{mapSampler:sprite._texture,filterMatrix:maskMatrix,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=sprite,this.maskMatrix=maskMatrix,scale==null&&(scale=20),this.scale=new Point(scale,scale)}apply(filterManager,input,output,clearMode){this.uniforms.filterMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const wt=this.maskSprite.worldTransform,lenX=Math.sqrt(wt.a*wt.a+wt.b*wt.b),lenY=Math.sqrt(wt.c*wt.c+wt.d*wt.d);lenX!==0&&lenY!==0&&(this.uniforms.rotation[0]=wt.a/lenX,this.uniforms.rotation[1]=wt.b/lenX,this.uniforms.rotation[2]=wt.c/lenY,this.uniforms.rotation[3]=wt.d/lenY),filterManager.applyFilter(this,input,output,clearMode)}get map(){return this.uniforms.mapSampler}set map(value){this.uniforms.mapSampler=value}}var fragment$2=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,vertex$1=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class FXAAFilter extends Filter{constructor(){super(vertex$1,fragment$2)}}var fragment$1=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class NoiseFilter extends Filter{constructor(noise=0.5,seed=Math.random()){super(defaultFilterVertex,fragment$1,{uNoise:0,uSeed:0}),this.noise=noise,this.seed=seed}get noise(){return this.uniforms.uNoise}set noise(value){this.uniforms.uNoise=value}get seed(){return this.uniforms.uSeed}set seed(value){this.uniforms.uSeed=value}}const filters={AlphaFilter,BlurFilter,BlurFilterPass,ColorMatrixFilter,DisplacementFilter,FXAAFilter,NoiseFilter};Object.entries(filters).forEach(([key,FilterClass])=>{Object.defineProperty(filters,key,{get(){return deprecation$1("7.1.0",`filters.${key} has moved to ${key}`),FilterClass}})});class EventsTickerClass{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(events){this.removeTickerListener(),this.events=events,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(paused){this._pauseUpdate=paused}addTickerListener(){this.tickerAdded||!this.domElement||(Ticker.system.add(this.tickerUpdate,this,UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Ticker.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const rootPointerEvent=this.events.rootPointerEvent;this.events.supportsTouchEvents&&rootPointerEvent.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:rootPointerEvent.clientX,clientY:rootPointerEvent.clientY}))}tickerUpdate(deltaTime){this._deltaTime+=deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const EventsTicker=new EventsTickerClass;class FederatedEvent{constructor(manager){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=FederatedEvent.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Point,this.page=new Point,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=manager}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(_type,_bubbles,_cancelable){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(_typeArg,_bubblesArg,_cancelableArg,_viewArg,_detailArg){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class FederatedMouseEvent extends FederatedEvent{constructor(){super(...arguments),this.client=new Point,this.movement=new Point,this.offset=new Point,this.global=new Point,this.screen=new Point}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)}getModifierState(key){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(key)}initMouseEvent(_typeArg,_canBubbleArg,_cancelableArg,_viewArg,_detailArg,_screenXArg,_screenYArg,_clientXArg,_clientYArg,_ctrlKeyArg,_altKeyArg,_shiftKeyArg,_metaKeyArg,_buttonArg,_relatedTargetArg){throw new Error("Method not implemented.")}}class FederatedPointerEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class FederatedWheelEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}FederatedWheelEvent.DOM_DELTA_PIXEL=0,FederatedWheelEvent.DOM_DELTA_LINE=1,FederatedWheelEvent.DOM_DELTA_PAGE=2;const PROPAGATION_LIMIT=2048,tempHitLocation=new Point,tempLocalMapping=new Point;class EventBoundary{constructor(rootTarget){this.dispatch=new EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=rootTarget,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(type,fn){this.mappingTable[type]||(this.mappingTable[type]=[]),this.mappingTable[type].push({fn,priority:0}),this.mappingTable[type].sort((a2,b2)=>a2.priority-b2.priority)}dispatchEvent(e2,type){e2.propagationStopped=!1,e2.propagationImmediatelyStopped=!1,this.propagate(e2,type),this.dispatch.emit(type||e2.type,e2)}mapEvent(e2){if(!this.rootTarget)return;const mappers=this.mappingTable[e2.type];if(mappers)for(let i2=0,j2=mappers.length;i2<j2;i2++)mappers[i2].fn(e2);else console.warn(`[EventBoundary]: Event mapping not defined for ${e2.type}`)}hitTest(x2,y2){EventsTicker.pauseUpdate=!0;const fn=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",invertedPath=this[fn](this.rootTarget,this.rootTarget.eventMode,tempHitLocation.set(x2,y2),this.hitTestFn,this.hitPruneFn);return invertedPath&&invertedPath[0]}propagate(e2,type){if(!e2.target)return;const composedPath=e2.composedPath();e2.eventPhase=e2.CAPTURING_PHASE;for(let i2=0,j2=composedPath.length-1;i2<j2;i2++)if(e2.currentTarget=composedPath[i2],this.notifyTarget(e2,type),e2.propagationStopped||e2.propagationImmediatelyStopped)return;if(e2.eventPhase=e2.AT_TARGET,e2.currentTarget=e2.target,this.notifyTarget(e2,type),!(e2.propagationStopped||e2.propagationImmediatelyStopped)){e2.eventPhase=e2.BUBBLING_PHASE;for(let i2=composedPath.length-2;i2>=0;i2--)if(e2.currentTarget=composedPath[i2],this.notifyTarget(e2,type),e2.propagationStopped||e2.propagationImmediatelyStopped)return}}all(e2,type,targets=this._allInteractiveElements){if(targets.length===0)return;e2.eventPhase=e2.BUBBLING_PHASE;const events=Array.isArray(type)?type:[type];for(let i2=targets.length-1;i2>=0;i2--)events.forEach(event=>{e2.currentTarget=targets[i2],this.notifyTarget(e2,event)})}propagationPath(target){const propagationPath=[target];for(let i2=0;i2<PROPAGATION_LIMIT&&target!==this.rootTarget;i2++){if(!target.parent)throw new Error("Cannot find propagation path to disconnected target");propagationPath.push(target.parent),target=target.parent}return propagationPath.reverse(),propagationPath}hitTestMoveRecursive(currentTarget,eventMode,location,testFn,pruneFn,ignore=!1){let shouldReturn=!1;if(this._interactivePrune(currentTarget))return null;if((currentTarget.eventMode==="dynamic"||eventMode==="dynamic")&&(EventsTicker.pauseUpdate=!1),currentTarget.interactiveChildren&&currentTarget.children){const children=currentTarget.children;for(let i2=children.length-1;i2>=0;i2--){const child=children[i2],nestedHit=this.hitTestMoveRecursive(child,this._isInteractive(eventMode)?eventMode:child.eventMode,location,testFn,pruneFn,ignore||pruneFn(currentTarget,location));if(nestedHit){if(nestedHit.length>0&&!nestedHit[nestedHit.length-1].parent)continue;const isInteractive=currentTarget.isInteractive();(nestedHit.length>0||isInteractive)&&(isInteractive&&this._allInteractiveElements.push(currentTarget),nestedHit.push(currentTarget)),this._hitElements.length===0&&(this._hitElements=nestedHit),shouldReturn=!0}}}const isInteractiveMode=this._isInteractive(eventMode),isInteractiveTarget=currentTarget.isInteractive();return isInteractiveMode&&isInteractiveTarget&&this._allInteractiveElements.push(currentTarget),ignore||this._hitElements.length>0?null:shouldReturn?this._hitElements:isInteractiveMode&&!pruneFn(currentTarget,location)&&testFn(currentTarget,location)?isInteractiveTarget?[currentTarget]:[]:null}hitTestRecursive(currentTarget,eventMode,location,testFn,pruneFn){if(this._interactivePrune(currentTarget)||pruneFn(currentTarget,location))return null;if((currentTarget.eventMode==="dynamic"||eventMode==="dynamic")&&(EventsTicker.pauseUpdate=!1),currentTarget.interactiveChildren&&currentTarget.children){const children=currentTarget.children;for(let i2=children.length-1;i2>=0;i2--){const child=children[i2],nestedHit=this.hitTestRecursive(child,this._isInteractive(eventMode)?eventMode:child.eventMode,location,testFn,pruneFn);if(nestedHit){if(nestedHit.length>0&&!nestedHit[nestedHit.length-1].parent)continue;const isInteractive=currentTarget.isInteractive();return(nestedHit.length>0||isInteractive)&&nestedHit.push(currentTarget),nestedHit}}}const isInteractiveMode=this._isInteractive(eventMode),isInteractiveTarget=currentTarget.isInteractive();return isInteractiveMode&&testFn(currentTarget,location)?isInteractiveTarget?[currentTarget]:[]:null}_isInteractive(int){return int==="static"||int==="dynamic"}_interactivePrune(displayObject){return!!(!displayObject||displayObject.isMask||!displayObject.visible||!displayObject.renderable||displayObject.eventMode==="none"||displayObject.eventMode==="passive"&&!displayObject.interactiveChildren||displayObject.isMask)}hitPruneFn(displayObject,location){var _a2;if(displayObject.hitArea&&(displayObject.worldTransform.applyInverse(location,tempLocalMapping),!displayObject.hitArea.contains(tempLocalMapping.x,tempLocalMapping.y)))return!0;if(displayObject._mask){const maskObject=displayObject._mask.isMaskData?displayObject._mask.maskObject:displayObject._mask;if(maskObject&&!((_a2=maskObject.containsPoint)!=null&&_a2.call(maskObject,location)))return!0}return!1}hitTestFn(displayObject,location){return displayObject.eventMode==="passive"?!1:displayObject.hitArea?!0:displayObject.containsPoint?displayObject.containsPoint(location):!1}notifyTarget(e2,type){var _a2,_b;type=type!=null?type:e2.type;const handlerKey=`on${type}`;(_b=(_a2=e2.currentTarget)[handlerKey])==null||_b.call(_a2,e2);const key=e2.eventPhase===e2.CAPTURING_PHASE||e2.eventPhase===e2.AT_TARGET?`${type}capture`:type;this.notifyListeners(e2,key),e2.eventPhase===e2.AT_TARGET&&this.notifyListeners(e2,type)}mapPointerDown(from){if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e2=this.createPointerEvent(from);if(this.dispatchEvent(e2,"pointerdown"),e2.pointerType==="touch")this.dispatchEvent(e2,"touchstart");else if(e2.pointerType==="mouse"||e2.pointerType==="pen"){const isRightButton=e2.button===2;this.dispatchEvent(e2,isRightButton?"rightdown":"mousedown")}const trackingData=this.trackingData(from.pointerId);trackingData.pressTargetsByButton[from.button]=e2.composedPath(),this.freeEvent(e2)}mapPointerMove(from){var _a2,_b,_c;if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e2=this.createPointerEvent(from);this._isPointerMoveEvent=!1;const isMouse=e2.pointerType==="mouse"||e2.pointerType==="pen",trackingData=this.trackingData(from.pointerId),outTarget=this.findMountedTarget(trackingData.overTargets);if(((_a2=trackingData.overTargets)==null?void 0:_a2.length)>0&&outTarget!==e2.target){const outType=from.type==="mousemove"?"mouseout":"pointerout",outEvent=this.createPointerEvent(from,outType,outTarget);if(this.dispatchEvent(outEvent,"pointerout"),isMouse&&this.dispatchEvent(outEvent,"mouseout"),!e2.composedPath().includes(outTarget)){const leaveEvent=this.createPointerEvent(from,"pointerleave",outTarget);for(leaveEvent.eventPhase=leaveEvent.AT_TARGET;leaveEvent.target&&!e2.composedPath().includes(leaveEvent.target);)leaveEvent.currentTarget=leaveEvent.target,this.notifyTarget(leaveEvent),isMouse&&this.notifyTarget(leaveEvent,"mouseleave"),leaveEvent.target=leaveEvent.target.parent;this.freeEvent(leaveEvent)}this.freeEvent(outEvent)}if(outTarget!==e2.target){const overType=from.type==="mousemove"?"mouseover":"pointerover",overEvent=this.clonePointerEvent(e2,overType);this.dispatchEvent(overEvent,"pointerover"),isMouse&&this.dispatchEvent(overEvent,"mouseover");let overTargetAncestor=outTarget==null?void 0:outTarget.parent;for(;overTargetAncestor&&overTargetAncestor!==this.rootTarget.parent&&overTargetAncestor!==e2.target;)overTargetAncestor=overTargetAncestor.parent;if(!overTargetAncestor||overTargetAncestor===this.rootTarget.parent){const enterEvent=this.clonePointerEvent(e2,"pointerenter");for(enterEvent.eventPhase=enterEvent.AT_TARGET;enterEvent.target&&enterEvent.target!==outTarget&&enterEvent.target!==this.rootTarget.parent;)enterEvent.currentTarget=enterEvent.target,this.notifyTarget(enterEvent),isMouse&&this.notifyTarget(enterEvent,"mouseenter"),enterEvent.target=enterEvent.target.parent;this.freeEvent(enterEvent)}this.freeEvent(overEvent)}const allMethods=[],allowGlobalPointerEvents=(_b=this.enableGlobalMoveEvents)!=null?_b:!0;this.moveOnAll?allMethods.push("pointermove"):this.dispatchEvent(e2,"pointermove"),allowGlobalPointerEvents&&allMethods.push("globalpointermove"),e2.pointerType==="touch"&&(this.moveOnAll?allMethods.splice(1,0,"touchmove"):this.dispatchEvent(e2,"touchmove"),allowGlobalPointerEvents&&allMethods.push("globaltouchmove")),isMouse&&(this.moveOnAll?allMethods.splice(1,0,"mousemove"):this.dispatchEvent(e2,"mousemove"),allowGlobalPointerEvents&&allMethods.push("globalmousemove"),this.cursor=(_c=e2.target)==null?void 0:_c.cursor),allMethods.length>0&&this.all(e2,allMethods),this._allInteractiveElements.length=0,this._hitElements.length=0,trackingData.overTargets=e2.composedPath(),this.freeEvent(e2)}mapPointerOver(from){var _a2;if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const trackingData=this.trackingData(from.pointerId),e2=this.createPointerEvent(from),isMouse=e2.pointerType==="mouse"||e2.pointerType==="pen";this.dispatchEvent(e2,"pointerover"),isMouse&&this.dispatchEvent(e2,"mouseover"),e2.pointerType==="mouse"&&(this.cursor=(_a2=e2.target)==null?void 0:_a2.cursor);const enterEvent=this.clonePointerEvent(e2,"pointerenter");for(enterEvent.eventPhase=enterEvent.AT_TARGET;enterEvent.target&&enterEvent.target!==this.rootTarget.parent;)enterEvent.currentTarget=enterEvent.target,this.notifyTarget(enterEvent),isMouse&&this.notifyTarget(enterEvent,"mouseenter"),enterEvent.target=enterEvent.target.parent;trackingData.overTargets=e2.composedPath(),this.freeEvent(e2),this.freeEvent(enterEvent)}mapPointerOut(from){if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const trackingData=this.trackingData(from.pointerId);if(trackingData.overTargets){const isMouse=from.pointerType==="mouse"||from.pointerType==="pen",outTarget=this.findMountedTarget(trackingData.overTargets),outEvent=this.createPointerEvent(from,"pointerout",outTarget);this.dispatchEvent(outEvent),isMouse&&this.dispatchEvent(outEvent,"mouseout");const leaveEvent=this.createPointerEvent(from,"pointerleave",outTarget);for(leaveEvent.eventPhase=leaveEvent.AT_TARGET;leaveEvent.target&&leaveEvent.target!==this.rootTarget.parent;)leaveEvent.currentTarget=leaveEvent.target,this.notifyTarget(leaveEvent),isMouse&&this.notifyTarget(leaveEvent,"mouseleave"),leaveEvent.target=leaveEvent.target.parent;trackingData.overTargets=null,this.freeEvent(outEvent),this.freeEvent(leaveEvent)}this.cursor=null}mapPointerUp(from){if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const now=performance.now(),e2=this.createPointerEvent(from);if(this.dispatchEvent(e2,"pointerup"),e2.pointerType==="touch")this.dispatchEvent(e2,"touchend");else if(e2.pointerType==="mouse"||e2.pointerType==="pen"){const isRightButton=e2.button===2;this.dispatchEvent(e2,isRightButton?"rightup":"mouseup")}const trackingData=this.trackingData(from.pointerId),pressTarget=this.findMountedTarget(trackingData.pressTargetsByButton[from.button]);let clickTarget=pressTarget;if(pressTarget&&!e2.composedPath().includes(pressTarget)){let currentTarget=pressTarget;for(;currentTarget&&!e2.composedPath().includes(currentTarget);){if(e2.currentTarget=currentTarget,this.notifyTarget(e2,"pointerupoutside"),e2.pointerType==="touch")this.notifyTarget(e2,"touchendoutside");else if(e2.pointerType==="mouse"||e2.pointerType==="pen"){const isRightButton=e2.button===2;this.notifyTarget(e2,isRightButton?"rightupoutside":"mouseupoutside")}currentTarget=currentTarget.parent}delete trackingData.pressTargetsByButton[from.button],clickTarget=currentTarget}if(clickTarget){const clickEvent=this.clonePointerEvent(e2,"click");clickEvent.target=clickTarget,clickEvent.path=null,trackingData.clicksByButton[from.button]||(trackingData.clicksByButton[from.button]={clickCount:0,target:clickEvent.target,timeStamp:now});const clickHistory=trackingData.clicksByButton[from.button];if(clickHistory.target===clickEvent.target&&now-clickHistory.timeStamp<200?++clickHistory.clickCount:clickHistory.clickCount=1,clickHistory.target=clickEvent.target,clickHistory.timeStamp=now,clickEvent.detail=clickHistory.clickCount,clickEvent.pointerType==="mouse"){const isRightButton=clickEvent.button===2;this.dispatchEvent(clickEvent,isRightButton?"rightclick":"click")}else clickEvent.pointerType==="touch"&&this.dispatchEvent(clickEvent,"tap");this.dispatchEvent(clickEvent,"pointertap"),this.freeEvent(clickEvent)}this.freeEvent(e2)}mapPointerUpOutside(from){if(!(from instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const trackingData=this.trackingData(from.pointerId),pressTarget=this.findMountedTarget(trackingData.pressTargetsByButton[from.button]),e2=this.createPointerEvent(from);if(pressTarget){let currentTarget=pressTarget;for(;currentTarget;)e2.currentTarget=currentTarget,this.notifyTarget(e2,"pointerupoutside"),e2.pointerType==="touch"?this.notifyTarget(e2,"touchendoutside"):(e2.pointerType==="mouse"||e2.pointerType==="pen")&&this.notifyTarget(e2,e2.button===2?"rightupoutside":"mouseupoutside"),currentTarget=currentTarget.parent;delete trackingData.pressTargetsByButton[from.button]}this.freeEvent(e2)}mapWheel(from){if(!(from instanceof FederatedWheelEvent)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const wheelEvent=this.createWheelEvent(from);this.dispatchEvent(wheelEvent),this.freeEvent(wheelEvent)}findMountedTarget(propagationPath){if(!propagationPath)return null;let currentTarget=propagationPath[0];for(let i2=1;i2<propagationPath.length&&propagationPath[i2].parent===currentTarget;i2++)currentTarget=propagationPath[i2];return currentTarget}createPointerEvent(from,type,target){var _a2;const event=this.allocateEvent(FederatedPointerEvent);return this.copyPointerData(from,event),this.copyMouseData(from,event),this.copyData(from,event),event.nativeEvent=from.nativeEvent,event.originalEvent=from,event.target=(_a2=target!=null?target:this.hitTest(event.global.x,event.global.y))!=null?_a2:this._hitElements[0],typeof type=="string"&&(event.type=type),event}createWheelEvent(from){const event=this.allocateEvent(FederatedWheelEvent);return this.copyWheelData(from,event),this.copyMouseData(from,event),this.copyData(from,event),event.nativeEvent=from.nativeEvent,event.originalEvent=from,event.target=this.hitTest(event.global.x,event.global.y),event}clonePointerEvent(from,type){const event=this.allocateEvent(FederatedPointerEvent);return event.nativeEvent=from.nativeEvent,event.originalEvent=from.originalEvent,this.copyPointerData(from,event),this.copyMouseData(from,event),this.copyData(from,event),event.target=from.target,event.path=from.composedPath().slice(),event.type=type!=null?type:event.type,event}copyWheelData(from,to){to.deltaMode=from.deltaMode,to.deltaX=from.deltaX,to.deltaY=from.deltaY,to.deltaZ=from.deltaZ}copyPointerData(from,to){from instanceof FederatedPointerEvent&&to instanceof FederatedPointerEvent&&(to.pointerId=from.pointerId,to.width=from.width,to.height=from.height,to.isPrimary=from.isPrimary,to.pointerType=from.pointerType,to.pressure=from.pressure,to.tangentialPressure=from.tangentialPressure,to.tiltX=from.tiltX,to.tiltY=from.tiltY,to.twist=from.twist)}copyMouseData(from,to){from instanceof FederatedMouseEvent&&to instanceof FederatedMouseEvent&&(to.altKey=from.altKey,to.button=from.button,to.buttons=from.buttons,to.client.copyFrom(from.client),to.ctrlKey=from.ctrlKey,to.metaKey=from.metaKey,to.movement.copyFrom(from.movement),to.screen.copyFrom(from.screen),to.shiftKey=from.shiftKey,to.global.copyFrom(from.global))}copyData(from,to){to.isTrusted=from.isTrusted,to.srcElement=from.srcElement,to.timeStamp=performance.now(),to.type=from.type,to.detail=from.detail,to.view=from.view,to.which=from.which,to.layer.copyFrom(from.layer),to.page.copyFrom(from.page)}trackingData(id){return this.mappingState.trackingData[id]||(this.mappingState.trackingData[id]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[id]}allocateEvent(constructor){this.eventPool.has(constructor)||this.eventPool.set(constructor,[]);const event=this.eventPool.get(constructor).pop()||new constructor(this);return event.eventPhase=event.NONE,event.currentTarget=null,event.path=null,event.target=null,event}freeEvent(event){if(event.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const constructor=event.constructor;this.eventPool.has(constructor)||this.eventPool.set(constructor,[]),this.eventPool.get(constructor).push(event)}notifyListeners(e2,type){const listeners=e2.currentTarget._events[type];if(listeners&&e2.currentTarget.isInteractive())if("fn"in listeners)listeners.once&&e2.currentTarget.removeListener(type,listeners.fn,void 0,!0),listeners.fn.call(listeners.context,e2);else for(let i2=0,j2=listeners.length;i2<j2&&!e2.propagationImmediatelyStopped;i2++)listeners[i2].once&&e2.currentTarget.removeListener(type,listeners[i2].fn,void 0,!0),listeners[i2].fn.call(listeners[i2].context,e2)}}var __defProp$a=Object.defineProperty,__getOwnPropSymbols$a=Object.getOwnPropertySymbols,__hasOwnProp$a=Object.prototype.hasOwnProperty,__propIsEnum$a=Object.prototype.propertyIsEnumerable,__defNormalProp$a=(obj,key,value)=>key in obj?__defProp$a(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$a=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$a.call(b2,prop)&&__defNormalProp$a(a2,prop,b2[prop]);if(__getOwnPropSymbols$a)for(var prop of __getOwnPropSymbols$a(b2))__propIsEnum$a.call(b2,prop)&&__defNormalProp$a(a2,prop,b2[prop]);return a2};const MOUSE_POINTER_ID=1,TOUCH_TO_POINTER={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},_EventSystem=class _EventSystem2{constructor(renderer){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=renderer,this.rootBoundary=new EventBoundary(null),EventsTicker.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new FederatedPointerEvent(null),this.rootWheelEvent=new FederatedWheelEvent(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(__spreadValues$a({},_EventSystem2.defaultEventFeatures),{set:(target,key,value)=>(key==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=value),target[key]=value,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(options){var _a2,_b;const{view,resolution}=this.renderer;this.setTargetElement(view),this.resolution=resolution,_EventSystem2._defaultEventMode=(_a2=options.eventMode)!=null?_a2:"auto",Object.assign(this.features,(_b=options.eventFeatures)!=null?_b:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(resolution){this.resolution=resolution}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(mode){mode=mode||"default";let applyStyles=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(applyStyles=!1),this.currentCursor===mode)return;this.currentCursor=mode;const style=this.cursorStyles[mode];if(style)switch(typeof style){case"string":applyStyles&&(this.domElement.style.cursor=style);break;case"function":style(mode);break;case"object":applyStyles&&Object.assign(this.domElement.style,style);break}else applyStyles&&typeof mode=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,mode)&&(this.domElement.style.cursor=mode)}get pointer(){return this.rootPointerEvent}onPointerDown(nativeEvent){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const events=this.normalizeToPointerData(nativeEvent);this.autoPreventDefault&&events[0].isNormalized&&(nativeEvent.cancelable||!("cancelable"in nativeEvent))&&nativeEvent.preventDefault();for(let i2=0,j2=events.length;i2<j2;i2++){const nativeEvent2=events[i2],federatedEvent=this.bootstrapEvent(this.rootPointerEvent,nativeEvent2);this.rootBoundary.mapEvent(federatedEvent)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(nativeEvent){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,EventsTicker.pointerMoved();const normalizedEvents=this.normalizeToPointerData(nativeEvent);for(let i2=0,j2=normalizedEvents.length;i2<j2;i2++){const event=this.bootstrapEvent(this.rootPointerEvent,normalizedEvents[i2]);this.rootBoundary.mapEvent(event)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(nativeEvent){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let target=nativeEvent.target;nativeEvent.composedPath&&nativeEvent.composedPath().length>0&&(target=nativeEvent.composedPath()[0]);const outside=target!==this.domElement?"outside":"",normalizedEvents=this.normalizeToPointerData(nativeEvent);for(let i2=0,j2=normalizedEvents.length;i2<j2;i2++){const event=this.bootstrapEvent(this.rootPointerEvent,normalizedEvents[i2]);event.type+=outside,this.rootBoundary.mapEvent(event)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(nativeEvent){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const normalizedEvents=this.normalizeToPointerData(nativeEvent);for(let i2=0,j2=normalizedEvents.length;i2<j2;i2++){const event=this.bootstrapEvent(this.rootPointerEvent,normalizedEvents[i2]);this.rootBoundary.mapEvent(event)}this.setCursor(this.rootBoundary.cursor)}onWheel(nativeEvent){if(!this.features.wheel)return;const wheelEvent=this.normalizeWheelEvent(nativeEvent);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(wheelEvent)}setTargetElement(element){this.removeEvents(),this.domElement=element,EventsTicker.domElement=element,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;EventsTicker.addTickerListener();const style=this.domElement.style;style&&(globalThis.navigator.msPointerEnabled?(style.msContentZooming="none",style.msTouchAction="none"):this.supportsPointerEvents&&(style.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;EventsTicker.removeTickerListener();const style=this.domElement.style;globalThis.navigator.msPointerEnabled?(style.msContentZooming="",style.msTouchAction=""):this.supportsPointerEvents&&(style.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(point,x2,y2){const rect=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},resolutionMultiplier=1/this.resolution;point.x=(x2-rect.left)*(this.domElement.width/rect.width)*resolutionMultiplier,point.y=(y2-rect.top)*(this.domElement.height/rect.height)*resolutionMultiplier}normalizeToPointerData(event){const normalizedEvents=[];if(this.supportsTouchEvents&&event instanceof TouchEvent)for(let i2=0,li=event.changedTouches.length;i2<li;i2++){const touch=event.changedTouches[i2];typeof touch.button=="undefined"&&(touch.button=0),typeof touch.buttons=="undefined"&&(touch.buttons=1),typeof touch.isPrimary=="undefined"&&(touch.isPrimary=event.touches.length===1&&event.type==="touchstart"),typeof touch.width=="undefined"&&(touch.width=touch.radiusX||1),typeof touch.height=="undefined"&&(touch.height=touch.radiusY||1),typeof touch.tiltX=="undefined"&&(touch.tiltX=0),typeof touch.tiltY=="undefined"&&(touch.tiltY=0),typeof touch.pointerType=="undefined"&&(touch.pointerType="touch"),typeof touch.pointerId=="undefined"&&(touch.pointerId=touch.identifier||0),typeof touch.pressure=="undefined"&&(touch.pressure=touch.force||0.5),typeof touch.twist=="undefined"&&(touch.twist=0),typeof touch.tangentialPressure=="undefined"&&(touch.tangentialPressure=0),typeof touch.layerX=="undefined"&&(touch.layerX=touch.offsetX=touch.clientX),typeof touch.layerY=="undefined"&&(touch.layerY=touch.offsetY=touch.clientY),touch.isNormalized=!0,touch.type=event.type,normalizedEvents.push(touch)}else if(!globalThis.MouseEvent||event instanceof MouseEvent&&(!this.supportsPointerEvents||!(event instanceof globalThis.PointerEvent))){const tempEvent=event;typeof tempEvent.isPrimary=="undefined"&&(tempEvent.isPrimary=!0),typeof tempEvent.width=="undefined"&&(tempEvent.width=1),typeof tempEvent.height=="undefined"&&(tempEvent.height=1),typeof tempEvent.tiltX=="undefined"&&(tempEvent.tiltX=0),typeof tempEvent.tiltY=="undefined"&&(tempEvent.tiltY=0),typeof tempEvent.pointerType=="undefined"&&(tempEvent.pointerType="mouse"),typeof tempEvent.pointerId=="undefined"&&(tempEvent.pointerId=MOUSE_POINTER_ID),typeof tempEvent.pressure=="undefined"&&(tempEvent.pressure=0.5),typeof tempEvent.twist=="undefined"&&(tempEvent.twist=0),typeof tempEvent.tangentialPressure=="undefined"&&(tempEvent.tangentialPressure=0),tempEvent.isNormalized=!0,normalizedEvents.push(tempEvent)}else normalizedEvents.push(event);return normalizedEvents}normalizeWheelEvent(nativeEvent){const event=this.rootWheelEvent;return this.transferMouseData(event,nativeEvent),event.deltaX=nativeEvent.deltaX,event.deltaY=nativeEvent.deltaY,event.deltaZ=nativeEvent.deltaZ,event.deltaMode=nativeEvent.deltaMode,this.mapPositionToPoint(event.screen,nativeEvent.clientX,nativeEvent.clientY),event.global.copyFrom(event.screen),event.offset.copyFrom(event.screen),event.nativeEvent=nativeEvent,event.type=nativeEvent.type,event}bootstrapEvent(event,nativeEvent){return event.originalEvent=null,event.nativeEvent=nativeEvent,event.pointerId=nativeEvent.pointerId,event.width=nativeEvent.width,event.height=nativeEvent.height,event.isPrimary=nativeEvent.isPrimary,event.pointerType=nativeEvent.pointerType,event.pressure=nativeEvent.pressure,event.tangentialPressure=nativeEvent.tangentialPressure,event.tiltX=nativeEvent.tiltX,event.tiltY=nativeEvent.tiltY,event.twist=nativeEvent.twist,this.transferMouseData(event,nativeEvent),this.mapPositionToPoint(event.screen,nativeEvent.clientX,nativeEvent.clientY),event.global.copyFrom(event.screen),event.offset.copyFrom(event.screen),event.isTrusted=nativeEvent.isTrusted,event.type==="pointerleave"&&(event.type="pointerout"),event.type.startsWith("mouse")&&(event.type=event.type.replace("mouse","pointer")),event.type.startsWith("touch")&&(event.type=TOUCH_TO_POINTER[event.type]||event.type),event}transferMouseData(event,nativeEvent){event.isTrusted=nativeEvent.isTrusted,event.srcElement=nativeEvent.srcElement,event.timeStamp=performance.now(),event.type=nativeEvent.type,event.altKey=nativeEvent.altKey,event.button=nativeEvent.button,event.buttons=nativeEvent.buttons,event.client.x=nativeEvent.clientX,event.client.y=nativeEvent.clientY,event.ctrlKey=nativeEvent.ctrlKey,event.metaKey=nativeEvent.metaKey,event.movement.x=nativeEvent.movementX,event.movement.y=nativeEvent.movementY,event.page.x=nativeEvent.pageX,event.page.y=nativeEvent.pageY,event.relatedTarget=null,event.shiftKey=nativeEvent.shiftKey}};_EventSystem.extension={name:"events",type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem]},_EventSystem.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let EventSystem=_EventSystem;extensions$1.add(EventSystem);function convertEventModeToInteractiveMode(mode){return mode==="dynamic"||mode==="static"}const FederatedDisplayObject={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var _a2;return(_a2=this._internalInteractive)!=null?_a2:convertEventModeToInteractiveMode(EventSystem.defaultEventMode)},set interactive(value){deprecation$1("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=value,this.eventMode=value?"static":"auto"},_internalEventMode:void 0,get eventMode(){var _a2;return(_a2=this._internalEventMode)!=null?_a2:EventSystem.defaultEventMode},set eventMode(value){this._internalInteractive=convertEventModeToInteractiveMode(value),this._internalEventMode=value},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(type,listener,options){const capture=typeof options=="boolean"&&options||typeof options=="object"&&options.capture,context2=typeof listener=="function"?void 0:listener;type=capture?`${type}capture`:type,listener=typeof listener=="function"?listener:listener.handleEvent,this.on(type,listener,context2)},removeEventListener(type,listener,options){const capture=typeof options=="boolean"&&options||typeof options=="object"&&options.capture,context2=typeof listener=="function"?void 0:listener;type=capture?`${type}capture`:type,listener=typeof listener=="function"?listener:listener.handleEvent,this.off(type,listener,context2)},dispatchEvent(e2){if(!(e2 instanceof FederatedEvent))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return e2.defaultPrevented=!1,e2.path=null,e2.target=this,e2.manager.dispatchEvent(e2),!e2.defaultPrevented}};DisplayObject.mixin(FederatedDisplayObject);const accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};DisplayObject.mixin(accessibleTarget);const KEY_CODE_TAB=9,DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,DIV_HOOK_SIZE=1,DIV_HOOK_POS_X=-1e3,DIV_HOOK_POS_Y=-1e3,DIV_HOOK_ZINDEX=2;class AccessibilityManager{constructor(renderer){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(isMobile.tablet||isMobile.phone)&&this.createTouchHook();const div=document.createElement("div");div.style.width=`${DIV_TOUCH_SIZE}px`,div.style.height=`${DIV_TOUCH_SIZE}px`,div.style.position="absolute",div.style.top=`${DIV_TOUCH_POS_X}px`,div.style.left=`${DIV_TOUCH_POS_Y}px`,div.style.zIndex=DIV_TOUCH_ZINDEX.toString(),this.div=div,this.renderer=renderer,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const hookDiv=document.createElement("button");hookDiv.style.width=`${DIV_HOOK_SIZE}px`,hookDiv.style.height=`${DIV_HOOK_SIZE}px`,hookDiv.style.position="absolute",hookDiv.style.top=`${DIV_HOOK_POS_X}px`,hookDiv.style.left=`${DIV_HOOK_POS_Y}px`,hookDiv.style.zIndex=DIV_HOOK_ZINDEX.toString(),hookDiv.style.backgroundColor="#FF0000",hookDiv.title="select to enable accessibility for this content",hookDiv.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(hookDiv),this._hookDiv=hookDiv}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var _a2;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(_a2=this.renderer.view.parentNode)==null||_a2.appendChild(this.div))}deactivate(){var _a2;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(_a2=this.div.parentNode)==null||_a2.removeChild(this.div))}updateAccessibleObjects(displayObject){if(!displayObject.visible||!displayObject.accessibleChildren)return;displayObject.accessible&&displayObject.isInteractive()&&(displayObject._accessibleActive||this.addChild(displayObject),displayObject.renderId=this.renderId);const children=displayObject.children;if(children)for(let i2=0;i2<children.length;i2++)this.updateAccessibleObjects(children[i2])}update(){const now=performance.now();if(isMobile.android.device&&now<this.androidUpdateCount||(this.androidUpdateCount=now+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:x2,y:y2,width,height}=this.renderer.view.getBoundingClientRect(),{width:viewWidth,height:viewHeight,resolution}=this.renderer,sx=width/viewWidth*resolution,sy=height/viewHeight*resolution;let div=this.div;div.style.left=`${x2}px`,div.style.top=`${y2}px`,div.style.width=`${viewWidth}px`,div.style.height=`${viewHeight}px`;for(let i2=0;i2<this.children.length;i2++){const child=this.children[i2];if(child.renderId!==this.renderId)child._accessibleActive=!1,removeItems(this.children,i2,1),this.div.removeChild(child._accessibleDiv),this.pool.push(child._accessibleDiv),child._accessibleDiv=null,i2--;else{div=child._accessibleDiv;let hitArea=child.hitArea;const wt=child.worldTransform;child.hitArea?(div.style.left=`${(wt.tx+hitArea.x*wt.a)*sx}px`,div.style.top=`${(wt.ty+hitArea.y*wt.d)*sy}px`,div.style.width=`${hitArea.width*wt.a*sx}px`,div.style.height=`${hitArea.height*wt.d*sy}px`):(hitArea=child.getBounds(),this.capHitArea(hitArea),div.style.left=`${hitArea.x*sx}px`,div.style.top=`${hitArea.y*sy}px`,div.style.width=`${hitArea.width*sx}px`,div.style.height=`${hitArea.height*sy}px`,div.title!==child.accessibleTitle&&child.accessibleTitle!==null&&(div.title=child.accessibleTitle),div.getAttribute("aria-label")!==child.accessibleHint&&child.accessibleHint!==null&&div.setAttribute("aria-label",child.accessibleHint)),(child.accessibleTitle!==div.title||child.tabIndex!==div.tabIndex)&&(div.title=child.accessibleTitle,div.tabIndex=child.tabIndex,this.debug&&this.updateDebugHTML(div))}}this.renderId++}updateDebugHTML(div){div.innerHTML=`type: ${div.type}</br> title : ${div.title}</br> tabIndex: ${div.tabIndex}`}capHitArea(hitArea){hitArea.x<0&&(hitArea.width+=hitArea.x,hitArea.x=0),hitArea.y<0&&(hitArea.height+=hitArea.y,hitArea.y=0);const{width:viewWidth,height:viewHeight}=this.renderer;hitArea.x+hitArea.width>viewWidth&&(hitArea.width=viewWidth-hitArea.x),hitArea.y+hitArea.height>viewHeight&&(hitArea.height=viewHeight-hitArea.y)}addChild(displayObject){let div=this.pool.pop();div||(div=document.createElement("button"),div.style.width=`${DIV_TOUCH_SIZE}px`,div.style.height=`${DIV_TOUCH_SIZE}px`,div.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",div.style.position="absolute",div.style.zIndex=DIV_TOUCH_ZINDEX.toString(),div.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?div.setAttribute("aria-live","off"):div.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?div.setAttribute("aria-relevant","additions"):div.setAttribute("aria-relevant","text"),div.addEventListener("click",this._onClick.bind(this)),div.addEventListener("focus",this._onFocus.bind(this)),div.addEventListener("focusout",this._onFocusOut.bind(this))),div.style.pointerEvents=displayObject.accessiblePointerEvents,div.type=displayObject.accessibleType,displayObject.accessibleTitle&&displayObject.accessibleTitle!==null?div.title=displayObject.accessibleTitle:(!displayObject.accessibleHint||displayObject.accessibleHint===null)&&(div.title=`displayObject ${displayObject.tabIndex}`),displayObject.accessibleHint&&displayObject.accessibleHint!==null&&div.setAttribute("aria-label",displayObject.accessibleHint),this.debug&&this.updateDebugHTML(div),displayObject._accessibleActive=!0,displayObject._accessibleDiv=div,div.displayObject=displayObject,this.children.push(displayObject),this.div.appendChild(displayObject._accessibleDiv),displayObject._accessibleDiv.tabIndex=displayObject.tabIndex}_dispatchEvent(e2,type){const{displayObject:target}=e2.target,boundry=this.renderer.events.rootBoundary,event=Object.assign(new FederatedEvent(boundry),{target});boundry.rootTarget=this.renderer.lastObjectRendered,type.forEach(type2=>boundry.dispatchEvent(event,type2))}_onClick(e2){this._dispatchEvent(e2,["click","pointertap","tap"])}_onFocus(e2){e2.target.getAttribute("aria-live")||e2.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e2,["mouseover"])}_onFocusOut(e2){e2.target.getAttribute("aria-live")||e2.target.setAttribute("aria-live","polite"),this._dispatchEvent(e2,["mouseout"])}_onKeyDown(e2){e2.keyCode===KEY_CODE_TAB&&this.activate()}_onMouseMove(e2){e2.movementX===0&&e2.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}AccessibilityManager.extension={name:"accessibility",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]},extensions$1.add(AccessibilityManager);const _Application=class _Application2{constructor(options){this.stage=new Container,options=Object.assign({forceCanvas:!1},options),this.renderer=autoDetectRenderer(options),_Application2._plugins.forEach(plugin=>{plugin.init.call(this,options)})}render(){this.renderer.render(this.stage)}get view(){var _a2;return(_a2=this.renderer)==null?void 0:_a2.view}get screen(){var _a2;return(_a2=this.renderer)==null?void 0:_a2.screen}destroy(removeView,stageOptions){const plugins=_Application2._plugins.slice(0);plugins.reverse(),plugins.forEach(plugin=>{plugin.destroy.call(this)}),this.stage.destroy(stageOptions),this.stage=null,this.renderer.destroy(removeView),this.renderer=null}};_Application._plugins=[];let Application=_Application;extensions$1.handleByList(ExtensionType.Application,Application._plugins);class ResizePlugin{static init(options){Object.defineProperty(this,"resizeTo",{set(dom){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=dom,dom&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let width,height;if(this._resizeTo===globalThis.window)width=globalThis.innerWidth,height=globalThis.innerHeight;else{const{clientWidth,clientHeight}=this._resizeTo;width=clientWidth,height=clientHeight}this.renderer.resize(width,height),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=options.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ResizePlugin.extension=ExtensionType.Application,extensions$1.add(ResizePlugin);const assetKeyMap={loader:ExtensionType.LoadParser,resolver:ExtensionType.ResolveParser,cache:ExtensionType.CacheParser,detection:ExtensionType.DetectionParser};extensions$1.handle(ExtensionType.Asset,extension=>{const ref=extension.ref;Object.entries(assetKeyMap).filter(([key])=>!!ref[key]).forEach(([key,type])=>{var _a2;return extensions$1.add(Object.assign(ref[key],{extension:(_a2=ref[key].extension)!=null?_a2:type}))})},extension=>{const ref=extension.ref;Object.keys(assetKeyMap).filter(key=>!!ref[key]).forEach(key=>extensions$1.remove(ref[key]))});class BackgroundLoader{constructor(loader,verbose=!1){this._loader=loader,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=verbose}add(assetUrls){assetUrls.forEach(a2=>{this._assetList.push(a2)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const toLoad=[],toLoadAmount=Math.min(this._assetList.length,this._maxConcurrent);for(let i2=0;i2<toLoadAmount;i2++)toLoad.push(this._assetList.pop());await this._loader.load(toLoad),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(value){this._isActive!==value&&(this._isActive=value,value&&!this._isLoading&&this._next())}}function checkDataUrl(url2,mimes){if(Array.isArray(mimes)){for(const mime of mimes)if(url2.startsWith(`data:${mime}`))return!0;return!1}return url2.startsWith(`data:${mimes}`)}function checkExtension(url2,extension){const tempURL=url2.split("?")[0],ext=path.extname(tempURL).toLowerCase();return Array.isArray(extension)?extension.includes(ext):ext===extension}const convertToList=(input,transform,forceTransform=!1)=>(Array.isArray(input)||(input=[input]),transform?input.map(item=>typeof item=="string"||forceTransform?transform(item):item):input),copySearchParams=(targetUrl,sourceUrl)=>{const searchParams=sourceUrl.split("?")[1];return searchParams&&(targetUrl+=`?${searchParams}`),targetUrl};function processX(base,ids,depth,result,tags){const id=ids[depth];for(let i2=0;i2<id.length;i2++){const value=id[i2];depth<ids.length-1?processX(base.replace(result[depth],value),ids,depth+1,result,tags):tags.push(base.replace(result[depth],value))}}function createStringVariations(string){const regex=/\{(.*?)\}/g,result=string.match(regex),tags=[];if(result){const ids=[];result.forEach(vars=>{const split=vars.substring(1,vars.length-1).split(",");ids.push(split)}),processX(string,ids,0,result,tags)}else tags.push(string);return tags}const isSingleItem=item=>!Array.isArray(item);class CacheClass{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(key){return this._cache.has(key)}get(key){const result=this._cache.get(key);return result||console.warn(`[Assets] Asset id ${key} was not found in the Cache`),result}set(key,value){const keys=convertToList(key);let cacheableAssets;for(let i2=0;i2<this.parsers.length;i2++){const parser=this.parsers[i2];if(parser.test(value)){cacheableAssets=parser.getCacheableAssets(keys,value);break}}cacheableAssets||(cacheableAssets={},keys.forEach(key2=>{cacheableAssets[key2]=value}));const cacheKeys=Object.keys(cacheableAssets),cachedAssets={cacheKeys,keys};if(keys.forEach(key2=>{this._cacheMap.set(key2,cachedAssets)}),cacheKeys.forEach(key2=>{this._cache.has(key2)&&this._cache.get(key2)!==value&&console.warn("[Cache] already has key:",key2),this._cache.set(key2,cacheableAssets[key2])}),value instanceof Texture){const texture=value;keys.forEach(key2=>{texture.baseTexture!==Texture.EMPTY.baseTexture&&BaseTexture.addToCache(texture.baseTexture,key2),Texture.addToCache(texture,key2)})}}remove(key){if(!this._cacheMap.has(key)){console.warn(`[Assets] Asset id ${key} was not found in the Cache`);return}const cacheMap=this._cacheMap.get(key);cacheMap.cacheKeys.forEach(key2=>{this._cache.delete(key2)}),cacheMap.keys.forEach(key2=>{this._cacheMap.delete(key2)})}get parsers(){return this._parsers}}const Cache=new CacheClass;var __defProp$9=Object.defineProperty,__defProps$3=Object.defineProperties,__getOwnPropDescs$3=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$9=Object.getOwnPropertySymbols,__hasOwnProp$9=Object.prototype.hasOwnProperty,__propIsEnum$9=Object.prototype.propertyIsEnumerable,__defNormalProp$9=(obj,key,value)=>key in obj?__defProp$9(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$9=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$9.call(b2,prop)&&__defNormalProp$9(a2,prop,b2[prop]);if(__getOwnPropSymbols$9)for(var prop of __getOwnPropSymbols$9(b2))__propIsEnum$9.call(b2,prop)&&__defNormalProp$9(a2,prop,b2[prop]);return a2},__spreadProps$3=(a2,b2)=>__defProps$3(a2,__getOwnPropDescs$3(b2));class Loader{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(target,key,value)=>(this._parsersValidated=!1,target[key]=value,!0)}),this.promiseCache={};this._assetsDataCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(url2,data){const result={promise:null,parser:null};let createLoadPromise;return result.promise=(createLoadPromise=async()=>{var _a2,_b;let asset=null,parser=null;if(data.loadParser&&(parser=this._parserHash[data.loadParser],parser||console.warn(`[Assets] specified load parser "${data.loadParser}" not found while loading ${url2}`)),!parser){for(let i2=0;i2<this.parsers.length;i2++){const parserX=this.parsers[i2];if(parserX.load&&(_a2=parserX.test)!=null&&_a2.call(parserX,url2,data,this)){parser=parserX;break}}if(!parser)return console.warn(`[Assets] ${url2} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}asset=parser.load(url2,data,this),result.parser=parser;asset=await asset.then(r=>r,r=>false);if(!asset){const{downloadRetriesTime}=data.data;await new Promise(resolve=>setTimeout(resolve,downloadRetriesTime));return createLoadPromise()}for(let i2=0;i2<this.parsers.length;i2++){const parser2=this.parsers[i2];parser2.parse&&parser2.parse&&(await((_b=parser2.testParse)==null?void 0:_b.call(parser2,asset,data,this)))&&(asset=(await parser2.parse(asset,data,this))||asset,result.parser=parser2)}return asset})(),result}async load(assetsToLoadIn,onProgress){this._parsersValidated||this._validateParsers();let count=0;const assets={},singleAsset=isSingleItem(assetsToLoadIn),assetsToLoad=convertToList(assetsToLoadIn,item=>({alias:[item],src:item})),total=assetsToLoad.length,promises=assetsToLoad.map(async asset=>{let assetName=asset.src.substring(asset.src.lastIndexOf("/")+1);assetName=assetName.split(".")[0];if(asset.data&&!this._assetsDataCache[assetName]){this._assetsDataCache[assetName]=asset.data}if(!asset.data&&this._assetsDataCache[assetName]){asset.data=this._assetsDataCache[assetName]}const format=asset.src.split(".").pop();let version="?";if(this._assetsDataCache[assetName]&&this._assetsDataCache[assetName].advancedSearchParams){version+=this._assetsDataCache[assetName].advancedSearchParams[format]}else{version=""}const url2=`${path.toAbsolute(asset.src)}${version}`;if(!assets[asset.src])try{this.promiseCache[url2]||(this.promiseCache[url2]=this._getLoadPromiseAndParser(url2,asset)),assets[asset.src]=await this.promiseCache[url2].promise,onProgress&&onProgress(++count/total)}catch(e2){throw delete this.promiseCache[url2],delete assets[asset.src],new Error(`[Loader.load] Failed to load ${url2}.
${e2}`)}});return await Promise.all(promises),singleAsset?assets[assetsToLoad[0].src]:assets}async unload(assetsToUnloadIn){const promises=convertToList(assetsToUnloadIn,item=>({alias:[item],src:item})).map(async asset=>{var _a2,_b;const url2=path.toAbsolute(asset.src),loadPromise=this.promiseCache[url2];if(loadPromise){const loadedAsset=await loadPromise.promise;delete this.promiseCache[url2],(_b=(_a2=loadPromise.parser)==null?void 0:_a2.unload)==null||_b.call(_a2,loadedAsset,asset,this)}});await Promise.all(promises)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(parser=>parser.name).reduce((hash,parser)=>(hash[parser.name]&&console.warn(`[Assets] loadParser name conflict "${parser.name}"`),__spreadProps$3(__spreadValues$9({},hash),{[parser.name]:parser})),{})}}var LoaderParserPriority=(LoaderParserPriority2=>(LoaderParserPriority2[LoaderParserPriority2.Low=0]="Low",LoaderParserPriority2[LoaderParserPriority2.Normal=1]="Normal",LoaderParserPriority2[LoaderParserPriority2.High=2]="High",LoaderParserPriority2))(LoaderParserPriority||{});const validJSONExtension=".json",validJSONMIME="application/json",loadJson={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},name:"loadJson",test(url2){return checkDataUrl(url2,validJSONMIME)||checkExtension(url2,validJSONExtension)},async load(url2){return await(await settings.ADAPTER.fetch(url2)).json()}};extensions$1.add(loadJson);const validTXTExtension=".txt",validTXTMIME="text/plain",loadTxt={name:"loadTxt",extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test(url2){return checkDataUrl(url2,validTXTMIME)||checkExtension(url2,validTXTExtension)},async load(url2){return await(await settings.ADAPTER.fetch(url2)).text()}};extensions$1.add(loadTxt);var __defProp$8=Object.defineProperty,__defProps$2=Object.defineProperties,__getOwnPropDescs$2=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$8=Object.getOwnPropertySymbols,__hasOwnProp$8=Object.prototype.hasOwnProperty,__propIsEnum$8=Object.prototype.propertyIsEnumerable,__defNormalProp$8=(obj,key,value)=>key in obj?__defProp$8(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$8=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$8.call(b2,prop)&&__defNormalProp$8(a2,prop,b2[prop]);if(__getOwnPropSymbols$8)for(var prop of __getOwnPropSymbols$8(b2))__propIsEnum$8.call(b2,prop)&&__defNormalProp$8(a2,prop,b2[prop]);return a2},__spreadProps$2=(a2,b2)=>__defProps$2(a2,__getOwnPropDescs$2(b2));const validWeights=["normal","bold","100","200","300","400","500","600","700","800","900"],validFontExtensions=[".ttf",".otf",".woff",".woff2"],validFontMIMEs=["font/ttf","font/otf","font/woff","font/woff2"],CSS_IDENT_TOKEN_REGEX=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function getFontFamilyName(url2){const ext=path.extname(url2),nameTokens=path.basename(url2,ext).replace(/(-|_)/g," ").toLowerCase().split(" ").map(word=>word.charAt(0).toUpperCase()+word.slice(1));let valid=nameTokens.length>0;for(const token of nameTokens)if(!token.match(CSS_IDENT_TOKEN_REGEX)){valid=!1;break}let fontFamilyName=nameTokens.join(" ");return valid||(fontFamilyName=`"${fontFamilyName.replace(/[\\"]/g,"\\$&")}"`),fontFamilyName}const validURICharactersRegex=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function encodeURIWhenNeeded(uri){return validURICharactersRegex.test(uri)?uri:encodeURI(uri)}const loadWebFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},name:"loadWebFont",test(url2){return checkDataUrl(url2,validFontMIMEs)||checkExtension(url2,validFontExtensions)},async load(url2,options){var _a2,_b,_c,_d,_e,_f;const fonts=settings.ADAPTER.getFontFaceSet();if(fonts){const fontFaces=[],name=(_b=(_a2=options.data)==null?void 0:_a2.family)!=null?_b:getFontFamilyName(url2),weights=(_e=(_d=(_c=options.data)==null?void 0:_c.weights)==null?void 0:_d.filter(weight=>validWeights.includes(weight)))!=null?_e:["normal"],data=(_f=options.data)!=null?_f:{};for(let i2=0;i2<weights.length;i2++){const weight=weights[i2],font=new FontFace(name,`url(${encodeURIWhenNeeded(url2)})`,__spreadProps$2(__spreadValues$8({},data),{weight}));await font.load(),fonts.add(font),fontFaces.push(font)}return fontFaces.length===1?fontFaces[0]:fontFaces}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(font){(Array.isArray(font)?font:[font]).forEach(t2=>settings.ADAPTER.getFontFaceSet().delete(t2))}};extensions$1.add(loadWebFont);let UUID=0,MAX_WORKERS;const WHITE_PNG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",checkImageBitmapCode={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${WHITE_PNG}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},workerCode={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url, repeatRequestCounter = 0)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        let imageBlob, imageBitmap;

        try 
        {
            imageBlob =  await response.blob();
            imageBitmap = await createImageBitmap(imageBlob);
        } 
        catch(e) 
        {
            const parsedUrl = url.split('?');
            const resourceVersion = parsedUrl.pop().split('&').pop();
            const url2 = parsedUrl.shift();
            const hash = 'v=' + repeatRequestCounter + '&' + resourceVersion;
            repeatRequestCounter++;
            url = url2 + '?' + hash;
            return loadImageBitmap(url, repeatRequestCounter);
        }

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let workerURL;class WorkerManagerClass{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(resolve2=>{const workerURL2=URL.createObjectURL(new Blob([checkImageBitmapCode.code],{type:"application/javascript"})),worker=new Worker(workerURL2);worker.addEventListener("message",event=>{worker.terminate(),URL.revokeObjectURL(workerURL2),resolve2(event.data)})}),this._isImageBitmapSupported)}loadImageBitmap(src){return this._run("loadImageBitmap",[src])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){MAX_WORKERS===void 0&&(MAX_WORKERS=navigator.hardwareConcurrency||4);let worker=this.workerPool.pop();return!worker&&this._createdWorkers<MAX_WORKERS&&(workerURL||(workerURL=URL.createObjectURL(new Blob([workerCode.code],{type:"application/javascript"}))),this._createdWorkers++,worker=new Worker(workerURL),worker.addEventListener("message",event=>{this.complete(event.data),this.returnWorker(event.target),this.next()})),worker}returnWorker(worker){this.workerPool.push(worker)}complete(data){data.error!==void 0?this.resolveHash[data.uuid].reject(data.error):this.resolveHash[data.uuid].resolve(data.data),this.resolveHash[data.uuid]=null}async _run(id,args){await this._initWorkers();const promise2=new Promise((resolve2,reject)=>{this.queue.push({id,arguments:args,resolve:resolve2,reject})});return this.next(),promise2}next(){if(!this.queue.length)return;const worker=this.getWorker();if(!worker)return;const toDo=this.queue.pop(),id=toDo.id;this.resolveHash[UUID]={resolve:toDo.resolve,reject:toDo.reject},worker.postMessage({data:toDo.arguments,uuid:UUID++,id})}}const WorkerManager=new WorkerManagerClass;function createTexture(base,loader,url2){base.resource.internal=!0;const texture=new Texture(base),unload=()=>{delete loader.promiseCache[url2],Cache.has(url2)&&Cache.remove(url2)};return texture.baseTexture.once("destroyed",()=>{url2 in loader.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),unload())}),texture.once("destroyed",()=>{base.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),unload())}),texture}var __defProp$7=Object.defineProperty,__getOwnPropSymbols$7=Object.getOwnPropertySymbols,__hasOwnProp$7=Object.prototype.hasOwnProperty,__propIsEnum$7=Object.prototype.propertyIsEnumerable,__defNormalProp$7=(obj,key,value)=>key in obj?__defProp$7(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$7=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$7.call(b2,prop)&&__defNormalProp$7(a2,prop,b2[prop]);if(__getOwnPropSymbols$7)for(var prop of __getOwnPropSymbols$7(b2))__propIsEnum$7.call(b2,prop)&&__defNormalProp$7(a2,prop,b2[prop]);return a2};const validImageExtensions=[".jpeg",".jpg",".png",".webp",".avif"],validImageMIMEs=["image/jpeg","image/png","image/webp","image/avif"];async function loadImageBitmap(url2,repeatRequestCounter=0){const response=await settings.ADAPTER.fetch(url2);if(!response.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${url2}: ${response.status} ${response.statusText}`);let imageBlob,imageBitmap;try{imageBlob=await response.blob();imageBitmap=await createImageBitmap(imageBlob)}catch(e){const parsedUrl=url2.split("?");const resourceVersion=parsedUrl.pop().split("&").pop();const url=parsedUrl.shift();const hash=`v=${repeatRequestCounter}&${resourceVersion}`;repeatRequestCounter++;url2=`${url}?${hash}`;return loadImageBitmap(url2,repeatRequestCounter)}return imageBitmap}const loadTextures={name:"loadTextures",extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(url2){return checkDataUrl(url2,validImageMIMEs)||checkExtension(url2,validImageExtensions)},async load(url2,asset,loader){var _a2,_b;const useImageBitmap=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let src;useImageBitmap?this.config.preferWorkers&&(await WorkerManager.isImageBitmapSupported())?src=await WorkerManager.loadImageBitmap(url2):src=await loadImageBitmap(url2):src=await new Promise((resolve2,reject)=>{const src2=new Image;src2.crossOrigin=this.config.crossOrigin,src2.src=url2,src2.complete?resolve2(src2):(src2.onload=()=>resolve2(src2),src2.onerror=e2=>reject(e2))});const options=__spreadValues$7({},asset.data);(_a2=options.resolution)!=null||(options.resolution=getResolutionOfUrl(url2)),useImageBitmap&&((_b=options.resourceOptions)==null?void 0:_b.ownsImageBitmap)===void 0&&(options.resourceOptions=__spreadValues$7({},options.resourceOptions),options.resourceOptions.ownsImageBitmap=!0);const base=new BaseTexture(src,options);return base.resource.src=url2,createTexture(base,loader,url2)},unload(texture){texture.destroy(!0)}};extensions$1.add(loadTextures);var __defProp$6=Object.defineProperty,__getOwnPropSymbols$6=Object.getOwnPropertySymbols,__hasOwnProp$6=Object.prototype.hasOwnProperty,__propIsEnum$6=Object.prototype.propertyIsEnumerable,__defNormalProp$6=(obj,key,value)=>key in obj?__defProp$6(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$6=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$6.call(b2,prop)&&__defNormalProp$6(a2,prop,b2[prop]);if(__getOwnPropSymbols$6)for(var prop of __getOwnPropSymbols$6(b2))__propIsEnum$6.call(b2,prop)&&__defNormalProp$6(a2,prop,b2[prop]);return a2};const validSVGExtension=".svg",validSVGMIME="image/svg+xml",loadSVG={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},name:"loadSVG",test(url2){return checkDataUrl(url2,validSVGMIME)||checkExtension(url2,validSVGExtension)},async testParse(data){return SVGResource.test(data)},async parse(asset,data,loader){var _a2;const src=new SVGResource(asset,(_a2=data==null?void 0:data.data)==null?void 0:_a2.resourceOptions);await src.load();const base=new BaseTexture(src,__spreadValues$6({resolution:getResolutionOfUrl(asset)},data==null?void 0:data.data));return base.resource.src=data.src,createTexture(base,loader,data.src)},async load(url2,_options){return(await settings.ADAPTER.fetch(url2)).text()},unload:loadTextures.unload};extensions$1.add(loadSVG);var __defProp$5=Object.defineProperty,__getOwnPropSymbols$5=Object.getOwnPropertySymbols,__hasOwnProp$5=Object.prototype.hasOwnProperty,__propIsEnum$5=Object.prototype.propertyIsEnumerable,__defNormalProp$5=(obj,key,value)=>key in obj?__defProp$5(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$5=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$5.call(b2,prop)&&__defNormalProp$5(a2,prop,b2[prop]);if(__getOwnPropSymbols$5)for(var prop of __getOwnPropSymbols$5(b2))__propIsEnum$5.call(b2,prop)&&__defNormalProp$5(a2,prop,b2[prop]);return a2};const validVideoExtensions=[".mp4",".m4v",".webm",".ogv"],validVideoMIMEs=["video/mp4","video/webm","video/ogg"],loadVideo={name:"loadVideo",extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},config:{defaultAutoPlay:!0},test(url2){return checkDataUrl(url2,validVideoMIMEs)||checkExtension(url2,validVideoExtensions)},async load(url2,loadAsset,loader){var _a2;let texture;const blob=await(await settings.ADAPTER.fetch(url2)).blob(),blobURL=URL.createObjectURL(blob);try{const options=__spreadValues$5({autoPlay:this.config.defaultAutoPlay},(_a2=loadAsset==null?void 0:loadAsset.data)==null?void 0:_a2.resourceOptions),src=new VideoResource(blobURL,options);await src.load();const base=new BaseTexture(src,__spreadValues$5({alphaMode:await detectVideoAlphaMode(),resolution:getResolutionOfUrl(url2)},loadAsset==null?void 0:loadAsset.data));base.resource.src=url2,texture=createTexture(base,loader,url2),texture.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(blobURL)})}catch(e2){throw URL.revokeObjectURL(blobURL),e2}return texture},unload(texture){texture.destroy(!0)}};extensions$1.add(loadVideo);var __defProp$4=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$4=Object.getOwnPropertySymbols,__hasOwnProp$4=Object.prototype.hasOwnProperty,__propIsEnum$4=Object.prototype.propertyIsEnumerable,__defNormalProp$4=(obj,key,value)=>key in obj?__defProp$4(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$4=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$4.call(b2,prop)&&__defNormalProp$4(a2,prop,b2[prop]);if(__getOwnPropSymbols$4)for(var prop of __getOwnPropSymbols$4(b2))__propIsEnum$4.call(b2,prop)&&__defNormalProp$4(a2,prop,b2[prop]);return a2},__spreadProps$1=(a2,b2)=>__defProps$1(a2,__getOwnPropDescs$1(b2));class Resolver{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(bundleId,assetId)=>`${bundleId}${this._bundleIdConnector}${assetId}`,extractAssetIdFromBundle:(bundleId,assetBundleId)=>assetBundleId.replace(`${bundleId}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(bundleIdentifier){var _a2,_b,_c;if(this._bundleIdConnector=(_a2=bundleIdentifier.connector)!=null?_a2:this._bundleIdConnector,this._createBundleAssetId=(_b=bundleIdentifier.createBundleAssetId)!=null?_b:this._createBundleAssetId,this._extractAssetIdFromBundle=(_c=bundleIdentifier.extractAssetIdFromBundle)!=null?_c:this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...preferOrders){preferOrders.forEach(prefer=>{this._preferredOrder.push(prefer),prefer.priority||(prefer.priority=Object.keys(prefer.params))}),this._resolverHash={}}set basePath(basePath){this._basePath=basePath}get basePath(){return this._basePath}set rootPath(rootPath){this._rootPath=rootPath}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(searchParams){if(typeof searchParams=="string")this._defaultSearchParams=searchParams;else{const queryValues=searchParams;this._defaultSearchParams=Object.keys(queryValues).map(key=>`${encodeURIComponent(key)}=${encodeURIComponent(queryValues[key])}`).join("&")}}getAlias(asset){const{alias,name,src,srcs}=asset;return convertToList(alias||name||src||srcs,value=>{var _a2;return typeof value=="string"?value:Array.isArray(value)?value.map(v2=>{var _a22,_b;return(_b=(_a22=v2==null?void 0:v2.src)!=null?_a22:v2==null?void 0:v2.srcs)!=null?_b:v2}):value!=null&&value.src||value!=null&&value.srcs?(_a2=value.src)!=null?_a2:value.srcs:value},!0)}addManifest(manifest){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=manifest,manifest.bundles.forEach(bundle=>{this.addBundle(bundle.name,bundle.assets)})}addBundle(bundleId,assets){const assetNames=[];Array.isArray(assets)?assets.forEach(asset=>{var _a2,_b;const srcs=(_a2=asset.src)!=null?_a2:asset.srcs,aliases=(_b=asset.alias)!=null?_b:asset.name;let ids;if(typeof aliases=="string"){const bundleAssetId=this._createBundleAssetId(bundleId,aliases);assetNames.push(bundleAssetId),ids=[aliases,bundleAssetId]}else{const bundleIds=aliases.map(name=>this._createBundleAssetId(bundleId,name));assetNames.push(...bundleIds),ids=[...aliases,...bundleIds]}this.add(__spreadProps$1(__spreadValues$4({},asset),{alias:ids,src:srcs}))}):Object.keys(assets).forEach(key=>{var _a2;const aliases=[key,this._createBundleAssetId(bundleId,key)];if(typeof assets[key]=="string")this.add({alias:aliases,src:assets[key]});else if(Array.isArray(assets[key]))this.add({alias:aliases,src:assets[key]});else{const asset=assets[key],assetSrc=(_a2=asset.src)!=null?_a2:asset.srcs;this.add(__spreadProps$1(__spreadValues$4({},asset),{alias:aliases,src:Array.isArray(assetSrc)?assetSrc:[assetSrc]}))}assetNames.push(...aliases)}),this._bundles[bundleId]=assetNames}add(aliases,srcs,data,format2,loadParser){const assets=[];typeof aliases=="string"||Array.isArray(aliases)&&typeof aliases[0]=="string"?(deprecation$1("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),assets.push({alias:aliases,src:srcs,data,format:format2,loadParser})):Array.isArray(aliases)?assets.push(...aliases):assets.push(aliases);let keyCheck;keyCheck=key=>{this.hasKey(key)&&console.warn(`[Resolver] already has key: ${key} overwriting`)},convertToList(assets).forEach(asset=>{const{src,srcs:srcs2}=asset;let{data:data2,format:format22,loadParser:loadParser2}=asset;const srcsToUse=convertToList(src||srcs2).map(src2=>typeof src2=="string"?createStringVariations(src2):Array.isArray(src2)?src2:[src2]),aliasesToUse=this.getAlias(asset);Array.isArray(aliasesToUse)?aliasesToUse.forEach(keyCheck):keyCheck(aliasesToUse);const resolvedAssets=[];srcsToUse.forEach(srcs3=>{srcs3.forEach(src2=>{var _a2,_b,_c;let formattedAsset={};if(typeof src2!="object"){formattedAsset.src=src2;for(let i2=0;i2<this._parsers.length;i2++){const parser=this._parsers[i2];if(parser.test(src2)){formattedAsset=parser.parse(src2);break}}}else data2=(_a2=src2.data)!=null?_a2:data2,format22=(_b=src2.format)!=null?_b:format22,loadParser2=(_c=src2.loadParser)!=null?_c:loadParser2,formattedAsset=__spreadValues$4(__spreadValues$4({},formattedAsset),src2);if(!aliasesToUse)throw new Error(`[Resolver] alias is undefined for this asset: ${formattedAsset.src}`);formattedAsset=this.buildResolvedAsset(formattedAsset,{aliases:aliasesToUse,data:data2,format:format22,loadParser:loadParser2}),resolvedAssets.push(formattedAsset)})}),aliasesToUse.forEach(alias=>{this._assetMap[alias]=resolvedAssets})})}resolveBundle(bundleIds){const singleAsset=isSingleItem(bundleIds);bundleIds=convertToList(bundleIds);const out={};return bundleIds.forEach(bundleId=>{const assetNames=this._bundles[bundleId];if(assetNames){const results=this.resolve(assetNames),assets={};for(const key in results){const asset=results[key];assets[this._extractAssetIdFromBundle(bundleId,key)]=asset}out[bundleId]=assets}}),singleAsset?out[bundleIds[0]]:out}resolveUrl(key){const result=this.resolve(key);if(typeof key!="string"){const out={};for(const i2 in result)out[i2]=result[i2].src;return out}return result.src}resolve(keys){const singleAsset=isSingleItem(keys);keys=convertToList(keys);const result={};return keys.forEach(key=>{var _a2;if(!this._resolverHash[key])if(this._assetMap[key]){let assets=this._assetMap[key];const bestAsset=assets[0],preferredOrder=this._getPreferredOrder(assets);preferredOrder==null||preferredOrder.priority.forEach(priorityKey=>{preferredOrder.params[priorityKey].forEach(value=>{const filteredAssets=assets.filter(asset=>asset[priorityKey]?asset[priorityKey]===value:!1);filteredAssets.length&&(assets=filteredAssets)})}),this._resolverHash[key]=(_a2=assets[0])!=null?_a2:bestAsset}else this._resolverHash[key]=this.buildResolvedAsset({alias:[key],src:key},{});result[key]=this._resolverHash[key]}),singleAsset?result[keys[0]]:result}hasKey(key){return!!this._assetMap[key]}hasBundle(key){return!!this._bundles[key]}_getPreferredOrder(assets){for(let i2=0;i2<assets.length;i2++){const asset=assets[0],preferred=this._preferredOrder.find(preference=>preference.params.format.includes(asset.format));if(preferred)return preferred}return this._preferredOrder[0]}_appendDefaultSearchParams(url2){if(!this._defaultSearchParams)return url2;const paramConnector=/\?/.test(url2)?"&":"?";return`${url2}${paramConnector}${this._defaultSearchParams}`}buildResolvedAsset(formattedAsset,data){var _a2;const{aliases,data:assetData,loadParser,format:format2}=data;return(this._basePath||this._rootPath)&&(formattedAsset.src=path.toAbsolute(formattedAsset.src,this._basePath,this._rootPath)),formattedAsset.alias=(_a2=aliases!=null?aliases:formattedAsset.alias)!=null?_a2:[formattedAsset.src],formattedAsset.src=this._appendDefaultSearchParams(formattedAsset.src),formattedAsset.data=__spreadValues$4(__spreadValues$4({},assetData||{}),formattedAsset.data),formattedAsset.loadParser=loadParser!=null?loadParser:formattedAsset.loadParser,formattedAsset.format=format2!=null?format2:path.extname(formattedAsset.src).slice(1),formattedAsset.srcs=formattedAsset.src,formattedAsset.name=formattedAsset.alias,formattedAsset}}class AssetsClass{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Resolver,this.loader=new Loader,this.cache=Cache,this._backgroundLoader=new BackgroundLoader(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(options={}){var _a2,_b,_c;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,options.defaultSearchParams&&this.resolver.setDefaultSearchParams(options.defaultSearchParams),options.basePath&&(this.resolver.basePath=options.basePath),options.bundleIdentifier&&this.resolver.setBundleIdentifier(options.bundleIdentifier),options.manifest){let manifest=options.manifest;typeof manifest=="string"&&(manifest=await this.load(manifest)),this.resolver.addManifest(manifest)}const resolutionPref=(_b=(_a2=options.texturePreference)==null?void 0:_a2.resolution)!=null?_b:1,resolution=typeof resolutionPref=="number"?[resolutionPref]:resolutionPref,formats2=await this._detectFormats({preferredFormats:(_c=options.texturePreference)==null?void 0:_c.format,skipDetections:options.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:formats2,resolution}}),options.preferences&&this.setPreferences(options.preferences)}add(aliases,srcs,data,format2,loadParser){this.resolver.add(aliases,srcs,data,format2,loadParser)}async load(urls,onProgress){this._initialized||(await this.init());const singleAsset=isSingleItem(urls),urlArray=convertToList(urls).map(url2=>{if(typeof url2!="string"){const aliases=this.resolver.getAlias(url2);return aliases.some(alias=>!this.resolver.hasKey(alias))&&this.add(url2),Array.isArray(aliases)?aliases[0]:aliases}return this.resolver.hasKey(url2)||this.add({alias:url2,src:url2}),url2}),resolveResults=this.resolver.resolve(urlArray),out=await this._mapLoadToResolve(resolveResults,onProgress);return singleAsset?out[urlArray[0]]:out}addBundle(bundleId,assets){this.resolver.addBundle(bundleId,assets)}async loadBundle(bundleIds,onProgress){this._initialized||(await this.init());let singleAsset=!1;typeof bundleIds=="string"&&(singleAsset=!0,bundleIds=[bundleIds]);const resolveResults=this.resolver.resolveBundle(bundleIds),out={},keys=Object.keys(resolveResults);let count=0,total=0;const _onProgress=()=>{onProgress==null||onProgress(++count/total)},promises=keys.map(bundleId=>{const resolveResult=resolveResults[bundleId];return total+=Object.keys(resolveResult).length,this._mapLoadToResolve(resolveResult,_onProgress).then(resolveResult2=>{out[bundleId]=resolveResult2})});return await Promise.all(promises),singleAsset?out[bundleIds[0]]:out}async backgroundLoad(urls){this._initialized||(await this.init()),typeof urls=="string"&&(urls=[urls]);const resolveResults=this.resolver.resolve(urls);this._backgroundLoader.add(Object.values(resolveResults))}async backgroundLoadBundle(bundleIds){this._initialized||(await this.init()),typeof bundleIds=="string"&&(bundleIds=[bundleIds]);const resolveResults=this.resolver.resolveBundle(bundleIds);Object.values(resolveResults).forEach(resolveResult=>{this._backgroundLoader.add(Object.values(resolveResult))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(keys){if(typeof keys=="string")return Cache.get(keys);const assets={};for(let i2=0;i2<keys.length;i2++)assets[i2]=Cache.get(keys[i2]);return assets}async _mapLoadToResolve(resolveResults,onProgress){const resolveArray=Object.values(resolveResults),resolveKeys=Object.keys(resolveResults);this._backgroundLoader.active=!1;const loadedAssets=await this.loader.load(resolveArray,onProgress);this._backgroundLoader.active=!0;const out={};return resolveArray.forEach((resolveResult,i2)=>{const asset=loadedAssets[resolveResult.src],keys=[resolveResult.src];resolveResult.alias&&keys.push(...resolveResult.alias),out[resolveKeys[i2]]=asset,Cache.set(keys,asset)}),out}async unload(urls){this._initialized||(await this.init());const urlArray=convertToList(urls).map(url2=>typeof url2!="string"?url2.src:url2),resolveResults=this.resolver.resolve(urlArray);await this._unloadFromResolved(resolveResults)}async unloadBundle(bundleIds){this._initialized||(await this.init()),bundleIds=convertToList(bundleIds);const resolveResults=this.resolver.resolveBundle(bundleIds),promises=Object.keys(resolveResults).map(bundleId=>this._unloadFromResolved(resolveResults[bundleId]));await Promise.all(promises)}async _unloadFromResolved(resolveResult){const resolveArray=Object.values(resolveResult);resolveArray.forEach(resolveResult2=>{Cache.remove(resolveResult2.src)}),await this.loader.unload(resolveArray)}async _detectFormats(options){let formats2=[];options.preferredFormats&&(formats2=Array.isArray(options.preferredFormats)?options.preferredFormats:[options.preferredFormats]);for(const detection of options.detections)options.skipDetections||(await detection.test())?formats2=await detection.add(formats2):options.skipDetections||(formats2=await detection.remove(formats2));return formats2=formats2.filter((format2,index)=>formats2.indexOf(format2)===index),formats2}get detections(){return this._detections}get preferWorkers(){return loadTextures.config.preferWorkers}set preferWorkers(value){deprecation$1("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:value})}setPreferences(preferences){this.loader.parsers.forEach(parser=>{parser.config&&Object.keys(parser.config).filter(key=>key in preferences).forEach(key=>{parser.config[key]=preferences[key]})})}}const Assets=new AssetsClass;extensions$1.handleByList(ExtensionType.LoadParser,Assets.loader.parsers).handleByList(ExtensionType.ResolveParser,Assets.resolver.parsers).handleByList(ExtensionType.CacheParser,Assets.cache.parsers).handleByList(ExtensionType.DetectionParser,Assets.detections);const cacheTextureArray={extension:ExtensionType.CacheParser,test:asset=>Array.isArray(asset)&&asset.every(t2=>t2 instanceof Texture),getCacheableAssets:(keys,asset)=>{const out={};return keys.forEach(key=>{asset.forEach((item,i2)=>{out[key+(i2===0?"":i2+1)]=item})}),out}};extensions$1.add(cacheTextureArray);async function testImageFormat(imageData){if("Image"in globalThis)return new Promise(resolve2=>{const image=new Image;image.onload=()=>{resolve2(!0)},image.onerror=()=>{resolve2(!1)},image.src=imageData});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const blob=await(await fetch(imageData)).blob();await createImageBitmap(blob)}catch(e2){return!1}return!0}return!1}const detectAvif={extension:{type:ExtensionType.DetectionParser,priority:1},test:async()=>testImageFormat("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async formats2=>[...formats2,"avif"],remove:async formats2=>formats2.filter(f2=>f2!=="avif")};extensions$1.add(detectAvif);const detectWebp={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>testImageFormat("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async formats2=>[...formats2,"webp"],remove:async formats2=>formats2.filter(f2=>f2!=="webp")};extensions$1.add(detectWebp);const imageFormats=["png","jpg","jpeg"],detectDefaults={extension:{type:ExtensionType.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async formats2=>[...formats2,...imageFormats],remove:async formats2=>formats2.filter(f2=>!imageFormats.includes(f2))};extensions$1.add(detectDefaults);const inWorker="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function testVideoFormat(mimeType){return inWorker?!1:document.createElement("video").canPlayType(mimeType)!==""}const detectWebm={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>testVideoFormat("video/webm"),add:async formats2=>[...formats2,"webm"],remove:async formats2=>formats2.filter(f2=>f2!=="webm")};extensions$1.add(detectWebm);const detectMp4={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>testVideoFormat("video/mp4"),add:async formats2=>[...formats2,"mp4","m4v"],remove:async formats2=>formats2.filter(f2=>f2!=="mp4"&&f2!=="m4v")};extensions$1.add(detectMp4);const detectOgv={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>testVideoFormat("video/ogg"),add:async formats2=>[...formats2,"ogv"],remove:async formats2=>formats2.filter(f2=>f2!=="ogv")};extensions$1.add(detectOgv);const resolveTextureUrl={extension:ExtensionType.ResolveParser,test:loadTextures.test,parse:value=>{var _a2,_b;return{resolution:parseFloat((_b=(_a2=settings.RETINA_PREFIX.exec(value))==null?void 0:_a2[1])!=null?_b:"1"),format:path.extname(value).slice(1),src:value}}};extensions$1.add(resolveTextureUrl);var INTERNAL_FORMATS=(INTERNAL_FORMATS2=>(INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",INTERNAL_FORMATS2[INTERNAL_FORMATS2.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",INTERNAL_FORMATS2))(INTERNAL_FORMATS||{});const INTERNAL_FORMAT_TO_BYTES_PER_PIXEL={33776:0.5,33777:0.5,33778:1,33779:1,35916:0.5,35917:0.5,35918:1,35919:1,37488:0.5,37489:0.5,37490:1,37491:1,37492:0.5,37496:1,37493:0.5,37497:1,37494:0.5,37495:0.5,35840:0.5,35842:0.5,35841:0.25,35843:0.25,36196:0.5,35986:0.5,35987:1,34798:1,37808:1};let storedGl,extensions;function getCompressedTextureExtensions(){extensions={s3tc:storedGl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:storedGl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:storedGl.getExtension("WEBGL_compressed_texture_etc"),etc1:storedGl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:storedGl.getExtension("WEBGL_compressed_texture_pvrtc")||storedGl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:storedGl.getExtension("WEBGL_compressed_texture_atc"),astc:storedGl.getExtension("WEBGL_compressed_texture_astc")}}const detectCompressedTextures={extension:{type:ExtensionType.DetectionParser,priority:2},test:async()=>{const gl=settings.ADAPTER.createCanvas().getContext("webgl");return gl?(storedGl=gl,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async formats2=>{extensions||getCompressedTextureExtensions();const textureFormats=[];for(const extensionName in extensions)extensions[extensionName]&&textureFormats.push(extensionName);return[...textureFormats,...formats2]},remove:async formats2=>(extensions||getCompressedTextureExtensions(),formats2.filter(f2=>!(f2 in extensions)))};extensions$1.add(detectCompressedTextures);class BlobResource extends BufferResource{constructor(source,options={width:1,height:1,autoLoad:!0}){let origin,data;typeof source=="string"?(origin=source,data=new Uint8Array):(origin=null,data=source),super(data,options),this.origin=origin,this.buffer=data?new ViewableBuffer(data):null,this._load=null,this.loaded=!1,this.origin!==null&&options.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(_data){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(response=>response.blob()).then(blob=>blob.arrayBuffer()).then(arrayBuffer=>(this.data=new Uint32Array(arrayBuffer),this.buffer=new ViewableBuffer(arrayBuffer),this.loaded=!0,this.onBlobLoaded(arrayBuffer),this.update(),this)),this._load)}}class CompressedTextureResource extends BlobResource{constructor(source,options){super(source,options),this.format=options.format,this.levels=options.levels||1,this._width=options.width,this._height=options.height,this._extension=CompressedTextureResource._formatToExtension(this.format),(options.levelBuffers||this.buffer)&&(this._levelBuffers=options.levelBuffers||CompressedTextureResource._createLevelBuffers(source instanceof Uint8Array?source:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(renderer,_texture,_glTexture){const gl=renderer.gl;if(!renderer.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;gl.pixelStorei(gl.UNPACK_ALIGNMENT,4);for(let i2=0,j2=this.levels;i2<j2;i2++){const{levelID,levelWidth,levelHeight,levelBuffer}=this._levelBuffers[i2];gl.compressedTexImage2D(gl.TEXTURE_2D,levelID,this.format,levelWidth,levelHeight,0,levelBuffer)}return!0}onBlobLoaded(){this._levelBuffers=CompressedTextureResource._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(format2){if(format2>=33776&&format2<=33779)return"s3tc";if(format2>=37488&&format2<=37497)return"etc";if(format2>=35840&&format2<=35843)return"pvrtc";if(format2>=36196)return"etc1";if(format2>=35986&&format2<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(buffer,format2,levels,blockWidth,blockHeight,imageWidth,imageHeight){const buffers=new Array(levels);let offset=buffer.byteOffset,levelWidth=imageWidth,levelHeight=imageHeight,alignedLevelWidth=levelWidth+blockWidth-1&~(blockWidth-1),alignedLevelHeight=levelHeight+blockHeight-1&~(blockHeight-1),levelSize=alignedLevelWidth*alignedLevelHeight*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[format2];for(let i2=0;i2<levels;i2++)buffers[i2]={levelID:i2,levelWidth:levels>1?levelWidth:alignedLevelWidth,levelHeight:levels>1?levelHeight:alignedLevelHeight,levelBuffer:new Uint8Array(buffer.buffer,offset,levelSize)},offset+=levelSize,levelWidth=levelWidth>>1||1,levelHeight=levelHeight>>1||1,alignedLevelWidth=levelWidth+blockWidth-1&~(blockWidth-1),alignedLevelHeight=levelHeight+blockHeight-1&~(blockHeight-1),levelSize=alignedLevelWidth*alignedLevelHeight*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[format2];return buffers}}const DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT={[FOURCC_DXT1]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[FOURCC_DXT3]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[FOURCC_DXT5]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT},DXGI_TO_FORMAT={70:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function parseDDS(arrayBuffer){const data=new Uint32Array(arrayBuffer);if(data[0]!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");const header=new Uint32Array(arrayBuffer,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),height=header[DDS_FIELDS.HEIGHT],width=header[DDS_FIELDS.WIDTH],mipmapCount=header[DDS_FIELDS.MIPMAP_COUNT],pixelFormat=new Uint32Array(arrayBuffer,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),formatFlags=pixelFormat[PF_FLAGS];if(formatFlags&DDPF_FOURCC){const fourCC=pixelFormat[DDS_PF_FIELDS.FOURCC];if(fourCC!==FOURCC_DX10){const internalFormat2=FOURCC_TO_FORMAT[fourCC],dataOffset2=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,texData=new Uint8Array(arrayBuffer,dataOffset2);return[new CompressedTextureResource(texData,{format:internalFormat2,width,height,levels:mipmapCount})]}const dx10Offset=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,dx10Header=new Uint32Array(data.buffer,dx10Offset,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),dxgiFormat=dx10Header[DDS_DX10_FIELDS.DXGI_FORMAT],resourceDimension=dx10Header[DDS_DX10_FIELDS.RESOURCE_DIMENSION],miscFlag=dx10Header[DDS_DX10_FIELDS.MISC_FLAG],arraySize=dx10Header[DDS_DX10_FIELDS.ARRAY_SIZE],internalFormat=DXGI_TO_FORMAT[dxgiFormat];if(internalFormat===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${dxgiFormat}`);if(miscFlag===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(resourceDimension===6)throw new Error("DDSParser does not supported 3D texture data");const imageBuffers=new Array,dataOffset=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(arraySize===1)imageBuffers.push(new Uint8Array(arrayBuffer,dataOffset));else{const pixelSize=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[internalFormat];let imageSize=0,levelWidth=width,levelHeight=height;for(let i2=0;i2<mipmapCount;i2++){const alignedLevelWidth=Math.max(1,levelWidth+3&-4),alignedLevelHeight=Math.max(1,levelHeight+3&-4),levelSize=alignedLevelWidth*alignedLevelHeight*pixelSize;imageSize+=levelSize,levelWidth=levelWidth>>>1,levelHeight=levelHeight>>>1}let imageOffset=dataOffset;for(let i2=0;i2<arraySize;i2++)imageBuffers.push(new Uint8Array(arrayBuffer,imageOffset,imageSize)),imageOffset+=imageSize}return imageBuffers.map(buffer=>new CompressedTextureResource(buffer,{format:internalFormat,width,height,levels:mipmapCount}))}throw formatFlags&DDPF_RGB?new Error("DDSParser does not support uncompressed texture data."):formatFlags&DDPF_YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):formatFlags&DDPF_LUMINANCE?new Error("DDSParser does not support single-channel (lumninance) texture data!"):formatFlags&DDPF_ALPHA?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT={[TYPES.UNSIGNED_BYTE]:1,[TYPES.UNSIGNED_SHORT]:2,[TYPES.INT]:4,[TYPES.UNSIGNED_INT]:4,[TYPES.FLOAT]:4,[TYPES.HALF_FLOAT]:8},FORMATS_TO_COMPONENTS={[FORMATS.RGBA]:4,[FORMATS.RGB]:3,[FORMATS.RG]:2,[FORMATS.RED]:1,[FORMATS.LUMINANCE]:1,[FORMATS.LUMINANCE_ALPHA]:2,[FORMATS.ALPHA]:1},TYPES_TO_BYTES_PER_PIXEL={[TYPES.UNSIGNED_SHORT_4_4_4_4]:2,[TYPES.UNSIGNED_SHORT_5_5_5_1]:2,[TYPES.UNSIGNED_SHORT_5_6_5]:2};function parseKTX(url2,arrayBuffer,loadKeyValueData=!1){const dataView=new DataView(arrayBuffer);if(!validate(url2,dataView))return null;const littleEndian=dataView.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,glType=dataView.getUint32(KTX_FIELDS.GL_TYPE,littleEndian),glFormat=dataView.getUint32(KTX_FIELDS.GL_FORMAT,littleEndian),glInternalFormat=dataView.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,littleEndian),pixelWidth=dataView.getUint32(KTX_FIELDS.PIXEL_WIDTH,littleEndian),pixelHeight=dataView.getUint32(KTX_FIELDS.PIXEL_HEIGHT,littleEndian)||1,pixelDepth=dataView.getUint32(KTX_FIELDS.PIXEL_DEPTH,littleEndian)||1,numberOfArrayElements=dataView.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,littleEndian)||1,numberOfFaces=dataView.getUint32(KTX_FIELDS.NUMBER_OF_FACES,littleEndian),numberOfMipmapLevels=dataView.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,littleEndian),bytesOfKeyValueData=dataView.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,littleEndian);if(pixelHeight===0||pixelDepth!==1)throw new Error("Only 2D textures are supported");if(numberOfFaces!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(numberOfArrayElements!==1)throw new Error("WebGL does not support array textures");const blockWidth=4,blockHeight=4,alignedWidth=pixelWidth+3&-4,alignedHeight=pixelHeight+3&-4,imageBuffers=new Array(numberOfArrayElements);let imagePixels=pixelWidth*pixelHeight;glType===0&&(imagePixels=alignedWidth*alignedHeight);let imagePixelByteSize;if(glType!==0?TYPES_TO_BYTES_PER_COMPONENT[glType]?imagePixelByteSize=TYPES_TO_BYTES_PER_COMPONENT[glType]*FORMATS_TO_COMPONENTS[glFormat]:imagePixelByteSize=TYPES_TO_BYTES_PER_PIXEL[glType]:imagePixelByteSize=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[glInternalFormat],imagePixelByteSize===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const kvData=loadKeyValueData?parseKvData(dataView,bytesOfKeyValueData,littleEndian):null;let mipByteSize=imagePixels*imagePixelByteSize,mipWidth=pixelWidth,mipHeight=pixelHeight,alignedMipWidth=alignedWidth,alignedMipHeight=alignedHeight,imageOffset=FILE_HEADER_SIZE+bytesOfKeyValueData;for(let mipmapLevel=0;mipmapLevel<numberOfMipmapLevels;mipmapLevel++){const imageSize=dataView.getUint32(imageOffset,littleEndian);let elementOffset=imageOffset+4;for(let arrayElement=0;arrayElement<numberOfArrayElements;arrayElement++){let mips=imageBuffers[arrayElement];mips||(mips=imageBuffers[arrayElement]=new Array(numberOfMipmapLevels)),mips[mipmapLevel]={levelID:mipmapLevel,levelWidth:numberOfMipmapLevels>1||glType!==0?mipWidth:alignedMipWidth,levelHeight:numberOfMipmapLevels>1||glType!==0?mipHeight:alignedMipHeight,levelBuffer:new Uint8Array(arrayBuffer,elementOffset,mipByteSize)},elementOffset+=mipByteSize}imageOffset+=imageSize+4,imageOffset=imageOffset%4!==0?imageOffset+4-imageOffset%4:imageOffset,mipWidth=mipWidth>>1||1,mipHeight=mipHeight>>1||1,alignedMipWidth=mipWidth+blockWidth-1&~(blockWidth-1),alignedMipHeight=mipHeight+blockHeight-1&~(blockHeight-1),mipByteSize=alignedMipWidth*alignedMipHeight*imagePixelByteSize}return glType!==0?{uncompressed:imageBuffers.map(levelBuffers=>{let buffer=levelBuffers[0].levelBuffer,convertToInt=!1;return glType===TYPES.FLOAT?buffer=new Float32Array(levelBuffers[0].levelBuffer.buffer,levelBuffers[0].levelBuffer.byteOffset,levelBuffers[0].levelBuffer.byteLength/4):glType===TYPES.UNSIGNED_INT?(convertToInt=!0,buffer=new Uint32Array(levelBuffers[0].levelBuffer.buffer,levelBuffers[0].levelBuffer.byteOffset,levelBuffers[0].levelBuffer.byteLength/4)):glType===TYPES.INT&&(convertToInt=!0,buffer=new Int32Array(levelBuffers[0].levelBuffer.buffer,levelBuffers[0].levelBuffer.byteOffset,levelBuffers[0].levelBuffer.byteLength/4)),{resource:new BufferResource(buffer,{width:levelBuffers[0].levelWidth,height:levelBuffers[0].levelHeight}),type:glType,format:convertToInt?convertFormatToInteger(glFormat):glFormat}}),kvData}:{compressed:imageBuffers.map(levelBuffers=>new CompressedTextureResource(null,{format:glInternalFormat,width:pixelWidth,height:pixelHeight,levels:numberOfMipmapLevels,levelBuffers})),kvData}}function validate(url2,dataView){for(let i2=0;i2<FILE_IDENTIFIER.length;i2++)if(dataView.getUint8(i2)!==FILE_IDENTIFIER[i2])return console.error(`${url2} is not a valid *.ktx file!`),!1;return!0}function convertFormatToInteger(format2){switch(format2){case FORMATS.RGBA:return FORMATS.RGBA_INTEGER;case FORMATS.RGB:return FORMATS.RGB_INTEGER;case FORMATS.RG:return FORMATS.RG_INTEGER;case FORMATS.RED:return FORMATS.RED_INTEGER;default:return format2}}function parseKvData(dataView,bytesOfKeyValueData,littleEndian){const kvData=new Map;let bytesIntoKeyValueData=0;for(;bytesIntoKeyValueData<bytesOfKeyValueData;){const keyAndValueByteSize=dataView.getUint32(FILE_HEADER_SIZE+bytesIntoKeyValueData,littleEndian),keyAndValueByteOffset=FILE_HEADER_SIZE+bytesIntoKeyValueData+4,valuePadding=3-(keyAndValueByteSize+3)%4;if(keyAndValueByteSize===0||keyAndValueByteSize>bytesOfKeyValueData-bytesIntoKeyValueData){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let keyNulByte=0;for(;keyNulByte<keyAndValueByteSize&&dataView.getUint8(keyAndValueByteOffset+keyNulByte)!==0;keyNulByte++);if(keyNulByte===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const key=new TextDecoder().decode(new Uint8Array(dataView.buffer,keyAndValueByteOffset,keyNulByte)),value=new DataView(dataView.buffer,keyAndValueByteOffset+keyNulByte+1,keyAndValueByteSize-keyNulByte-1);kvData.set(key,value),bytesIntoKeyValueData+=4+keyAndValueByteSize+valuePadding}return kvData}var __defProp$3=Object.defineProperty,__getOwnPropSymbols$3=Object.getOwnPropertySymbols,__hasOwnProp$3=Object.prototype.hasOwnProperty,__propIsEnum$3=Object.prototype.propertyIsEnumerable,__defNormalProp$3=(obj,key,value)=>key in obj?__defProp$3(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$3=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$3.call(b2,prop)&&__defNormalProp$3(a2,prop,b2[prop]);if(__getOwnPropSymbols$3)for(var prop of __getOwnPropSymbols$3(b2))__propIsEnum$3.call(b2,prop)&&__defNormalProp$3(a2,prop,b2[prop]);return a2};const loadDDS={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},name:"loadDDS",test(url2){return checkExtension(url2,".dds")},async load(url2,asset,loader){const arrayBuffer=await(await settings.ADAPTER.fetch(url2)).arrayBuffer(),textures=parseDDS(arrayBuffer).map(resource=>{const base=new BaseTexture(resource,__spreadValues$3({mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(url2)},asset.data));return createTexture(base,loader,url2)});return textures.length===1?textures[0]:textures},unload(texture){Array.isArray(texture)?texture.forEach(t2=>t2.destroy(!0)):texture.destroy(!0)}};extensions$1.add(loadDDS);var __defProp$2=Object.defineProperty,__getOwnPropSymbols$2=Object.getOwnPropertySymbols,__hasOwnProp$2=Object.prototype.hasOwnProperty,__propIsEnum$2=Object.prototype.propertyIsEnumerable,__defNormalProp$2=(obj,key,value)=>key in obj?__defProp$2(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$2=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$2.call(b2,prop)&&__defNormalProp$2(a2,prop,b2[prop]);if(__getOwnPropSymbols$2)for(var prop of __getOwnPropSymbols$2(b2))__propIsEnum$2.call(b2,prop)&&__defNormalProp$2(a2,prop,b2[prop]);return a2};const loadKTX={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},name:"loadKTX",test(url2){return checkExtension(url2,".ktx")},async load(url2,asset,loader){const arrayBuffer=await(await settings.ADAPTER.fetch(url2)).arrayBuffer(),{compressed,uncompressed,kvData}=parseKTX(url2,arrayBuffer),resources=compressed!=null?compressed:uncompressed,options=__spreadValues$2({mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(url2)},asset.data),textures=resources.map(resource=>{var _a2;resources===uncompressed&&Object.assign(options,{type:resource.type,format:resource.format});const res=(_a2=resource.resource)!=null?_a2:resource,base=new BaseTexture(res,options);return base.ktxKeyValueData=kvData,createTexture(base,loader,url2)});return textures.length===1?textures[0]:textures},unload(texture){Array.isArray(texture)?texture.forEach(t2=>t2.destroy(!0)):texture.destroy(!0)}};extensions$1.add(loadKTX);const resolveCompressedTextureUrl={extension:ExtensionType.ResolveParser,test:value=>{const extension=path.extname(value).slice(1);return["basis","ktx","dds"].includes(extension)},parse:value=>{var _a2,_b,_c,_d;const extension=path.extname(value).slice(1);if(extension==="ktx"){const extensions2=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(extensions2.some(ext=>value.endsWith(ext)))return{resolution:parseFloat((_b=(_a2=settings.RETINA_PREFIX.exec(value))==null?void 0:_a2[1])!=null?_b:"1"),format:extensions2.find(ext=>value.endsWith(ext)),src:value}}return{resolution:parseFloat((_d=(_c=settings.RETINA_PREFIX.exec(value))==null?void 0:_c[1])!=null?_d:"1"),format:extension,src:value}}};extensions$1.add(resolveCompressedTextureUrl);const TEMP_RECT$1=new Rectangle,BYTES_PER_PIXEL=4,_Extract=class _Extract2{constructor(renderer){this.renderer=renderer,this._rendererPremultipliedAlpha=!1}contextChange(){var _a2;const attributes=(_a2=this.renderer)==null?void 0:_a2.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(attributes&&attributes.alpha&&attributes.premultipliedAlpha)}async image(target,format2,quality,frame){const image=new Image;return image.src=await this.base64(target,format2,quality,frame),image}async base64(target,format2,quality,frame){const canvas=this.canvas(target,frame);if(canvas.toBlob!==void 0)return new Promise((resolve2,reject)=>{canvas.toBlob(blob=>{if(!blob){reject(new Error("ICanvas.toBlob failed!"));return}const reader=new FileReader;reader.onload=()=>resolve2(reader.result),reader.onerror=reject,reader.readAsDataURL(blob)},format2,quality)});if(canvas.toDataURL!==void 0)return canvas.toDataURL(format2,quality);if(canvas.convertToBlob!==void 0){const blob=await canvas.convertToBlob({type:format2,quality});return new Promise((resolve2,reject)=>{const reader=new FileReader;reader.onload=()=>resolve2(reader.result),reader.onerror=reject,reader.readAsDataURL(blob)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(target,frame){const{pixels,width,height,flipY,premultipliedAlpha}=this._rawPixels(target,frame);flipY&&_Extract2._flipY(pixels,width,height),premultipliedAlpha&&_Extract2._unpremultiplyAlpha(pixels);const canvasBuffer=new CanvasRenderTarget(width,height,1),imageData=new ImageData(new Uint8ClampedArray(pixels.buffer),width,height);return canvasBuffer.context.putImageData(imageData,0,0),canvasBuffer.canvas}pixels(target,frame){const{pixels,width,height,flipY,premultipliedAlpha}=this._rawPixels(target,frame);return flipY&&_Extract2._flipY(pixels,width,height),premultipliedAlpha&&_Extract2._unpremultiplyAlpha(pixels),pixels}_rawPixels(target,frame){const renderer=this.renderer;if(!renderer)throw new Error("The Extract has already been destroyed");let resolution,flipY=!1,premultipliedAlpha=!1,renderTexture,generated=!1;target&&(target instanceof RenderTexture?renderTexture=target:(renderTexture=renderer.generateTexture(target,{region:frame,resolution:renderer.resolution,multisample:renderer.multisample}),generated=!0,frame&&(TEMP_RECT$1.width=frame.width,TEMP_RECT$1.height=frame.height,frame=TEMP_RECT$1)));const gl=renderer.gl;if(renderTexture){if(resolution=renderTexture.baseTexture.resolution,frame=frame!=null?frame:renderTexture.frame,flipY=!1,premultipliedAlpha=renderTexture.baseTexture.alphaMode>0&&renderTexture.baseTexture.format===FORMATS.RGBA,!generated){renderer.renderTexture.bind(renderTexture);const fbo=renderTexture.framebuffer.glFramebuffers[renderer.CONTEXT_UID];fbo.blitFramebuffer&&renderer.framebuffer.bind(fbo.blitFramebuffer)}}else resolution=renderer.resolution,frame||(frame=TEMP_RECT$1,frame.width=renderer.width/resolution,frame.height=renderer.height/resolution),flipY=!0,premultipliedAlpha=this._rendererPremultipliedAlpha,renderer.renderTexture.bind();const width=Math.max(Math.round(frame.width*resolution),1),height=Math.max(Math.round(frame.height*resolution),1),pixels=new Uint8Array(BYTES_PER_PIXEL*width*height);return gl.readPixels(Math.round(frame.x*resolution),Math.round(frame.y*resolution),width,height,gl.RGBA,gl.UNSIGNED_BYTE,pixels),generated&&(renderTexture==null||renderTexture.destroy(!0)),{pixels,width,height,flipY,premultipliedAlpha}}destroy(){this.renderer=null}static _flipY(pixels,width,height){const w2=width<<2,h2=height>>1,temp=new Uint8Array(w2);for(let y2=0;y2<h2;y2++){const t2=y2*w2,b2=(height-y2-1)*w2;temp.set(pixels.subarray(t2,t2+w2)),pixels.copyWithin(t2,b2,b2+w2),pixels.set(temp,b2)}}static _unpremultiplyAlpha(pixels){pixels instanceof Uint8ClampedArray&&(pixels=new Uint8Array(pixels.buffer));const n2=pixels.length;for(let i2=0;i2<n2;i2+=4){const alpha=pixels[i2+3];if(alpha!==0){const a2=255.001/alpha;pixels[i2]=pixels[i2]*a2+0.5,pixels[i2+1]=pixels[i2+1]*a2+0.5,pixels[i2+2]=pixels[i2+2]*a2+0.5}}}};_Extract.extension={name:"extract",type:ExtensionType.RendererSystem};let Extract=_Extract;extensions$1.add(Extract);const buildCircle={build(graphicsData){const points=graphicsData.points;let x2,y2,dx,dy,rx,ry;if(graphicsData.type===SHAPES.CIRC){const circle=graphicsData.shape;x2=circle.x,y2=circle.y,rx=ry=circle.radius,dx=dy=0}else if(graphicsData.type===SHAPES.ELIP){const ellipse=graphicsData.shape;x2=ellipse.x,y2=ellipse.y,rx=ellipse.width,ry=ellipse.height,dx=dy=0}else{const roundedRect=graphicsData.shape,halfWidth=roundedRect.width/2,halfHeight=roundedRect.height/2;x2=roundedRect.x+halfWidth,y2=roundedRect.y+halfHeight,rx=ry=Math.max(0,Math.min(roundedRect.radius,Math.min(halfWidth,halfHeight))),dx=halfWidth-rx,dy=halfHeight-ry}if(!(rx>=0&&ry>=0&&dx>=0&&dy>=0)){points.length=0;return}const n2=Math.ceil(2.3*Math.sqrt(rx+ry)),m2=n2*8+(dx?4:0)+(dy?4:0);if(points.length=m2,m2===0)return;if(n2===0){points.length=8,points[0]=points[6]=x2+dx,points[1]=points[3]=y2+dy,points[2]=points[4]=x2-dx,points[5]=points[7]=y2-dy;return}let j1=0,j2=n2*4+(dx?2:0)+2,j3=j2,j4=m2;{const x0=dx+rx,y0=dy,x1=x2+x0,x22=x2-x0,y1=y2+y0;if(points[j1++]=x1,points[j1++]=y1,points[--j2]=y1,points[--j2]=x22,dy){const y22=y2-y0;points[j3++]=x22,points[j3++]=y22,points[--j4]=y22,points[--j4]=x1}}for(let i2=1;i2<n2;i2++){const a2=Math.PI/2*(i2/n2),x0=dx+Math.cos(a2)*rx,y0=dy+Math.sin(a2)*ry,x1=x2+x0,x22=x2-x0,y1=y2+y0,y22=y2-y0;points[j1++]=x1,points[j1++]=y1,points[--j2]=y1,points[--j2]=x22,points[j3++]=x22,points[j3++]=y22,points[--j4]=y22,points[--j4]=x1}{const x0=dx,y0=dy+ry,x1=x2+x0,x22=x2-x0,y1=y2+y0,y22=y2-y0;points[j1++]=x1,points[j1++]=y1,points[--j4]=y22,points[--j4]=x1,dx&&(points[j1++]=x22,points[j1++]=y1,points[--j4]=y22,points[--j4]=x22)}},triangulate(graphicsData,graphicsGeometry){const points=graphicsData.points,verts=graphicsGeometry.points,indices2=graphicsGeometry.indices;if(points.length===0)return;let vertPos=verts.length/2;const center=vertPos;let x2,y2;if(graphicsData.type!==SHAPES.RREC){const circle=graphicsData.shape;x2=circle.x,y2=circle.y}else{const roundedRect=graphicsData.shape;x2=roundedRect.x+roundedRect.width/2,y2=roundedRect.y+roundedRect.height/2}const matrix=graphicsData.matrix;verts.push(graphicsData.matrix?matrix.a*x2+matrix.c*y2+matrix.tx:x2,graphicsData.matrix?matrix.b*x2+matrix.d*y2+matrix.ty:y2),vertPos++,verts.push(points[0],points[1]);for(let i2=2;i2<points.length;i2+=2)verts.push(points[i2],points[i2+1]),indices2.push(vertPos++,center,vertPos);indices2.push(center+1,center,vertPos)}};function fixOrientation(points,hole=!1){const m2=points.length;if(m2<6)return;let area2=0;for(let i2=0,x1=points[m2-2],y1=points[m2-1];i2<m2;i2+=2){const x2=points[i2],y2=points[i2+1];area2+=(x2-x1)*(y2+y1),x1=x2,y1=y2}if(!hole&&area2>0||hole&&area2<=0){const n2=m2/2;for(let i2=n2+n2%2;i2<m2;i2+=2){const i1=m2-i2-2,i22=m2-i2-1,i3=i2,i4=i2+1;[points[i1],points[i3]]=[points[i3],points[i1]],[points[i22],points[i4]]=[points[i4],points[i22]]}}}const buildPoly={build(graphicsData){graphicsData.points=graphicsData.shape.points.slice()},triangulate(graphicsData,graphicsGeometry){let points=graphicsData.points;const holes=graphicsData.holes,verts=graphicsGeometry.points,indices2=graphicsGeometry.indices;if(points.length>=6){fixOrientation(points,!1);const holeArray=[];for(let i2=0;i2<holes.length;i2++){const hole=holes[i2];fixOrientation(hole.points,!0),holeArray.push(points.length/2),points=points.concat(hole.points)}const triangles=earcut$1(points,holeArray,2);if(!triangles)return;const vertPos=verts.length/2;for(let i2=0;i2<triangles.length;i2+=3)indices2.push(triangles[i2]+vertPos),indices2.push(triangles[i2+1]+vertPos),indices2.push(triangles[i2+2]+vertPos);for(let i2=0;i2<points.length;i2++)verts.push(points[i2])}}},buildRectangle={build(graphicsData){const rectData=graphicsData.shape,x2=rectData.x,y2=rectData.y,width=rectData.width,height=rectData.height,points=graphicsData.points;points.length=0,width>=0&&height>=0&&points.push(x2,y2,x2+width,y2,x2+width,y2+height,x2,y2+height)},triangulate(graphicsData,graphicsGeometry){const points=graphicsData.points,verts=graphicsGeometry.points;if(points.length===0)return;const vertPos=verts.length/2;verts.push(points[0],points[1],points[2],points[3],points[6],points[7],points[4],points[5]),graphicsGeometry.indices.push(vertPos,vertPos+1,vertPos+2,vertPos+1,vertPos+2,vertPos+3)}},buildRoundedRectangle={build(graphicsData){buildCircle.build(graphicsData)},triangulate(graphicsData,graphicsGeometry){buildCircle.triangulate(graphicsData,graphicsGeometry)}};var LINE_JOIN=(LINE_JOIN2=>(LINE_JOIN2.MITER="miter",LINE_JOIN2.BEVEL="bevel",LINE_JOIN2.ROUND="round",LINE_JOIN2))(LINE_JOIN||{}),LINE_CAP=(LINE_CAP2=>(LINE_CAP2.BUTT="butt",LINE_CAP2.ROUND="round",LINE_CAP2.SQUARE="square",LINE_CAP2))(LINE_CAP||{});const curves={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(length,defaultSegments=20){if(!this.adaptive||!length||isNaN(length))return defaultSegments;let result=Math.ceil(length/this.maxLength);return result<this.minSegments?result=this.minSegments:result>this.maxSegments&&(result=this.maxSegments),result}},GRAPHICS_CURVES=curves;class ArcUtils{static curveTo(x1,y1,x2,y2,radius,points){const fromX=points[points.length-2],a1=points[points.length-1]-y1,b1=fromX-x1,a2=y2-y1,b2=x2-x1,mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||radius===0)return(points[points.length-2]!==x1||points[points.length-1]!==y1)&&points.push(x1,y1),null;const dd=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=radius*Math.sqrt(dd)/mm,k2=radius*Math.sqrt(cc)/mm,j1=k1*tt/dd,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2),startAngle=Math.atan2(py-cy,px-cx),endAngle=Math.atan2(qy-cy,qx-cx);return{cx:cx+x1,cy:cy+y1,radius,startAngle,endAngle,anticlockwise:b1*a2>b2*a1}}static arc(_startX,_startY,cx,cy,radius,startAngle,endAngle,_anticlockwise,points){const sweep=endAngle-startAngle,n2=curves._segmentsCount(Math.abs(sweep)*radius,Math.ceil(Math.abs(sweep)/PI_2)*40),theta=sweep/(n2*2),theta2=theta*2,cTheta=Math.cos(theta),sTheta=Math.sin(theta),segMinus=n2-1,remainder=segMinus%1/segMinus;for(let i2=0;i2<=segMinus;++i2){const real=i2+remainder*i2,angle=theta+startAngle+theta2*real,c2=Math.cos(angle),s2=-Math.sin(angle);points.push((cTheta*c2+sTheta*s2)*radius+cx,(cTheta*-s2+sTheta*c2)*radius+cy)}}}class BatchPart{constructor(){this.reset()}begin(style,startIndex,attribStart){this.reset(),this.style=style,this.start=startIndex,this.attribStart=attribStart}end(endIndex,endAttrib){this.attribSize=endAttrib-this.attribStart,this.size=endIndex-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class BezierUtils{static curveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY){let result=0,t2=0,t22=0,t3=0,nt=0,nt2=0,nt3=0,x2=0,y2=0,dx=0,dy=0,prevX=fromX,prevY=fromY;for(let i2=1;i2<=10;++i2)t2=i2/10,t22=t2*t2,t3=t22*t2,nt=1-t2,nt2=nt*nt,nt3=nt2*nt,x2=nt3*fromX+3*nt2*t2*cpX+3*nt*t22*cpX2+t3*toX,y2=nt3*fromY+3*nt2*t2*cpY+3*nt*t22*cpY2+t3*toY,dx=prevX-x2,dy=prevY-y2,prevX=x2,prevY=y2,result+=Math.sqrt(dx*dx+dy*dy);return result}static curveTo(cpX,cpY,cpX2,cpY2,toX,toY,points){const fromX=points[points.length-2],fromY=points[points.length-1];points.length-=2;const n2=curves._segmentsCount(BezierUtils.curveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY));let dt=0,dt2=0,dt3=0,t2=0,t3=0;points.push(fromX,fromY);for(let i2=1,j2=0;i2<=n2;++i2)j2=i2/n2,dt=1-j2,dt2=dt*dt,dt3=dt2*dt,t2=j2*j2,t3=t2*j2,points.push(dt3*fromX+3*dt2*j2*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j2*cpY+3*dt*t2*cpY2+t3*toY)}}function square(x2,y2,nx,ny,innerWeight,outerWeight,clockwise,verts){const ix=x2-nx*innerWeight,iy=y2-ny*innerWeight,ox=x2+nx*outerWeight,oy=y2+ny*outerWeight;let exx,eyy;clockwise?(exx=ny,eyy=-nx):(exx=-ny,eyy=nx);const eix=ix+exx,eiy=iy+eyy,eox=ox+exx,eoy=oy+eyy;return verts.push(eix,eiy,eox,eoy),2}function round(cx,cy,sx,sy,ex,ey,verts,clockwise){const cx2p0x=sx-cx,cy2p0y=sy-cy;let angle0=Math.atan2(cx2p0x,cy2p0y),angle1=Math.atan2(ex-cx,ey-cy);clockwise&&angle0<angle1?angle0+=Math.PI*2:!clockwise&&angle0>angle1&&(angle1+=Math.PI*2);let startAngle=angle0;const angleDiff=angle1-angle0,absAngleDiff=Math.abs(angleDiff),radius=Math.sqrt(cx2p0x*cx2p0x+cy2p0y*cy2p0y),segCount=(15*absAngleDiff*Math.sqrt(radius)/Math.PI>>0)+1,angleInc=angleDiff/segCount;if(startAngle+=angleInc,clockwise){verts.push(cx,cy,sx,sy);for(let i2=1,angle=startAngle;i2<segCount;i2++,angle+=angleInc)verts.push(cx,cy,cx+Math.sin(angle)*radius,cy+Math.cos(angle)*radius);verts.push(cx,cy,ex,ey)}else{verts.push(sx,sy,cx,cy);for(let i2=1,angle=startAngle;i2<segCount;i2++,angle+=angleInc)verts.push(cx+Math.sin(angle)*radius,cy+Math.cos(angle)*radius,cx,cy);verts.push(ex,ey,cx,cy)}return segCount*2}function buildNonNativeLine(graphicsData,graphicsGeometry){const shape=graphicsData.shape;let points=graphicsData.points||shape.points.slice();const eps=graphicsGeometry.closePointEps;if(points.length===0)return;const style=graphicsData.lineStyle,firstPoint=new Point(points[0],points[1]),lastPoint=new Point(points[points.length-2],points[points.length-1]),closedShape=shape.type!==SHAPES.POLY||shape.closeStroke,closedPath=Math.abs(firstPoint.x-lastPoint.x)<eps&&Math.abs(firstPoint.y-lastPoint.y)<eps;if(closedShape){points=points.slice(),closedPath&&(points.pop(),points.pop(),lastPoint.set(points[points.length-2],points[points.length-1]));const midPointX=(firstPoint.x+lastPoint.x)*0.5,midPointY=(lastPoint.y+firstPoint.y)*0.5;points.unshift(midPointX,midPointY),points.push(midPointX,midPointY)}const verts=graphicsGeometry.points,length=points.length/2;let indexCount=points.length;const indexStart=verts.length/2,width=style.width/2,widthSquared=width*width,miterLimitSquared=style.miterLimit*style.miterLimit;let x0=points[0],y0=points[1],x1=points[2],y1=points[3],x2=0,y2=0,perpx=-(y0-y1),perpy=x0-x1,perp1x=0,perp1y=0,dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist,perpy/=dist,perpx*=width,perpy*=width;const ratio=style.alignment,innerWeight=(1-ratio)*2,outerWeight=ratio*2;closedShape||(style.cap===LINE_CAP.ROUND?indexCount+=round(x0-perpx*(innerWeight-outerWeight)*0.5,y0-perpy*(innerWeight-outerWeight)*0.5,x0-perpx*innerWeight,y0-perpy*innerWeight,x0+perpx*outerWeight,y0+perpy*outerWeight,verts,!0)+2:style.cap===LINE_CAP.SQUARE&&(indexCount+=square(x0,y0,perpx,perpy,innerWeight,outerWeight,!0,verts))),verts.push(x0-perpx*innerWeight,y0-perpy*innerWeight,x0+perpx*outerWeight,y0+perpy*outerWeight);for(let i2=1;i2<length-1;++i2){x0=points[(i2-1)*2],y0=points[(i2-1)*2+1],x1=points[i2*2],y1=points[i2*2+1],x2=points[(i2+1)*2],y2=points[(i2+1)*2+1],perpx=-(y0-y1),perpy=x0-x1,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,perp1x=-(y1-y2),perp1y=x1-x2,dist=Math.sqrt(perp1x*perp1x+perp1y*perp1y),perp1x/=dist,perp1y/=dist,perp1x*=width,perp1y*=width;const dx0=x1-x0,dy0=y0-y1,dx1=x1-x2,dy1=y2-y1,dot=dx0*dx1+dy0*dy1,cross=dy0*dx1-dy1*dx0,clockwise=cross<0;if(Math.abs(cross)<1e-3*Math.abs(dot)){verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight),dot>=0&&(style.join===LINE_JOIN.ROUND?indexCount+=round(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,!1)+4:indexCount+=2,verts.push(x1-perp1x*outerWeight,y1-perp1y*outerWeight,x1+perp1x*innerWeight,y1+perp1y*innerWeight));continue}const c1=(-perpx+x0)*(-perpy+y1)-(-perpx+x1)*(-perpy+y0),c2=(-perp1x+x2)*(-perp1y+y1)-(-perp1x+x1)*(-perp1y+y2),px=(dx0*c2-dx1*c1)/cross,py=(dy1*c1-dy0*c2)/cross,pdist=(px-x1)*(px-x1)+(py-y1)*(py-y1),imx=x1+(px-x1)*innerWeight,imy=y1+(py-y1)*innerWeight,omx=x1-(px-x1)*outerWeight,omy=y1-(py-y1)*outerWeight,smallerInsideSegmentSq=Math.min(dx0*dx0+dy0*dy0,dx1*dx1+dy1*dy1),insideWeight=clockwise?innerWeight:outerWeight,smallerInsideDiagonalSq=smallerInsideSegmentSq+insideWeight*insideWeight*widthSquared,insideMiterOk=pdist<=smallerInsideDiagonalSq;let join=style.join;if(join===LINE_JOIN.MITER&&pdist/widthSquared>miterLimitSquared&&(join=LINE_JOIN.BEVEL),insideMiterOk)switch(join){case LINE_JOIN.MITER:{verts.push(imx,imy,omx,omy);break}case LINE_JOIN.BEVEL:{clockwise?verts.push(imx,imy,x1+perpx*outerWeight,y1+perpy*outerWeight,imx,imy,x1+perp1x*outerWeight,y1+perp1y*outerWeight):verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,omx,omy,x1-perp1x*innerWeight,y1-perp1y*innerWeight,omx,omy),indexCount+=2;break}case LINE_JOIN.ROUND:{clockwise?(verts.push(imx,imy,x1+perpx*outerWeight,y1+perpy*outerWeight),indexCount+=round(x1,y1,x1+perpx*outerWeight,y1+perpy*outerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight,verts,!0)+4,verts.push(imx,imy,x1+perp1x*outerWeight,y1+perp1y*outerWeight)):(verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,omx,omy),indexCount+=round(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,!1)+4,verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight,omx,omy));break}}else{switch(verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight),join){case LINE_JOIN.MITER:{clockwise?verts.push(omx,omy,omx,omy):verts.push(imx,imy,imx,imy),indexCount+=2;break}case LINE_JOIN.ROUND:{clockwise?indexCount+=round(x1,y1,x1+perpx*outerWeight,y1+perpy*outerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight,verts,!0)+2:indexCount+=round(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,!1)+2;break}}verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight),indexCount+=2}}x0=points[(length-2)*2],y0=points[(length-2)*2+1],x1=points[(length-1)*2],y1=points[(length-1)*2+1],perpx=-(y0-y1),perpy=x0-x1,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight),closedShape||(style.cap===LINE_CAP.ROUND?indexCount+=round(x1-perpx*(innerWeight-outerWeight)*0.5,y1-perpy*(innerWeight-outerWeight)*0.5,x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight,verts,!1)+2:style.cap===LINE_CAP.SQUARE&&(indexCount+=square(x1,y1,perpx,perpy,innerWeight,outerWeight,!1,verts)));const indices2=graphicsGeometry.indices,eps2=curves.epsilon*curves.epsilon;for(let i2=indexStart;i2<indexCount+indexStart-2;++i2)x0=verts[i2*2],y0=verts[i2*2+1],x1=verts[(i2+1)*2],y1=verts[(i2+1)*2+1],x2=verts[(i2+2)*2],y2=verts[(i2+2)*2+1],!(Math.abs(x0*(y1-y2)+x1*(y2-y0)+x2*(y0-y1))<eps2)&&indices2.push(i2,i2+1,i2+2)}function buildNativeLine(graphicsData,graphicsGeometry){let i2=0;const shape=graphicsData.shape,points=graphicsData.points||shape.points,closedShape=shape.type!==SHAPES.POLY||shape.closeStroke;if(points.length===0)return;const verts=graphicsGeometry.points,indices2=graphicsGeometry.indices,length=points.length/2,startIndex=verts.length/2;let currentIndex=startIndex;for(verts.push(points[0],points[1]),i2=1;i2<length;i2++)verts.push(points[i2*2],points[i2*2+1]),indices2.push(currentIndex,currentIndex+1),currentIndex++;closedShape&&indices2.push(currentIndex,startIndex)}function buildLine(graphicsData,graphicsGeometry){graphicsData.lineStyle.native?buildNativeLine(graphicsData,graphicsGeometry):buildNonNativeLine(graphicsData,graphicsGeometry)}class QuadraticUtils{static curveLength(fromX,fromY,cpX,cpY,toX,toY){const ax=fromX-2*cpX+toX,ay=fromY-2*cpY+toY,bx=2*cpX-2*fromX,by=2*cpY-2*fromY,a2=4*(ax*ax+ay*ay),b2=4*(ax*bx+ay*by),c2=bx*bx+by*by,s2=2*Math.sqrt(a2+b2+c2),a22=Math.sqrt(a2),a32=2*a2*a22,c22=2*Math.sqrt(c2),ba=b2/a22;return(a32*s2+a22*b2*(s2-c22)+(4*c2*a2-b2*b2)*Math.log((2*a22+ba+s2)/(ba+c22)))/(4*a32)}static curveTo(cpX,cpY,toX,toY,points){const fromX=points[points.length-2],fromY=points[points.length-1],n2=curves._segmentsCount(QuadraticUtils.curveLength(fromX,fromY,cpX,cpY,toX,toY));let xa=0,ya=0;for(let i2=1;i2<=n2;++i2){const j2=i2/n2;xa=fromX+(cpX-fromX)*j2,ya=fromY+(cpY-fromY)*j2,points.push(xa+(cpX+(toX-cpX)*j2-xa)*j2,ya+(cpY+(toY-cpY)*j2-ya)*j2)}}}const FILL_COMMANDS={[SHAPES.POLY]:buildPoly,[SHAPES.CIRC]:buildCircle,[SHAPES.ELIP]:buildCircle,[SHAPES.RECT]:buildRectangle,[SHAPES.RREC]:buildRoundedRectangle},BATCH_POOL=[],DRAW_CALL_POOL=[];class GraphicsData{constructor(shape,fillStyle=null,lineStyle=null,matrix=null){this.points=[],this.holes=[],this.shape=shape,this.lineStyle=lineStyle,this.fillStyle=fillStyle,this.matrix=matrix,this.type=shape.type}clone(){return new GraphicsData(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const tmpPoint=new Point,_GraphicsGeometry=class _GraphicsGeometry2 extends BatchGeometry{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Bounds,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let i2=0;i2<this.drawCalls.length;i2++)this.drawCalls[i2].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[i2]);this.drawCalls.length=0;for(let i2=0;i2<this.batches.length;i2++){const batchPart=this.batches[i2];batchPart.reset(),BATCH_POOL.push(batchPart)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(shape,fillStyle=null,lineStyle=null,matrix=null){const data=new GraphicsData(shape,fillStyle,lineStyle,matrix);return this.graphicsData.push(data),this.dirty++,this}drawHole(shape,matrix=null){if(!this.graphicsData.length)return null;const data=new GraphicsData(shape,null,null,matrix),lastShape=this.graphicsData[this.graphicsData.length-1];return data.lineStyle=lastShape.lineStyle,lastShape.holes.push(data),this.dirty++,this}destroy(){super.destroy();for(let i2=0;i2<this.graphicsData.length;++i2)this.graphicsData[i2].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(point){const graphicsData=this.graphicsData;for(let i2=0;i2<graphicsData.length;++i2){const data=graphicsData[i2];if(data.fillStyle.visible&&data.shape&&(data.matrix?data.matrix.applyInverse(point,tmpPoint):tmpPoint.copyFrom(point),data.shape.contains(tmpPoint.x,tmpPoint.y))){let hitHole=!1;if(data.holes){for(let i22=0;i22<data.holes.length;i22++)if(data.holes[i22].shape.contains(tmpPoint.x,tmpPoint.y)){hitHole=!0;break}}if(!hitHole)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const uvs=this.uvs,graphicsData=this.graphicsData;let batchPart=null,currentStyle=null;this.batches.length>0&&(batchPart=this.batches[this.batches.length-1],currentStyle=batchPart.style);for(let i2=this.shapeIndex;i2<graphicsData.length;i2++){this.shapeIndex++;const data=graphicsData[i2],fillStyle=data.fillStyle,lineStyle=data.lineStyle;FILL_COMMANDS[data.type].build(data),data.matrix&&this.transformPoints(data.points,data.matrix),(fillStyle.visible||lineStyle.visible)&&this.processHoles(data.holes);for(let j2=0;j2<2;j2++){const style=j2===0?fillStyle:lineStyle;if(!style.visible)continue;const nextTexture=style.texture.baseTexture,index2=this.indices.length,attribIndex=this.points.length/2;nextTexture.wrapMode=WRAP_MODES.REPEAT,j2===0?this.processFill(data):this.processLine(data);const size=this.points.length/2-attribIndex;size!==0&&(batchPart&&!this._compareStyles(currentStyle,style)&&(batchPart.end(index2,attribIndex),batchPart=null),batchPart||(batchPart=BATCH_POOL.pop()||new BatchPart,batchPart.begin(style,index2,attribIndex),this.batches.push(batchPart),currentStyle=style),this.addUvs(this.points,uvs,style.texture,attribIndex,size,style.matrix))}}const index=this.indices.length,attrib=this.points.length/2;if(batchPart&&batchPart.end(index,attrib),this.batches.length===0){this.batchable=!0;return}const need32=attrib>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&need32===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=need32?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(styleA,styleB){return!(!styleA||!styleB||styleA.texture.baseTexture!==styleB.texture.baseTexture||styleA.color+styleA.alpha!==styleB.color+styleB.alpha||!!styleA.native!=!!styleB.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let i2=0,l2=this.graphicsData.length;i2<l2;i2++){const data=this.graphicsData[i2],fill=data.fillStyle,line=data.lineStyle;if(fill&&!fill.texture.baseTexture.valid||line&&!line.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const batches=this.batches;for(let i2=0,l2=batches.length;i2<l2;i2++){const batch=batches[i2];for(let j2=0;j2<batch.size;j2++){const index=batch.start+j2;this.indicesUint16[index]=this.indicesUint16[index]-batch.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const batches=this.batches;for(let i2=0;i2<batches.length;i2++)if(batches[i2].style.native)return!1;return this.points.length<_GraphicsGeometry2.BATCHABLE_SIZE*2}buildDrawCalls(){let TICK=++BaseTexture._globalBatch;for(let i2=0;i2<this.drawCalls.length;i2++)this.drawCalls[i2].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[i2]);this.drawCalls.length=0;const colors=this.colors,textureIds=this.textureIds;let currentGroup=DRAW_CALL_POOL.pop();currentGroup||(currentGroup=new BatchDrawCall,currentGroup.texArray=new BatchTextureArray),currentGroup.texArray.count=0,currentGroup.start=0,currentGroup.size=0,currentGroup.type=DRAW_MODES.TRIANGLES;let textureCount=0,currentTexture=null,textureId=0,native=!1,drawMode=DRAW_MODES.TRIANGLES,index=0;this.drawCalls.push(currentGroup);for(let i2=0;i2<this.batches.length;i2++){const data=this.batches[i2],maxTextures=8,style=data.style,nextTexture=style.texture.baseTexture;native!==!!style.native&&(native=!!style.native,drawMode=native?DRAW_MODES.LINES:DRAW_MODES.TRIANGLES,currentTexture=null,textureCount=maxTextures,TICK++),currentTexture!==nextTexture&&(currentTexture=nextTexture,nextTexture._batchEnabled!==TICK&&(textureCount===maxTextures&&(TICK++,textureCount=0,currentGroup.size>0&&(currentGroup=DRAW_CALL_POOL.pop(),currentGroup||(currentGroup=new BatchDrawCall,currentGroup.texArray=new BatchTextureArray),this.drawCalls.push(currentGroup)),currentGroup.start=index,currentGroup.size=0,currentGroup.texArray.count=0,currentGroup.type=drawMode),nextTexture.touched=1,nextTexture._batchEnabled=TICK,nextTexture._batchLocation=textureCount,nextTexture.wrapMode=WRAP_MODES.REPEAT,currentGroup.texArray.elements[currentGroup.texArray.count++]=nextTexture,textureCount++)),currentGroup.size+=data.size,index+=data.size,textureId=nextTexture._batchLocation,this.addColors(colors,style.color,style.alpha,data.attribSize,data.attribStart),this.addTextureIds(textureIds,textureId,data.attribSize,data.attribStart)}BaseTexture._globalBatch=TICK,this.packAttributes()}packAttributes(){const verts=this.points,uvs=this.uvs,colors=this.colors,textureIds=this.textureIds,glPoints=new ArrayBuffer(verts.length*3*4),f32=new Float32Array(glPoints),u32=new Uint32Array(glPoints);let p2=0;for(let i2=0;i2<verts.length/2;i2++)f32[p2++]=verts[i2*2],f32[p2++]=verts[i2*2+1],f32[p2++]=uvs[i2*2],f32[p2++]=uvs[i2*2+1],u32[p2++]=colors[i2],f32[p2++]=textureIds[i2];this._buffer.update(glPoints),this._indexBuffer.update(this.indicesUint16)}processFill(data){data.holes.length?buildPoly.triangulate(data,this):FILL_COMMANDS[data.type].triangulate(data,this)}processLine(data){buildLine(data,this);for(let i2=0;i2<data.holes.length;i2++)buildLine(data.holes[i2],this)}processHoles(holes){for(let i2=0;i2<holes.length;i2++){const hole=holes[i2];FILL_COMMANDS[hole.type].build(hole),hole.matrix&&this.transformPoints(hole.points,hole.matrix)}}calculateBounds(){const bounds=this._bounds;bounds.clear(),bounds.addVertexData(this.points,0,this.points.length),bounds.pad(this.boundsPadding,this.boundsPadding)}transformPoints(points,matrix){for(let i2=0;i2<points.length/2;i2++){const x2=points[i2*2],y2=points[i2*2+1];points[i2*2]=matrix.a*x2+matrix.c*y2+matrix.tx,points[i2*2+1]=matrix.b*x2+matrix.d*y2+matrix.ty}}addColors(colors,color,alpha,size,offset=0){const bgr=Color.shared.setValue(color).toLittleEndianNumber(),result=Color.shared.setValue(bgr).toPremultiplied(alpha);colors.length=Math.max(colors.length,offset+size);for(let i2=0;i2<size;i2++)colors[offset+i2]=result}addTextureIds(textureIds,id,size,offset=0){textureIds.length=Math.max(textureIds.length,offset+size);for(let i2=0;i2<size;i2++)textureIds[offset+i2]=id}addUvs(verts,uvs,texture,start,size,matrix=null){let index=0;const uvsStart=uvs.length,frame=texture.frame;for(;index<size;){let x2=verts[(start+index)*2],y2=verts[(start+index)*2+1];if(matrix){const nx=matrix.a*x2+matrix.c*y2+matrix.tx;y2=matrix.b*x2+matrix.d*y2+matrix.ty,x2=nx}index++,uvs.push(x2/frame.width,y2/frame.height)}const baseTexture=texture.baseTexture;(frame.width<baseTexture.width||frame.height<baseTexture.height)&&this.adjustUvs(uvs,texture,uvsStart,size)}adjustUvs(uvs,texture,start,size){const baseTexture=texture.baseTexture,eps=1e-6,finish=start+size*2,frame=texture.frame,scaleX=frame.width/baseTexture.width,scaleY=frame.height/baseTexture.height;let offsetX=frame.x/frame.width,offsetY=frame.y/frame.height,minX=Math.floor(uvs[start]+eps),minY=Math.floor(uvs[start+1]+eps);for(let i2=start+2;i2<finish;i2+=2)minX=Math.min(minX,Math.floor(uvs[i2]+eps)),minY=Math.min(minY,Math.floor(uvs[i2+1]+eps));offsetX-=minX,offsetY-=minY;for(let i2=start;i2<finish;i2+=2)uvs[i2]=(uvs[i2]+offsetX)*scaleX,uvs[i2+1]=(uvs[i2+1]+offsetY)*scaleY}};_GraphicsGeometry.BATCHABLE_SIZE=100;let GraphicsGeometry=_GraphicsGeometry;class FillStyle{constructor(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const obj=new FillStyle;return obj.color=this.color,obj.alpha=this.alpha,obj.texture=this.texture,obj.matrix=this.matrix,obj.visible=this.visible,obj}reset(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class LineStyle extends FillStyle{constructor(){super(...arguments),this.width=0,this.alignment=0.5,this.native=!1,this.cap=LINE_CAP.BUTT,this.join=LINE_JOIN.MITER,this.miterLimit=10}clone(){const obj=new LineStyle;return obj.color=this.color,obj.alpha=this.alpha,obj.texture=this.texture,obj.matrix=this.matrix,obj.visible=this.visible,obj.width=this.width,obj.alignment=this.alignment,obj.native=this.native,obj.cap=this.cap,obj.join=this.join,obj.miterLimit=this.miterLimit,obj}reset(){super.reset(),this.color=0,this.alignment=0.5,this.width=0,this.native=!1,this.cap=LINE_CAP.BUTT,this.join=LINE_JOIN.MITER,this.miterLimit=10}}const DEFAULT_SHADERS={},_Graphics=class _Graphics2 extends Container{constructor(geometry=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new FillStyle,this._lineStyle=new LineStyle,this._matrix=null,this._holeMode=!1,this.state=State.for2d(),this._geometry=geometry||new GraphicsGeometry,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Color(16777215),this.blendMode=BLEND_MODES.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new _Graphics2(this._geometry)}set blendMode(value){this.state.blendMode=value}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(value){this._tintColor.setValue(value)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(options=null,color=0,alpha,alignment=0.5,native=!1){return typeof options=="number"&&(options={width:options,color,alpha,alignment,native}),this.lineTextureStyle(options)}lineTextureStyle(options){const defaultLineStyleOptions={width:0,texture:Texture.WHITE,color:options!=null&&options.texture?16777215:0,matrix:null,alignment:0.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10};options=Object.assign(defaultLineStyleOptions,options),this.normalizeColor(options),this.currentPath&&this.startPoly();const visible=options.width>0&&options.alpha>0;return visible?(options.matrix&&(options.matrix=options.matrix.clone(),options.matrix.invert()),Object.assign(this._lineStyle,{visible},options)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const points=this.currentPath.points,len=this.currentPath.points.length;len>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(points[len-2],points[len-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(x2,y2){return this.startPoly(),this.currentPath.points[0]=x2,this.currentPath.points[1]=y2,this}lineTo(x2,y2){this.currentPath||this.moveTo(0,0);const points=this.currentPath.points,fromX=points[points.length-2],fromY=points[points.length-1];return(fromX!==x2||fromY!==y2)&&points.push(x2,y2),this}_initCurve(x2=0,y2=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[x2,y2]):this.moveTo(x2,y2)}quadraticCurveTo(cpX,cpY,toX,toY){this._initCurve();const points=this.currentPath.points;return points.length===0&&this.moveTo(0,0),QuadraticUtils.curveTo(cpX,cpY,toX,toY,points),this}bezierCurveTo(cpX,cpY,cpX2,cpY2,toX,toY){return this._initCurve(),BezierUtils.curveTo(cpX,cpY,cpX2,cpY2,toX,toY,this.currentPath.points),this}arcTo(x1,y1,x2,y2,radius){this._initCurve(x1,y1);const points=this.currentPath.points,result=ArcUtils.curveTo(x1,y1,x2,y2,radius,points);if(result){const{cx,cy,radius:radius2,startAngle,endAngle,anticlockwise}=result;this.arc(cx,cy,radius2,startAngle,endAngle,anticlockwise)}return this}arc(cx,cy,radius,startAngle,endAngle,anticlockwise=!1){if(startAngle===endAngle)return this;if(!anticlockwise&&endAngle<=startAngle?endAngle+=PI_2:anticlockwise&&startAngle<=endAngle&&(startAngle+=PI_2),endAngle-startAngle===0)return this;const startX=cx+Math.cos(startAngle)*radius,startY=cy+Math.sin(startAngle)*radius,eps=this._geometry.closePointEps;let points=this.currentPath?this.currentPath.points:null;if(points){const xDiff=Math.abs(points[points.length-2]-startX),yDiff=Math.abs(points[points.length-1]-startY);xDiff<eps&&yDiff<eps||points.push(startX,startY)}else this.moveTo(startX,startY),points=this.currentPath.points;return ArcUtils.arc(startX,startY,cx,cy,radius,startAngle,endAngle,anticlockwise,points),this}beginFill(color=0,alpha){return this.beginTextureFill({texture:Texture.WHITE,color,alpha})}normalizeColor(options){var _a2,_b;const temp=Color.shared.setValue((_a2=options.color)!=null?_a2:0);options.color=temp.toNumber(),(_b=options.alpha)!=null||(options.alpha=temp.alpha)}beginTextureFill(options){const defaultOptions={texture:Texture.WHITE,color:16777215,matrix:null};options=Object.assign(defaultOptions,options),this.normalizeColor(options),this.currentPath&&this.startPoly();const visible=options.alpha>0;return visible?(options.matrix&&(options.matrix=options.matrix.clone(),options.matrix.invert()),Object.assign(this._fillStyle,{visible},options)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(x2,y2,width,height){return this.drawShape(new Rectangle(x2,y2,width,height))}drawRoundedRect(x2,y2,width,height,radius){return this.drawShape(new RoundedRectangle(x2,y2,width,height,radius))}drawCircle(x2,y2,radius){return this.drawShape(new Circle(x2,y2,radius))}drawEllipse(x2,y2,width,height){return this.drawShape(new Ellipse(x2,y2,width,height))}drawPolygon(...path2){let points,closeStroke=!0;const poly=path2[0];poly.points?(closeStroke=poly.closeStroke,points=poly.points):Array.isArray(path2[0])?points=path2[0]:points=path2;const shape=new Polygon(points);return shape.closeStroke=closeStroke,this.drawShape(shape),this}drawShape(shape){return this._holeMode?this._geometry.drawHole(shape,this._matrix):this._geometry.drawShape(shape,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const data=this._geometry.graphicsData;return data.length===1&&data[0].shape.type===SHAPES.RECT&&!data[0].matrix&&!data[0].holes.length&&!(data[0].lineStyle.visible&&data[0].lineStyle.width)}_render(renderer){this.finishPoly();const geometry=this._geometry;geometry.updateBatches(),geometry.batchable?(this.batchDirty!==geometry.batchDirty&&this._populateBatches(),this._renderBatched(renderer)):(renderer.batch.flush(),this._renderDirect(renderer))}_populateBatches(){const geometry=this._geometry,blendMode=this.blendMode,len=geometry.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=geometry.batchDirty,this.batches.length=len,this.vertexData=new Float32Array(geometry.points);for(let i2=0;i2<len;i2++){const gI=geometry.batches[i2],color=gI.style.color,vertexData=new Float32Array(this.vertexData.buffer,gI.attribStart*4*2,gI.attribSize*2),uvs=new Float32Array(geometry.uvsFloat32.buffer,gI.attribStart*4*2,gI.attribSize*2),indices2=new Uint16Array(geometry.indicesUint16.buffer,gI.start*2,gI.size),batch={vertexData,blendMode,indices:indices2,uvs,_batchRGB:Color.shared.setValue(color).toRgbArray(),_tintRGB:color,_texture:gI.style.texture,alpha:gI.style.alpha,worldAlpha:1};this.batches[i2]=batch}}_renderBatched(renderer){if(this.batches.length){renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let i2=0,l2=this.batches.length;i2<l2;i2++){const batch=this.batches[i2];batch.worldAlpha=this.worldAlpha*batch.alpha,renderer.plugins[this.pluginName].render(batch)}}}_renderDirect(renderer){const shader=this._resolveDirectShader(renderer),geometry=this._geometry,worldAlpha=this.worldAlpha,uniforms=shader.uniforms,drawCalls=geometry.drawCalls;uniforms.translationMatrix=this.transform.worldTransform,Color.shared.setValue(this._tintColor).premultiply(worldAlpha).toArray(uniforms.tint),renderer.shader.bind(shader),renderer.geometry.bind(geometry,shader),renderer.state.set(this.state);for(let i2=0,l2=drawCalls.length;i2<l2;i2++)this._renderDrawCallDirect(renderer,geometry.drawCalls[i2])}_renderDrawCallDirect(renderer,drawCall){const{texArray,type,size,start}=drawCall,groupTextureCount=texArray.count;for(let j2=0;j2<groupTextureCount;j2++)renderer.texture.bind(texArray.elements[j2],j2);renderer.geometry.draw(type,size,start)}_resolveDirectShader(renderer){let shader=this.shader;const pluginName=this.pluginName;if(!shader){if(!DEFAULT_SHADERS[pluginName]){const{maxTextures}=renderer.plugins[pluginName],sampleValues=new Int32Array(maxTextures);for(let i2=0;i2<maxTextures;i2++)sampleValues[i2]=i2;const uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:sampleValues},!0)},program=renderer.plugins[pluginName]._shader.program;DEFAULT_SHADERS[pluginName]=new Shader(program,uniforms)}shader=DEFAULT_SHADERS[pluginName]}return shader}_calculateBounds(){this.finishPoly();const geometry=this._geometry;if(!geometry.graphicsData.length)return;const{minX,minY,maxX,maxY}=geometry.bounds;this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)}containsPoint(point){return this.worldTransform.applyInverse(point,_Graphics2._TEMP_POINT),this._geometry.containsPoint(_Graphics2._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let i2=0;i2<this.batches.length;i2++){const batch=this.batches[i2];batch._tintRGB=Color.shared.setValue(this._tintColor).multiply(batch._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const wtID=this.transform._worldID;if(this._transformID===wtID)return;this._transformID=wtID;const wt=this.transform.worldTransform,a2=wt.a,b2=wt.b,c2=wt.c,d2=wt.d,tx=wt.tx,ty=wt.ty,data=this._geometry.points,vertexData=this.vertexData;let count=0;for(let i2=0;i2<data.length;i2+=2){const x2=data[i2],y2=data[i2+1];vertexData[count++]=a2*x2+c2*y2+tx,vertexData[count++]=d2*y2+b2*x2+ty}}closePath(){const currentPath=this.currentPath;return currentPath&&(currentPath.closeStroke=!0,this.finishPoly()),this}setMatrix(matrix){return this._matrix=matrix,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(options){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(options)}};_Graphics.curves=curves,_Graphics._TEMP_POINT=new Point;let Graphics=_Graphics;const graphicsUtils={buildPoly,buildCircle,buildRectangle,buildRoundedRectangle,buildLine,ArcUtils,BezierUtils,QuadraticUtils,BatchPart,FILL_COMMANDS,BATCH_POOL,DRAW_CALL_POOL};class MeshBatchUvs{constructor(uvBuffer,uvMatrix){this.uvBuffer=uvBuffer,this.uvMatrix=uvMatrix,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(forceUpdate){if(!forceUpdate&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const data=this.uvBuffer.data;(!this.data||this.data.length!==data.length)&&(this.data=new Float32Array(data.length)),this.uvMatrix.multiplyUvs(data,this.data),this._updateID++}}const tempPoint=new Point,tempPolygon=new Polygon,_Mesh=class _Mesh2 extends Container{constructor(geometry,shader,state,drawMode=DRAW_MODES.TRIANGLES){super(),this.geometry=geometry,this.shader=shader,this.state=state||State.for2d(),this.drawMode=drawMode,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=settings.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(value){this._geometry!==value&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=value,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(value){this.shader=value}get material(){return this.shader}set blendMode(value){this.state.blendMode=value}get blendMode(){return this.state.blendMode}set roundPixels(value){this._roundPixels!==value&&(this._transformID=-1),this._roundPixels=value}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(value){this.shader.tint=value}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(value){this.shader.texture=value}_render(renderer){const vertices=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===DRAW_MODES.TRIANGLES&&vertices.length<_Mesh2.BATCHABLE_SIZE*2?this._renderToBatch(renderer):this._renderDefault(renderer)}_renderDefault(renderer){const shader=this.shader;shader.alpha=this.worldAlpha,shader.update&&shader.update(),renderer.batch.flush(),shader.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),renderer.shader.bind(shader),renderer.state.set(this.state),renderer.geometry.bind(this.geometry,shader),renderer.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(renderer){const geometry=this.geometry,shader=this.shader;shader.uvMatrix&&(shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=geometry.indexBuffer.data,this._tintRGB=shader._tintRGB,this._texture=shader.texture;const pluginName=this.material.pluginName;renderer.batch.setObjectRenderer(renderer.plugins[pluginName]),renderer.plugins[pluginName].render(this)}calculateVertices(){const verticesBuffer=this.geometry.buffers[0],vertices=verticesBuffer.data,vertexDirtyId=verticesBuffer._updateID;if(vertexDirtyId===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==vertices.length&&(this.vertexData=new Float32Array(vertices.length));const wt=this.transform.worldTransform,a2=wt.a,b2=wt.b,c2=wt.c,d2=wt.d,tx=wt.tx,ty=wt.ty,vertexData=this.vertexData;for(let i2=0;i2<vertexData.length/2;i2++){const x2=vertices[i2*2],y2=vertices[i2*2+1];vertexData[i2*2]=a2*x2+c2*y2+tx,vertexData[i2*2+1]=b2*x2+d2*y2+ty}if(this._roundPixels){const resolution=settings.RESOLUTION;for(let i2=0;i2<vertexData.length;++i2)vertexData[i2]=Math.round(vertexData[i2]*resolution)/resolution}this.vertexDirty=vertexDirtyId}calculateUvs(){const geomUvs=this.geometry.buffers[1],shader=this.shader;shader.uvMatrix.isSimple?this.uvs=geomUvs.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(geomUvs,shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(point){if(!this.getBounds().contains(point.x,point.y))return!1;this.worldTransform.applyInverse(point,tempPoint);const vertices=this.geometry.getBuffer("aVertexPosition").data,points=tempPolygon.points,indices2=this.geometry.getIndex().data,len=indices2.length,step=this.drawMode===4?3:1;for(let i2=0;i2+2<len;i2+=step){const ind0=indices2[i2]*2,ind1=indices2[i2+1]*2,ind2=indices2[i2+2]*2;if(points[0]=vertices[ind0],points[1]=vertices[ind0+1],points[2]=vertices[ind1],points[3]=vertices[ind1+1],points[4]=vertices[ind2],points[5]=vertices[ind2+1],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}return!1}destroy(options){super.destroy(options),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};_Mesh.BATCHABLE_SIZE=100;let Mesh=_Mesh;class MeshGeometry extends Geometry{constructor(vertices,uvs,index){super();const verticesBuffer=new Buffer(vertices),uvsBuffer=new Buffer(uvs,!0),indexBuffer=new Buffer(index,!0,!0);this.addAttribute("aVertexPosition",verticesBuffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",uvsBuffer,2,!1,TYPES.FLOAT).addIndex(indexBuffer),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var fragment=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,vertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class MeshMaterial extends Shader{constructor(uSampler,options){const uniforms={uSampler,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};options=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},options),options.uniforms&&Object.assign(uniforms,options.uniforms),super(options.program||Program.from(vertex,fragment),uniforms),this._colorDirty=!1,this.uvMatrix=new TextureMatrix(uSampler),this.batchable=options.program===void 0,this.pluginName=options.pluginName,this._tintColor=new Color(options.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=options.alpha}get texture(){return this.uniforms.uSampler}set texture(value){this.uniforms.uSampler!==value&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!value.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=value,this.uvMatrix.texture=value)}set alpha(value){value!==this._alpha&&(this._alpha=value,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(value){value!==this.tint&&(this._tintColor.setValue(value),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const applyToChannels=this.texture.baseTexture.alphaMode;Color.shared.setValue(this._tintColor).premultiply(this._alpha,applyToChannels).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class PlaneGeometry extends MeshGeometry{constructor(width=100,height=100,segWidth=10,segHeight=10){super(),this.segWidth=segWidth,this.segHeight=segHeight,this.width=width,this.height=height,this.build()}build(){const total=this.segWidth*this.segHeight,verts=[],uvs=[],indices2=[],segmentsX=this.segWidth-1,segmentsY=this.segHeight-1,sizeX=this.width/segmentsX,sizeY=this.height/segmentsY;for(let i2=0;i2<total;i2++){const x2=i2%this.segWidth,y2=i2/this.segWidth|0;verts.push(x2*sizeX,y2*sizeY),uvs.push(x2/segmentsX,y2/segmentsY)}const totalSub=segmentsX*segmentsY;for(let i2=0;i2<totalSub;i2++){const xpos=i2%segmentsX,ypos=i2/segmentsX|0,value=ypos*this.segWidth+xpos,value2=ypos*this.segWidth+xpos+1,value3=(ypos+1)*this.segWidth+xpos,value4=(ypos+1)*this.segWidth+xpos+1;indices2.push(value,value2,value3,value2,value4,value3)}this.buffers[0].data=new Float32Array(verts),this.buffers[1].data=new Float32Array(uvs),this.indexBuffer.data=new Uint16Array(indices2),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class RopeGeometry extends MeshGeometry{constructor(width=200,points,textureScale=0){super(new Float32Array(points.length*4),new Float32Array(points.length*4),new Uint16Array((points.length-1)*6)),this.points=points,this._width=width,this.textureScale=textureScale,this.build()}get width(){return this._width}build(){const points=this.points;if(!points)return;const vertexBuffer=this.getBuffer("aVertexPosition"),uvBuffer=this.getBuffer("aTextureCoord"),indexBuffer=this.getIndex();if(points.length<1)return;vertexBuffer.data.length/4!==points.length&&(vertexBuffer.data=new Float32Array(points.length*4),uvBuffer.data=new Float32Array(points.length*4),indexBuffer.data=new Uint16Array((points.length-1)*6));const uvs=uvBuffer.data,indices2=indexBuffer.data;uvs[0]=0,uvs[1]=0,uvs[2]=0,uvs[3]=1;let amount=0,prev=points[0];const textureWidth=this._width*this.textureScale,total=points.length;for(let i2=0;i2<total;i2++){const index=i2*4;if(this.textureScale>0){const dx=prev.x-points[i2].x,dy=prev.y-points[i2].y,distance=Math.sqrt(dx*dx+dy*dy);prev=points[i2],amount+=distance/textureWidth}else amount=i2/(total-1);uvs[index]=amount,uvs[index+1]=0,uvs[index+2]=amount,uvs[index+3]=1}let indexCount=0;for(let i2=0;i2<total-1;i2++){const index=i2*2;indices2[indexCount++]=index,indices2[indexCount++]=index+1,indices2[indexCount++]=index+2,indices2[indexCount++]=index+2,indices2[indexCount++]=index+1,indices2[indexCount++]=index+3}uvBuffer.update(),indexBuffer.update(),this.updateVertices()}updateVertices(){const points=this.points;if(points.length<1)return;let lastPoint=points[0],nextPoint,perpX=0,perpY=0;const vertices=this.buffers[0].data,total=points.length,halfWidth=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let i2=0;i2<total;i2++){const point=points[i2],index=i2*4;i2<points.length-1?nextPoint=points[i2+1]:nextPoint=point,perpY=-(nextPoint.x-lastPoint.x),perpX=nextPoint.y-lastPoint.y;let ratio=(1-i2/(total-1))*10;ratio>1&&(ratio=1);const perpLength=Math.sqrt(perpX*perpX+perpY*perpY);perpLength<1e-6?(perpX=0,perpY=0):(perpX/=perpLength,perpY/=perpLength,perpX*=halfWidth,perpY*=halfWidth),vertices[index]=point.x+perpX,vertices[index+1]=point.y+perpY,vertices[index+2]=point.x-perpX,vertices[index+3]=point.y-perpY,lastPoint=point}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class SimplePlane extends Mesh{constructor(texture,verticesX,verticesY){const planeGeometry=new PlaneGeometry(texture.width,texture.height,verticesX,verticesY),meshMaterial=new MeshMaterial(Texture.WHITE);super(planeGeometry,meshMaterial),this.texture=texture,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const geometry=this.geometry,{width,height}=this.shader.texture;this.autoResize&&(geometry.width!==width||geometry.height!==height)&&(geometry.width=this.shader.texture.width,geometry.height=this.shader.texture.height,geometry.build())}set texture(value){this.shader.texture!==value&&(this.shader.texture=value,this._textureID=-1,value.baseTexture.valid?this.textureUpdated():value.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(renderer){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(renderer)}destroy(options){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(options)}}const DEFAULT_BORDER_SIZE=10;class NineSlicePlane extends SimplePlane{constructor(texture,leftWidth,topHeight,rightWidth,bottomHeight){var _a2,_b,_c,_d,_e,_f,_g,_h;super(Texture.WHITE,4,4),this._origWidth=texture.orig.width,this._origHeight=texture.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=(_b=leftWidth!=null?leftWidth:(_a2=texture.defaultBorders)==null?void 0:_a2.left)!=null?_b:DEFAULT_BORDER_SIZE,this._rightWidth=(_d=rightWidth!=null?rightWidth:(_c=texture.defaultBorders)==null?void 0:_c.right)!=null?_d:DEFAULT_BORDER_SIZE,this._topHeight=(_f=topHeight!=null?topHeight:(_e=texture.defaultBorders)==null?void 0:_e.top)!=null?_f:DEFAULT_BORDER_SIZE,this._bottomHeight=(_h=bottomHeight!=null?bottomHeight:(_g=texture.defaultBorders)==null?void 0:_g.bottom)!=null?_h:DEFAULT_BORDER_SIZE,this.texture=texture}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(value){this.geometry.getBuffer("aVertexPosition").data=value}updateHorizontalVertices(){const vertices=this.vertices,scale=this._getMinScale();vertices[9]=vertices[11]=vertices[13]=vertices[15]=this._topHeight*scale,vertices[17]=vertices[19]=vertices[21]=vertices[23]=this._height-this._bottomHeight*scale,vertices[25]=vertices[27]=vertices[29]=vertices[31]=this._height}updateVerticalVertices(){const vertices=this.vertices,scale=this._getMinScale();vertices[2]=vertices[10]=vertices[18]=vertices[26]=this._leftWidth*scale,vertices[4]=vertices[12]=vertices[20]=vertices[28]=this._width-this._rightWidth*scale,vertices[6]=vertices[14]=vertices[22]=vertices[30]=this._width}_getMinScale(){const w2=this._leftWidth+this._rightWidth,scaleW=this._width>w2?1:this._width/w2,h2=this._topHeight+this._bottomHeight,scaleH=this._height>h2?1:this._height/h2;return Math.min(scaleW,scaleH)}get width(){return this._width}set width(value){this._width=value,this._refresh()}get height(){return this._height}set height(value){this._height=value,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(value){this._leftWidth=value,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(value){this._rightWidth=value,this._refresh()}get topHeight(){return this._topHeight}set topHeight(value){this._topHeight=value,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(value){this._bottomHeight=value,this._refresh()}_refresh(){const texture=this.texture,uvs=this.geometry.buffers[1].data;this._origWidth=texture.orig.width,this._origHeight=texture.orig.height;const _uvw=1/this._origWidth,_uvh=1/this._origHeight;uvs[0]=uvs[8]=uvs[16]=uvs[24]=0,uvs[1]=uvs[3]=uvs[5]=uvs[7]=0,uvs[6]=uvs[14]=uvs[22]=uvs[30]=1,uvs[25]=uvs[27]=uvs[29]=uvs[31]=1,uvs[2]=uvs[10]=uvs[18]=uvs[26]=_uvw*this._leftWidth,uvs[4]=uvs[12]=uvs[20]=uvs[28]=1-_uvw*this._rightWidth,uvs[9]=uvs[11]=uvs[13]=uvs[15]=_uvh*this._topHeight,uvs[17]=uvs[19]=uvs[21]=uvs[23]=1-_uvh*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class SimpleMesh extends Mesh{constructor(texture=Texture.EMPTY,vertices,uvs,indices2,drawMode){const geometry=new MeshGeometry(vertices,uvs,indices2);geometry.getBuffer("aVertexPosition").static=!1;const meshMaterial=new MeshMaterial(texture);super(geometry,meshMaterial,null,drawMode),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(value){this.geometry.getBuffer("aVertexPosition").data=value}_render(renderer){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(renderer)}}class SimpleRope extends Mesh{constructor(texture,points,textureScale=0){const ropeGeometry=new RopeGeometry(texture.height,points,textureScale),meshMaterial=new MeshMaterial(texture);textureScale>0&&(texture.baseTexture.wrapMode=WRAP_MODES.REPEAT),super(ropeGeometry,meshMaterial),this.autoUpdate=!0}_render(renderer){const geometry=this.geometry;(this.autoUpdate||geometry._width!==this.shader.texture.height)&&(geometry._width=this.shader.texture.height,geometry.update()),super._render(renderer)}}class CountLimiter{constructor(maxItemsPerFrame){this.maxItemsPerFrame=maxItemsPerFrame,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-->0}}function findMultipleBaseTextures(item,queue){var _a2;let result=!1;if((_a2=item==null?void 0:item._textures)!=null&&_a2.length){for(let i2=0;i2<item._textures.length;i2++)if(item._textures[i2]instanceof Texture){const baseTexture=item._textures[i2].baseTexture;queue.includes(baseTexture)||(queue.push(baseTexture),result=!0)}}return result}function findBaseTexture(item,queue){if(item.baseTexture instanceof BaseTexture){const texture=item.baseTexture;return queue.includes(texture)||queue.push(texture),!0}return!1}function findTexture(item,queue){if(item._texture&&item._texture instanceof Texture){const texture=item._texture.baseTexture;return queue.includes(texture)||queue.push(texture),!0}return!1}function drawText(_helper,item){return item instanceof Text?(item.updateText(!0),!0):!1}function calculateTextStyle(_helper,item){if(item instanceof TextStyle){const font=item.toFontString();return TextMetrics.measureFont(font),!0}return!1}function findText(item,queue){if(item instanceof Text){queue.includes(item.style)||queue.push(item.style),queue.includes(item)||queue.push(item);const texture=item._texture.baseTexture;return queue.includes(texture)||queue.push(texture),!0}return!1}function findTextStyle(item,queue){return item instanceof TextStyle?(queue.includes(item)||queue.push(item),!0):!1}const _BasePrepare=class _BasePrepare2{constructor(renderer){this.limiter=new CountLimiter(_BasePrepare2.uploadsPerFrame),this.renderer=renderer,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}upload(item){return new Promise(resolve2=>{item&&this.add(item),this.queue.length?(this.completes.push(resolve2),this.ticking||(this.ticking=!0,Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY))):resolve2()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const item=this.queue[0];let uploaded=!1;if(item&&!item._destroyed){for(let i2=0,len=this.uploadHooks.length;i2<len;i2++)if(this.uploadHooks[i2](this.uploadHookHelper,item)){this.queue.shift(),uploaded=!0;break}}uploaded||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;const completes=this.completes.slice(0);this.completes.length=0;for(let i2=0,len=completes.length;i2<len;i2++)completes[i2]()}}registerFindHook(addHook){return addHook&&this.addHooks.push(addHook),this}registerUploadHook(uploadHook){return uploadHook&&this.uploadHooks.push(uploadHook),this}add(item){for(let i2=0,len=this.addHooks.length;i2<len&&!this.addHooks[i2](item,this.queue);i2++);if(item instanceof Container)for(let i2=item.children.length-1;i2>=0;i2--)this.add(item.children[i2]);return this}destroy(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};_BasePrepare.uploadsPerFrame=4;let BasePrepare=_BasePrepare;Object.defineProperties(settings,{UPLOADS_PER_FRAME:{get(){return BasePrepare.uploadsPerFrame},set(value){deprecation$1("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),BasePrepare.uploadsPerFrame=value}}});function uploadBaseTextures$1(renderer,item){return item instanceof BaseTexture?(item._glTextures[renderer.CONTEXT_UID]||renderer.texture.bind(item),!0):!1}function uploadGraphics(renderer,item){if(!(item instanceof Graphics))return!1;const{geometry}=item;item.finishPoly(),geometry.updateBatches();const{batches}=geometry;for(let i2=0;i2<batches.length;i2++){const{texture}=batches[i2].style;texture&&uploadBaseTextures$1(renderer,texture.baseTexture)}return geometry.batchable||renderer.geometry.bind(geometry,item._resolveDirectShader(renderer)),!0}function findGraphics(item,queue){return item instanceof Graphics?(queue.push(item),!0):!1}class Prepare extends BasePrepare{constructor(renderer){super(renderer),this.uploadHookHelper=this.renderer,this.registerFindHook(findGraphics),this.registerUploadHook(uploadBaseTextures$1),this.registerUploadHook(uploadGraphics)}}Prepare.extension={name:"prepare",type:ExtensionType.RendererSystem},extensions$1.add(Prepare);class TimeLimiter{constructor(maxMilliseconds){this.maxMilliseconds=maxMilliseconds,this.frameStart=0}beginFrame(){this.frameStart=Date.now()}allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds}}class AnimatedSprite extends Sprite{constructor(textures,autoUpdate=!0){super(textures[0]instanceof Texture?textures[0]:textures[0].texture),this._textures=null,this._durations=null,this._autoUpdate=autoUpdate,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=textures}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(frameNumber){this.stop(),this.currentFrame=frameNumber}gotoAndPlay(frameNumber){this.currentFrame=frameNumber,this.play()}update(deltaTime){if(!this._playing)return;const elapsed=this.animationSpeed*deltaTime,previousFrame=this.currentFrame;if(this._durations!==null){let lag=this._currentTime%1*this._durations[this.currentFrame];for(lag+=elapsed/60*1e3;lag<0;)this._currentTime--,lag+=this._durations[this.currentFrame];const sign2=Math.sign(this.animationSpeed*deltaTime);for(this._currentTime=Math.floor(this._currentTime);lag>=this._durations[this.currentFrame];)lag-=this._durations[this.currentFrame]*sign2,this._currentTime+=sign2;this._currentTime+=lag/this._durations[this.currentFrame]}else this._currentTime+=elapsed;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):previousFrame!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<previousFrame||this.animationSpeed<0&&this.currentFrame>previousFrame)&&this.onLoop(),this.updateTexture())}updateTexture(){const currentFrame=this.currentFrame;this._previousFrame!==currentFrame&&(this._previousFrame=currentFrame,this._texture=this._textures[currentFrame],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(options){this.stop(),super.destroy(options),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(frames){const textures=[];for(let i2=0;i2<frames.length;++i2)textures.push(Texture.from(frames[i2]));return new AnimatedSprite(textures)}static fromImages(images){const textures=[];for(let i2=0;i2<images.length;++i2)textures.push(Texture.from(images[i2]));return new AnimatedSprite(textures)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(value){if(value[0]instanceof Texture)this._textures=value,this._durations=null;else{this._textures=[],this._durations=[];for(let i2=0;i2<value.length;i2++)this._textures.push(value[i2].texture),this._durations.push(value[i2].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let currentFrame=Math.floor(this._currentTime)%this._textures.length;return currentFrame<0&&(currentFrame+=this._textures.length),currentFrame}set currentFrame(value){if(value<0||value>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${value}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const previousFrame=this.currentFrame;this._currentTime=value,previousFrame!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const _Spritesheet=class _Spritesheet2{constructor(texture,data,resolutionFilename=null){this.linkedSheets=[],this._texture=texture instanceof Texture?texture:null,this.baseTexture=texture instanceof BaseTexture?texture:this._texture.baseTexture,this.textures={},this.animations={},this.data=data;const resource=this.baseTexture.resource;this.resolution=this._updateResolution(resolutionFilename||(resource?resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(resolutionFilename=null){const{scale}=this.data.meta;let resolution=getResolutionOfUrl(resolutionFilename,null);return resolution===null&&(resolution=typeof scale=="number"?scale:parseFloat(scale!=null?scale:"1")),resolution!==1&&this.baseTexture.setResolution(resolution),resolution}parse(){return new Promise(resolve2=>{this._callback=resolve2,this._batchIndex=0,this._frameKeys.length<=_Spritesheet2.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(initialFrameIndex){let frameIndex=initialFrameIndex;const maxFrames=_Spritesheet2.BATCH_SIZE;for(;frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length;){const i2=this._frameKeys[frameIndex],data=this._frames[i2],rect=data.frame;if(rect){let frame=null,trim=null;const sourceSize=data.trimmed!==!1&&data.sourceSize?data.sourceSize:data.frame,orig=new Rectangle(0,0,Math.floor(sourceSize.w)/this.resolution,Math.floor(sourceSize.h)/this.resolution);data.rotated?frame=new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.h)/this.resolution,Math.floor(rect.w)/this.resolution):frame=new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution),data.trimmed!==!1&&data.spriteSourceSize&&(trim=new Rectangle(Math.floor(data.spriteSourceSize.x)/this.resolution,Math.floor(data.spriteSourceSize.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution)),this.textures[i2]=new Texture(this.baseTexture,frame,orig,trim,data.rotated?2:0,data.anchor,data.borders),Texture.addToCache(this.textures[i2],i2.toString())}frameIndex++}}_processAnimations(){const animations=this.data.animations||{};for(const animName in animations){this.animations[animName]=[];for(let i2=0;i2<animations[animName].length;i2++){const frameName=animations[animName][i2];this.animations[animName].push(this.textures[frameName])}}}_parseComplete(){const callback=this._callback;this._callback=null,this._batchIndex=0,callback.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*_Spritesheet2.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*_Spritesheet2.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(destroyBase=!1){var _a2;for(const i2 in this.textures)this.textures[i2].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,destroyBase&&((_a2=this._texture)==null||_a2.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};_Spritesheet.BATCH_SIZE=1e3;let Spritesheet=_Spritesheet;const validImages=["jpg","png","jpeg","avif","webp"];function getCacheableAssets(keys,asset,ignoreMultiPack){const out={};if(keys.forEach(key=>{out[key]=asset}),Object.keys(asset.textures).forEach(key=>{out[key]=asset.textures[key]}),!ignoreMultiPack){const basePath=path.dirname(keys[0]);asset.linkedSheets.forEach((item,i2)=>{const out2=getCacheableAssets([`${basePath}/${asset.data.meta.related_multi_packs[i2]}`],item,!0);Object.assign(out,out2)})}return out}const spritesheetAsset={extension:ExtensionType.Asset,cache:{test:asset=>asset instanceof Spritesheet,getCacheableAssets:(keys,asset)=>getCacheableAssets(keys,asset,!1)},resolver:{test:value=>{const split=value.split("?")[0].split("."),extension=split.pop(),format2=split.pop();return extension==="json"&&validImages.includes(format2)},parse:value=>{var _a2,_b;const split=value.split(".");return{resolution:parseFloat((_b=(_a2=settings.RETINA_PREFIX.exec(value))==null?void 0:_a2[1])!=null?_b:"1"),format:split[split.length-2],src:value}}},loader:{name:"spritesheetLoader",extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},async testParse(asset,options){return path.extname(options.src).toLowerCase()===".json"&&!!asset.frames},async parse(asset,options,loader){var _a2,_b;let basePath=path.dirname(options.src);basePath&&basePath.lastIndexOf("/")!==basePath.length-1&&(basePath+="/");let imagePath=basePath+asset.meta.image;imagePath=copySearchParams(imagePath,options.src);const texture=(await loader.load([imagePath]))[imagePath],spritesheet=new Spritesheet(texture.baseTexture,asset,options.src);await spritesheet.parse();const multiPacks=(_a2=asset==null?void 0:asset.meta)==null?void 0:_a2.related_multi_packs;if(Array.isArray(multiPacks)){const promises=[];for(const item of multiPacks){if(typeof item!="string")continue;let itemUrl=basePath+item;(_b=options.data)!=null&&_b.ignoreMultiPack||(itemUrl=copySearchParams(itemUrl,options.src),promises.push(loader.load({src:itemUrl,data:{ignoreMultiPack:!0}})))}const res=await Promise.all(promises);spritesheet.linkedSheets=res,res.forEach(item=>{item.linkedSheets=[spritesheet].concat(spritesheet.linkedSheets.filter(sp=>sp!==item))})}return spritesheet},unload(spritesheet){spritesheet.destroy(!0)}}};extensions$1.add(spritesheetAsset);class BitmapFontData{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class TextFormat{static test(data){return typeof data=="string"&&data.startsWith("info face=")}static parse(txt){const items=txt.match(/^[a-z]+\s+.+$/gm),rawData={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const i2 in items){const name=items[i2].match(/^[a-z]+/gm)[0],attributeList=items[i2].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),itemData={};for(const i22 in attributeList){const split=attributeList[i22].split("="),key=split[0],strValue=split[1].replace(/"/gm,""),floatValue=parseFloat(strValue),value=isNaN(floatValue)?strValue:floatValue;itemData[key]=value}rawData[name].push(itemData)}const font=new BitmapFontData;return rawData.info.forEach(info=>font.info.push({face:info.face,size:parseInt(info.size,10)})),rawData.common.forEach(common=>font.common.push({lineHeight:parseInt(common.lineHeight,10)})),rawData.page.forEach(page=>font.page.push({id:parseInt(page.id,10),file:page.file})),rawData.char.forEach(char=>font.char.push({id:parseInt(char.id,10),page:parseInt(char.page,10),x:parseInt(char.x,10),y:parseInt(char.y,10),width:parseInt(char.width,10),height:parseInt(char.height,10),xoffset:parseInt(char.xoffset,10),yoffset:parseInt(char.yoffset,10),xadvance:parseInt(char.xadvance,10)})),rawData.kerning.forEach(kerning=>font.kerning.push({first:parseInt(kerning.first,10),second:parseInt(kerning.second,10),amount:parseInt(kerning.amount,10)})),rawData.distanceField.forEach(df=>font.distanceField.push({distanceRange:parseInt(df.distanceRange,10),fieldType:df.fieldType})),font}}class XMLFormat{static test(data){const xml=data;return typeof data!="string"&&"getElementsByTagName"in data&&xml.getElementsByTagName("page").length&&xml.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(xml){const data=new BitmapFontData,info=xml.getElementsByTagName("info"),common=xml.getElementsByTagName("common"),page=xml.getElementsByTagName("page"),char=xml.getElementsByTagName("char"),kerning=xml.getElementsByTagName("kerning"),distanceField=xml.getElementsByTagName("distanceField");for(let i2=0;i2<info.length;i2++)data.info.push({face:info[i2].getAttribute("face"),size:parseInt(info[i2].getAttribute("size"),10)});for(let i2=0;i2<common.length;i2++)data.common.push({lineHeight:parseInt(common[i2].getAttribute("lineHeight"),10)});for(let i2=0;i2<page.length;i2++)data.page.push({id:parseInt(page[i2].getAttribute("id"),10)||0,file:page[i2].getAttribute("file")});for(let i2=0;i2<char.length;i2++){const letter=char[i2];data.char.push({id:parseInt(letter.getAttribute("id"),10),page:parseInt(letter.getAttribute("page"),10)||0,x:parseInt(letter.getAttribute("x"),10),y:parseInt(letter.getAttribute("y"),10),width:parseInt(letter.getAttribute("width"),10),height:parseInt(letter.getAttribute("height"),10),xoffset:parseInt(letter.getAttribute("xoffset"),10),yoffset:parseInt(letter.getAttribute("yoffset"),10),xadvance:parseInt(letter.getAttribute("xadvance"),10)})}for(let i2=0;i2<kerning.length;i2++)data.kerning.push({first:parseInt(kerning[i2].getAttribute("first"),10),second:parseInt(kerning[i2].getAttribute("second"),10),amount:parseInt(kerning[i2].getAttribute("amount"),10)});for(let i2=0;i2<distanceField.length;i2++)data.distanceField.push({fieldType:distanceField[i2].getAttribute("fieldType"),distanceRange:parseInt(distanceField[i2].getAttribute("distanceRange"),10)});return data}}class XMLStringFormat{static test(data){return typeof data=="string"&&data.includes("<font>")?XMLFormat.test(settings.ADAPTER.parseXML(data)):!1}static parse(xmlTxt){return XMLFormat.parse(settings.ADAPTER.parseXML(xmlTxt))}}const formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(data){for(let i2=0;i2<formats.length;i2++)if(formats[i2].test(data))return formats[i2];return null}function generateFillStyle(canvas,context2,style,resolution,lines,metrics){const fillStyle=style.fill;if(Array.isArray(fillStyle)){if(fillStyle.length===1)return fillStyle[0]}else return fillStyle;let gradient;const dropShadowCorrection=style.dropShadow?style.dropShadowDistance:0,padding=style.padding||0,width=canvas.width/resolution-dropShadowCorrection-padding*2,height=canvas.height/resolution-dropShadowCorrection-padding*2,fill=fillStyle.slice(),fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length){const lengthPlus1=fill.length+1;for(let i2=1;i2<lengthPlus1;++i2)fillGradientStops.push(i2/lengthPlus1)}if(fill.unshift(fillStyle[0]),fillGradientStops.unshift(0),fill.push(fillStyle[fillStyle.length-1]),fillGradientStops.push(1),style.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=context2.createLinearGradient(width/2,padding,width/2,height+padding);let lastIterationStop=0;const gradStopLineHeight=(metrics.fontProperties.fontSize+style.strokeThickness)/height;for(let i2=0;i2<lines.length;i2++){const thisLineTop=metrics.lineHeight*i2;for(let j2=0;j2<fill.length;j2++){let lineStop=0;typeof fillGradientStops[j2]=="number"?lineStop=fillGradientStops[j2]:lineStop=j2/fill.length;const globalStop=thisLineTop/height+lineStop*gradStopLineHeight;let clampedStop=Math.max(lastIterationStop,globalStop);clampedStop=Math.min(clampedStop,1),gradient.addColorStop(clampedStop,fill[j2]),lastIterationStop=clampedStop}}}else{gradient=context2.createLinearGradient(padding,height/2,width+padding,height/2);const totalIterations=fill.length+1;let currentIteration=1;for(let i2=0;i2<fill.length;i2++){let stop;typeof fillGradientStops[i2]=="number"?stop=fillGradientStops[i2]:stop=currentIteration/totalIterations,gradient.addColorStop(stop,fill[i2]),currentIteration++}}return gradient}function drawGlyph(canvas,context2,metrics,x2,y2,resolution,style){const char=metrics.text,fontProperties=metrics.fontProperties;context2.translate(x2,y2),context2.scale(resolution,resolution);const tx=style.strokeThickness/2,ty=-(style.strokeThickness/2);if(context2.font=style.toFontString(),context2.lineWidth=style.strokeThickness,context2.textBaseline=style.textBaseline,context2.lineJoin=style.lineJoin,context2.miterLimit=style.miterLimit,context2.fillStyle=generateFillStyle(canvas,context2,style,resolution,[char],metrics),context2.strokeStyle=style.stroke,style.dropShadow){const dropShadowColor=style.dropShadowColor,dropShadowBlur=style.dropShadowBlur*resolution,dropShadowDistance=style.dropShadowDistance*resolution;context2.shadowColor=Color.shared.setValue(dropShadowColor).setAlpha(style.dropShadowAlpha).toRgbaString(),context2.shadowBlur=dropShadowBlur,context2.shadowOffsetX=Math.cos(style.dropShadowAngle)*dropShadowDistance,context2.shadowOffsetY=Math.sin(style.dropShadowAngle)*dropShadowDistance}else context2.shadowColor="black",context2.shadowBlur=0,context2.shadowOffsetX=0,context2.shadowOffsetY=0;style.stroke&&style.strokeThickness&&context2.strokeText(char,tx,ty+metrics.lineHeight-fontProperties.descent),style.fill&&context2.fillText(char,tx,ty+metrics.lineHeight-fontProperties.descent),context2.setTransform(1,0,0,1,0,0),context2.fillStyle="rgba(0, 0, 0, 0)"}function extractCharCode(str){return str.codePointAt?str.codePointAt(0):str.charCodeAt(0)}function splitTextToCharacters(text){return Array.from?Array.from(text):text.split("")}function resolveCharacters(chars){typeof chars=="string"&&(chars=[chars]);const result=[];for(let i2=0,j2=chars.length;i2<j2;i2++){const item=chars[i2];if(Array.isArray(item)){if(item.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${item.length}.`);const startCode=item[0].charCodeAt(0),endCode=item[1].charCodeAt(0);if(endCode<startCode)throw new Error("[BitmapFont]: Invalid character range.");for(let i22=startCode,j22=endCode;i22<=j22;i22++)result.push(String.fromCharCode(i22))}else result.push(...splitTextToCharacters(item))}if(result.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return result}var __defProp$1=Object.defineProperty,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=(obj,key,value)=>key in obj?__defProp$1(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues$1=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp$1.call(b2,prop)&&__defNormalProp$1(a2,prop,b2[prop]);if(__getOwnPropSymbols$1)for(var prop of __getOwnPropSymbols$1(b2))__propIsEnum$1.call(b2,prop)&&__defNormalProp$1(a2,prop,b2[prop]);return a2},__objRest=(source,exclude)=>{var target={};for(var prop in source)__hasOwnProp$1.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(source!=null&&__getOwnPropSymbols$1)for(var prop of __getOwnPropSymbols$1(source))exclude.indexOf(prop)<0&&__propIsEnum$1.call(source,prop)&&(target[prop]=source[prop]);return target};const _BitmapFont=class _BitmapFont2{constructor(data,textures,ownsTextures){var _a2,_b;const[info]=data.info,[common]=data.common,[page]=data.page,[distanceField]=data.distanceField,res=getResolutionOfUrl(page.file),pageTextures={};this._ownsTextures=ownsTextures,this.font=info.face,this.size=info.size,this.lineHeight=common.lineHeight/res,this.chars={},this.pageTextures=pageTextures;for(let i2=0;i2<data.page.length;i2++){const{id,file}=data.page[i2];pageTextures[id]=textures instanceof Array?textures[i2]:textures[file],distanceField!=null&&distanceField.fieldType&&distanceField.fieldType!=="none"&&(pageTextures[id].baseTexture.alphaMode=ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,pageTextures[id].baseTexture.mipmap=MIPMAP_MODES.OFF)}for(let i2=0;i2<data.char.length;i2++){const{id,page:page2}=data.char[i2];let{x:x2,y:y2,width,height,xoffset,yoffset,xadvance}=data.char[i2];x2/=res,y2/=res,width/=res,height/=res,xoffset/=res,yoffset/=res,xadvance/=res;const rect=new Rectangle(x2+pageTextures[page2].frame.x/res,y2+pageTextures[page2].frame.y/res,width,height);this.chars[id]={xOffset:xoffset,yOffset:yoffset,xAdvance:xadvance,kerning:{},texture:new Texture(pageTextures[page2].baseTexture,rect),page:page2}}for(let i2=0;i2<data.kerning.length;i2++){let{first,second,amount}=data.kerning[i2];first/=res,second/=res,amount/=res,this.chars[second]&&(this.chars[second].kerning[first]=amount)}this.distanceFieldRange=distanceField==null?void 0:distanceField.distanceRange,this.distanceFieldType=(_b=(_a2=distanceField==null?void 0:distanceField.fieldType)==null?void 0:_a2.toLowerCase())!=null?_b:"none"}destroy(){for(const id in this.chars)this.chars[id].texture.destroy(),this.chars[id].texture=null;for(const id in this.pageTextures)this._ownsTextures&&this.pageTextures[id].destroy(!0),this.pageTextures[id]=null;this.chars=null,this.pageTextures=null}static install(data,textures,ownsTextures){let fontData;if(data instanceof BitmapFontData)fontData=data;else{const format2=autoDetectFormat(data);if(!format2)throw new Error("Unrecognized data format for font.");fontData=format2.parse(data)}textures instanceof Texture&&(textures=[textures]);const font=new _BitmapFont2(fontData,textures,ownsTextures);return _BitmapFont2.available[font.font]=font,font}static uninstall(name){const font=_BitmapFont2.available[name];if(!font)throw new Error(`No font found named '${name}'`);font.destroy(),delete _BitmapFont2.available[name]}static from(name,textStyle,options){if(!name)throw new Error("[BitmapFont] Property `name` is required.");const _a2=Object.assign({},_BitmapFont2.defaultOptions,options),{chars,padding,resolution,textureWidth,textureHeight}=_a2,baseOptions=__objRest(_a2,["chars","padding","resolution","textureWidth","textureHeight"]),charsList=resolveCharacters(chars),style=textStyle instanceof TextStyle?textStyle:new TextStyle(textStyle),lineWidth=textureWidth,fontData=new BitmapFontData;fontData.info[0]={face:style.fontFamily,size:style.fontSize},fontData.common[0]={lineHeight:style.fontSize};let positionX=0,positionY=0,canvas,context2,baseTexture,maxCharHeight=0;const baseTextures=[],textures=[];for(let i2=0;i2<charsList.length;i2++){canvas||(canvas=settings.ADAPTER.createCanvas(),canvas.width=textureWidth,canvas.height=textureHeight,context2=canvas.getContext("2d"),baseTexture=new BaseTexture(canvas,__spreadValues$1({resolution},baseOptions)),baseTextures.push(baseTexture),textures.push(new Texture(baseTexture)),fontData.page.push({id:textures.length-1,file:""}));const character=charsList[i2],metrics=TextMetrics.measureText(character,style,!1,canvas),width=metrics.width,height=Math.ceil(metrics.height),textureGlyphWidth=Math.ceil((style.fontStyle==="italic"?2:1)*width);if(positionY>=textureHeight-height*resolution){if(positionY===0)throw new Error(`[BitmapFont] textureHeight ${textureHeight}px is too small (fontFamily: '${style.fontFamily}', fontSize: ${style.fontSize}px, char: '${character}')`);--i2,canvas=null,context2=null,baseTexture=null,positionY=0,positionX=0,maxCharHeight=0;continue}if(maxCharHeight=Math.max(height+metrics.fontProperties.descent,maxCharHeight),textureGlyphWidth*resolution+positionX>=lineWidth){if(positionX===0)throw new Error(`[BitmapFont] textureWidth ${textureWidth}px is too small (fontFamily: '${style.fontFamily}', fontSize: ${style.fontSize}px, char: '${character}')`);--i2,positionY+=maxCharHeight*resolution,positionY=Math.ceil(positionY),positionX=0,maxCharHeight=0;continue}drawGlyph(canvas,context2,metrics,positionX,positionY,resolution,style);const id=extractCharCode(metrics.text);fontData.char.push({id,page:textures.length-1,x:positionX/resolution,y:positionY/resolution,width:textureGlyphWidth,height,xoffset:0,yoffset:0,xadvance:width-(style.dropShadow?style.dropShadowDistance:0)-(style.stroke?style.strokeThickness:0)}),positionX+=(textureGlyphWidth+2*padding)*resolution,positionX=Math.ceil(positionX)}if(!(options!=null&&options.skipKerning))for(let i2=0,len=charsList.length;i2<len;i2++){const first=charsList[i2];for(let j2=0;j2<len;j2++){const second=charsList[j2],c1=context2.measureText(first).width,c2=context2.measureText(second).width,amount=context2.measureText(first+second).width-(c1+c2);amount&&fontData.kerning.push({first:extractCharCode(first),second:extractCharCode(second),amount})}}const font=new _BitmapFont2(fontData,textures,!0);return _BitmapFont2.available[name]!==void 0&&_BitmapFont2.uninstall(name),_BitmapFont2.available[name]=font,font}};_BitmapFont.ALPHA=[["a","z"],["A","Z"]," "],_BitmapFont.NUMERIC=[["0","9"]],_BitmapFont.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],_BitmapFont.ASCII=[[" ","~"]],_BitmapFont.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:_BitmapFont.ALPHANUMERIC},_BitmapFont.available={};let BitmapFont=_BitmapFont;var msdfFrag=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,msdfVert=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const pageMeshDataDefaultPageMeshData=[],pageMeshDataMSDFPageMeshData=[],charRenderDataPool=[],_BitmapText=class _BitmapText2 extends Container{constructor(text,style={}){super();const{align,tint,maxWidth,letterSpacing,fontName,fontSize}=Object.assign({},_BitmapText2.styleDefaults,style);if(!BitmapFont.available[fontName])throw new Error(`Missing BitmapFont "${fontName}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=align,this._tintColor=new Color(tint),this._font=void 0,this._fontName=fontName,this._fontSize=fontSize,this.text=text,this._maxWidth=maxWidth,this._maxLineHeight=0,this._letterSpacing=letterSpacing,this._anchor=new ObservablePoint(()=>{this.dirty=!0},this,0,0),this._roundPixels=settings.ROUND_PIXELS,this.dirty=!0,this._resolution=settings.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var _a2;const data=BitmapFont.available[this._fontName],fontSize=this.fontSize,scale=fontSize/data.size,pos=new Point,chars=[],lineWidths=[],lineSpaces=[],text=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",charsInput=splitTextToCharacters(text),maxWidth=this._maxWidth*data.size/fontSize,pageMeshDataPool=data.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;let prevCharCode=null,lastLineWidth=0,maxLineWidth=0,line=0,lastBreakPos=-1,lastBreakWidth=0,spacesRemoved=0,maxLineHeight=0,spaceCount=0;for(let i2=0;i2<charsInput.length;i2++){const char=charsInput[i2],charCode=extractCharCode(char);if(/(?:\s)/.test(char)&&(lastBreakPos=i2,lastBreakWidth=lastLineWidth,spaceCount++),char==="\r"||char===`
`){lineWidths.push(lastLineWidth),lineSpaces.push(-1),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),++line,++spacesRemoved,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null,spaceCount=0;continue}const charData=data.chars[charCode];if(!charData)continue;prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]);const charRenderData=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point};charRenderData.texture=charData.texture,charRenderData.line=line,charRenderData.charCode=charCode,charRenderData.position.x=Math.round(pos.x+charData.xOffset+this._letterSpacing/2),charRenderData.position.y=Math.round(pos.y+charData.yOffset),charRenderData.prevSpaces=spaceCount,chars.push(charRenderData),lastLineWidth=charRenderData.position.x+Math.max(charData.xAdvance-charData.xOffset,charData.texture.orig.width),pos.x+=charData.xAdvance+this._letterSpacing,maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height),prevCharCode=charCode,lastBreakPos!==-1&&maxWidth>0&&pos.x>maxWidth&&(++spacesRemoved,removeItems(chars,1+lastBreakPos-spacesRemoved,1+i2-lastBreakPos),i2=lastBreakPos,lastBreakPos=-1,lineWidths.push(lastBreakWidth),lineSpaces.push(chars.length>0?chars[chars.length-1].prevSpaces:0),maxLineWidth=Math.max(maxLineWidth,lastBreakWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null,spaceCount=0)}const lastChar=charsInput[charsInput.length-1];lastChar!=="\r"&&lastChar!==`
`&&(/(?:\s)/.test(lastChar)&&(lastLineWidth=lastBreakWidth),lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),lineSpaces.push(-1));const lineAlignOffsets=[];for(let i2=0;i2<=line;i2++){let alignOffset=0;this._align==="right"?alignOffset=maxLineWidth-lineWidths[i2]:this._align==="center"?alignOffset=(maxLineWidth-lineWidths[i2])/2:this._align==="justify"&&(alignOffset=lineSpaces[i2]<0?0:(maxLineWidth-lineWidths[i2])/lineSpaces[i2]),lineAlignOffsets.push(alignOffset)}const lenChars=chars.length,pagesMeshData={},newPagesMeshData=[],activePagesMeshData=this._activePagesMeshData;pageMeshDataPool.push(...activePagesMeshData);for(let i2=0;i2<lenChars;i2++){const texture=chars[i2].texture,baseTextureUid=texture.baseTexture.uid;if(!pagesMeshData[baseTextureUid]){let pageMeshData=pageMeshDataPool.pop();if(!pageMeshData){const geometry=new MeshGeometry;let material,meshBlendMode;data.distanceFieldType==="none"?(material=new MeshMaterial(Texture.EMPTY),meshBlendMode=BLEND_MODES.NORMAL):(material=new MeshMaterial(Texture.EMPTY,{program:Program.from(msdfVert,msdfFrag),uniforms:{uFWidth:0}}),meshBlendMode=BLEND_MODES.NORMAL_NPM);const mesh=new Mesh(geometry,material);mesh.blendMode=meshBlendMode,pageMeshData={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh,vertices:null,uvs:null,indices:null}}pageMeshData.index=0,pageMeshData.indexCount=0,pageMeshData.vertexCount=0,pageMeshData.uvsCount=0,pageMeshData.total=0;const{_textureCache}=this;_textureCache[baseTextureUid]=_textureCache[baseTextureUid]||new Texture(texture.baseTexture),pageMeshData.mesh.texture=_textureCache[baseTextureUid],pageMeshData.mesh.tint=this._tintColor.value,newPagesMeshData.push(pageMeshData),pagesMeshData[baseTextureUid]=pageMeshData}pagesMeshData[baseTextureUid].total++}for(let i2=0;i2<activePagesMeshData.length;i2++)newPagesMeshData.includes(activePagesMeshData[i2])||this.removeChild(activePagesMeshData[i2].mesh);for(let i2=0;i2<newPagesMeshData.length;i2++)newPagesMeshData[i2].mesh.parent!==this&&this.addChild(newPagesMeshData[i2].mesh);this._activePagesMeshData=newPagesMeshData;for(const i2 in pagesMeshData){const pageMeshData=pagesMeshData[i2],total=pageMeshData.total;if(!(((_a2=pageMeshData.indices)==null?void 0:_a2.length)>6*total)||pageMeshData.vertices.length<Mesh.BATCHABLE_SIZE*2)pageMeshData.vertices=new Float32Array(4*2*total),pageMeshData.uvs=new Float32Array(4*2*total),pageMeshData.indices=new Uint16Array(6*total);else{const total2=pageMeshData.total,vertices=pageMeshData.vertices;for(let i22=total2*4*2;i22<vertices.length;i22++)vertices[i22]=0}pageMeshData.mesh.size=6*total}for(let i2=0;i2<lenChars;i2++){const char=chars[i2];let offset=char.position.x+lineAlignOffsets[char.line]*(this._align==="justify"?char.prevSpaces:1);this._roundPixels&&(offset=Math.round(offset));const xPos=offset*scale,yPos=char.position.y*scale,texture=char.texture,pageMesh=pagesMeshData[texture.baseTexture.uid],textureFrame=texture.frame,textureUvs=texture._uvs,index=pageMesh.index++;pageMesh.indices[index*6+0]=0+index*4,pageMesh.indices[index*6+1]=1+index*4,pageMesh.indices[index*6+2]=2+index*4,pageMesh.indices[index*6+3]=0+index*4,pageMesh.indices[index*6+4]=2+index*4,pageMesh.indices[index*6+5]=3+index*4,pageMesh.vertices[index*8+0]=xPos,pageMesh.vertices[index*8+1]=yPos,pageMesh.vertices[index*8+2]=xPos+textureFrame.width*scale,pageMesh.vertices[index*8+3]=yPos,pageMesh.vertices[index*8+4]=xPos+textureFrame.width*scale,pageMesh.vertices[index*8+5]=yPos+textureFrame.height*scale,pageMesh.vertices[index*8+6]=xPos,pageMesh.vertices[index*8+7]=yPos+textureFrame.height*scale,pageMesh.uvs[index*8+0]=textureUvs.x0,pageMesh.uvs[index*8+1]=textureUvs.y0,pageMesh.uvs[index*8+2]=textureUvs.x1,pageMesh.uvs[index*8+3]=textureUvs.y1,pageMesh.uvs[index*8+4]=textureUvs.x2,pageMesh.uvs[index*8+5]=textureUvs.y2,pageMesh.uvs[index*8+6]=textureUvs.x3,pageMesh.uvs[index*8+7]=textureUvs.y3}this._textWidth=maxLineWidth*scale,this._textHeight=(pos.y+data.lineHeight)*scale;for(const i2 in pagesMeshData){const pageMeshData=pagesMeshData[i2];if(this.anchor.x!==0||this.anchor.y!==0){let vertexCount=0;const anchorOffsetX=this._textWidth*this.anchor.x,anchorOffsetY=this._textHeight*this.anchor.y;for(let i22=0;i22<pageMeshData.total;i22++)pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY}this._maxLineHeight=maxLineHeight*scale;const vertexBuffer=pageMeshData.mesh.geometry.getBuffer("aVertexPosition"),textureBuffer=pageMeshData.mesh.geometry.getBuffer("aTextureCoord"),indexBuffer=pageMeshData.mesh.geometry.getIndex();vertexBuffer.data=pageMeshData.vertices,textureBuffer.data=pageMeshData.uvs,indexBuffer.data=pageMeshData.indices,vertexBuffer.update(),textureBuffer.update(),indexBuffer.update()}for(let i2=0;i2<chars.length;i2++)charRenderDataPool.push(chars[i2]);this._font=data,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0);const{distanceFieldRange,distanceFieldType,size}=BitmapFont.available[this._fontName];if(distanceFieldType!=="none"){const{a:a2,b:b2,c:c2,d:d2}=this.worldTransform,dx=Math.sqrt(a2*a2+b2*b2),dy=Math.sqrt(c2*c2+d2*d2),worldScale=(Math.abs(dx)+Math.abs(dy))/2,fontScale=this.fontSize/size,resolution=renderer._view.resolution;for(const mesh of this._activePagesMeshData)mesh.mesh.shader.uniforms.uFWidth=worldScale*distanceFieldRange*fontScale*resolution}super._render(renderer)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const font=BitmapFont.available[this._fontName];if(!font)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==font&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(value){if(this.tint!==value){this._tintColor.setValue(value);for(let i2=0;i2<this._activePagesMeshData.length;i2++)this._activePagesMeshData[i2].mesh.tint=value}}get align(){return this._align}set align(value){this._align!==value&&(this._align=value,this.dirty=!0)}get fontName(){return this._fontName}set fontName(value){if(!BitmapFont.available[value])throw new Error(`Missing BitmapFont "${value}"`);this._fontName!==value&&(this._fontName=value,this.dirty=!0)}get fontSize(){var _a2;return(_a2=this._fontSize)!=null?_a2:BitmapFont.available[this._fontName].size}set fontSize(value){this._fontSize!==value&&(this._fontSize=value,this.dirty=!0)}get anchor(){return this._anchor}set anchor(value){typeof value=="number"?this._anchor.set(value):this._anchor.copyFrom(value)}get text(){return this._text}set text(text){text=String(text==null?"":text),this._text!==text&&(this._text=text,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(value){this._maxWidth!==value&&(this._maxWidth=value,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(value){this._letterSpacing!==value&&(this._letterSpacing=value,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(value){value!==this._roundPixels&&(this._roundPixels=value,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(value){this._autoResolution=!1,this._resolution!==value&&(this._resolution=value,this.dirty=!0)}destroy(options){const{_textureCache}=this,pageMeshDataPool=BitmapFont.available[this._fontName].distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;pageMeshDataPool.push(...this._activePagesMeshData);for(const pageMeshData of this._activePagesMeshData)this.removeChild(pageMeshData.mesh);this._activePagesMeshData=[],pageMeshDataPool.filter(page=>_textureCache[page.mesh.texture.baseTexture.uid]).forEach(page=>{page.mesh.texture=Texture.EMPTY});for(const id in _textureCache)_textureCache[id].destroy(),delete _textureCache[id];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(options)}};_BitmapText.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};let BitmapText=_BitmapText;const validExtensions=[".xml",".fnt"],loadBitmapFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},name:"loadBitmapFont",test(url2){return validExtensions.includes(path.extname(url2).toLowerCase())},async testParse(data){return TextFormat.test(data)||XMLStringFormat.test(data)},async parse(asset,data,loader){const fontData=TextFormat.test(asset)?TextFormat.parse(asset):XMLStringFormat.parse(asset),{src}=data,{page:pages}=fontData,textureUrls=[];for(let i2=0;i2<pages.length;++i2){const pageFile=pages[i2].file;let imagePath=path.join(path.dirname(src),pageFile);imagePath=copySearchParams(imagePath,src),textureUrls.push(imagePath)}const loadedTextures=await loader.load(textureUrls),textures=textureUrls.map(url2=>loadedTextures[url2]);return BitmapFont.install(fontData,textures,!0)},async load(url2,_options){return(await settings.ADAPTER.fetch(url2)).text()},unload(bitmapFont){bitmapFont.destroy()}};extensions$1.add(loadBitmapFont);var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__spreadValues=(a2,b2)=>{for(var prop in b2||(b2={}))__hasOwnProp.call(b2,prop)&&__defNormalProp(a2,prop,b2[prop]);if(__getOwnPropSymbols)for(var prop of __getOwnPropSymbols(b2))__propIsEnum.call(b2,prop)&&__defNormalProp(a2,prop,b2[prop]);return a2},__spreadProps=(a2,b2)=>__defProps(a2,__getOwnPropDescs(b2));const _HTMLTextStyle=class _HTMLTextStyle2 extends TextStyle{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(originalStyle){return new _HTMLTextStyle2(Object.keys(_HTMLTextStyle2.defaultOptions).reduce((obj,prop)=>__spreadProps(__spreadValues({},obj),{[prop]:originalStyle[prop]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(font=>{URL.revokeObjectURL(font.src),font.refs--,font.refs===0&&(font.fontFace&&document.fonts.delete(font.fontFace),delete _HTMLTextStyle2.availableFonts[font.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(url2,options={}){const{availableFonts}=_HTMLTextStyle2;if(availableFonts[url2]){const font=availableFonts[url2];return this._fonts.push(font),font.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return settings.ADAPTER.fetch(url2).then(response=>response.blob()).then(async blob=>new Promise((resolve2,reject)=>{const src=URL.createObjectURL(blob),reader=new FileReader;reader.onload=()=>resolve2([src,reader.result]),reader.onerror=reject,reader.readAsDataURL(blob)})).then(async([src,dataSrc])=>{const font=Object.assign({family:path.basename(url2,path.extname(url2)),weight:"normal",style:"normal",display:"auto",src,dataSrc,refs:1,originalUrl:url2,fontFace:null},options);availableFonts[url2]=font,this._fonts.push(font),this.styleID++;const fontFace=new FontFace(font.family,`url(${font.src})`,{weight:font.weight,style:font.style,display:font.display});font.fontFace=fontFace,await fontFace.load(),document.fonts.add(fontFace),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...value){const toAdd=value.filter(v2=>!this._overrides.includes(v2));toAdd.length>0&&(this._overrides.push(...toAdd),this.styleID++)}removeOverride(...value){const toRemove=value.filter(v2=>this._overrides.includes(v2));toRemove.length>0&&(this._overrides=this._overrides.filter(v2=>!toRemove.includes(v2)),this.styleID++)}toCSS(scale){return[`transform: scale(${scale})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...(this.lineHeight?[`line-height: ${this.lineHeight}px`]:[]),...(this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[]),...(this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[]),...(this.dropShadow?[this.dropShadowToCSS()]:[]),...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((result,font)=>`${result}
            @font-face {
                font-family: "${font.family}";
                src: url('${font.dataSrc}');
                font-weight: ${font.weight};
                font-style: ${font.style};
                font-display: ${font.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(value){this._stylesheet!==value&&(this._stylesheet=value,this.styleID++)}normalizeColor(color){return Array.isArray(color)&&(color=rgb2hex(color)),typeof color=="number"?hex2string(color):color}dropShadowToCSS(){let color=this.normalizeColor(this.dropShadowColor);const alpha=this.dropShadowAlpha,x2=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),y2=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);color.startsWith("#")&&alpha<1&&(color+=(alpha*255|0).toString(16).padStart(2,"0"));const position=`${x2}px ${y2}px`;return this.dropShadowBlur>0?`text-shadow: ${position} ${this.dropShadowBlur}px ${color}`:`text-shadow: ${position} ${color}`}reset(){Object.assign(this,_HTMLTextStyle2.defaultOptions)}onBeforeDraw(){const{fontsDirty:prevFontsDirty}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&prevFontsDirty?new Promise(resolve2=>setTimeout(resolve2,100)):Promise.resolve()}get isSafari(){const{userAgent}=settings.ADAPTER.getNavigator();return /^((?!chrome|android).)*safari/i.test(userAgent)}set fillGradientStops(_value){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(_value){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(_value){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(_value){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(_value){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(_value){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(_value){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};_HTMLTextStyle.availableFonts={},_HTMLTextStyle.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let HTMLTextStyle=_HTMLTextStyle;const _HTMLText=class _HTMLText2 extends Sprite{constructor(text="",style={}){var _a2;super(Texture.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const image=new Image,texture=Texture.from(image,{scaleMode:settings.SCALE_MODE,resourceOptions:{autoLoad:!1}});texture.orig=new Rectangle,texture.trim=new Rectangle,this.texture=texture;const nssvg="http://www.w3.org/2000/svg",nsxhtml="http://www.w3.org/1999/xhtml",svgRoot=document.createElementNS(nssvg,"svg"),foreignObject=document.createElementNS(nssvg,"foreignObject"),domElement=document.createElementNS(nsxhtml,"div"),styleElement=document.createElementNS(nsxhtml,"style");foreignObject.setAttribute("width","10000"),foreignObject.setAttribute("height","10000"),foreignObject.style.overflow="hidden",svgRoot.appendChild(foreignObject),this.maxWidth=_HTMLText2.defaultMaxWidth,this.maxHeight=_HTMLText2.defaultMaxHeight,this._domElement=domElement,this._styleElement=styleElement,this._svgRoot=svgRoot,this._foreignObject=foreignObject,this._foreignObject.appendChild(styleElement),this._foreignObject.appendChild(domElement),this._image=image,this._loadImage=new Image,this._autoResolution=_HTMLText2.defaultAutoResolution,this._resolution=(_a2=_HTMLText2.defaultResolution)!=null?_a2:settings.RESOLUTION,this.text=text,this.style=style}measureText(overrides){var _a2,_b;const{text,style,resolution}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},overrides);Object.assign(this._domElement,{innerHTML:text,style:style.toCSS(resolution)}),this._styleElement.textContent=style.toGlobalCSS(),document.body.appendChild(this._svgRoot);const contentBounds=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width,height}=contentBounds;(width>this.maxWidth||height>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const contentWidth=Math.min(this.maxWidth,Math.ceil(width)),contentHeight=Math.min(this.maxHeight,Math.ceil(height));return this._svgRoot.setAttribute("width",contentWidth.toString()),this._svgRoot.setAttribute("height",contentHeight.toString()),text!==this._text&&(this._domElement.innerHTML=this._text),style!==this._style&&(Object.assign(this._domElement,{style:(_a2=this._style)==null?void 0:_a2.toCSS(resolution)}),this._styleElement.textContent=(_b=this._style)==null?void 0:_b.toGlobalCSS()),{width:contentWidth+style.padding*2,height:contentHeight+style.padding*2}}async updateText(respectDirty=!0){const{style,_image:image,_loadImage:loadImage}=this;if(this.localStyleID!==style.styleID&&(this.dirty=!0,this.localStyleID=style.styleID),!this.dirty&&respectDirty)return;const{width,height}=this.measureText();image.width=loadImage.width=Math.ceil(Math.max(1,width)),image.height=loadImage.height=Math.ceil(Math.max(1,height)),this._updateID++;const updateID=this._updateID;await new Promise(resolve2=>{loadImage.onload=async()=>{if(updateID<this._updateID){resolve2();return}await style.onBeforeDraw(),image.src=loadImage.src,loadImage.onload=null,loadImage.src="",this.updateTexture(),resolve2()};const svgURL=new XMLSerializer().serializeToString(this._svgRoot);loadImage.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(svgURL)}`})}get source(){return this._image}updateTexture(){const{style,texture,_image:image,resolution}=this,{padding}=style,{baseTexture}=texture;texture.trim.width=texture._frame.width=image.width/resolution,texture.trim.height=texture._frame.height=image.height/resolution,texture.trim.x=-padding,texture.trim.y=-padding,texture.orig.width=texture._frame.width-padding*2,texture.orig.height=texture._frame.height-padding*2,this._onTextureUpdate(),baseTexture.setRealSize(image.width,image.height,resolution),this.dirty=!1}_render(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),super._render(renderer)}_renderCanvas(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(renderer)}getLocalBounds(rect){return this.updateText(!0),super.getLocalBounds(rect)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(options){var _a2,_b,_c,_d,_e;typeof options=="boolean"&&(options={children:options}),options=Object.assign({},_HTMLText2.defaultDestroyOptions,options),super.destroy(options);const forceClear=null;this.ownsStyle&&((_a2=this._style)==null||_a2.cleanFonts()),this._style=forceClear,(_b=this._svgRoot)==null||_b.remove(),this._svgRoot=forceClear,(_c=this._domElement)==null||_c.remove(),this._domElement=forceClear,(_d=this._foreignObject)==null||_d.remove(),this._foreignObject=forceClear,(_e=this._styleElement)==null||_e.remove(),this._styleElement=forceClear,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=forceClear,this._image.src="",this._image=forceClear}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(value){this.updateText(!0);const s2=sign(this.scale.x)||1;this.scale.x=s2*value/this._image.width/this.resolution,this._width=value}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(value){this.updateText(!0);const s2=sign(this.scale.y)||1;this.scale.y=s2*value/this._image.height/this.resolution,this._height=value}get style(){return this._style}set style(style){this._style!==style&&(style=style||{},style instanceof HTMLTextStyle?(this.ownsStyle=!1,this._style=style):style instanceof TextStyle?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=HTMLTextStyle.from(style)):(this.ownsStyle=!0,this._style=new HTMLTextStyle(style)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(text){text=String(text===""||text===null||text===void 0?" ":text),text=this.sanitiseText(text),this._text!==text&&(this._text=text,this.dirty=!0)}get resolution(){return this._resolution}set resolution(value){this._autoResolution=!1,this._resolution!==value&&(this._resolution=value,this.dirty=!0)}sanitiseText(text){return text.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};_HTMLText.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},_HTMLText.defaultMaxWidth=2024,_HTMLText.defaultMaxHeight=2024,_HTMLText.defaultAutoResolution=!0;let HTMLText=_HTMLText;const TEMP_RECT=new Rectangle;class CanvasExtract{constructor(renderer){this.renderer=renderer}async image(target,format2,quality,frame){const image=new Image;return image.src=await this.base64(target,format2,quality,frame),image}async base64(target,format2,quality,frame){const canvas=this.canvas(target,frame);if(canvas.toBlob!==void 0)return new Promise((resolve2,reject)=>{canvas.toBlob(blob=>{if(!blob){reject(new Error("ICanvas.toBlob failed!"));return}const reader=new FileReader;reader.onload=()=>resolve2(reader.result),reader.onerror=reject,reader.readAsDataURL(blob)},format2,quality)});if(canvas.toDataURL!==void 0)return canvas.toDataURL(format2,quality);if(canvas.convertToBlob!==void 0){const blob=await canvas.convertToBlob({type:format2,quality});return new Promise((resolve2,reject)=>{const reader=new FileReader;reader.onload=()=>resolve2(reader.result),reader.onerror=reject,reader.readAsDataURL(blob)})}throw new Error("CanvasExtract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(target,frame){const renderer=this.renderer;if(!renderer)throw new Error("The CanvasExtract has already been destroyed");let context2,resolution,renderTexture;target&&(target instanceof RenderTexture?renderTexture=target:(renderTexture=renderer.generateTexture(target,{region:frame,resolution:renderer.resolution}),frame&&(TEMP_RECT.width=frame.width,TEMP_RECT.height=frame.height,frame=TEMP_RECT))),renderTexture?(context2=renderTexture.baseTexture._canvasRenderTarget.context,resolution=renderTexture.baseTexture._canvasRenderTarget.resolution,frame=frame!=null?frame:renderTexture.frame):(context2=renderer.canvasContext.rootContext,resolution=renderer._view.resolution,frame||(frame=TEMP_RECT,frame.width=renderer.width/resolution,frame.height=renderer.height/resolution));const x2=Math.round(frame.x*resolution),y2=Math.round(frame.y*resolution),width=Math.max(Math.round(frame.width*resolution),1),height=Math.max(Math.round(frame.height*resolution),1),canvasBuffer=new CanvasRenderTarget(width,height,1),canvasData=context2.getImageData(x2,y2,width,height);return canvasBuffer.context.putImageData(canvasData,0,0),canvasBuffer.canvas}pixels(target,frame){const renderer=this.renderer;if(!renderer)throw new Error("The CanvasExtract has already been destroyed");let context2,resolution,renderTexture;target&&(target instanceof RenderTexture?renderTexture=target:(renderTexture=renderer.generateTexture(target,{region:frame,resolution:renderer.resolution}),frame&&(TEMP_RECT.width=frame.width,TEMP_RECT.height=frame.height,frame=TEMP_RECT))),renderTexture?(context2=renderTexture.baseTexture._canvasRenderTarget.context,resolution=renderTexture.baseTexture._canvasRenderTarget.resolution,frame=frame!=null?frame:renderTexture.frame):(context2=renderer.canvasContext.rootContext,resolution=renderer.resolution,frame||(frame=TEMP_RECT,frame.width=renderer.width/resolution,frame.height=renderer.height/resolution));const x2=Math.round(frame.x*resolution),y2=Math.round(frame.y*resolution),width=Math.max(Math.round(frame.width*resolution),1),height=Math.max(Math.round(frame.height*resolution),1);return context2.getImageData(x2,y2,width,height).data}destroy(){this.renderer=null}}CanvasExtract.extension={name:"extract",type:ExtensionType.CanvasRendererSystem},extensions$1.add(CanvasExtract);let canvasRenderer;const tempMatrix=new Matrix;Graphics.prototype.generateCanvasTexture=function(scaleMode,resolution=1){const bounds=this.getLocalBounds(new Rectangle);bounds.width=Math.max(bounds.width,1/resolution),bounds.height=Math.max(bounds.height,1/resolution);const canvasBuffer=RenderTexture.create({width:bounds.width,height:bounds.height,scaleMode,resolution});canvasRenderer||(canvasRenderer=new CanvasRenderer),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(tempMatrix),tempMatrix.invert(),tempMatrix.tx-=bounds.x,tempMatrix.ty-=bounds.y,canvasRenderer.render(this,{renderTexture:canvasBuffer,clear:!0,transform:tempMatrix});const texture=Texture.from(canvasBuffer.baseTexture._canvasRenderTarget.canvas,{scaleMode});return texture.baseTexture.setResolution(resolution),texture},Graphics.prototype.cachedGraphicsData=[],Graphics.prototype._renderCanvas=function(renderer){this.isMask!==!0&&(this.finishPoly(),renderer.plugins.graphics.render(this))};class PolygonUtils{static offsetPolygon(points,offset){const offsetPoints=[],length=points.length;offset=PolygonUtils.isPolygonClockwise(points)?offset:-1*offset;for(let j2=0;j2<length;j2+=2){let i2=j2-2;i2<0&&(i2+=length);const k2=(j2+2)%length;let v1x=points[j2]-points[i2],v1y=points[j2+1]-points[i2+1],len=Math.sqrt(v1x*v1x+v1y*v1y);v1x/=len,v1y/=len,v1x*=offset,v1y*=offset;const norm1x=-v1y,norm1y=v1x,pij1=[points[i2]+norm1x,points[i2+1]+norm1y],pij2=[points[j2]+norm1x,points[j2+1]+norm1y];let v2x=points[k2]-points[j2],v2y=points[k2+1]-points[j2+1];len=Math.sqrt(v2x*v2x+v2y*v2y),v2x/=len,v2y/=len,v2x*=offset,v2y*=offset;const norm2x=-v2y,norm2y=v2x,pjk1=[points[j2]+norm2x,points[j2+1]+norm2y],pjk2=[points[k2]+norm2x,points[k2+1]+norm2y],intersectPoint=PolygonUtils.findIntersection(pij1[0],pij1[1],pij2[0],pij2[1],pjk1[0],pjk1[1],pjk2[0],pjk2[1]);intersectPoint&&offsetPoints.push(...intersectPoint)}return offsetPoints}static findIntersection(x1,y1,x2,y2,x3,y3,x4,y4){const denominator=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1),numeratorA=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3),numeratorB=(x2-x1)*(y1-y3)-(y2-y1)*(x1-x3);if(denominator===0)return numeratorA===0&&numeratorB===0?[(x1+x2)/2,(y1+y2)/2]:null;const uA=numeratorA/denominator;return[x1+uA*(x2-x1),y1+uA*(y2-y1)]}static isPolygonClockwise(polygon){let sum=0;for(let i2=0,j2=polygon.length-2;i2<polygon.length;j2=i2,i2+=2)sum+=(polygon[i2]-polygon[j2])*(polygon[i2+1]+polygon[j2+1]);return sum>0}}class CanvasGraphicsRenderer{constructor(renderer){this._svgMatrix=null,this._tempMatrix=new Matrix,this.renderer=renderer}_calcCanvasStyle(style,tint){let res;return style.texture&&style.texture.baseTexture!==Texture.WHITE.baseTexture?style.texture.valid?(res=canvasUtils.getTintedPattern(style.texture,tint),this.setPatternTransform(res,style.matrix||Matrix.IDENTITY)):res="#808080":res=`#${`00000${(tint|0).toString(16)}`.slice(-6)}`,res}render(graphics){const renderer=this.renderer,context2=renderer.canvasContext.activeContext,worldAlpha=graphics.worldAlpha,transform=graphics.transform.worldTransform;renderer.canvasContext.setContextTransform(transform),renderer.canvasContext.setBlendMode(graphics.blendMode);const graphicsData=graphics.geometry.graphicsData;let contextFillStyle,contextStrokeStyle;const tint=Color.shared.setValue(graphics.tint).toArray();for(let i2=0;i2<graphicsData.length;i2++){const data=graphicsData[i2],shape=data.shape,fillStyle=data.fillStyle,lineStyle=data.lineStyle,fillColor=data.fillStyle.color|0,lineColor=data.lineStyle.color|0;if(data.matrix&&renderer.canvasContext.setContextTransform(transform.copyTo(this._tempMatrix).append(data.matrix)),fillStyle.visible&&(contextFillStyle=this._calcCanvasStyle(fillStyle,Color.shared.setValue(fillColor).multiply(tint).toNumber())),lineStyle.visible&&(contextStrokeStyle=this._calcCanvasStyle(lineStyle,Color.shared.setValue(lineColor).multiply(tint).toNumber())),context2.lineWidth=lineStyle.width,context2.lineCap=lineStyle.cap,context2.lineJoin=lineStyle.join,context2.miterLimit=lineStyle.miterLimit,data.type===SHAPES.POLY){context2.beginPath();const tempShape=shape;let points=tempShape.points;const holes=data.holes;let outerArea,innerArea,px,py,holesDirection;context2.moveTo(points[0],points[1]);for(let j2=2;j2<points.length;j2+=2)context2.lineTo(points[j2],points[j2+1]);if(tempShape.closeStroke&&context2.closePath(),holes.length>0){holesDirection=[],outerArea=0,px=points[0],py=points[1];for(let j2=2;j2+2<points.length;j2+=2)outerArea+=(points[j2]-px)*(points[j2+3]-py)-(points[j2+2]-px)*(points[j2+1]-py);for(let k2=0;k2<holes.length;k2++)if(points=holes[k2].shape.points,!!points){innerArea=0,px=points[0],py=points[1];for(let j2=2;j2+2<points.length;j2+=2)innerArea+=(points[j2]-px)*(points[j2+3]-py)-(points[j2+2]-px)*(points[j2+1]-py);if(innerArea*outerArea<0){context2.moveTo(points[0],points[1]);for(let j2=2;j2<points.length;j2+=2)context2.lineTo(points[j2],points[j2+1])}else{context2.moveTo(points[points.length-2],points[points.length-1]);for(let j2=points.length-4;j2>=0;j2-=2)context2.lineTo(points[j2],points[j2+1])}holes[k2].shape.closeStroke&&context2.closePath(),holesDirection[k2]=innerArea*outerArea<0}}fillStyle.visible&&(context2.globalAlpha=fillStyle.alpha*worldAlpha,context2.fillStyle=contextFillStyle,context2.fill()),lineStyle.visible&&this.paintPolygonStroke(tempShape,lineStyle,contextStrokeStyle,holes,holesDirection,worldAlpha,context2)}else if(data.type===SHAPES.RECT){const tempShape=shape;if(fillStyle.visible&&(context2.globalAlpha=fillStyle.alpha*worldAlpha,context2.fillStyle=contextFillStyle,context2.fillRect(tempShape.x,tempShape.y,tempShape.width,tempShape.height)),lineStyle.visible){const alignmentOffset=lineStyle.width*(0.5-(1-lineStyle.alignment)),width=tempShape.width+2*alignmentOffset,height=tempShape.height+2*alignmentOffset;context2.globalAlpha=lineStyle.alpha*worldAlpha,context2.strokeStyle=contextStrokeStyle,context2.strokeRect(tempShape.x-alignmentOffset,tempShape.y-alignmentOffset,width,height)}}else if(data.type===SHAPES.CIRC){const tempShape=shape;if(context2.beginPath(),context2.arc(tempShape.x,tempShape.y,tempShape.radius,0,2*Math.PI),context2.closePath(),fillStyle.visible&&(context2.globalAlpha=fillStyle.alpha*worldAlpha,context2.fillStyle=contextFillStyle,context2.fill()),lineStyle.visible){if(lineStyle.alignment!==0.5){const alignmentOffset=lineStyle.width*(0.5-(1-lineStyle.alignment));context2.beginPath(),context2.arc(tempShape.x,tempShape.y,tempShape.radius+alignmentOffset,0,2*Math.PI),context2.closePath()}context2.globalAlpha=lineStyle.alpha*worldAlpha,context2.strokeStyle=contextStrokeStyle,context2.stroke()}}else if(data.type===SHAPES.ELIP){const tempShape=shape,drawShapeOverStroke=lineStyle.alignment===1;if(drawShapeOverStroke||this.paintEllipse(tempShape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context2),lineStyle.visible){if(lineStyle.alignment!==0.5){const kappa=0.5522848,alignmentOffset=lineStyle.width*(0.5-(1-lineStyle.alignment)),sW=(tempShape.width+alignmentOffset)*2,sH=(tempShape.height+alignmentOffset)*2,sX=tempShape.x-sW/2,sY=tempShape.y-sH/2,sOx=sW/2*kappa,sOy=sH/2*kappa,sXe=sX+sW,sYe=sY+sH,sXm=sX+sW/2,sYm=sY+sH/2;context2.beginPath(),context2.moveTo(sX,sYm),context2.bezierCurveTo(sX,sYm-sOy,sXm-sOx,sY,sXm,sY),context2.bezierCurveTo(sXm+sOx,sY,sXe,sYm-sOy,sXe,sYm),context2.bezierCurveTo(sXe,sYm+sOy,sXm+sOx,sYe,sXm,sYe),context2.bezierCurveTo(sXm-sOx,sYe,sX,sYm+sOy,sX,sYm),context2.closePath()}context2.globalAlpha=lineStyle.alpha*worldAlpha,context2.strokeStyle=contextStrokeStyle,context2.stroke()}drawShapeOverStroke&&this.paintEllipse(tempShape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context2)}else if(data.type===SHAPES.RREC){const tempShape=shape,drawShapeOverStroke=lineStyle.alignment===1;if(drawShapeOverStroke||this.paintRoundedRectangle(tempShape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context2),lineStyle.visible){if(lineStyle.alignment!==0.5){const width=tempShape.width,height=tempShape.height,alignmentOffset=lineStyle.width*(0.5-(1-lineStyle.alignment)),sRx=tempShape.x-alignmentOffset,sRy=tempShape.y-alignmentOffset,sWidth=tempShape.width+2*alignmentOffset,sHeight=tempShape.height+2*alignmentOffset,radiusOffset=alignmentOffset*(lineStyle.alignment>=1?Math.min(sWidth/width,sHeight/height):Math.min(width/sWidth,height/sHeight));let sRadius=tempShape.radius+radiusOffset;const sMaxRadius=Math.min(sWidth,sHeight)/2;sRadius=sRadius>sMaxRadius?sMaxRadius:sRadius,context2.beginPath(),context2.moveTo(sRx,sRy+sRadius),context2.lineTo(sRx,sRy+sHeight-sRadius),context2.quadraticCurveTo(sRx,sRy+sHeight,sRx+sRadius,sRy+sHeight),context2.lineTo(sRx+sWidth-sRadius,sRy+sHeight),context2.quadraticCurveTo(sRx+sWidth,sRy+sHeight,sRx+sWidth,sRy+sHeight-sRadius),context2.lineTo(sRx+sWidth,sRy+sRadius),context2.quadraticCurveTo(sRx+sWidth,sRy,sRx+sWidth-sRadius,sRy),context2.lineTo(sRx+sRadius,sRy),context2.quadraticCurveTo(sRx,sRy,sRx,sRy+sRadius),context2.closePath()}context2.globalAlpha=lineStyle.alpha*worldAlpha,context2.strokeStyle=contextStrokeStyle,context2.stroke()}drawShapeOverStroke&&this.paintRoundedRectangle(tempShape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context2)}}}paintPolygonStroke(shape,lineStyle,contextStrokeStyle,holes,holesDirection,worldAlpha,context2){if(lineStyle.alignment!==0.5){const alignmentOffset=lineStyle.width*(0.5-(1-lineStyle.alignment));let offsetPoints=PolygonUtils.offsetPolygon(shape.points,alignmentOffset),points;context2.beginPath(),context2.moveTo(offsetPoints[0],offsetPoints[1]);for(let j2=2;j2<offsetPoints.length;j2+=2)context2.lineTo(offsetPoints[j2],offsetPoints[j2+1]);shape.closeStroke&&context2.closePath();for(let k2=0;k2<holes.length;k2++){if(points=holes[k2].shape.points,offsetPoints=PolygonUtils.offsetPolygon(points,alignmentOffset),holesDirection[k2]){context2.moveTo(offsetPoints[0],offsetPoints[1]);for(let j2=2;j2<offsetPoints.length;j2+=2)context2.lineTo(offsetPoints[j2],offsetPoints[j2+1])}else{context2.moveTo(offsetPoints[offsetPoints.length-2],offsetPoints[offsetPoints.length-1]);for(let j2=offsetPoints.length-4;j2>=0;j2-=2)context2.lineTo(offsetPoints[j2],offsetPoints[j2+1])}holes[k2].shape.closeStroke&&context2.closePath()}}context2.globalAlpha=lineStyle.alpha*worldAlpha,context2.strokeStyle=contextStrokeStyle,context2.stroke()}paintEllipse(shape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context2){const w2=shape.width*2,h2=shape.height*2,x2=shape.x-w2/2,y2=shape.y-h2/2,kappa=0.5522848,ox=w2/2*kappa,oy=h2/2*kappa,xe=x2+w2,ye=y2+h2,xm=x2+w2/2,ym=y2+h2/2;lineStyle.alignment===0&&context2.save(),context2.beginPath(),context2.moveTo(x2,ym),context2.bezierCurveTo(x2,ym-oy,xm-ox,y2,xm,y2),context2.bezierCurveTo(xm+ox,y2,xe,ym-oy,xe,ym),context2.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context2.bezierCurveTo(xm-ox,ye,x2,ym+oy,x2,ym),context2.closePath(),lineStyle.alignment===0&&context2.clip(),fillStyle.visible&&(context2.globalAlpha=fillStyle.alpha*worldAlpha,context2.fillStyle=contextFillStyle,context2.fill()),lineStyle.alignment===0&&context2.restore()}paintRoundedRectangle(shape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context2){const rx=shape.x,ry=shape.y,width=shape.width,height=shape.height;let radius=shape.radius;const maxRadius=Math.min(width,height)/2;radius=radius>maxRadius?maxRadius:radius,lineStyle.alignment===0&&context2.save(),context2.beginPath(),context2.moveTo(rx,ry+radius),context2.lineTo(rx,ry+height-radius),context2.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context2.lineTo(rx+width-radius,ry+height),context2.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context2.lineTo(rx+width,ry+radius),context2.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context2.lineTo(rx+radius,ry),context2.quadraticCurveTo(rx,ry,rx,ry+radius),context2.closePath(),lineStyle.alignment===0&&context2.clip(),fillStyle.visible&&(context2.globalAlpha=fillStyle.alpha*worldAlpha,context2.fillStyle=contextFillStyle,context2.fill()),lineStyle.alignment===0&&context2.restore()}setPatternTransform(pattern,matrix){if(this._svgMatrix!==!1){if(!this._svgMatrix){const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");if(svg!=null&&svg.createSVGMatrix&&(this._svgMatrix=svg.createSVGMatrix()),!this._svgMatrix||!pattern.setTransform){this._svgMatrix=!1;return}}this._svgMatrix.a=matrix.a,this._svgMatrix.b=matrix.b,this._svgMatrix.c=matrix.c,this._svgMatrix.d=matrix.d,this._svgMatrix.e=matrix.tx,this._svgMatrix.f=matrix.ty,pattern.setTransform(this._svgMatrix.inverse())}}destroy(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null}}CanvasGraphicsRenderer.extension={name:"graphics",type:ExtensionType.CanvasRendererPlugin},extensions$1.add(CanvasGraphicsRenderer),Object.defineProperties(settings,{MESH_CANVAS_PADDING:{get(){return Mesh.defaultCanvasPadding},set(value){deprecation$1("7.1.0","settings.MESH_CANVAS_PADDING is deprecated, use Mesh.defaultCanvasPadding"),Mesh.defaultCanvasPadding=value}}}),MeshMaterial.prototype._renderCanvas=function(renderer,mesh){renderer.plugins.mesh.render(mesh)},NineSlicePlane.prototype._cachedTint=16777215,NineSlicePlane.prototype._tintedCanvas=null,NineSlicePlane.prototype._canvasUvs=null,NineSlicePlane.prototype._renderCanvas=function(renderer){const context2=renderer.canvasContext.activeContext,transform=this.worldTransform,isTinted=this.tintValue!==16777215,texture=this.texture;if(!texture.valid)return;isTinted&&this._cachedTint!==this.tintValue&&(this._cachedTint=this.tintValue,this._tintedCanvas=canvasUtils.getTintedCanvas(this,this.tintValue));const textureSource=isTinted?this._tintedCanvas:texture.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);const vertices=this.vertices,uvs=this._canvasUvs,u0=isTinted?0:texture.frame.x,v0=isTinted?0:texture.frame.y,u1=u0+texture.frame.width,v1=v0+texture.frame.height;uvs[0]=u0,uvs[1]=u0+this._leftWidth,uvs[2]=u1-this._rightWidth,uvs[3]=u1,uvs[4]=v0,uvs[5]=v0+this._topHeight,uvs[6]=v1-this._bottomHeight,uvs[7]=v1;for(let i2=0;i2<8;i2++)uvs[i2]*=texture.baseTexture.resolution;context2.globalAlpha=this.worldAlpha,renderer.canvasContext.setBlendMode(this.blendMode),renderer.canvasContext.setContextTransform(transform,this.roundPixels);for(let row=0;row<3;row++)for(let col=0;col<3;col++){const ind=col*2+row*8,sw=Math.max(1,uvs[col+1]-uvs[col]),sh=Math.max(1,uvs[row+5]-uvs[row+4]),dw=Math.max(1,vertices[ind+10]-vertices[ind]),dh=Math.max(1,vertices[ind+11]-vertices[ind+1]);context2.drawImage(textureSource,uvs[col],uvs[row+4],sw,sh,vertices[ind],vertices[ind+1],dw,dh)}};let warned=!1;Mesh.prototype._cachedTint=16777215,Mesh.prototype._tintedCanvas=null,Mesh.prototype._cachedTexture=null,Mesh.prototype._renderCanvas=function(renderer){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(renderer,this):warned||(warned=!0,globalThis.console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))},Mesh.prototype._canvasPadding=null,Mesh.defaultCanvasPadding=0,Object.defineProperty(Mesh.prototype,"canvasPadding",{get(){var _a2;return(_a2=this._canvasPadding)!=null?_a2:Mesh.defaultCanvasPadding},set(value){this._canvasPadding=value}}),SimpleMesh.prototype._renderCanvas=function(renderer){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(renderer,this)},SimpleRope.prototype._renderCanvas=function(renderer){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(renderer,this)};class CanvasMeshRenderer{constructor(renderer){this.renderer=renderer}render(mesh){const renderer=this.renderer,transform=mesh.worldTransform;renderer.canvasContext.activeContext.globalAlpha=mesh.worldAlpha,renderer.canvasContext.setBlendMode(mesh.blendMode),renderer.canvasContext.setContextTransform(transform,mesh.roundPixels),mesh.drawMode!==DRAW_MODES.TRIANGLES?this._renderTriangleMesh(mesh):this._renderTriangles(mesh)}_renderTriangleMesh(mesh){const length=mesh.geometry.buffers[0].data.length;for(let i2=0;i2<length-2;i2++){const index=i2*2;this._renderDrawTriangle(mesh,index,index+2,index+4)}}_renderTriangles(mesh){const indices2=mesh.geometry.getIndex().data,length=indices2.length;for(let i2=0;i2<length;i2+=3){const index0=indices2[i2]*2,index1=indices2[i2+1]*2,index2=indices2[i2+2]*2;this._renderDrawTriangle(mesh,index0,index1,index2)}}_renderDrawTriangle(mesh,index0,index1,index2){var _a2;const context2=this.renderer.canvasContext.activeContext,vertices=mesh.geometry.buffers[0].data,{uvs,texture}=mesh;if(!texture.valid)return;const isTinted=mesh.tintValue!==16777215,base=texture.baseTexture,textureWidth=base.width,textureHeight=base.height;mesh._cachedTexture&&mesh._cachedTexture.baseTexture!==base&&(mesh._cachedTint=16777215,(_a2=mesh._cachedTexture)==null||_a2.destroy(),mesh._cachedTexture=null,mesh._tintedCanvas=null),isTinted&&mesh._cachedTint!==mesh.tintValue&&(mesh._cachedTint=mesh.tintValue,mesh._cachedTexture=mesh._cachedTexture||new Texture(base),mesh._tintedCanvas=canvasUtils.getTintedCanvas({texture:mesh._cachedTexture},mesh.tintValue));const textureSource=isTinted?mesh._tintedCanvas:base.getDrawableSource(),u0=uvs[index0]*base.width,u1=uvs[index1]*base.width,u2=uvs[index2]*base.width,v0=uvs[index0+1]*base.height,v1=uvs[index1+1]*base.height,v2=uvs[index2+1]*base.height;let x0=vertices[index0],x1=vertices[index1],x2=vertices[index2],y0=vertices[index0+1],y1=vertices[index1+1],y2=vertices[index2+1];const screenPadding=mesh.canvasPadding/this.renderer.canvasContext.activeResolution;if(screenPadding>0){const{a:a2,b:b2,c:c2,d:d2}=mesh.worldTransform,centerX=(x0+x1+x2)/3,centerY=(y0+y1+y2)/3;let normX=x0-centerX,normY=y0-centerY,screenX=a2*normX+c2*normY,screenY=b2*normX+d2*normY,screenDist=Math.sqrt(screenX*screenX+screenY*screenY),paddingFactor=1+screenPadding/screenDist;x0=centerX+normX*paddingFactor,y0=centerY+normY*paddingFactor,normX=x1-centerX,normY=y1-centerY,screenX=a2*normX+c2*normY,screenY=b2*normX+d2*normY,screenDist=Math.sqrt(screenX*screenX+screenY*screenY),paddingFactor=1+screenPadding/screenDist,x1=centerX+normX*paddingFactor,y1=centerY+normY*paddingFactor,normX=x2-centerX,normY=y2-centerY,screenX=a2*normX+c2*normY,screenY=b2*normX+d2*normY,screenDist=Math.sqrt(screenX*screenX+screenY*screenY),paddingFactor=1+screenPadding/screenDist,x2=centerX+normX*paddingFactor,y2=centerY+normY*paddingFactor}context2.save(),context2.beginPath(),context2.moveTo(x0,y0),context2.lineTo(x1,y1),context2.lineTo(x2,y2),context2.closePath(),context2.clip();const delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2,deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2,deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2,deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2,deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2,deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2,deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context2.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta),context2.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight),context2.restore(),this.renderer.canvasContext.invalidateBlendMode()}renderMeshFlat(mesh){const context2=this.renderer.canvasContext.activeContext,vertices=mesh.geometry.getBuffer("aVertexPosition").data,length=vertices.length/2;context2.beginPath();for(let i2=1;i2<length-2;++i2){const index=i2*2,x0=vertices[index],y0=vertices[index+1],x1=vertices[index+2],y1=vertices[index+3],x2=vertices[index+4],y2=vertices[index+5];context2.moveTo(x0,y0),context2.lineTo(x1,y1),context2.lineTo(x2,y2)}context2.fillStyle="#FF0000",context2.fill(),context2.closePath()}destroy(){this.renderer=null}}CanvasMeshRenderer.extension={name:"mesh",type:ExtensionType.CanvasRendererPlugin},extensions$1.add(CanvasMeshRenderer);const CANVAS_START_SIZE=16;function uploadBaseTextures(prepare,item){const tempPrepare=prepare;if(item instanceof BaseTexture){const image=item.source,imageWidth=image.width===0?tempPrepare.canvas.width:Math.min(tempPrepare.canvas.width,image.width),imageHeight=image.height===0?tempPrepare.canvas.height:Math.min(tempPrepare.canvas.height,image.height);return tempPrepare.ctx.drawImage(image,0,0,imageWidth,imageHeight,0,0,tempPrepare.canvas.width,tempPrepare.canvas.height),!0}return!1}class CanvasPrepare extends BasePrepare{constructor(renderer){super(renderer),this.uploadHookHelper=this,this.canvas=settings.ADAPTER.createCanvas(CANVAS_START_SIZE,CANVAS_START_SIZE),this.ctx=this.canvas.getContext("2d"),this.registerUploadHook(uploadBaseTextures)}destroy(){super.destroy(),this.ctx=null,this.canvas=null}}CanvasPrepare.extension={name:"prepare",type:ExtensionType.CanvasRendererSystem},extensions$1.add(CanvasPrepare),Sprite.prototype._tintedCanvas=null,Sprite.prototype._renderCanvas=function(renderer){renderer.plugins.sprite.render(this)};const canvasRenderWorldTransform=new Matrix;class CanvasSpriteRenderer{constructor(renderer){this.renderer=renderer}render(sprite){const texture=sprite._texture,renderer=this.renderer,context2=renderer.canvasContext.activeContext,activeResolution=renderer.canvasContext.activeResolution;if(!texture.valid)return;const sourceWidth=texture._frame.width,sourceHeight=texture._frame.height;let destWidth=texture._frame.width,destHeight=texture._frame.height;texture.trim&&(destWidth=texture.trim.width,destHeight=texture.trim.height);let wt=sprite.transform.worldTransform,dx=0,dy=0;const source=texture.baseTexture.getDrawableSource();if(texture.orig.width<=0||texture.orig.height<=0||!texture.valid||!source)return;renderer.canvasContext.setBlendMode(sprite.blendMode,!0),context2.globalAlpha=sprite.worldAlpha;const smoothingEnabled=texture.baseTexture.scaleMode===SCALE_MODES.LINEAR,smoothProperty=renderer.canvasContext.smoothProperty;smoothProperty&&context2[smoothProperty]!==smoothingEnabled&&(context2[smoothProperty]=smoothingEnabled),texture.trim?(dx=texture.trim.width/2+texture.trim.x-sprite.anchor.x*texture.orig.width,dy=texture.trim.height/2+texture.trim.y-sprite.anchor.y*texture.orig.height):(dx=(0.5-sprite.anchor.x)*texture.orig.width,dy=(0.5-sprite.anchor.y)*texture.orig.height),texture.rotate&&(wt.copyTo(canvasRenderWorldTransform),wt=canvasRenderWorldTransform,groupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy),dx=0,dy=0),dx-=destWidth/2,dy-=destHeight/2,renderer.canvasContext.setContextTransform(wt,sprite.roundPixels,1),sprite.roundPixels&&(dx=dx|0,dy=dy|0);const resolution=texture.baseTexture.resolution,outerBlend=renderer.canvasContext._outerBlend;outerBlend&&(context2.save(),context2.beginPath(),context2.rect(dx*activeResolution,dy*activeResolution,destWidth*activeResolution,destHeight*activeResolution),context2.clip()),sprite.tint!==16777215?((sprite._cachedTint!==sprite.tintValue||sprite._tintedCanvas.tintId!==sprite._texture._updateID)&&(sprite._cachedTint=sprite.tintValue,sprite._tintedCanvas=canvasUtils.getTintedCanvas(sprite,sprite.tintValue)),context2.drawImage(sprite._tintedCanvas,0,0,Math.floor(sourceWidth*resolution),Math.floor(sourceHeight*resolution),Math.floor(dx*activeResolution),Math.floor(dy*activeResolution),Math.floor(destWidth*activeResolution),Math.floor(destHeight*activeResolution))):context2.drawImage(source,texture._frame.x*resolution,texture._frame.y*resolution,Math.floor(sourceWidth*resolution),Math.floor(sourceHeight*resolution),Math.floor(dx*activeResolution),Math.floor(dy*activeResolution),Math.floor(destWidth*activeResolution),Math.floor(destHeight*activeResolution)),outerBlend&&context2.restore(),renderer.canvasContext.setBlendMode(BLEND_MODES.NORMAL)}destroy(){this.renderer=null}}return CanvasSpriteRenderer.extension={name:"sprite",type:ExtensionType.CanvasRendererPlugin},extensions$1.add(CanvasSpriteRenderer),exports.ALPHA_MODES=ALPHA_MODES,exports.AbstractMultiResource=AbstractMultiResource,exports.AccessibilityManager=AccessibilityManager,exports.AlphaFilter=AlphaFilter,exports.AnimatedSprite=AnimatedSprite,exports.Application=Application,exports.ArrayResource=ArrayResource,exports.Assets=Assets,exports.AssetsClass=AssetsClass,exports.Attribute=Attribute,exports.BLEND_MODES=BLEND_MODES,exports.BUFFER_BITS=BUFFER_BITS,exports.BUFFER_TYPE=BUFFER_TYPE,exports.BackgroundSystem=BackgroundSystem,exports.BaseImageResource=BaseImageResource,exports.BasePrepare=BasePrepare,exports.BaseRenderTexture=BaseRenderTexture,exports.BaseTexture=BaseTexture,exports.BatchDrawCall=BatchDrawCall,exports.BatchGeometry=BatchGeometry,exports.BatchRenderer=BatchRenderer,exports.BatchShaderGenerator=BatchShaderGenerator,exports.BatchSystem=BatchSystem,exports.BatchTextureArray=BatchTextureArray,exports.BitmapFont=BitmapFont,exports.BitmapFontData=BitmapFontData,exports.BitmapText=BitmapText,exports.BlobResource=BlobResource,exports.BlurFilter=BlurFilter,exports.BlurFilterPass=BlurFilterPass,exports.Bounds=Bounds,exports.BrowserAdapter=BrowserAdapter,exports.Buffer=Buffer,exports.BufferResource=BufferResource,exports.BufferSystem=BufferSystem,exports.CLEAR_MODES=CLEAR_MODES,exports.COLOR_MASK_BITS=COLOR_MASK_BITS,exports.Cache=Cache,exports.CanvasContextSystem=CanvasContextSystem,exports.CanvasExtract=CanvasExtract,exports.CanvasGraphicsRenderer=CanvasGraphicsRenderer,exports.CanvasMaskSystem=CanvasMaskSystem,exports.CanvasMeshRenderer=CanvasMeshRenderer,exports.CanvasObjectRendererSystem=CanvasObjectRendererSystem,exports.CanvasPrepare=CanvasPrepare,exports.CanvasRenderer=CanvasRenderer,exports.CanvasResource=CanvasResource,exports.CanvasSpriteRenderer=CanvasSpriteRenderer,exports.Circle=Circle,exports.Color=Color,exports.ColorMatrixFilter=ColorMatrixFilter,exports.CompressedTextureResource=CompressedTextureResource,exports.Container=Container,exports.ContextSystem=ContextSystem,exports.CountLimiter=CountLimiter,exports.CubeResource=CubeResource,exports.DEG_TO_RAD=DEG_TO_RAD,exports.DRAW_MODES=DRAW_MODES,exports.DisplacementFilter=DisplacementFilter,exports.DisplayObject=DisplayObject,exports.ENV=ENV,exports.Ellipse=Ellipse,exports.EventBoundary=EventBoundary,exports.EventSystem=EventSystem,exports.ExtensionType=ExtensionType,exports.Extract=Extract,exports.FORMATS=FORMATS,exports.FORMATS_TO_COMPONENTS=FORMATS_TO_COMPONENTS,exports.FXAAFilter=FXAAFilter,exports.FederatedDisplayObject=FederatedDisplayObject,exports.FederatedEvent=FederatedEvent,exports.FederatedMouseEvent=FederatedMouseEvent,exports.FederatedPointerEvent=FederatedPointerEvent,exports.FederatedWheelEvent=FederatedWheelEvent,exports.FillStyle=FillStyle,exports.Filter=Filter,exports.FilterState=FilterState,exports.FilterSystem=FilterSystem,exports.Framebuffer=Framebuffer,exports.FramebufferSystem=FramebufferSystem,exports.GC_MODES=GC_MODES,exports.GLFramebuffer=GLFramebuffer,exports.GLProgram=GLProgram,exports.GLTexture=GLTexture,exports.GRAPHICS_CURVES=GRAPHICS_CURVES,exports.GenerateTextureSystem=GenerateTextureSystem,exports.Geometry=Geometry,exports.GeometrySystem=GeometrySystem,exports.Graphics=Graphics,exports.GraphicsData=GraphicsData,exports.GraphicsGeometry=GraphicsGeometry,exports.HTMLText=HTMLText,exports.HTMLTextStyle=HTMLTextStyle,exports.IGLUniformData=IGLUniformData,exports.INSTALLED=INSTALLED,exports.INTERNAL_FORMATS=INTERNAL_FORMATS,exports.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL,exports.ImageBitmapResource=ImageBitmapResource,exports.ImageResource=ImageResource,exports.LINE_CAP=LINE_CAP,exports.LINE_JOIN=LINE_JOIN,exports.LineStyle=LineStyle,exports.LoaderParserPriority=LoaderParserPriority,exports.MASK_TYPES=MASK_TYPES,exports.MIPMAP_MODES=MIPMAP_MODES,exports.MSAA_QUALITY=MSAA_QUALITY,exports.MaskData=MaskData,exports.MaskSystem=MaskSystem,exports.Matrix=Matrix,exports.Mesh=Mesh,exports.MeshBatchUvs=MeshBatchUvs,exports.MeshGeometry=MeshGeometry,exports.MeshMaterial=MeshMaterial,exports.MultisampleSystem=MultisampleSystem,exports.NineSlicePlane=NineSlicePlane,exports.NoiseFilter=NoiseFilter,exports.ObjectRenderer=ObjectRenderer,exports.ObjectRendererSystem=ObjectRendererSystem,exports.ObservablePoint=ObservablePoint,exports.PI_2=PI_2,exports.PRECISION=PRECISION,exports.ParticleContainer=ParticleContainer,exports.ParticleRenderer=ParticleRenderer,exports.PlaneGeometry=PlaneGeometry,exports.PluginSystem=PluginSystem,exports.Point=Point,exports.Polygon=Polygon,exports.Prepare=Prepare,exports.Program=Program,exports.ProjectionSystem=ProjectionSystem,exports.Quad=Quad,exports.QuadUv=QuadUv,exports.RAD_TO_DEG=RAD_TO_DEG,exports.RENDERER_TYPE=RENDERER_TYPE,exports.Rectangle=Rectangle,exports.RenderTexture=RenderTexture,exports.RenderTexturePool=RenderTexturePool,exports.RenderTextureSystem=RenderTextureSystem,exports.Renderer=Renderer,exports.ResizePlugin=ResizePlugin,exports.Resource=Resource,exports.RopeGeometry=RopeGeometry,exports.RoundedRectangle=RoundedRectangle,exports.Runner=Runner,exports.SAMPLER_TYPES=SAMPLER_TYPES,exports.SCALE_MODES=SCALE_MODES,exports.SHAPES=SHAPES,exports.SVGResource=SVGResource,exports.ScissorSystem=ScissorSystem,exports.Shader=Shader,exports.ShaderSystem=ShaderSystem,exports.SimpleMesh=SimpleMesh,exports.SimplePlane=SimplePlane,exports.SimpleRope=SimpleRope,exports.Sprite=Sprite,exports.SpriteMaskFilter=SpriteMaskFilter,exports.Spritesheet=Spritesheet,exports.StartupSystem=StartupSystem,exports.State=State,exports.StateSystem=StateSystem,exports.StencilSystem=StencilSystem,exports.SystemManager=SystemManager,exports.TARGETS=TARGETS,exports.TEXT_GRADIENT=TEXT_GRADIENT,exports.TYPES=TYPES,exports.TYPES_TO_BYTES_PER_COMPONENT=TYPES_TO_BYTES_PER_COMPONENT,exports.TYPES_TO_BYTES_PER_PIXEL=TYPES_TO_BYTES_PER_PIXEL,exports.TemporaryDisplayObject=TemporaryDisplayObject,exports.Text=Text,exports.TextFormat=TextFormat,exports.TextMetrics=TextMetrics,exports.TextStyle=TextStyle,exports.Texture=Texture,exports.TextureGCSystem=TextureGCSystem,exports.TextureMatrix=TextureMatrix,exports.TextureSystem=TextureSystem,exports.TextureUvs=TextureUvs,exports.Ticker=Ticker,exports.TickerPlugin=TickerPlugin,exports.TilingSprite=TilingSprite,exports.TilingSpriteRenderer=TilingSpriteRenderer,exports.TimeLimiter=TimeLimiter,exports.Transform=Transform,exports.TransformFeedback=TransformFeedback,exports.TransformFeedbackSystem=TransformFeedbackSystem,exports.UPDATE_PRIORITY=UPDATE_PRIORITY,exports.UniformGroup=UniformGroup,exports.VERSION=VERSION,exports.VideoResource=VideoResource,exports.ViewSystem=ViewSystem,exports.ViewableBuffer=ViewableBuffer,exports.WRAP_MODES=WRAP_MODES,exports.XMLFormat=XMLFormat,exports.XMLStringFormat=XMLStringFormat,exports.accessibleTarget=accessibleTarget,exports.autoDetectFormat=autoDetectFormat,exports.autoDetectRenderer=autoDetectRenderer,exports.autoDetectResource=autoDetectResource,exports.cacheTextureArray=cacheTextureArray,exports.canUseNewCanvasBlendModes=canUseNewCanvasBlendModes,exports.canvasUtils=canvasUtils,exports.checkDataUrl=checkDataUrl,exports.checkExtension=checkExtension,exports.checkMaxIfStatementsInShader=checkMaxIfStatementsInShader,exports.convertToList=convertToList,exports.copySearchParams=copySearchParams,exports.createStringVariations=createStringVariations,exports.createTexture=createTexture,exports.createUBOElements=createUBOElements,exports.curves=curves,exports.defaultFilterVertex=defaultFilterVertex,exports.defaultVertex=defaultVertex,exports.detectAvif=detectAvif,exports.detectCompressedTextures=detectCompressedTextures,exports.detectDefaults=detectDefaults,exports.detectMp4=detectMp4,exports.detectOgv=detectOgv,exports.detectWebm=detectWebm,exports.detectWebp=detectWebp,exports.extensions=extensions$1,exports.filters=filters,exports.generateProgram=generateProgram,exports.generateUniformBufferSync=generateUniformBufferSync,exports.getFontFamilyName=getFontFamilyName,exports.getTestContext=getTestContext,exports.getUBOData=getUBOData,exports.graphicsUtils=graphicsUtils,exports.groupD8=groupD8,exports.isMobile=isMobile,exports.isSingleItem=isSingleItem,exports.loadBitmapFont=loadBitmapFont,exports.loadDDS=loadDDS,exports.loadImageBitmap=loadImageBitmap,exports.loadJson=loadJson,exports.loadKTX=loadKTX,exports.loadSVG=loadSVG,exports.loadTextures=loadTextures,exports.loadTxt=loadTxt,exports.loadVideo=loadVideo,exports.loadWebFont=loadWebFont,exports.parseDDS=parseDDS,exports.parseKTX=parseKTX,exports.resolveCompressedTextureUrl=resolveCompressedTextureUrl,exports.resolveTextureUrl=resolveTextureUrl,exports.settings=settings,exports.spritesheetAsset=spritesheetAsset,exports.uniformParsers=uniformParsers,exports.unsafeEvalSupported=unsafeEvalSupported,exports.utils=utils,exports}({});this.PIXI=this.PIXI||{},this.PIXI.spine=function(tt,H,dn,wr,br,oe,qe){"use strict";var Z=(c=>(c[c.Region=0]="Region",c[c.BoundingBox=1]="BoundingBox",c[c.Mesh=2]="Mesh",c[c.LinkedMesh=3]="LinkedMesh",c[c.Path=4]="Path",c[c.Point=5]="Point",c[c.Clipping=6]="Clipping",c))(Z||{});class Mn{constructor(t,n=new Array,e=0,i=new DataView(t.buffer)){this.strings=n,this.index=e,this.buffer=i}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){const t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){const t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let n=this.readByte(),e=n&127;return n&128&&(n=this.readByte(),e|=(n&127)<<7,n&128&&(n=this.readByte(),e|=(n&127)<<14,n&128&&(n=this.readByte(),e|=(n&127)<<21,n&128&&(n=this.readByte(),e|=(n&127)<<28)))),t?e:e>>>1^-(e&1)}readStringRef(){const t=this.readInt(!0);return t==0?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let n="";for(let e=0;e<t;){const i=this.readUnsignedByte();switch(i>>4){case 12:case 13:n+=String.fromCharCode((i&31)<<6|this.readByte()&63),e+=2;break;case 14:n+=String.fromCharCode((i&15)<<12|(this.readByte()&63)<<6|this.readByte()&63),e+=3;break;default:n+=String.fromCharCode(i),e++}}return n}readFloat(){const t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return this.readByte()!=0}}var A=(c=>(c[c.setup=0]="setup",c[c.first=1]="first",c[c.replace=2]="replace",c[c.add=3]="add",c))(A||{}),J=(c=>(c[c.mixIn=0]="mixIn",c[c.mixOut=1]="mixOut",c))(J||{}),dt=(c=>(c[c.Fixed=0]="Fixed",c[c.Percent=1]="Percent",c))(dt||{}),pt=(c=>(c[c.Tangent=0]="Tangent",c[c.Chain=1]="Chain",c[c.ChainScale=2]="ChainScale",c))(pt||{}),j=(c=>(c[c.Normal=0]="Normal",c[c.OnlyTranslation=1]="OnlyTranslation",c[c.NoRotationOrReflection=2]="NoRotationOrReflection",c[c.NoScale=3]="NoScale",c[c.NoScaleOrReflection=4]="NoScaleOrReflection",c))(j||{});function Jn(c){switch(c.toLowerCase()){case"nearest":return Bt.Nearest;case"linear":return Bt.Linear;case"mipmap":return Bt.MipMap;case"mipmapnearestnearest":return Bt.MipMapNearestNearest;case"mipmaplinearnearest":return Bt.MipMapLinearNearest;case"mipmapnearestlinear":return Bt.MipMapNearestLinear;case"mipmaplinearlinear":return Bt.MipMapLinearLinear;default:throw new Error(`Unknown texture filter ${c}`)}}function Er(c){switch(c.toLowerCase()){case"mirroredtepeat":return fe.MirroredRepeat;case"clamptoedge":return fe.ClampToEdge;case"repeat":return fe.Repeat;default:throw new Error(`Unknown texture wrap ${c}`)}}var Bt=(c=>(c[c.Nearest=9728]="Nearest",c[c.Linear=9729]="Linear",c[c.MipMap=9987]="MipMap",c[c.MipMapNearestNearest=9984]="MipMapNearestNearest",c[c.MipMapLinearNearest=9985]="MipMapLinearNearest",c[c.MipMapNearestLinear=9986]="MipMapNearestLinear",c[c.MipMapLinearLinear=9987]="MipMapLinearLinear",c))(Bt||{}),fe=(c=>(c[c.MirroredRepeat=33648]="MirroredRepeat",c[c.ClampToEdge=33071]="ClampToEdge",c[c.Repeat=10497]="Repeat",c))(fe||{});class Vn{constructor(){this.size=null,this.names=null,this.values=null,this.renderObject=null}get width(){const t=this.texture;return t.trim?t.trim.width:t.orig.width}get height(){const t=this.texture;return t.trim?t.trim.height:t.orig.height}get u(){return this.texture._uvs.x0}get v(){return this.texture._uvs.y0}get u2(){return this.texture._uvs.x2}get v2(){return this.texture._uvs.y2}get offsetX(){const t=this.texture;return t.trim?t.trim.x:0}get offsetY(){return this.spineOffsetY}get pixiOffsetY(){const t=this.texture;return t.trim?t.trim.y:0}get spineOffsetY(){const t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)}get originalWidth(){return this.texture.orig.width}get originalHeight(){return this.texture.orig.height}get x(){return this.texture.frame.x}get y(){return this.texture.frame.y}get rotate(){return this.texture.rotate!==0}get degrees(){return(360-this.texture.rotate*45)%360}}class Sr{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0,this.rotate=0,this.index=0}}class Fn{constructor(t,n,e){this.pages=new Array,this.regions=new Array,t&&this.addSpineAtlas(t,n,e)}addTexture(t,n){const e=this.pages;let i=null;for(let h=0;h<e.length;h++)if(e[h].baseTexture===n.baseTexture){i=e[h];break}if(i===null){i=new ts,i.name="texturePage";const h=n.baseTexture;i.width=h.realWidth,i.height=h.realHeight,i.baseTexture=h,i.minFilter=i.magFilter=Bt.Nearest,i.uWrap=fe.ClampToEdge,i.vWrap=fe.ClampToEdge,e.push(i)}const r=new es;return r.name=t,r.page=i,r.texture=n,r.index=-1,this.regions.push(r),r}addTextureHash(t,n){for(const e in t)t.hasOwnProperty(e)&&this.addTexture(n&&e.indexOf(".")!==-1?e.substr(0,e.lastIndexOf(".")):e,t[e])}addSpineAtlas(t,n,e){return this.load(t,n,e)}load(t,n,e){if(n==null)throw new Error("textureLoader cannot be null.");const i=new yr(t),r=new Array(4);let h=null;const l={};let s=null;l.size=()=>{h.width=parseInt(r[1]),h.height=parseInt(r[2])},l.format=()=>{},l.filter=()=>{h.minFilter=Jn(r[1]),h.magFilter=Jn(r[2])},l.repeat=()=>{r[1].indexOf("x")!=-1&&(h.uWrap=fe.Repeat),r[1].indexOf("y")!=-1&&(h.vWrap=fe.Repeat)},l.pma=()=>{h.pma=r[1]=="true"};const a={};a.xy=()=>{s.x=parseInt(r[1]),s.y=parseInt(r[2])},a.size=()=>{s.width=parseInt(r[1]),s.height=parseInt(r[2])},a.bounds=()=>{s.x=parseInt(r[1]),s.y=parseInt(r[2]),s.width=parseInt(r[3]),s.height=parseInt(r[4])},a.offset=()=>{s.offsetX=parseInt(r[1]),s.offsetY=parseInt(r[2])},a.orig=()=>{s.originalWidth=parseInt(r[1]),s.originalHeight=parseInt(r[2])},a.offsets=()=>{s.offsetX=parseInt(r[1]),s.offsetY=parseInt(r[2]),s.originalWidth=parseInt(r[3]),s.originalHeight=parseInt(r[4])},a.rotate=()=>{const f=r[1];let u=0;f.toLocaleLowerCase()=="true"?u=6:f.toLocaleLowerCase()=="false"?u=0:u=(720-parseFloat(f))%360/45,s.rotate=u},a.index=()=>{s.index=parseInt(r[1])};let o=i.readLine();for(;o!=null&&o.trim().length==0;)o=i.readLine();for(;!(o==null||o.trim().length==0||i.readEntry(r,o)==0);)o=i.readLine();const d=()=>{for(;;){if(o==null)return e&&e(this);if(o.trim().length==0)h=null,o=i.readLine();else if(h===null){for(h=new ts,h.name=o.trim();i.readEntry(r,o=i.readLine())!=0;){const f=l[r[0]];f&&f()}this.pages.push(h),n(h.name,f=>{if(f===null)return this.pages.splice(this.pages.indexOf(h),1),e&&e(null);h.baseTexture=f,h.pma&&(f.alphaMode=H.ALPHA_MODES.PMA),f.valid||f.setSize(h.width,h.height),h.setFilters(),(!h.width||!h.height)&&(h.width=f.realWidth,h.height=f.realHeight,(!h.width||!h.height)&&console.log(`ERROR spine atlas page ${h.name}: meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)`)),d()});break}else{s=new Sr;const f=new es;f.name=o,f.page=h;let u=null,m=null;for(;;){const p=i.readEntry(r,o=i.readLine());if(p==0)break;const S=a[r[0]];if(S)S();else{u==null&&(u=[],m=[]),u.push(r[0]);const y=[];for(let M=0;M<p;M++)y.push(parseInt(r[M+1]));m.push(y)}}s.originalWidth==0&&s.originalHeight==0&&(s.originalWidth=s.width,s.originalHeight=s.height);const g=h.baseTexture.resolution;s.x/=g,s.y/=g,s.width/=g,s.height/=g,s.originalWidth/=g,s.originalHeight/=g,s.offsetX/=g,s.offsetY/=g;const x=s.rotate%4!==0,E=new H.Rectangle(s.x,s.y,x?s.height:s.width,x?s.width:s.height),w=new H.Rectangle(0,0,s.originalWidth,s.originalHeight),b=new H.Rectangle(s.offsetX,s.originalHeight-s.height-s.offsetY,s.width,s.height);f.texture=new H.Texture(f.page.baseTexture,E,w,b,s.rotate),f.index=s.index,f.texture.updateUvs(),this.regions.push(f)}}};d()}findRegion(t){for(let n=0;n<this.regions.length;n++)if(this.regions[n].name==t)return this.regions[n];return null}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()}}class yr{constructor(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,n){if(n==null||(n=n.trim(),n.length==0))return 0;const e=n.indexOf(":");if(e==-1)return 0;t[0]=n.substr(0,e).trim();for(let i=1,r=e+1;;i++){const h=n.indexOf(",",r);if(h==-1)return t[i]=n.substr(r).trim(),i;if(t[i]=n.substr(r,h-r).trim(),r=h+1,i==4)return 4}}}class ts{constructor(){this.minFilter=Bt.Nearest,this.magFilter=Bt.Nearest,this.uWrap=fe.ClampToEdge,this.vWrap=fe.ClampToEdge}setFilters(){const t=this.baseTexture,n=this.minFilter;n==Bt.Linear?t.scaleMode=H.SCALE_MODES.LINEAR:this.minFilter==Bt.Nearest?t.scaleMode=H.SCALE_MODES.NEAREST:(t.mipmap=H.MIPMAP_MODES.POW2,n==Bt.MipMapNearestNearest?t.scaleMode=H.SCALE_MODES.NEAREST:t.scaleMode=H.SCALE_MODES.LINEAR)}}class es extends Vn{}class ns{constructor(){this.array=new Array}add(t){const n=this.contains(t);return this.array[t|0]=t|0,!n}contains(t){return this.array[t|0]!=null}remove(t){this.array[t|0]=void 0}clear(){this.array.length=0}}class ss{constructor(){this.entries={},this.size=0}add(t){const n=this.entries[t];return this.entries[t]=!0,n?!1:(this.size++,!0)}addAll(t){const n=this.size;for(let e=0,i=t.length;e<i;e++)this.add(t[e]);return n!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}const Je=class{constructor(c=0,t=0,n=0,e=0){this.r=c,this.g=t,this.b=n,this.a=e}set(c,t,n,e){return this.r=c,this.g=t,this.b=n,this.a=e,this.clamp()}setFromColor(c){return this.r=c.r,this.g=c.g,this.b=c.b,this.a=c.a,this}setFromString(c){return c=c.charAt(0)=="#"?c.substr(1):c,this.r=parseInt(c.substr(0,2),16)/255,this.g=parseInt(c.substr(2,2),16)/255,this.b=parseInt(c.substr(4,2),16)/255,this.a=c.length!=8?1:parseInt(c.substr(6,2),16)/255,this}add(c,t,n,e){return this.r+=c,this.g+=t,this.b+=n,this.a+=e,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(c,t){c.r=((t&4278190080)>>>24)/255,c.g=((t&16711680)>>>16)/255,c.b=((t&65280)>>>8)/255,c.a=(t&255)/255}static rgb888ToColor(c,t){c.r=((t&16711680)>>>16)/255,c.g=((t&65280)>>>8)/255,c.b=(t&255)/255}static fromString(c){return new Je().setFromString(c)}};let _=Je;_.WHITE=new Je(1,1,1,1),_.RED=new Je(1,0,0,1),_.GREEN=new Je(0,1,0,1),_.BLUE=new Je(0,0,1,1),_.MAGENTA=new Je(1,0,1,1);const Fe=class{static clamp(c,t,n){return c<t?t:c>n?n:c}static cosDeg(c){return Math.cos(c*Fe.degRad)}static sinDeg(c){return Math.sin(c*Fe.degRad)}static signum(c){return Math.sign(c)}static toInt(c){return c>0?Math.floor(c):Math.ceil(c)}static cbrt(c){const t=Math.pow(Math.abs(c),.3333333333333333);return c<0?-t:t}static randomTriangular(c,t){return Fe.randomTriangularWith(c,t,(c+t)*.5)}static randomTriangularWith(c,t,n){const e=Math.random(),i=t-c;return e<=(n-c)/i?c+Math.sqrt(e*i*(n-c)):t-Math.sqrt((1-e)*i*(t-n))}static isPowerOfTwo(c){return c&&(c&c-1)===0}};let C=Fe;C.PI=3.1415927,C.PI2=Fe.PI*2,C.radiansToDegrees=180/Fe.PI,C.radDeg=Fe.radiansToDegrees,C.degreesToRadians=Fe.PI/180,C.degRad=Fe.degreesToRadians;class Si{apply(t,n,e){return t+(n-t)*this.applyInternal(e)}}class yi extends Si{constructor(t){super(),this.power=2,this.power=t}applyInternal(t){return t<=.5?Math.pow(t*2,this.power)/2:Math.pow((t-1)*2,this.power)/(this.power%2==0?-2:2)+1}}class is extends yi{applyInternal(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}const fn=class{static arrayCopy(c,t,n,e,i){for(let r=t,h=e;r<t+i;r++,h++)n[h]=c[r]}static arrayFill(c,t,n,e){for(let i=t;i<n;i++)c[i]=e}static setArraySize(c,t,n=0){const e=c.length;if(e==t)return c;if(c.length=t,e<t)for(let i=e;i<t;i++)c[i]=n;return c}static ensureArrayCapacity(c,t,n=0){return c.length>=t?c:fn.setArraySize(c,t,n)}static newArray(c,t){const n=new Array(c);for(let e=0;e<c;e++)n[e]=t;return n}static newFloatArray(c){if(fn.SUPPORTS_TYPED_ARRAYS)return new Float32Array(c);const t=new Array(c);for(let n=0;n<t.length;n++)t[n]=0;return t}static newShortArray(c){if(fn.SUPPORTS_TYPED_ARRAYS)return new Int16Array(c);const t=new Array(c);for(let n=0;n<t.length;n++)t[n]=0;return t}static toFloatArray(c){return fn.SUPPORTS_TYPED_ARRAYS?new Float32Array(c):c}static toSinglePrecision(c){return fn.SUPPORTS_TYPED_ARRAYS?Math.fround(c):c}static webkit602BugfixHelper(c,t){}static contains(c,t,n=!0){for(let e=0;e<c.length;e++)if(c[e]==t)return!0;return!1}static enumValue(c,t){return c[t[0].toUpperCase()+t.slice(1)]}};let v=fn;v.SUPPORTS_TYPED_ARRAYS=typeof Float32Array!="undefined";class Mr{static logBones(t){for(let n=0;n<t.bones.length;n++){const e=t.bones[n],i=e.matrix;console.log(`${e.data.name}, ${i.a}, ${i.b}, ${i.c}, ${i.d}, ${i.tx}, ${i.ty}`)}}}class An{constructor(t){this.items=new Array,this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let n=0;n<t.length;n++)this.free(t[n])}clear(){this.items.length=0}}class un{constructor(t=0,n=0){this.x=t,this.y=n}set(t,n){return this.x=t,this.y=n,this}length(){const t=this.x,n=this.y;return Math.sqrt(t*t+n*n)}normalize(){const t=this.length();return t!=0&&(this.x/=t,this.y/=t),this}}class Ar{constructor(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}update(){const t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)}}class Cr{constructor(t=32){this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}hasEnoughData(){return this.addedValues>=this.values.length}addValue(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0}getMean(){if(this.hasEnoughData()){if(this.dirty){let t=0;for(let n=0;n<this.values.length;n++)t+=this.values[n];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0}}class Cn{constructor(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new An(()=>v.newFloatArray(16))}update(t,n){if(!t)throw new Error("skeleton cannot be null.");const e=this.boundingBoxes,i=this.polygons,r=this.polygonPool,h=t.slots,l=h.length;e.length=0,r.freeAll(i),i.length=0;for(let s=0;s<l;s++){const a=h[s];if(!a.bone.active)continue;const o=a.getAttachment();if(o!=null&&o.type===Z.BoundingBox){const d=o;e.push(d);let f=r.obtain();f.length!=d.worldVerticesLength&&(f=v.newFloatArray(d.worldVerticesLength)),i.push(f),d.computeWorldVertices(a,0,d.worldVerticesLength,f,0,2)}}n?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const r=this.polygons;for(let h=0,l=r.length;h<l;h++){const s=r[h],a=s;for(let o=0,d=s.length;o<d;o+=2){const f=a[o],u=a[o+1];t=Math.min(t,f),n=Math.min(n,u),e=Math.max(e,f),i=Math.max(i,u)}}this.minX=t,this.minY=n,this.maxX=e,this.maxY=i}aabbContainsPoint(t,n){return t>=this.minX&&t<=this.maxX&&n>=this.minY&&n<=this.maxY}aabbIntersectsSegment(t,n,e,i){const r=this.minX,h=this.minY,l=this.maxX,s=this.maxY;if(t<=r&&e<=r||n<=h&&i<=h||t>=l&&e>=l||n>=s&&i>=s)return!1;const a=(i-n)/(e-t);let o=a*(r-t)+n;if(o>h&&o<s||(o=a*(l-t)+n,o>h&&o<s))return!0;let d=(h-n)/a+t;return d>r&&d<l||(d=(s-n)/a+t,d>r&&d<l)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,n){const e=this.polygons;for(let i=0,r=e.length;i<r;i++)if(this.containsPointPolygon(e[i],t,n))return this.boundingBoxes[i];return null}containsPointPolygon(t,n,e){const i=t,r=t.length;let h=r-2,l=!1;for(let s=0;s<r;s+=2){const a=i[s+1],o=i[h+1];if(a<e&&o>=e||o<e&&a>=e){const d=i[s];d+(e-a)/(o-a)*(i[h]-d)<n&&(l=!l)}h=s}return l}intersectsSegment(t,n,e,i){const r=this.polygons;for(let h=0,l=r.length;h<l;h++)if(this.intersectsSegmentPolygon(r[h],t,n,e,i))return this.boundingBoxes[h];return null}intersectsSegmentPolygon(t,n,e,i,r){const h=t,l=t.length,s=n-i,a=e-r,o=n*r-e*i;let d=h[l-2],f=h[l-1];for(let u=0;u<l;u+=2){const m=h[u],g=h[u+1],x=d*g-f*m,E=d-m,w=f-g,b=s*w-a*E,p=(o*E-s*x)/b;if((p>=d&&p<=m||p>=m&&p<=d)&&(p>=n&&p<=i||p>=i&&p<=n)){const S=(o*w-a*x)/b;if((S>=f&&S<=g||S>=g&&S<=f)&&(S>=e&&S<=r||S>=r&&S<=e))return!0}d=m,f=g}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");const n=this.boundingBoxes.indexOf(t);return n==-1?null:this.polygons[n]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}const zt={yDown:!0,FAIL_ON_NON_EXISTING_SKIN:!1,GLOBAL_AUTO_UPDATE:!0,GLOBAL_DELAY_LIMIT:0},Ue=[0,0,0];class Mi extends wr.Sprite{constructor(){super(...arguments),this.region=null,this.attachment=null}}class Ai extends br.SimpleMesh{constructor(t,n,e,i,r){super(t,n,e,i,r),this.region=null,this.attachment=null}}const Ci=class extends dn.Container{constructor(c){if(super(),!c)throw new Error("The spineData param is required.");if(typeof c=="string")throw new Error("spineData param cant be string. Please use spine.Spine.fromAtlas(\"YOUR_RESOURCE_NAME\") from now on.");this.spineData=c,this.createSkeleton(c),this.slotContainers=[],this.tempClipContainers=[];for(let t=0,n=this.skeleton.slots.length;t<n;t++){const e=this.skeleton.slots[t],i=e.getAttachment(),r=this.newContainer();if(this.slotContainers.push(r),this.addChild(r),this.tempClipContainers.push(null),!!i)if(i.type===Z.Region){const h=i.name,l=this.createSprite(e,i,h);e.currentSprite=l,e.currentSpriteName=h,r.addChild(l)}else if(i.type===Z.Mesh){const h=this.createMesh(e,i);e.currentMesh=h,e.currentMeshId=i.id,e.currentMeshName=i.name,r.addChild(h)}else i.type===Z.Clipping&&(this.createGraphics(e,i),r.addChild(e.clippingContainer),r.addChild(e.currentGraphics))}this.tintRgb=new Float32Array([1,1,1]),this.autoUpdate=!0,this.visible=!0}get debug(){return this._debug}set debug(c){var t;c!=this._debug&&((t=this._debug)==null||t.unregisterSpine(this),c==null||c.registerSpine(this),this._debug=c)}get autoUpdate(){return this._autoUpdate}set autoUpdate(c){c!==this._autoUpdate&&(this._autoUpdate=c,this.updateTransform=c?Ci.prototype.autoUpdateTransform:dn.Container.prototype.updateTransform)}get tint(){return new H.Color(this.tintRgb).toNumber()}set tint(c){this.tintRgb=new H.Color(c).toRgbArray(this.tintRgb)}get delayLimit(){return(typeof this.localDelayLimit!="undefined"?this.localDelayLimit:zt.GLOBAL_DELAY_LIMIT)||Number.MAX_VALUE}update(c){var a;const t=this.delayLimit;if(c>t&&(c=t),this.state.update(c),this.state.apply(this.skeleton),!this.skeleton)return;this.skeleton.updateWorldTransform();const n=this.skeleton.slots,e=this.color;let i=null,r=null;e?(i=e.light,r=e.dark):i=this.tintRgb;for(let o=0,d=n.length;o<d;o++){const f=n[o],u=f.getAttachment(),m=this.slotContainers[o];if(!u){m.visible=!1;continue}let g=null;u.sequence&&u.sequence.apply(f,u);let x=u.region;const E=u.color;switch(u!=null&&u.type){case Z.Region:if(m.transform.setFromMatrix(f.bone.matrix),x=u.region,f.currentMesh&&(f.currentMesh.visible=!1,f.currentMesh=null,f.currentMeshId=void 0,f.currentMeshName=void 0),!x){f.currentSprite&&(f.currentSprite.renderable=!1);break}if(!f.currentSpriteName||f.currentSpriteName!==u.name){const p=u.name;if(f.currentSprite&&(f.currentSprite.visible=!1),f.sprites=f.sprites||{},f.sprites[p]!==void 0)f.sprites[p].visible=!0;else{const S=this.createSprite(f,u,p);m.addChild(S)}f.currentSprite=f.sprites[p],f.currentSpriteName=p}f.currentSprite.renderable=!0,f.hackRegion||this.setSpriteRegion(u,f.currentSprite,x),f.currentSprite.color?g=f.currentSprite.color:(Ue[0]=i[0]*f.color.r*E.r,Ue[1]=i[1]*f.color.g*E.g,Ue[2]=i[2]*f.color.b*E.b,f.currentSprite.tint=new H.Color(Ue).toNumber()),f.currentSprite.blendMode=f.blendMode;break;case Z.Mesh:if(f.currentSprite){f.currentSprite.visible=!1,f.currentSprite=null,f.currentSpriteName=void 0;const p=new H.Transform;p._parentID=-1,p._worldID=m.transform._worldID,m.transform=p}if(!x){f.currentMesh&&(f.currentMesh.renderable=!1);break}const b=u.id;if(f.currentMeshId===void 0||f.currentMeshId!==b){const p=b;if(f.currentMesh&&(f.currentMesh.visible=!1),f.meshes=f.meshes||{},f.meshes[p]!==void 0)f.meshes[p].visible=!0;else{const S=this.createMesh(f,u);m.addChild(S)}f.currentMesh=f.meshes[p],f.currentMeshName=u.name,f.currentMeshId=p}f.currentMesh.renderable=!0,u.computeWorldVerticesOld(f,f.currentMesh.vertices),f.currentMesh.color?g=f.currentMesh.color:(Ue[0]=i[0]*f.color.r*E.r,Ue[1]=i[1]*f.color.g*E.g,Ue[2]=i[2]*f.color.b*E.b,f.currentMesh.tint=new H.Color(Ue).toNumber()),f.currentMesh.blendMode=f.blendMode,f.hackRegion||this.setMeshRegion(u,f.currentMesh,x);break;case Z.Clipping:f.currentGraphics||(this.createGraphics(f,u),m.addChild(f.clippingContainer),m.addChild(f.currentGraphics)),this.updateGraphics(f,u),m.alpha=1,m.visible=!0;continue;default:m.visible=!1;continue}if(m.visible=!0,g){let w=f.color.r*E.r,b=f.color.g*E.g,p=f.color.b*E.b;g.setLight(i[0]*w+r[0]*(1-w),i[1]*b+r[1]*(1-b),i[2]*p+r[2]*(1-p)),f.darkColor?(w=f.darkColor.r,b=f.darkColor.g,p=f.darkColor.b):(w=0,b=0,p=0),g.setDark(i[0]*w+r[0]*(1-w),i[1]*b+r[1]*(1-b),i[2]*p+r[2]*(1-p))}m.alpha=f.color.a}const h=this.skeleton.drawOrder;let l=null,s=null;for(let o=0,d=h.length;o<d;o++){const f=n[h[o].data.index],u=this.slotContainers[h[o].data.index];if(s||u.parent!==null&&u.parent!==this&&(u.parent.removeChild(u),u.parent=this),f.currentGraphics&&f.getAttachment())s=f.clippingContainer,l=f.getAttachment(),s.children.length=0,this.children[o]=u,l.endSlot===f.data&&(l.endSlot=null);else if(s){let m=this.tempClipContainers[o];m||(m=this.tempClipContainers[o]=this.newContainer(),m.visible=!1),this.children[o]=m,u.parent=null,s.addChild(u),l.endSlot==f.data&&(s.renderable=!0,s=null,l=null)}else this.children[o]=u}(a=this._debug)==null||a.renderDebug(this)}setSpriteRegion(c,t,n){t.attachment===c&&t.region===n||(t.region=n,t.attachment=c,t.texture=n.texture,t.rotation=c.rotation*C.degRad,t.position.x=c.x,t.position.y=c.y,t.alpha=c.color.a,n.size?(t.scale.x=n.size.width/n.originalWidth,t.scale.y=-n.size.height/n.originalHeight):(t.scale.x=c.scaleX*c.width/n.originalWidth,t.scale.y=-c.scaleY*c.height/n.originalHeight))}setMeshRegion(c,t,n){t.attachment===c&&t.region===n||(t.region=n,t.attachment=c,t.texture=n.texture,n.texture.updateUvs(),t.uvBuffer.update(c.regionUVs))}autoUpdateTransform(){if(zt.GLOBAL_AUTO_UPDATE){this.lastTime=this.lastTime||Date.now();const c=(Date.now()-this.lastTime)*.001;this.lastTime=Date.now(),this.update(c)}else this.lastTime=0;dn.Container.prototype.updateTransform.call(this)}createSprite(c,t,n){let e=t.region;c.hackAttachment===t&&(e=c.hackRegion);const i=e?e.texture:null,r=this.newSprite(i);return r.anchor.set(.5),e&&this.setSpriteRegion(t,r,t.region),c.sprites=c.sprites||{},c.sprites[n]=r,r}createMesh(c,t){let n=t.region;c.hackAttachment===t&&(n=c.hackRegion,c.hackAttachment=null,c.hackRegion=null);const e=this.newMesh(n?n.texture:null,new Float32Array(t.regionUVs.length),t.regionUVs,new Uint16Array(t.triangles),H.DRAW_MODES.TRIANGLES);return typeof e._canvasPadding!="undefined"&&(e._canvasPadding=1.5),e.alpha=t.color.a,e.region=t.region,n&&this.setMeshRegion(t,e,n),c.meshes=c.meshes||{},c.meshes[t.id]=e,e}createGraphics(c,t){const n=this.newGraphics(),e=new H.Polygon([]);return n.clear(),n.beginFill(16777215,1),n.drawPolygon(e),n.renderable=!1,c.currentGraphics=n,c.clippingContainer=this.newContainer(),c.clippingContainer.mask=c.currentGraphics,n}updateGraphics(c,t){const n=c.currentGraphics.geometry,e=n.graphicsData[0].shape.points,i=t.worldVerticesLength;e.length=i,t.computeWorldVertices(c,0,i,e,0,2),n.invalidate()}hackTextureBySlotIndex(c,t=null,n=null){const e=this.skeleton.slots[c];if(!e)return!1;const i=e.getAttachment();let r=i.region;return t?(r=new Vn,r.texture=t,r.size=n,e.hackRegion=r,e.hackAttachment=i):(e.hackRegion=null,e.hackAttachment=null),e.currentSprite?this.setSpriteRegion(i,e.currentSprite,r):e.currentMesh&&this.setMeshRegion(i,e.currentMesh,r),!0}hackTextureBySlotName(c,t=null,n=null){const e=this.skeleton.findSlotIndex(c);return e==-1?!1:this.hackTextureBySlotIndex(e,t,n)}hackTextureAttachment(c,t,n,e=null){const i=this.skeleton.findSlotIndex(c),r=this.skeleton.getAttachmentByName(c,t);r.region.texture=n;const h=this.skeleton.slots[i];if(!h)return!1;const l=h.getAttachment();if(t===l.name){let s=r.region;return n?(s=new Vn,s.texture=n,s.size=e,h.hackRegion=s,h.hackAttachment=l):(h.hackRegion=null,h.hackAttachment=null),h.currentSprite&&h.currentSprite.region!=s?(this.setSpriteRegion(l,h.currentSprite,s),h.currentSprite.region=s):h.currentMesh&&h.currentMesh.region!=s&&this.setMeshRegion(l,h.currentMesh,s),!0}return!1}newContainer(){return new dn.Container}newSprite(c){return new Mi(c)}newGraphics(){return new oe.Graphics}newMesh(c,t,n,e,i){return new Ai(c,t,n,e,i)}transformHack(){return 1}hackAttachmentGroups(c,t,n){if(!c)return;const e=[],i=[];for(let r=0,h=this.skeleton.slots.length;r<h;r++){const l=this.skeleton.slots[r],s=l.currentSpriteName||l.currentMeshName||"",a=l.currentSprite||l.currentMesh;s.endsWith(c)?(a.parentGroup=t,i.push(a)):n&&a&&(a.parentGroup=n,e.push(a))}return[e,i]}destroy(c){this.debug=null;for(let t=0,n=this.skeleton.slots.length;t<n;t++){const e=this.skeleton.slots[t];for(const i in e.meshes)e.meshes[i].destroy(c);e.meshes=null;for(const i in e.sprites)e.sprites[i].destroy(c);e.sprites=null}for(let t=0,n=this.slotContainers.length;t<n;t++)this.slotContainers[t].destroy(c);this.spineData=null,this.skeleton=null,this.slotContainers=null,this.stateData=null,this.state=null,this.tempClipContainers=null,super.destroy(c)}};let tn=Ci;tn.clippingPolygon=[],Object.defineProperty(tn.prototype,"visible",{get(){return this._visible},set(c){c!==this._visible&&(this._visible=c,c&&(this.lastTime=0))}});class Tr{constructor(){this.registeredSpines=new Map,this.drawDebug=!0,this.drawMeshHull=!0,this.drawMeshTriangles=!0,this.drawBones=!0,this.drawPaths=!0,this.drawBoundingBoxes=!0,this.drawClipping=!0,this.drawRegionAttachments=!0,this.lineWidth=1,this.regionAttachmentsColor=30975,this.meshHullColor=30975,this.meshTrianglesColor=16763904,this.clippingPolygonColor=16711935,this.boundingBoxesRectColor=65280,this.boundingBoxesPolygonColor=65280,this.boundingBoxesCircleColor=65280,this.pathsCurveColor=16711680,this.pathsLineColor=16711935,this.skeletonXYColor=16711680,this.bonesColor=61132}registerSpine(t){this.registeredSpines.has(t)&&console.warn("SpineDebugRenderer.registerSpine() - this spine is already registered!",t);const n={parentDebugContainer:new dn.Container,bones:new dn.Container,skeletonXY:new oe.Graphics,regionAttachmentsShape:new oe.Graphics,meshTrianglesLine:new oe.Graphics,meshHullLine:new oe.Graphics,clippingPolygon:new oe.Graphics,boundingBoxesRect:new oe.Graphics,boundingBoxesCircle:new oe.Graphics,boundingBoxesPolygon:new oe.Graphics,pathsCurve:new oe.Graphics,pathsLine:new oe.Graphics};n.parentDebugContainer.addChild(n.bones),n.parentDebugContainer.addChild(n.skeletonXY),n.parentDebugContainer.addChild(n.regionAttachmentsShape),n.parentDebugContainer.addChild(n.meshTrianglesLine),n.parentDebugContainer.addChild(n.meshHullLine),n.parentDebugContainer.addChild(n.clippingPolygon),n.parentDebugContainer.addChild(n.boundingBoxesRect),n.parentDebugContainer.addChild(n.boundingBoxesCircle),n.parentDebugContainer.addChild(n.boundingBoxesPolygon),n.parentDebugContainer.addChild(n.pathsCurve),n.parentDebugContainer.addChild(n.pathsLine),t.addChild(n.parentDebugContainer),this.registeredSpines.set(t,n)}renderDebug(t){this.registeredSpines.has(t)||this.registerSpine(t);const n=this.registeredSpines.get(t);n.skeletonXY.clear(),n.regionAttachmentsShape.clear(),n.meshTrianglesLine.clear(),n.meshHullLine.clear(),n.clippingPolygon.clear(),n.boundingBoxesRect.clear(),n.boundingBoxesCircle.clear(),n.boundingBoxesPolygon.clear(),n.pathsCurve.clear(),n.pathsLine.clear();for(let r=n.bones.children.length;r>0;r--)n.bones.children[r-1].destroy({children:!0,texture:!0,baseTexture:!0});const e=t.scale.x||t.scale.y||1,i=this.lineWidth/e;this.drawBones&&this.drawBonesFunc(t,n,i,e),this.drawPaths&&this.drawPathsFunc(t,n,i),this.drawBoundingBoxes&&this.drawBoundingBoxesFunc(t,n,i),this.drawClipping&&this.drawClippingFunc(t,n,i),(this.drawMeshHull||this.drawMeshTriangles)&&this.drawMeshHullAndMeshTriangles(t,n,i),this.drawRegionAttachments&&this.drawRegionAttachmentsFunc(t,n,i)}drawBonesFunc(t,n,e,i){const r=t.skeleton,h=r.x,l=r.y,s=r.bones;n.skeletonXY.lineStyle(e,this.skeletonXYColor,1);for(let o=0,d=s.length;o<d;o++){const f=s[o],u=f.data.length,m=h+f.matrix.tx,g=l+f.matrix.ty,x=h+u*f.matrix.a+f.matrix.tx,E=l+u*f.matrix.b+f.matrix.ty;if(f.data.name==="root"||f.data.parent===null)continue;const w=Math.abs(m-x),b=Math.abs(g-E),p=Math.pow(w,2),S=b,y=Math.pow(b,2),M=Math.sqrt(p+y),T=Math.pow(M,2),k=Math.PI/180,I=Math.acos((T+y-p)/(2*S*M))||0;if(M===0)continue;const R=new oe.Graphics;n.bones.addChild(R);const V=M/50/i;R.beginFill(this.bonesColor,1),R.drawPolygon(0,0,0-V,M-V*3,0,M-V,0+V,M-V*3),R.endFill(),R.x=m,R.y=g,R.pivot.y=M;let F=0;m<x&&g<E?F=-I+180*k:m>x&&g<E?F=180*k+I:m>x&&g>E?F=-I:m<x&&g>E?F=I:g===E&&m<x?F=90*k:g===E&&m>x?F=-90*k:m===x&&g<E?F=180*k:m===x&&g>E&&(F=0),R.rotation=F,R.lineStyle(e+V/2.4,this.bonesColor,1),R.beginFill(0,.6),R.drawCircle(0,M,V*1.2),R.endFill()}const a=e*3;n.skeletonXY.moveTo(h-a,l-a),n.skeletonXY.lineTo(h+a,l+a),n.skeletonXY.moveTo(h+a,l-a),n.skeletonXY.lineTo(h-a,l+a)}drawRegionAttachmentsFunc(t,n,e){const r=t.skeleton.slots;n.regionAttachmentsShape.lineStyle(e,this.regionAttachmentsColor,1);for(let h=0,l=r.length;h<l;h++){const s=r[h],a=s.getAttachment();if(a==null||a.type!==Z.Region)continue;const o=a,d=new Float32Array(8);o.updateOffset&&o.updateOffset(),o.computeWorldVertices(s,d,0,2),n.regionAttachmentsShape.drawPolygon(Array.from(d.slice(0,8)))}}drawMeshHullAndMeshTriangles(t,n,e){const r=t.skeleton.slots;n.meshHullLine.lineStyle(e,this.meshHullColor,1),n.meshTrianglesLine.lineStyle(e,this.meshTrianglesColor,1);for(let h=0,l=r.length;h<l;h++){const s=r[h];if(!s.bone.active)continue;const a=s.getAttachment();if(a==null||a.type!==Z.Mesh)continue;const o=a,d=new Float32Array(o.worldVerticesLength),f=o.triangles;let u=o.hullLength;if(o.computeWorldVertices(s,0,o.worldVerticesLength,d,0,2),this.drawMeshTriangles)for(let m=0,g=f.length;m<g;m+=3){const x=f[m]*2,E=f[m+1]*2,w=f[m+2]*2;n.meshTrianglesLine.moveTo(d[x],d[x+1]),n.meshTrianglesLine.lineTo(d[E],d[E+1]),n.meshTrianglesLine.lineTo(d[w],d[w+1])}if(this.drawMeshHull&&u>0){u=(u>>1)*2;let m=d[u-2],g=d[u-1];for(let x=0,E=u;x<E;x+=2){const w=d[x],b=d[x+1];n.meshHullLine.moveTo(w,b),n.meshHullLine.lineTo(m,g),m=w,g=b}}}}drawClippingFunc(t,n,e){const r=t.skeleton.slots;n.clippingPolygon.lineStyle(e,this.clippingPolygonColor,1);for(let h=0,l=r.length;h<l;h++){const s=r[h];if(!s.bone.active)continue;const a=s.getAttachment();if(a==null||a.type!==Z.Clipping)continue;const o=a,d=o.worldVerticesLength,f=new Float32Array(d);o.computeWorldVertices(s,0,d,f,0,2),n.clippingPolygon.drawPolygon(Array.from(f))}}drawBoundingBoxesFunc(t,n,e){n.boundingBoxesRect.lineStyle(e,this.boundingBoxesRectColor,5);const i=new Cn;i.update(t.skeleton,!0),n.boundingBoxesRect.drawRect(i.minX,i.minY,i.getWidth(),i.getHeight());const r=i.polygons,h=(l,s,a)=>{if(n.boundingBoxesPolygon.lineStyle(e,this.boundingBoxesPolygonColor,1),n.boundingBoxesPolygon.beginFill(this.boundingBoxesPolygonColor,.1),a<3)throw new Error("Polygon must contain at least 3 vertices");const o=[],d=e*2;for(let f=0,u=l.length;f<u;f+=2){const m=l[f],g=l[f+1];n.boundingBoxesCircle.lineStyle(0),n.boundingBoxesCircle.beginFill(this.boundingBoxesCircleColor),n.boundingBoxesCircle.drawCircle(m,g,d),n.boundingBoxesCircle.endFill(),o.push(m,g)}n.boundingBoxesPolygon.drawPolygon(o),n.boundingBoxesPolygon.endFill()};for(let l=0,s=r.length;l<s;l++){const a=r[l];h(a,0,a.length)}}drawPathsFunc(t,n,e){const r=t.skeleton.slots;n.pathsCurve.lineStyle(e,this.pathsCurveColor,1),n.pathsLine.lineStyle(e,this.pathsLineColor,1);for(let h=0,l=r.length;h<l;h++){const s=r[h];if(!s.bone.active)continue;const a=s.getAttachment();if(a==null||a.type!==Z.Path)continue;const o=a;let d=o.worldVerticesLength;const f=new Float32Array(d);o.computeWorldVertices(s,0,d,f,0,2);let u=f[2],m=f[3],g=0,x=0;if(o.closed){const E=f[0],w=f[1],b=f[d-2],p=f[d-1];g=f[d-4],x=f[d-3],n.pathsCurve.moveTo(u,m),n.pathsCurve.bezierCurveTo(E,w,b,p,g,x),n.pathsLine.moveTo(u,m),n.pathsLine.lineTo(E,w),n.pathsLine.moveTo(g,x),n.pathsLine.lineTo(b,p)}d-=4;for(let E=4;E<d;E+=6){const w=f[E],b=f[E+1],p=f[E+2],S=f[E+3];g=f[E+4],x=f[E+5],n.pathsCurve.moveTo(u,m),n.pathsCurve.bezierCurveTo(w,b,p,S,g,x),n.pathsLine.moveTo(u,m),n.pathsLine.lineTo(w,b),n.pathsLine.moveTo(g,x),n.pathsLine.lineTo(p,S),u=g,m=x}}}unregisterSpine(t){this.registeredSpines.has(t)||console.warn("SpineDebugRenderer.unregisterSpine() - spine is not registered, can't unregister!",t),this.registeredSpines.get(t).parentDebugContainer.destroy({baseTexture:!0,children:!0,texture:!0}),this.registeredSpines.delete(t)}}const kr={extension:H.ExtensionType.Asset,loader:{extension:{type:H.ExtensionType.LoadParser,priority:qe.LoaderParserPriority.Normal},test(c){return qe.checkExtension(c,".atlas")},async load(c){return await(await H.settings.ADAPTER.fetch(c)).text()},testParse(c,t){const n=qe.checkExtension(t.src,".atlas"),e=typeof c=="string";return Promise.resolve(n&&e)},async parse(c,t,n){const e=t.data;let i=H.utils.path.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let r=null,h=null;const l=new Promise((o,d)=>{r=o,h=d});let s;const a=o=>{o||h(`Something went terribly wrong loading a spine .atlas file
Most likely your texture failed to load.`),r(s)};if(e.image||e.images){const o=Object.assign(e.image?{default:e.image}:{},e.images);s=new Fn(c,(d,f)=>{const u=o[d]||o.default;u&&u.baseTexture?f(u.baseTexture):f(u)},a)}else s=new Fn(c,Ti(n,i,e.imageMetadata),a);return await l},unload(c){c.dispose()}}},Ti=(c,t,n)=>async(e,i)=>{const r=H.utils.path.normalize([...t.split(H.utils.path.sep),e].join(H.utils.path.sep)),h=await c.load({src:r,data:n});i(h.baseTexture)};H.extensions.add(kr);function ki(c){return c.hasOwnProperty("bones")}function Ir(c){return c instanceof ArrayBuffer}class Rr{constructor(){}installLoader(){const t=this,n={extension:H.ExtensionType.Asset,loader:{extension:{type:H.ExtensionType.LoadParser,priority:qe.LoaderParserPriority.Normal},test(e){return qe.checkExtension(e,".skel")},async load(e){return await(await H.settings.ADAPTER.fetch(e)).arrayBuffer()},testParse(e,i){var s;const r=qe.checkExtension(i.src,".json")&&ki(e),h=qe.checkExtension(i.src,".skel")&&Ir(e),l=((s=i.data)==null?void 0:s.spineAtlas)===!1;return Promise.resolve(r&&!l||h)},async parse(e,i,r){var w;const h=H.utils.path.extname(i.src).toLowerCase(),l=H.utils.path.basename(i.src,h);let s=H.utils.path.dirname(i.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");const a=qe.checkExtension(i.src,".json")&&ki(e);let o=null,d=e;a?o=t.createJsonParser():(o=t.createBinaryParser(),d=new Uint8Array(e));const f=i.data||{},u=(w=f==null?void 0:f.spineSkeletonScale)!=null?w:null;u&&(o.scale=u);const m=f.spineAtlas;if(m&&m.pages)return t.parseData(o,m,d);const g=f.atlasRawData;if(g){let b=null,p=null;const S=new Promise((T,k)=>{b=T,p=k}),y=new Fn(g,Ti(r,s,f.imageMetadata),T=>{T||p(`Something went terribly wrong loading a spine .atlas file
Most likely your texture failed to load.`),b(y)}),M=await S;return t.parseData(o,M,d)}let x=f.spineAtlasFile;x||(x=`${s+l}.atlas`);const E=await r.load({src:x,data:f,alias:f.spineAtlasAlias});return t.parseData(o,E,d)}}};return H.extensions.add(n),n}}let rs=class{constructor(t){if(t==null)throw new Error("name cannot be null.");this.name=t}};const Ii=class extends rs{constructor(t){super(t),this.id=(Ii.nextID++&65535)<<11,this.worldVerticesLength=0,this.deformAttachment=this}computeWorldVerticesOld(t,n){this.computeWorldVertices(t,0,this.worldVerticesLength,n,0,2)}computeWorldVertices(t,n,e,i,r,h){e=r+(e>>1)*h;const l=t.bone.skeleton,s=t.deform;let a=this.vertices;const o=this.bones;if(o==null){s.length>0&&(a=s);const m=t.bone.matrix,g=m.tx,x=m.ty,E=m.a,w=m.c,b=m.b,p=m.d;for(let S=n,y=r;y<e;S+=2,y+=h){const M=a[S],T=a[S+1];i[y]=M*E+T*w+g,i[y+1]=M*b+T*p+x}return}let d=0,f=0;for(let m=0;m<n;m+=2){const g=o[d];d+=g+1,f+=g}const u=l.bones;if(s.length==0)for(let m=r,g=f*3;m<e;m+=h){let x=0,E=0,w=o[d++];for(w+=d;d<w;d++,g+=3){const b=u[o[d]].matrix,p=a[g],S=a[g+1],y=a[g+2];x+=(p*b.a+S*b.c+b.tx)*y,E+=(p*b.b+S*b.d+b.ty)*y}i[m]=x,i[m+1]=E}else{const m=s;for(let g=r,x=f*3,E=f<<1;g<e;g+=h){let w=0,b=0,p=o[d++];for(p+=d;d<p;d++,x+=3,E+=2){const S=u[o[d]].matrix,y=a[x]+m[E],M=a[x+1]+m[E+1],T=a[x+2];w+=(y*S.a+M*S.c+S.tx)*T,b+=(y*S.b+M*S.d+S.ty)*T}i[g]=w,i[g+1]=b}}}copyTo(t){this.bones!=null?(t.bones=new Array(this.bones.length),v.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices!=null?(t.vertices=v.newFloatArray(this.vertices.length),v.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}};let ze=Ii;ze.nextID=0;let as=class extends ze{constructor(t){super(t),this.type=Z.BoundingBox,this.color=new _(1,1,1,1)}copy(){const t=new as(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}},os=class extends ze{constructor(t){super(t),this.type=Z.Clipping,this.color=new _(.2275,.2275,.8078,1)}copy(){const t=new os(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}},mn=class extends ze{constructor(t){super(t),this.type=Z.Mesh,this.color=new _(1,1,1,1),this.tempColor=new _(0,0,0,0)}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t!=null&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh!=null)return this.newLinkedMesh();const t=new mn(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),v.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),v.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,this.edges!=null&&(t.edges=new Array(this.edges.length),v.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}newLinkedMesh(){const t=new mn(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(this.parentMesh!=null?this.parentMesh:this),t}},gn=class extends ze{constructor(t){super(t),this.type=Z.Path,this.closed=!1,this.constantSpeed=!1,this.color=new _(1,1,1,1)}copy(){const t=new gn(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),v.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}},ls=class extends ze{constructor(t){super(t),this.type=Z.Point,this.color=new _(.38,.94,0,1)}computeWorldPosition(t,n){const e=t.matrix;return n.x=this.x*e.a+this.y*e.c+t.worldX,n.y=this.x*e.b+this.y*e.d+t.worldY,n}computeWorldRotation(t){const n=t.matrix,e=C.cosDeg(this.rotation),i=C.sinDeg(this.rotation),r=e*n.a+i*n.c,h=e*n.b+i*n.d;return Math.atan2(h,r)*C.radDeg}copy(){const t=new ls(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}},cs=class{constructor(t,n){if(this.deform=new Array,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("bone cannot be null.");this.data=t,this.bone=n,this.color=new _,this.darkColor=t.darkColor==null?null:new _,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor!=null&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName==null?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const Rt=class extends rs{constructor(t){super(t),this.type=Z.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new _(1,1,1,1),this.offset=v.newFloatArray(8),this.uvs=v.newFloatArray(8),this.tempColor=new _(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,n=this.height/this.region.originalHeight*this.scaleY,e=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*n,r=e+this.region.width*t,h=i+this.region.height*n,l=this.rotation*Math.PI/180,s=Math.cos(l),a=Math.sin(l),o=e*s+this.x,d=e*a,f=i*s+this.y,u=i*a,m=r*s+this.x,g=r*a,x=h*s+this.y,E=h*a,w=this.offset;w[Rt.OX1]=o-u,w[Rt.OY1]=f+d,w[Rt.OX2]=o-E,w[Rt.OY2]=x+d,w[Rt.OX3]=m-E,w[Rt.OY3]=x+g,w[Rt.OX4]=m-u,w[Rt.OY4]=f+g}setRegion(t){this.region=t;const n=this.uvs;t.rotate?(n[2]=t.u,n[3]=t.v2,n[4]=t.u,n[5]=t.v,n[6]=t.u2,n[7]=t.v,n[0]=t.u2,n[1]=t.v2):(n[0]=t.u,n[1]=t.v2,n[2]=t.u,n[3]=t.v,n[4]=t.u2,n[5]=t.v,n[6]=t.u2,n[7]=t.v2)}computeWorldVertices(t,n,e,i){const r=this.offset,h=t instanceof cs?t.bone.matrix:t.matrix,l=h.tx,s=h.ty,a=h.a,o=h.c,d=h.b,f=h.d;let u=0,m=0;u=r[Rt.OX1],m=r[Rt.OY1],n[e]=u*a+m*o+l,n[e+1]=u*d+m*f+s,e+=i,u=r[Rt.OX2],m=r[Rt.OY2],n[e]=u*a+m*o+l,n[e+1]=u*d+m*f+s,e+=i,u=r[Rt.OX3],m=r[Rt.OY3],n[e]=u*a+m*o+l,n[e+1]=u*d+m*f+s,e+=i,u=r[Rt.OX4],m=r[Rt.OY4],n[e]=u*a+m*o+l,n[e+1]=u*d+m*f+s}copy(){const t=new Rt(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,v.arrayCopy(this.uvs,0,t.uvs,0,8),v.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}};let Q=Rt;Q.OX1=0,Q.OY1=1,Q.OX2=2,Q.OY2=3,Q.OX3=4,Q.OY3=5,Q.OX4=6,Q.OY4=7,Q.X1=0,Q.Y1=1,Q.C1R=2,Q.C1G=3,Q.C1B=4,Q.C1A=5,Q.U1=6,Q.V1=7,Q.X2=8,Q.Y2=9,Q.C2R=10,Q.C2G=11,Q.C2B=12,Q.C2A=13,Q.U2=14,Q.V2=15,Q.X3=16,Q.Y3=17,Q.C3R=18,Q.C3G=19,Q.C3B=20,Q.C3A=21,Q.U3=22,Q.V3=23,Q.X4=24,Q.Y4=25,Q.C4R=26,Q.C4G=27,Q.C4B=28,Q.C4A=29,Q.U4=30,Q.V4=31;let vr=class{constructor(t,n){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=n}begin(t){}transform(t,n,e,i){t.x+=C.randomTriangular(-this.jitterX,this.jitterY),t.y+=C.randomTriangular(-this.jitterX,this.jitterY)}end(){}};const Ri=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,n,e,i){const r=this.angle*C.degreesToRadians,h=t.x-this.worldX,l=t.y-this.worldY,s=Math.sqrt(h*h+l*l);if(s<this.radius){const a=Ri.interpolation.apply(0,r,(this.radius-s)/this.radius),o=Math.cos(a),d=Math.sin(a);t.x=o*h-d*l+this.worldX,t.y=d*h+o*l+this.worldY}}end(){}};let vi=Ri;vi.interpolation=new is(2);let Et=class{constructor(t,n,e){if(t==null)throw new Error("name cannot be null.");if(n==null)throw new Error("timelines cannot be null.");this.name=t,this.timelines=n,this.timelineIds=[];for(let i=0;i<n.length;i++)this.timelineIds[n[i].getPropertyId()]=!0;this.duration=e}hasTimeline(t){return this.timelineIds[t]==!0}apply(t,n,e,i,r,h,l,s){if(t==null)throw new Error("skeleton cannot be null.");i&&this.duration!=0&&(e%=this.duration,n>0&&(n%=this.duration));const a=this.timelines;for(let o=0,d=a.length;o<d;o++)a[o].apply(t,n,e,r,h,l,s)}static binarySearch(t,n,e=1){let i=0,r=t.length/e-2;if(r==0)return e;let h=r>>>1;for(;;){if(t[(h+1)*e]<=n?i=h+1:r=h,i==r)return(i+1)*e;h=i+r>>>1}}static linearSearch(t,n,e){for(let i=0,r=t.length-e;i<=r;i+=e)if(t[i]>n)return i;return-1}};var Pi=(c=>(c[c.rotate=0]="rotate",c[c.translate=1]="translate",c[c.scale=2]="scale",c[c.shear=3]="shear",c[c.attachment=4]="attachment",c[c.color=5]="color",c[c.deform=6]="deform",c[c.event=7]="event",c[c.drawOrder=8]="drawOrder",c[c.ikConstraint=9]="ikConstraint",c[c.transformConstraint=10]="transformConstraint",c[c.pathConstraintPosition=11]="pathConstraintPosition",c[c.pathConstraintSpacing=12]="pathConstraintSpacing",c[c.pathConstraintMix=13]="pathConstraintMix",c[c.twoColor=14]="twoColor",c))(Pi||{});const St=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=v.newFloatArray((t-1)*St.BEZIER_SIZE)}getFrameCount(){return this.curves.length/St.BEZIER_SIZE+1}setLinear(t){this.curves[t*St.BEZIER_SIZE]=St.LINEAR}setStepped(t){this.curves[t*St.BEZIER_SIZE]=St.STEPPED}getCurveType(t){const n=t*St.BEZIER_SIZE;if(n==this.curves.length)return St.LINEAR;const e=this.curves[n];return e==St.LINEAR?St.LINEAR:e==St.STEPPED?St.STEPPED:St.BEZIER}setCurve(t,n,e,i,r){const h=(-n*2+i)*.03,l=(-e*2+r)*.03,s=((n-i)*3+1)*.006,a=((e-r)*3+1)*.006;let o=h*2+s,d=l*2+a,f=n*.3+h+s*.16666667,u=e*.3+l+a*.16666667,m=t*St.BEZIER_SIZE;const g=this.curves;g[m++]=St.BEZIER;let x=f,E=u;for(let w=m+St.BEZIER_SIZE-1;m<w;m+=2)g[m]=x,g[m+1]=E,f+=o,u+=d,o+=s,d+=a,x+=f,E+=u}getCurvePercent(t,n){n=C.clamp(n,0,1);const e=this.curves;let i=t*St.BEZIER_SIZE;const r=e[i];if(r==St.LINEAR)return n;if(r==St.STEPPED)return 0;i++;let h=0;for(let s=i,a=i+St.BEZIER_SIZE-1;i<a;i+=2)if(h=e[i],h>=n){let o,d;return i==s?(o=0,d=0):(o=e[i-2],d=e[i-1]),d+(e[i+1]-d)*(n-o)/(h-o)}const l=e[i-1];return l+(1-l)*(n-h)/(1-h)}};let Ht=St;Ht.LINEAR=0,Ht.STEPPED=1,Ht.BEZIER=2,Ht.BEZIER_SIZE=10*2-1;const He=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t<<1)}getPropertyId(){return(0<<24)+this.boneIndex}setFrame(t,n,e){t<<=1,this.frames[t]=n,this.frames[t+He.ROTATION]=e}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.bones[this.boneIndex];if(!a.active)return;if(e<s[0]){switch(h){case A.setup:a.rotation=a.data.rotation;return;case A.first:const g=a.data.rotation-a.rotation;a.rotation+=(g-(16384-(16384.499999999996-g/360|0))*360)*r}return}if(e>=s[s.length-He.ENTRIES]){let g=s[s.length+He.PREV_ROTATION];switch(h){case A.setup:a.rotation=a.data.rotation+g*r;break;case A.first:case A.replace:g+=a.data.rotation-a.rotation,g-=(16384-(16384.499999999996-g/360|0))*360;case A.add:a.rotation+=g*r}return}const o=Et.binarySearch(s,e,He.ENTRIES),d=s[o+He.PREV_ROTATION],f=s[o],u=this.getCurvePercent((o>>1)-1,1-(e-f)/(s[o+He.PREV_TIME]-f));let m=s[o+He.ROTATION]-d;switch(m=d+(m-(16384-(16384.499999999996-m/360|0))*360)*u,h){case A.setup:a.rotation=a.data.rotation+(m-(16384-(16384.499999999996-m/360|0))*360)*r;break;case A.first:case A.replace:m+=a.data.rotation-a.rotation;case A.add:a.rotation+=(m-(16384-(16384.499999999996-m/360|0))*360)*r}}};let Vt=He;Vt.ENTRIES=2,Vt.PREV_TIME=-2,Vt.PREV_ROTATION=-1,Vt.ROTATION=1;const Dt=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t*Dt.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,n,e,i){t*=Dt.ENTRIES,this.frames[t]=n,this.frames[t+Dt.X]=e,this.frames[t+Dt.Y]=i}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.bones[this.boneIndex];if(!a.active)return;if(e<s[0]){switch(h){case A.setup:a.x=a.data.x,a.y=a.data.y;return;case A.first:a.x+=(a.data.x-a.x)*r,a.y+=(a.data.y-a.y)*r}return}let o=0,d=0;if(e>=s[s.length-Dt.ENTRIES])o=s[s.length+Dt.PREV_X],d=s[s.length+Dt.PREV_Y];else{const f=Et.binarySearch(s,e,Dt.ENTRIES);o=s[f+Dt.PREV_X],d=s[f+Dt.PREV_Y];const u=s[f],m=this.getCurvePercent(f/Dt.ENTRIES-1,1-(e-u)/(s[f+Dt.PREV_TIME]-u));o+=(s[f+Dt.X]-o)*m,d+=(s[f+Dt.Y]-d)*m}switch(h){case A.setup:a.x=a.data.x+o*r,a.y=a.data.y+d*r;break;case A.first:case A.replace:a.x+=(a.data.x+o-a.x)*r,a.y+=(a.data.y+d-a.y)*r;break;case A.add:a.x+=o*r,a.y+=d*r}}};let Jt=Dt;Jt.ENTRIES=3,Jt.PREV_TIME=-3,Jt.PREV_X=-2,Jt.PREV_Y=-1,Jt.X=1,Jt.Y=2;let te=class extends Jt{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.bones[this.boneIndex];if(!a.active)return;if(e<s[0]){switch(h){case A.setup:a.scaleX=a.data.scaleX,a.scaleY=a.data.scaleY;return;case A.first:a.scaleX+=(a.data.scaleX-a.scaleX)*r,a.scaleY+=(a.data.scaleY-a.scaleY)*r}return}let o=0,d=0;if(e>=s[s.length-te.ENTRIES])o=s[s.length+te.PREV_X]*a.data.scaleX,d=s[s.length+te.PREV_Y]*a.data.scaleY;else{const f=Et.binarySearch(s,e,te.ENTRIES);o=s[f+te.PREV_X],d=s[f+te.PREV_Y];const u=s[f],m=this.getCurvePercent(f/te.ENTRIES-1,1-(e-u)/(s[f+te.PREV_TIME]-u));o=(o+(s[f+te.X]-o)*m)*a.data.scaleX,d=(d+(s[f+te.Y]-d)*m)*a.data.scaleY}if(r==1)h==A.add?(a.scaleX+=o-a.data.scaleX,a.scaleY+=d-a.data.scaleY):(a.scaleX=o,a.scaleY=d);else{let f=0,u=0;if(l==J.mixOut)switch(h){case A.setup:f=a.data.scaleX,u=a.data.scaleY,a.scaleX=f+(Math.abs(o)*C.signum(f)-f)*r,a.scaleY=u+(Math.abs(d)*C.signum(u)-u)*r;break;case A.first:case A.replace:f=a.scaleX,u=a.scaleY,a.scaleX=f+(Math.abs(o)*C.signum(f)-f)*r,a.scaleY=u+(Math.abs(d)*C.signum(u)-u)*r;break;case A.add:f=a.scaleX,u=a.scaleY,a.scaleX=f+(Math.abs(o)*C.signum(f)-a.data.scaleX)*r,a.scaleY=u+(Math.abs(d)*C.signum(u)-a.data.scaleY)*r}else switch(h){case A.setup:f=Math.abs(a.data.scaleX)*C.signum(o),u=Math.abs(a.data.scaleY)*C.signum(d),a.scaleX=f+(o-f)*r,a.scaleY=u+(d-u)*r;break;case A.first:case A.replace:f=Math.abs(a.scaleX)*C.signum(o),u=Math.abs(a.scaleY)*C.signum(d),a.scaleX=f+(o-f)*r,a.scaleY=u+(d-u)*r;break;case A.add:f=C.signum(o),u=C.signum(d),a.scaleX=Math.abs(a.scaleX)*f+(o-Math.abs(a.data.scaleX)*f)*r,a.scaleY=Math.abs(a.scaleY)*u+(d-Math.abs(a.data.scaleY)*u)*r}}}},ee=class extends Jt{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.bones[this.boneIndex];if(!a.active)return;if(e<s[0]){switch(h){case A.setup:a.shearX=a.data.shearX,a.shearY=a.data.shearY;return;case A.first:a.shearX+=(a.data.shearX-a.shearX)*r,a.shearY+=(a.data.shearY-a.shearY)*r}return}let o=0,d=0;if(e>=s[s.length-ee.ENTRIES])o=s[s.length+ee.PREV_X],d=s[s.length+ee.PREV_Y];else{const f=Et.binarySearch(s,e,ee.ENTRIES);o=s[f+ee.PREV_X],d=s[f+ee.PREV_Y];const u=s[f],m=this.getCurvePercent(f/ee.ENTRIES-1,1-(e-u)/(s[f+ee.PREV_TIME]-u));o=o+(s[f+ee.X]-o)*m,d=d+(s[f+ee.Y]-d)*m}switch(h){case A.setup:a.shearX=a.data.shearX+o*r,a.shearY=a.data.shearY+d*r;break;case A.first:case A.replace:a.shearX+=(a.data.shearX+o-a.shearX)*r,a.shearY+=(a.data.shearY+d-a.shearY)*r;break;case A.add:a.shearX+=o*r,a.shearY+=d*r}}};const ft=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t*ft.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,n,e,i,r,h){t*=ft.ENTRIES,this.frames[t]=n,this.frames[t+ft.R]=e,this.frames[t+ft.G]=i,this.frames[t+ft.B]=r,this.frames[t+ft.A]=h}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.color.setFromColor(s.data.color);return;case A.first:const m=s.color,g=s.data.color;m.add((g.r-m.r)*r,(g.g-m.g)*r,(g.b-m.b)*r,(g.a-m.a)*r)}return}let o=0,d=0,f=0,u=0;if(e>=a[a.length-ft.ENTRIES]){const m=a.length;o=a[m+ft.PREV_R],d=a[m+ft.PREV_G],f=a[m+ft.PREV_B],u=a[m+ft.PREV_A]}else{const m=Et.binarySearch(a,e,ft.ENTRIES);o=a[m+ft.PREV_R],d=a[m+ft.PREV_G],f=a[m+ft.PREV_B],u=a[m+ft.PREV_A];const g=a[m],x=this.getCurvePercent(m/ft.ENTRIES-1,1-(e-g)/(a[m+ft.PREV_TIME]-g));o+=(a[m+ft.R]-o)*x,d+=(a[m+ft.G]-d)*x,f+=(a[m+ft.B]-f)*x,u+=(a[m+ft.A]-u)*x}if(r==1)s.color.set(o,d,f,u);else{const m=s.color;h==A.setup&&m.setFromColor(s.data.color),m.add((o-m.r)*r,(d-m.g)*r,(f-m.b)*r,(u-m.a)*r)}}};let Lt=ft;Lt.ENTRIES=5,Lt.PREV_TIME=-5,Lt.PREV_R=-4,Lt.PREV_G=-3,Lt.PREV_B=-2,Lt.PREV_A=-1,Lt.R=1,Lt.G=2,Lt.B=3,Lt.A=4;const nt=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t*nt.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,n,e,i,r,h,l,s,a){t*=nt.ENTRIES,this.frames[t]=n,this.frames[t+nt.R]=e,this.frames[t+nt.G]=i,this.frames[t+nt.B]=r,this.frames[t+nt.A]=h,this.frames[t+nt.R2]=l,this.frames[t+nt.G2]=s,this.frames[t+nt.B2]=a}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.color.setFromColor(s.data.color),s.darkColor.setFromColor(s.data.darkColor);return;case A.first:const E=s.color,w=s.darkColor,b=s.data.color,p=s.data.darkColor;E.add((b.r-E.r)*r,(b.g-E.g)*r,(b.b-E.b)*r,(b.a-E.a)*r),w.add((p.r-w.r)*r,(p.g-w.g)*r,(p.b-w.b)*r,0)}return}let o=0,d=0,f=0,u=0,m=0,g=0,x=0;if(e>=a[a.length-nt.ENTRIES]){const E=a.length;o=a[E+nt.PREV_R],d=a[E+nt.PREV_G],f=a[E+nt.PREV_B],u=a[E+nt.PREV_A],m=a[E+nt.PREV_R2],g=a[E+nt.PREV_G2],x=a[E+nt.PREV_B2]}else{const E=Et.binarySearch(a,e,nt.ENTRIES);o=a[E+nt.PREV_R],d=a[E+nt.PREV_G],f=a[E+nt.PREV_B],u=a[E+nt.PREV_A],m=a[E+nt.PREV_R2],g=a[E+nt.PREV_G2],x=a[E+nt.PREV_B2];const w=a[E],b=this.getCurvePercent(E/nt.ENTRIES-1,1-(e-w)/(a[E+nt.PREV_TIME]-w));o+=(a[E+nt.R]-o)*b,d+=(a[E+nt.G]-d)*b,f+=(a[E+nt.B]-f)*b,u+=(a[E+nt.A]-u)*b,m+=(a[E+nt.R2]-m)*b,g+=(a[E+nt.G2]-g)*b,x+=(a[E+nt.B2]-x)*b}if(r==1)s.color.set(o,d,f,u),s.darkColor.set(m,g,x,1);else{const E=s.color,w=s.darkColor;h==A.setup&&(E.setFromColor(s.data.color),w.setFromColor(s.data.darkColor)),E.add((o-E.r)*r,(d-E.g)*r,(f-E.b)*r,(u-E.a)*r),w.add((m-w.r)*r,(g-w.g)*r,(x-w.b)*r,0)}}};let yt=nt;yt.ENTRIES=8,yt.PREV_TIME=-8,yt.PREV_R=-7,yt.PREV_G=-6,yt.PREV_B=-5,yt.PREV_A=-4,yt.PREV_R2=-3,yt.PREV_G2=-2,yt.PREV_B2=-1,yt.R=1,yt.G=2,yt.B=3,yt.A=4,yt.R2=5,yt.G2=6,yt.B2=7;let en=class{constructor(t){this.frames=v.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,n,e){this.frames[t]=n,this.attachmentNames[t]=e}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;if(l==J.mixOut){h==A.setup&&this.setAttachment(t,s,s.data.attachmentName);return}const a=this.frames;if(e<a[0]){(h==A.setup||h==A.first)&&this.setAttachment(t,s,s.data.attachmentName);return}let o=0;e>=a[a.length-1]?o=a.length-1:o=Et.binarySearch(a,e,1)-1;const d=this.attachmentNames[o];t.slots[this.slotIndex].setAttachment(d==null?null:t.getAttachment(this.slotIndex,d))}setAttachment(t,n,e){n.setAttachment(e==null?null:t.getAttachment(this.slotIndex,e))}},Vi=null,hs=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t),this.frameVertices=new Array(t),Vi==null&&(Vi=v.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,n,e){this.frames[t]=n,this.frameVertices[t]=e}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=s.getAttachment();if(!(a instanceof ze)||a.deformAttachment!=this.attachment)return;const o=s.deform;o.length==0&&(h=A.setup);const d=this.frameVertices,f=d[0].length,u=this.frames;if(e<u[0]){const p=a;switch(h){case A.setup:o.length=0;return;case A.first:if(r==1){o.length=0;break}const S=v.setArraySize(o,f);if(p.bones==null){const y=p.vertices;for(let M=0;M<f;M++)S[M]+=(y[M]-S[M])*r}else{r=1-r;for(let y=0;y<f;y++)S[y]*=r}}return}const m=v.setArraySize(o,f);if(e>=u[u.length-1]){const p=d[u.length-1];if(r==1){if(h==A.add){const S=a;if(S.bones==null){const y=S.vertices;for(let M=0;M<f;M++)m[M]+=p[M]-y[M]}else for(let y=0;y<f;y++)m[y]+=p[y]}else v.arrayCopy(p,0,m,0,f);}else switch(h){case A.setup:{const y=a;if(y.bones==null){const M=y.vertices;for(let T=0;T<f;T++){const k=M[T];m[T]=k+(p[T]-k)*r}}else for(let M=0;M<f;M++)m[M]=p[M]*r;break}case A.first:case A.replace:for(let y=0;y<f;y++)m[y]+=(p[y]-m[y])*r;break;case A.add:const S=a;if(S.bones==null){const y=S.vertices;for(let M=0;M<f;M++)m[M]+=(p[M]-y[M])*r}else for(let y=0;y<f;y++)m[y]+=p[y]*r}return}const g=Et.binarySearch(u,e),x=d[g-1],E=d[g],w=u[g],b=this.getCurvePercent(g-1,1-(e-w)/(u[g-1]-w));if(r==1){if(h==A.add){const p=a;if(p.bones==null){const S=p.vertices;for(let y=0;y<f;y++){const M=x[y];m[y]+=M+(E[y]-M)*b-S[y]}}else for(let S=0;S<f;S++){const y=x[S];m[S]+=y+(E[S]-y)*b}}else for(let p=0;p<f;p++){const S=x[p];m[p]=S+(E[p]-S)*b}}else switch(h){case A.setup:{const S=a;if(S.bones==null){const y=S.vertices;for(let M=0;M<f;M++){const T=x[M],k=y[M];m[M]=k+(T+(E[M]-T)*b-k)*r}}else for(let y=0;y<f;y++){const M=x[y];m[y]=(M+(E[y]-M)*b)*r}break}case A.first:case A.replace:for(let S=0;S<f;S++){const y=x[S];m[S]+=(y+(E[S]-y)*b-m[S])*r}break;case A.add:const p=a;if(p.bones==null){const S=p.vertices;for(let y=0;y<f;y++){const M=x[y];m[y]+=(M+(E[y]-M)*b-S[y])*r}}else for(let S=0;S<f;S++){const y=x[S];m[S]+=(y+(E[S]-y)*b)*r}}}},Yn=class{constructor(t){this.frames=v.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,n){this.frames[t]=n.time,this.events[t]=n}apply(t,n,e,i,r,h,l){if(i==null)return;const s=this.frames,a=this.frames.length;if(n>e)this.apply(t,n,Number.MAX_VALUE,i,r,h,l),n=-1;else if(n>=s[a-1])return;if(e<s[0])return;let o=0;if(n<s[0])o=0;else{o=Et.binarySearch(s,n);const d=s[o];for(;o>0&&s[o-1]==d;)o--}for(;o<a&&e>=s[o];o++)i.push(this.events[o])}},xn=class{constructor(t){this.frames=v.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,n,e){this.frames[t]=n,this.drawOrders[t]=e}apply(t,n,e,i,r,h,l){const s=t.drawOrder,a=t.slots;if(l==J.mixOut&&h==A.setup){v.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);return}const o=this.frames;if(e<o[0]){(h==A.setup||h==A.first)&&v.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);return}let d=0;e>=o[o.length-1]?d=o.length-1:d=Et.binarySearch(o,e)-1;const f=this.drawOrders[d];if(f==null)v.arrayCopy(a,0,s,0,a.length);else for(let u=0,m=f.length;u<m;u++)s[u]=a[f[u]]}};const at=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t*at.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,n,e,i,r,h,l){t*=at.ENTRIES,this.frames[t]=n,this.frames[t+at.MIX]=e,this.frames[t+at.SOFTNESS]=i,this.frames[t+at.BEND_DIRECTION]=r,this.frames[t+at.COMPRESS]=h?1:0,this.frames[t+at.STRETCH]=l?1:0}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.ikConstraints[this.ikConstraintIndex];if(!a.active)return;if(e<s[0]){switch(h){case A.setup:a.mix=a.data.mix,a.softness=a.data.softness,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch;return;case A.first:a.mix+=(a.data.mix-a.mix)*r,a.softness+=(a.data.softness-a.softness)*r,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch}return}if(e>=s[s.length-at.ENTRIES]){h==A.setup?(a.mix=a.data.mix+(s[s.length+at.PREV_MIX]-a.data.mix)*r,a.softness=a.data.softness+(s[s.length+at.PREV_SOFTNESS]-a.data.softness)*r,l==J.mixOut?(a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch):(a.bendDirection=s[s.length+at.PREV_BEND_DIRECTION],a.compress=s[s.length+at.PREV_COMPRESS]!=0,a.stretch=s[s.length+at.PREV_STRETCH]!=0)):(a.mix+=(s[s.length+at.PREV_MIX]-a.mix)*r,a.softness+=(s[s.length+at.PREV_SOFTNESS]-a.softness)*r,l==J.mixIn&&(a.bendDirection=s[s.length+at.PREV_BEND_DIRECTION],a.compress=s[s.length+at.PREV_COMPRESS]!=0,a.stretch=s[s.length+at.PREV_STRETCH]!=0));return}const o=Et.binarySearch(s,e,at.ENTRIES),d=s[o+at.PREV_MIX],f=s[o+at.PREV_SOFTNESS],u=s[o],m=this.getCurvePercent(o/at.ENTRIES-1,1-(e-u)/(s[o+at.PREV_TIME]-u));h==A.setup?(a.mix=a.data.mix+(d+(s[o+at.MIX]-d)*m-a.data.mix)*r,a.softness=a.data.softness+(f+(s[o+at.SOFTNESS]-f)*m-a.data.softness)*r,l==J.mixOut?(a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch):(a.bendDirection=s[o+at.PREV_BEND_DIRECTION],a.compress=s[o+at.PREV_COMPRESS]!=0,a.stretch=s[o+at.PREV_STRETCH]!=0)):(a.mix+=(d+(s[o+at.MIX]-d)*m-a.mix)*r,a.softness+=(f+(s[o+at.SOFTNESS]-f)*m-a.softness)*r,l==J.mixIn&&(a.bendDirection=s[o+at.PREV_BEND_DIRECTION],a.compress=s[o+at.PREV_COMPRESS]!=0,a.stretch=s[o+at.PREV_STRETCH]!=0))}};let Ft=at;Ft.ENTRIES=6,Ft.PREV_TIME=-6,Ft.PREV_MIX=-5,Ft.PREV_SOFTNESS=-4,Ft.PREV_BEND_DIRECTION=-3,Ft.PREV_COMPRESS=-2,Ft.PREV_STRETCH=-1,Ft.MIX=1,Ft.SOFTNESS=2,Ft.BEND_DIRECTION=3,Ft.COMPRESS=4,Ft.STRETCH=5;const ut=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t*ut.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,n,e,i,r,h){t*=ut.ENTRIES,this.frames[t]=n,this.frames[t+ut.ROTATE]=e,this.frames[t+ut.TRANSLATE]=i,this.frames[t+ut.SCALE]=r,this.frames[t+ut.SHEAR]=h}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.transformConstraints[this.transformConstraintIndex];if(!a.active)return;if(e<s[0]){const m=a.data;switch(h){case A.setup:a.rotateMix=m.rotateMix,a.translateMix=m.translateMix,a.scaleMix=m.scaleMix,a.shearMix=m.shearMix;return;case A.first:a.rotateMix+=(m.rotateMix-a.rotateMix)*r,a.translateMix+=(m.translateMix-a.translateMix)*r,a.scaleMix+=(m.scaleMix-a.scaleMix)*r,a.shearMix+=(m.shearMix-a.shearMix)*r}return}let o=0,d=0,f=0,u=0;if(e>=s[s.length-ut.ENTRIES]){const m=s.length;o=s[m+ut.PREV_ROTATE],d=s[m+ut.PREV_TRANSLATE],f=s[m+ut.PREV_SCALE],u=s[m+ut.PREV_SHEAR]}else{const m=Et.binarySearch(s,e,ut.ENTRIES);o=s[m+ut.PREV_ROTATE],d=s[m+ut.PREV_TRANSLATE],f=s[m+ut.PREV_SCALE],u=s[m+ut.PREV_SHEAR];const g=s[m],x=this.getCurvePercent(m/ut.ENTRIES-1,1-(e-g)/(s[m+ut.PREV_TIME]-g));o+=(s[m+ut.ROTATE]-o)*x,d+=(s[m+ut.TRANSLATE]-d)*x,f+=(s[m+ut.SCALE]-f)*x,u+=(s[m+ut.SHEAR]-u)*x}if(h==A.setup){const m=a.data;a.rotateMix=m.rotateMix+(o-m.rotateMix)*r,a.translateMix=m.translateMix+(d-m.translateMix)*r,a.scaleMix=m.scaleMix+(f-m.scaleMix)*r,a.shearMix=m.shearMix+(u-m.shearMix)*r}else a.rotateMix+=(o-a.rotateMix)*r,a.translateMix+=(d-a.translateMix)*r,a.scaleMix+=(f-a.scaleMix)*r,a.shearMix+=(u-a.shearMix)*r}};let _t=ut;_t.ENTRIES=5,_t.PREV_TIME=-5,_t.PREV_ROTATE=-4,_t.PREV_TRANSLATE=-3,_t.PREV_SCALE=-2,_t.PREV_SHEAR=-1,_t.ROTATE=1,_t.TRANSLATE=2,_t.SCALE=3,_t.SHEAR=4;const ue=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t*ue.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,n,e){t*=ue.ENTRIES,this.frames[t]=n,this.frames[t+ue.VALUE]=e}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(e<s[0]){switch(h){case A.setup:a.position=a.data.position;return;case A.first:a.position+=(a.data.position-a.position)*r}return}let o=0;if(e>=s[s.length-ue.ENTRIES])o=s[s.length+ue.PREV_VALUE];else{const d=Et.binarySearch(s,e,ue.ENTRIES);o=s[d+ue.PREV_VALUE];const f=s[d],u=this.getCurvePercent(d/ue.ENTRIES-1,1-(e-f)/(s[d+ue.PREV_TIME]-f));o+=(s[d+ue.VALUE]-o)*u}h==A.setup?a.position=a.data.position+(o-a.data.position)*r:a.position+=(o-a.position)*r}};let Te=ue;Te.ENTRIES=2,Te.PREV_TIME=-2,Te.PREV_VALUE=-1,Te.VALUE=1;let ke=class extends Te{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(e<s[0]){switch(h){case A.setup:a.spacing=a.data.spacing;return;case A.first:a.spacing+=(a.data.spacing-a.spacing)*r}return}let o=0;if(e>=s[s.length-ke.ENTRIES])o=s[s.length+ke.PREV_VALUE];else{const d=Et.binarySearch(s,e,ke.ENTRIES);o=s[d+ke.PREV_VALUE];const f=s[d],u=this.getCurvePercent(d/ke.ENTRIES-1,1-(e-f)/(s[d+ke.PREV_TIME]-f));o+=(s[d+ke.VALUE]-o)*u}h==A.setup?a.spacing=a.data.spacing+(o-a.data.spacing)*r:a.spacing+=(o-a.spacing)*r}};const Ot=class extends Ht{constructor(t){super(t),this.frames=v.newFloatArray(t*Ot.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,n,e,i){t*=Ot.ENTRIES,this.frames[t]=n,this.frames[t+Ot.ROTATE]=e,this.frames[t+Ot.TRANSLATE]=i}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(e<s[0]){switch(h){case A.setup:a.rotateMix=a.data.rotateMix,a.translateMix=a.data.translateMix;return;case A.first:a.rotateMix+=(a.data.rotateMix-a.rotateMix)*r,a.translateMix+=(a.data.translateMix-a.translateMix)*r}return}let o=0,d=0;if(e>=s[s.length-Ot.ENTRIES])o=s[s.length+Ot.PREV_ROTATE],d=s[s.length+Ot.PREV_TRANSLATE];else{const f=Et.binarySearch(s,e,Ot.ENTRIES);o=s[f+Ot.PREV_ROTATE],d=s[f+Ot.PREV_TRANSLATE];const u=s[f],m=this.getCurvePercent(f/Ot.ENTRIES-1,1-(e-u)/(s[f+Ot.PREV_TIME]-u));o+=(s[f+Ot.ROTATE]-o)*m,d+=(s[f+Ot.TRANSLATE]-d)*m}h==A.setup?(a.rotateMix=a.data.rotateMix+(o-a.data.rotateMix)*r,a.translateMix=a.data.translateMix+(d-a.data.translateMix)*r):(a.rotateMix+=(o-a.rotateMix)*r,a.translateMix+=(d-a.translateMix)*r)}};let me=Ot;me.ENTRIES=3,me.PREV_TIME=-3,me.PREV_ROTATE=-2,me.PREV_TRANSLATE=-1,me.ROTATE=1,me.TRANSLATE=2;const mt=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new fs(this),this.propertyIDs=new ns,this.animationsChanged=!1,this.trackEntryPool=new An(()=>new Xn),this.data=t}update(t){t*=this.timeScale;const n=this.tracks;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r==null)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let h=t*r.timeScale;if(r.delay>0){if(r.delay-=h,r.delay>0)continue;h=-r.delay,r.delay=0}let l=r.next;if(l!=null){const s=r.trackLast-l.delay;if(s>=0){for(l.delay=0,l.trackTime+=r.timeScale==0?0:(s/r.timeScale+t)*l.timeScale,r.trackTime+=h,this.setCurrent(e,l,!0);l.mixingFrom!=null;)l.mixTime+=t,l=l.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&r.mixingFrom==null){n[e]=null,this.queue.end(r),this.disposeNext(r);continue}if(r.mixingFrom!=null&&this.updateMixingFrom(r,t)){let s=r.mixingFrom;for(r.mixingFrom=null,s!=null&&(s.mixingTo=null);s!=null;)this.queue.end(s),s=s.mixingFrom}r.trackTime+=h}this.queue.drain()}updateMixingFrom(t,n){const e=t.mixingFrom;if(e==null)return!0;const i=this.updateMixingFrom(e,n);return e.animationLast=e.nextAnimationLast,e.trackLast=e.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?((e.totalAlpha==0||t.mixDuration==0)&&(t.mixingFrom=e.mixingFrom,e.mixingFrom!=null&&(e.mixingFrom.mixingTo=t),t.interruptAlpha=e.interruptAlpha,this.queue.end(e)),i):(e.trackTime+=n*e.timeScale,t.mixTime+=n,!1)}apply(t){if(t==null)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const n=this.events,e=this.tracks;let i=!1;for(let l=0,s=e.length;l<s;l++){const a=e[l];if(a==null||a.delay>0)continue;i=!0;const o=l==0?A.first:a.mixBlend;let d=a.alpha;a.mixingFrom!=null?d*=this.applyMixingFrom(a,t,o):a.trackTime>=a.trackEnd&&a.next==null&&(d=0);const f=a.animationLast,u=a.getAnimationTime(),m=a.animation.timelines.length,g=a.animation.timelines;if(l==0&&d==1||o==A.add)for(let x=0;x<m;x++){v.webkit602BugfixHelper(d,o);const E=g[x];E instanceof en?this.applyAttachmentTimeline(E,t,u,o,!0):E.apply(t,f,u,n,d,o,J.mixIn)}else{const x=a.timelineMode,E=a.timelinesRotation.length==0;E&&v.setArraySize(a.timelinesRotation,m<<1,null);const w=a.timelinesRotation;for(let b=0;b<m;b++){const p=g[b],S=x[b]==mt.SUBSEQUENT?o:A.setup;p instanceof Vt?this.applyRotateTimeline(p,t,u,d,S,w,b<<1,E):p instanceof en?this.applyAttachmentTimeline(p,t,u,o,!0):(v.webkit602BugfixHelper(d,o),p.apply(t,f,u,n,d,S,J.mixIn))}}this.queueEvents(a,u),n.length=0,a.nextAnimationLast=u,a.nextTrackLast=a.trackTime}const r=this.unkeyedState+mt.SETUP,h=t.slots;for(let l=0,s=t.slots.length;l<s;l++){const a=h[l];if(a.attachmentState==r){const o=a.data.attachmentName;a.setAttachment(o==null?null:t.getAttachment(a.data.index,o))}}return this.unkeyedState+=2,this.queue.drain(),i}applyMixingFrom(t,n,e){const i=t.mixingFrom;i.mixingFrom!=null&&this.applyMixingFrom(i,n,e);let r=0;t.mixDuration==0?(r=1,e==A.first&&(e=A.setup)):(r=t.mixTime/t.mixDuration,r>1&&(r=1),e!=A.first&&(e=i.mixBlend));const h=r<i.eventThreshold?this.events:null,l=r<i.attachmentThreshold,s=r<i.drawOrderThreshold,a=i.animationLast,o=i.getAnimationTime(),d=i.animation.timelines.length,f=i.animation.timelines,u=i.alpha*t.interruptAlpha,m=u*(1-r);if(e==A.add)for(let g=0;g<d;g++)f[g].apply(n,a,o,h,m,e,J.mixOut);else{const g=i.timelineMode,x=i.timelineHoldMix,E=i.timelinesRotation.length==0;E&&v.setArraySize(i.timelinesRotation,d<<1,null);const w=i.timelinesRotation;i.totalAlpha=0;for(let b=0;b<d;b++){const p=f[b];let S=J.mixOut,y,M=0;switch(g[b]){case mt.SUBSEQUENT:if(!s&&p instanceof xn)continue;y=e,M=m;break;case mt.FIRST:y=A.setup,M=m;break;case mt.HOLD_SUBSEQUENT:y=e,M=u;break;case mt.HOLD_FIRST:y=A.setup,M=u;break;default:y=A.setup;const T=x[b];M=u*Math.max(0,1-T.mixTime/T.mixDuration);break}i.totalAlpha+=M,p instanceof Vt?this.applyRotateTimeline(p,n,o,M,y,w,b<<1,E):p instanceof en?this.applyAttachmentTimeline(p,n,o,y,l):(v.webkit602BugfixHelper(M,e),s&&p instanceof xn&&y==A.setup&&(S=J.mixIn),p.apply(n,a,o,h,M,y,S))}}return t.mixDuration>0&&this.queueEvents(i,o),this.events.length=0,i.nextAnimationLast=o,i.nextTrackLast=i.trackTime,r}applyAttachmentTimeline(t,n,e,i,r){const h=n.slots[t.slotIndex];if(!h.bone.active)return;const l=t.frames;if(e<l[0])(i==A.setup||i==A.first)&&this.setAttachment(n,h,h.data.attachmentName,r);else{let s;e>=l[l.length-1]?s=l.length-1:s=Et.binarySearch(l,e)-1,this.setAttachment(n,h,t.attachmentNames[s],r)}h.attachmentState<=this.unkeyedState&&(h.attachmentState=this.unkeyedState+mt.SETUP)}setAttachment(t,n,e,i){n.setAttachment(e==null?null:t.getAttachment(n.data.index,e)),i&&(n.attachmentState=this.unkeyedState+mt.CURRENT)}applyRotateTimeline(t,n,e,i,r,h,l,s){if(s&&(h[l]=0),i==1){t.apply(n,0,e,null,1,r,J.mixIn);return}const a=t,o=a.frames,d=n.bones[a.boneIndex];if(!d.active)return;let f=0,u=0;if(e<o[0])switch(r){case A.setup:d.rotation=d.data.rotation;default:return;case A.first:f=d.rotation,u=d.data.rotation}else if(f=r==A.setup?d.data.rotation:d.rotation,e>=o[o.length-Vt.ENTRIES])u=d.data.rotation+o[o.length+Vt.PREV_ROTATION];else{const x=Et.binarySearch(o,e,Vt.ENTRIES),E=o[x+Vt.PREV_ROTATION],w=o[x],b=a.getCurvePercent((x>>1)-1,1-(e-w)/(o[x+Vt.PREV_TIME]-w));u=o[x+Vt.ROTATION]-E,u-=(16384-(16384.499999999996-u/360|0))*360,u=E+u*b+d.data.rotation,u-=(16384-(16384.499999999996-u/360|0))*360}let m=0,g=u-f;if(g-=(16384-(16384.499999999996-g/360|0))*360,g==0)m=h[l];else{let x=0,E=0;s?(x=0,E=g):(x=h[l],E=h[l+1]);const w=g>0;let b=x>=0;C.signum(E)!=C.signum(g)&&Math.abs(E)<=90&&(Math.abs(x)>180&&(x+=360*C.signum(x)),b=w),m=g+x-x%360,b!=w&&(m+=360*C.signum(x)),h[l]=m}h[l+1]=g,f+=m*i,d.rotation=f-(16384-(16384.499999999996-f/360|0))*360}queueEvents(t,n){const e=t.animationStart,i=t.animationEnd,r=i-e,h=t.trackLast%r,l=this.events;let s=0;const a=l.length;for(;s<a;s++){const d=l[s];if(d.time<h)break;d.time>i||this.queue.event(t,d)}let o=!1;for(t.loop?o=r==0||h>t.trackTime%r:o=n>=i&&t.animationLast<i,o&&this.queue.complete(t);s<a;s++)l[s].time<e||this.queue.event(t,l[s])}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let n=0,e=this.tracks.length;n<e;n++)this.clearTrack(n);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const n=this.tracks[t];if(n==null)return;this.queue.end(n),this.disposeNext(n);let e=n;for(;;){const i=e.mixingFrom;if(i==null)break;this.queue.end(i),e.mixingFrom=null,e.mixingTo=null,e=i}this.tracks[n.trackIndex]=null,this.queue.drain()}setCurrent(t,n,e){const i=this.expandToIndex(t);this.tracks[t]=n,i!=null&&(e&&this.queue.interrupt(i),n.mixingFrom=i,i.mixingTo=n,n.mixTime=0,i.mixingFrom!=null&&i.mixDuration>0&&(n.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(n)}setAnimation(t,n,e){const i=this.data.skeletonData.findAnimation(n);if(i==null)throw new Error(`Animation not found: ${n}`);return this.setAnimationWith(t,i,e)}setAnimationWith(t,n,e){if(n==null)throw new Error("animation cannot be null.");let i=!0,r=this.expandToIndex(t);r!=null&&(r.nextTrackLast==-1?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,i=!1):this.disposeNext(r));const h=this.trackEntry(t,n,e,r);return this.setCurrent(t,h,i),this.queue.drain(),h}addAnimation(t,n,e,i){const r=this.data.skeletonData.findAnimation(n);if(r==null)throw new Error(`Animation not found: ${n}`);return this.addAnimationWith(t,r,e,i)}addAnimationWith(t,n,e,i){if(n==null)throw new Error("animation cannot be null.");let r=this.expandToIndex(t);if(r!=null)for(;r.next!=null;)r=r.next;const h=this.trackEntry(t,n,e,r);if(r==null)this.setCurrent(t,h,!0),this.queue.drain();else if(r.next=h,i<=0){const l=r.animationEnd-r.animationStart;l!=0?(r.loop?i+=l*(1+(r.trackTime/l|0)):i+=Math.max(l,r.trackTime),i-=this.data.getMix(r.animation,n)):i=r.trackTime}return h.delay=i,h}setEmptyAnimation(t,n){const e=this.setAnimationWith(t,mt.emptyAnimation,!1);return e.mixDuration=n,e.trackEnd=n,e}addEmptyAnimation(t,n,e){e<=0&&(e-=n);const i=this.addAnimationWith(t,mt.emptyAnimation,!1,e);return i.mixDuration=n,i.trackEnd=n,i}setEmptyAnimations(t){const n=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,i=this.tracks.length;e<i;e++){const r=this.tracks[e];r!=null&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=n,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(v.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,n,e,i){const r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=n,r.loop=e,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=n.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=i==null?0:this.data.getMix(i.animation,n),r.mixBlend=A.replace,r}disposeNext(t){let n=t.next;for(;n!=null;)this.queue.dispose(n),n=n.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,n=this.tracks.length;t<n;t++){let e=this.tracks[t];if(e!=null){for(;e.mixingFrom!=null;)e=e.mixingFrom;do(e.mixingFrom==null||e.mixBlend!=A.add)&&this.computeHold(e),e=e.mixingTo;while(e!=null)}}}computeHold(t){const n=t.mixingTo,e=t.animation.timelines,i=t.animation.timelines.length,r=v.setArraySize(t.timelineMode,i);t.timelineHoldMix.length=0;const h=v.setArraySize(t.timelineHoldMix,i),l=this.propertyIDs;if(n!=null&&n.holdPrevious){for(let s=0;s<i;s++)r[s]=l.add(e[s].getPropertyId())?mt.HOLD_FIRST:mt.HOLD_SUBSEQUENT;return}t:for(let s=0;s<i;s++){const a=e[s],o=a.getPropertyId();if(!l.add(o))r[s]=mt.SUBSEQUENT;else if(n==null||a instanceof en||a instanceof xn||a instanceof Yn||!n.animation.hasTimeline(o))r[s]=mt.FIRST;else{for(let d=n.mixingTo;d!=null;d=d.mixingTo)if(!d.animation.hasTimeline(o)){if(t.mixDuration>0){r[s]=mt.HOLD_MIX,h[s]=d;continue t}break}r[s]=mt.HOLD_FIRST}}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(t==null)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const n=this.listeners.indexOf(t);n>=0&&this.listeners.splice(n,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,n,e){mt.deprecatedWarning1||(mt.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,n,e)}addAnimationByName(t,n,e,i){mt.deprecatedWarning2||(mt.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,n,e,i)}hasAnimation(t){return this.data.skeletonData.findAnimation(t)!==null}hasAnimationByName(t){return mt.deprecatedWarning3||(mt.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let ne=mt;ne.emptyAnimation=new Et("<empty>",[],0),ne.SUBSEQUENT=0,ne.FIRST=1,ne.HOLD_SUBSEQUENT=2,ne.HOLD_FIRST=3,ne.HOLD_MIX=4,ne.SETUP=1,ne.CURRENT=2,ne.deprecatedWarning1=!1,ne.deprecatedWarning2=!1,ne.deprecatedWarning3=!1;const Ye=class{constructor(){this.mixBlend=A.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return t==0?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return Ye.deprecatedWarning1||(Ye.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){Ye.deprecatedWarning1||(Ye.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return Ye.deprecatedWarning2||(Ye.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){Ye.deprecatedWarning2||(Ye.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let Xn=Ye;Xn.deprecatedWarning1=!1,Xn.deprecatedWarning2=!1;const ds=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Gt.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Gt.interrupt),this.objects.push(t)}end(t){this.objects.push(Gt.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Gt.dispose),this.objects.push(t)}complete(t){this.objects.push(Gt.complete),this.objects.push(t)}event(t,n){this.objects.push(Gt.event),this.objects.push(t),this.objects.push(n)}deprecateStuff(){return ds.deprecatedWarning1||(ds.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,n=this.animState.listeners;for(let e=0;e<t.length;e+=2){const i=t[e],r=t[e+1];switch(i){case Gt.start:r.listener!=null&&r.listener.start&&r.listener.start(r);for(let s=0;s<n.length;s++)n[s].start&&n[s].start(r);r.onStart&&this.deprecateStuff()&&r.onStart(r.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(r.trackIndex);break;case Gt.interrupt:r.listener!=null&&r.listener.interrupt&&r.listener.interrupt(r);for(let s=0;s<n.length;s++)n[s].interrupt&&n[s].interrupt(r);break;case Gt.end:r.listener!=null&&r.listener.end&&r.listener.end(r);for(let s=0;s<n.length;s++)n[s].end&&n[s].end(r);r.onEnd&&this.deprecateStuff()&&r.onEnd(r.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(r.trackIndex);case Gt.dispose:r.listener!=null&&r.listener.dispose&&r.listener.dispose(r);for(let s=0;s<n.length;s++)n[s].dispose&&n[s].dispose(r);this.animState.trackEntryPool.free(r);break;case Gt.complete:r.listener!=null&&r.listener.complete&&r.listener.complete(r);for(let s=0;s<n.length;s++)n[s].complete&&n[s].complete(r);const h=C.toInt(r.loopsCount());r.onComplete&&this.deprecateStuff()&&r.onComplete(r.trackIndex,h),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(r.trackIndex,h);break;case Gt.event:const l=t[e++ +2];r.listener!=null&&r.listener.event&&r.listener.event(r,l);for(let s=0;s<n.length;s++)n[s].event&&n[s].event(r,l);r.onEvent&&this.deprecateStuff()&&r.onEvent(r.trackIndex,l),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(r.trackIndex,l);break}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let fs=ds;fs.deprecatedWarning1=!1;var Gt=(c=>(c[c.start=0]="start",c[c.interrupt=1]="interrupt",c[c.end=2]="end",c[c.dispose=3]="dispose",c[c.complete=4]="complete",c[c.event=5]="event",c))(Gt||{});let Pr=class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,n){}};const us=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,t==null)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,n,e){const i=this.skeletonData.findAnimation(t);if(i==null)throw new Error(`Animation not found: ${t}`);const r=this.skeletonData.findAnimation(n);if(r==null)throw new Error(`Animation not found: ${n}`);this.setMixWith(i,r,e)}setMixByName(t,n,e){us.deprecatedWarning1||(us.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(t,n,e)}setMixWith(t,n,e){if(t==null)throw new Error("from cannot be null.");if(n==null)throw new Error("to cannot be null.");const i=`${t.name}.${n.name}`;this.animationToMixTime[i]=e}getMix(t,n){const e=`${t.name}.${n.name}`,i=this.animationToMixTime[e];return i===void 0?this.defaultMix:i}};let ms=us;ms.deprecatedWarning1=!1;let gs=class{constructor(t){this.atlas=t}newRegionAttachment(t,n,e){const i=this.atlas.findRegion(e);if(i==null)throw new Error(`Region not found in atlas: ${e} (region attachment: ${n})`);const r=new Q(n);return r.region=i,r}newMeshAttachment(t,n,e){const i=this.atlas.findRegion(e);if(i==null)throw new Error(`Region not found in atlas: ${e} (mesh attachment: ${n})`);const r=new mn(n);return r.region=i,r}newBoundingBoxAttachment(t,n){return new as(n)}newPathAttachment(t,n){return new gn(n)}newPointAttachment(t,n){return new ls(n)}newClippingAttachment(t,n){return new os(n)}},xs=class{constructor(t,n,e){if(this.matrix=new H.Matrix,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!1,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=n,this.parent=e,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,n,e,i,r,h,l){this.ax=t,this.ay=n,this.arotation=e,this.ascaleX=i,this.ascaleY=r,this.ashearX=h,this.ashearY=l,this.appliedValid=!0;const s=this.parent,a=this.matrix,o=this.skeleton.scaleX,d=zt.yDown?-this.skeleton.scaleY:this.skeleton.scaleY;if(s==null){const x=this.skeleton,E=e+90+l;a.a=C.cosDeg(e+h)*i*o,a.c=C.cosDeg(E)*r*o,a.b=C.sinDeg(e+h)*i*d,a.d=C.sinDeg(E)*r*d,a.tx=t*o+x.x,a.ty=n*d+x.y;return}let f=s.matrix.a,u=s.matrix.c,m=s.matrix.b,g=s.matrix.d;switch(a.tx=f*t+u*n+s.matrix.tx,a.ty=m*t+g*n+s.matrix.ty,this.data.transformMode){case j.Normal:{const x=e+90+l,E=C.cosDeg(e+h)*i,w=C.cosDeg(x)*r,b=C.sinDeg(e+h)*i,p=C.sinDeg(x)*r;a.a=f*E+u*b,a.c=f*w+u*p,a.b=m*E+g*b,a.d=m*w+g*p;return}case j.OnlyTranslation:{const x=e+90+l;a.a=C.cosDeg(e+h)*i,a.c=C.cosDeg(x)*r,a.b=C.sinDeg(e+h)*i,a.d=C.sinDeg(x)*r;break}case j.NoRotationOrReflection:{let x=f*f+m*m,E=0;x>1e-4?(x=Math.abs(f*g-u*m)/x,f/=this.skeleton.scaleX,m/=this.skeleton.scaleY,u=m*x,g=f*x,E=Math.atan2(m,f)*C.radDeg):(f=0,m=0,E=90-Math.atan2(g,u)*C.radDeg);const w=e+h-E,b=e+l-E+90,p=C.cosDeg(w)*i,S=C.cosDeg(b)*r,y=C.sinDeg(w)*i,M=C.sinDeg(b)*r;a.a=f*p-u*y,a.c=f*S-u*M,a.b=m*p+g*y,a.d=m*S+g*M;break}case j.NoScale:case j.NoScaleOrReflection:{const x=C.cosDeg(e),E=C.sinDeg(e);let w=(f*x+u*E)/o,b=(m*x+g*E)/d,p=Math.sqrt(w*w+b*b);p>1e-5&&(p=1/p),w*=p,b*=p,p=Math.sqrt(w*w+b*b),this.data.transformMode==j.NoScale&&f*g-u*m<0!=(zt.yDown?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(p=-p);const S=Math.PI/2+Math.atan2(b,w),y=Math.cos(S)*p,M=Math.sin(S)*p,T=C.cosDeg(h)*i,k=C.cosDeg(90+l)*r,I=C.sinDeg(h)*i,R=C.sinDeg(90+l)*r;a.a=w*T+y*I,a.c=w*k+y*R,a.b=b*T+M*I,a.d=b*k+M*R;break}}a.a*=o,a.c*=o,a.b*=d,a.d*=d}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*C.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*C.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,n=this.matrix;if(t==null){this.ax=n.tx,this.ay=n.ty,this.arotation=Math.atan2(n.b,n.a)*C.radDeg,this.ascaleX=Math.sqrt(n.a*n.a+n.b*n.b),this.ascaleY=Math.sqrt(n.c*n.c+n.d*n.d),this.ashearX=0,this.ashearY=Math.atan2(n.a*n.c+n.b*n.d,n.a*n.d-n.b*n.c)*C.radDeg;return}const e=t.matrix,i=1/(e.a*e.d-e.b*e.c),r=n.tx-e.tx,h=n.ty-e.ty;this.ax=r*e.d*i-h*e.c*i,this.ay=h*e.a*i-r*e.b*i;const l=i*e.d,s=i*e.a,a=i*e.c,o=i*e.b,d=l*n.a-a*n.b,f=l*n.c-a*n.d,u=s*n.b-o*n.a,m=s*n.d-o*n.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(d*d+u*u),this.ascaleX>1e-4){const g=d*m-f*u;this.ascaleY=g/this.ascaleX,this.ashearY=Math.atan2(d*f+u*m,g)*C.radDeg,this.arotation=Math.atan2(u,d)*C.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,f)*C.radDeg}worldToLocal(t){const n=this.matrix,e=n.a,i=n.c,r=n.b,h=n.d,l=1/(e*h-i*r),s=t.x-n.tx,a=t.y-n.ty;return t.x=s*h*l-a*i*l,t.y=a*e*l-s*r*l,t}localToWorld(t){const n=this.matrix,e=t.x,i=t.y;return t.x=e*n.a+i*n.c+n.tx,t.y=e*n.b+i*n.d+n.ty,t}worldToLocalRotation(t){const n=C.sinDeg(t),e=C.cosDeg(t),i=this.matrix;return Math.atan2(i.a*n-i.b*e,i.d*e-i.c*n)*C.radDeg}localToWorldRotation(t){const n=C.sinDeg(t),e=C.cosDeg(t),i=this.matrix;return Math.atan2(e*i.b+n*i.d,e*i.a+n*i.c)*C.radDeg}rotateWorld(t){const n=this.matrix,e=n.a,i=n.c,r=n.b,h=n.d,l=C.cosDeg(t),s=C.sinDeg(t);n.a=l*e-s*r,n.c=l*i-s*h,n.b=s*e+l*r,n.d=s*i+l*h,this.appliedValid=!1}},ps=class{constructor(t,n,e){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=j.Normal,this.skinRequired=!1,this.color=new _,t<0)throw new Error("index must be >= 0.");if(n==null)throw new Error("name cannot be null.");this.index=t,this.name=n,this.parent=e}},Nn=class{constructor(t,n,e){this.name=t,this.order=n,this.skinRequired=e}},ws=class{constructor(t,n){if(n==null)throw new Error("data cannot be null.");this.time=t,this.data=n}},bs=class{constructor(t){this.name=t}},Fi=class{constructor(t,n){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let e=0;e<t.bones.length;e++)this.bones.push(n.findBone(t.bones[e].name));this.target=n.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){const t=this.target,n=this.bones;switch(n.length){case 1:this.apply1(n[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(n[0],n[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix);break}}apply1(t,n,e,i,r,h,l){t.appliedValid||t.updateAppliedTransform();const s=t.parent.matrix,a=s.a;let o=s.c;const d=s.b;let f=s.d,u=-t.ashearX-t.arotation,m=0,g=0;switch(t.data.transformMode){case j.OnlyTranslation:m=n-t.worldX,g=e-t.worldY;break;case j.NoRotationOrReflection:const w=Math.abs(a*f-o*d)/(a*a+d*d),b=a/t.skeleton.scaleX,p=d/t.skeleton.scaleY;o=-p*w*t.skeleton.scaleX,f=b*w*t.skeleton.scaleY,u+=Math.atan2(p,b)*C.radDeg;default:const S=n-s.tx,y=e-s.ty,M=a*f-o*d;m=(S*f-y*o)/M-t.ax,g=(y*a-S*d)/M-t.ay}u+=Math.atan2(g,m)*C.radDeg,t.ascaleX<0&&(u+=180),u>180?u-=360:u<-180&&(u+=360);let x=t.ascaleX,E=t.ascaleY;if(i||r){switch(t.data.transformMode){case j.NoScale:case j.NoScaleOrReflection:m=n-t.worldX,g=e-t.worldY}const w=t.data.length*x,b=Math.sqrt(m*m+g*g);if(i&&b<w||r&&b>w&&w>1e-4){const p=(b/w-1)*l+1;x*=p,h&&(E*=p)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+u*l,x,E,t.ashearX,t.ashearY)}apply2(t,n,e,i,r,h,l,s){if(s==0){n.updateWorldTransform();return}t.appliedValid||t.updateAppliedTransform(),n.appliedValid||n.updateAppliedTransform();const a=t.ax,o=t.ay;let d=t.ascaleX,f=d,u=t.ascaleY,m=n.ascaleX;const g=t.matrix;let x=0,E=0,w=0;d<0?(d=-d,x=180,w=-1):(x=0,w=1),u<0&&(u=-u,w=-w),m<0?(m=-m,E=180):E=0;const b=n.ax;let p=0,S=0,y=0,M=g.a,T=g.c,k=g.b,I=g.d;const R=Math.abs(d-u)<=1e-4;R?(p=n.ay,S=M*b+T*p+g.tx,y=k*b+I*p+g.ty):(p=0,S=M*b+g.tx,y=k*b+g.ty);const V=t.parent.matrix;M=V.a,T=V.c,k=V.b,I=V.d;const F=1/(M*I-T*k);let B=S-V.tx,Y=y-V.ty;const N=(B*I-Y*T)*F-a,q=(Y*M-B*k)*F-o,z=Math.sqrt(N*N+q*q);let D=n.data.length*m,X,L;if(z<1e-4){this.apply1(t,e,i,!1,h,!1,s),n.updateWorldTransformWith(b,p,0,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY);return}B=e-V.tx,Y=i-V.ty;let O=(B*I-Y*T)*F-a,W=(Y*M-B*k)*F-o,U=O*O+W*W;if(l!=0){l*=d*(m+1)/2;const lt=Math.sqrt(U),It=lt-z-D*d+l;if(It>0){let ct=Math.min(1,It/(l*2))-1;ct=(It-l*(1-ct*ct))/lt,O-=ct*O,W-=ct*W,U=O*O+W*W}}t:if(R){D*=d;let lt=(U-z*z-D*D)/(2*z*D);lt<-1?lt=-1:lt>1&&(lt=1,h&&(f*=(Math.sqrt(U)/(z+D)-1)*s+1)),L=Math.acos(lt)*r,M=z+D*lt,T=D*Math.sin(L),X=Math.atan2(W*M-O*T,O*M+W*T)}else{M=d*D,T=u*D;const lt=M*M,It=T*T,ct=Math.atan2(W,O);k=It*z*z+lt*U-lt*It;const Xt=-2*It*z,Ut=It-lt;if(I=Xt*Xt-4*Ut*k,I>=0){let ae=Math.sqrt(I);Xt<0&&(ae=-ae),ae=-(Xt+ae)/2;const Ke=ae/Ut,Nt=k/ae,We=Math.abs(Ke)<Math.abs(Nt)?Ke:Nt;if(We*We<=U){Y=Math.sqrt(U-We*We)*r,X=ct-Math.atan2(Y,We),L=Math.atan2(Y/u,(We-z)/d);break t}}let de=C.PI,Me=z-M,Oe=Me*Me,Ve=0,Ae=0,Ce=z+M,$e=Ce*Ce,Kt=0;k=-M*z/(lt-It),k>=-1&&k<=1&&(k=Math.acos(k),B=M*Math.cos(k)+z,Y=T*Math.sin(k),I=B*B+Y*Y,I<Oe&&(de=k,Oe=I,Me=B,Ve=Y),I>$e&&(Ae=k,$e=I,Ce=B,Kt=Y)),U<=(Oe+$e)/2?(X=ct-Math.atan2(Ve*r,Me),L=de*r):(X=ct-Math.atan2(Kt*r,Ce),L=Ae*r)}const $=Math.atan2(p,b)*w;let G=t.arotation;X=(X-$)*C.radDeg+x-G,X>180?X-=360:X<-180&&(X+=360),t.updateWorldTransformWith(a,o,G+X*s,f,t.ascaleY,0,0),G=n.arotation,L=((L+$)*C.radDeg-n.ashearX)*w+E-G,L>180?L-=360:L<-180&&(L+=360),n.updateWorldTransformWith(b,p,G+L*s,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY)}},Es=class extends Nn{constructor(t){super(t,0,!1),this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}},Ss=class extends Nn{constructor(t){super(t,0,!1),this.bones=new Array}};var vt=(c=>(c[c.Length=0]="Length",c[c.Fixed=1]="Fixed",c[c.Percent=2]="Percent",c))(vt||{});const nn=class{constructor(t,n){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let e=0,i=t.bones.length;e<i;e++)this.bones.push(n.findBone(t.bones[e].name));this.target=n.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}isActive(){return this.active}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof gn))return;const n=this.rotateMix,e=this.translateMix,i=e>0,r=n>0;if(!i&&!r)return;const h=this.data,l=h.spacingMode,s=l==vt.Length,a=h.rotateMode,o=a==pt.Tangent,d=a==pt.ChainScale,f=this.bones.length,u=o?f:f+1,m=this.bones,g=v.setArraySize(this.spaces,u);let x=null;const E=this.spacing;if(d||s){d&&(x=v.setArraySize(this.lengths,f));for(let M=0,T=u-1;M<T;){const k=m[M],I=k.data.length;if(I<nn.epsilon)d&&(x[M]=0),g[++M]=0;else{const R=I*k.matrix.a,V=I*k.matrix.b,F=Math.sqrt(R*R+V*V);d&&(x[M]=F),g[++M]=(s?I+E:E)*F/I}}}else for(let M=1;M<u;M++)g[M]=E;const w=this.computeWorldPositions(t,u,o,h.positionMode==dt.Percent,l==vt.Percent);let b=w[0],p=w[1],S=h.offsetRotation,y=!1;if(S==0)y=a==pt.Chain;else{y=!1;const M=this.target.bone.matrix;S*=M.a*M.d-M.b*M.c>0?C.degRad:-C.degRad}for(let M=0,T=3;M<f;M++,T+=3){const k=m[M],I=k.matrix;I.tx+=(b-I.tx)*e,I.ty+=(p-I.ty)*e;const R=w[T],V=w[T+1],F=R-b,B=V-p;if(d){const Y=x[M];if(Y!=0){const N=(Math.sqrt(F*F+B*B)/Y-1)*n+1;I.a*=N,I.b*=N}}if(b=R,p=V,r){const Y=I.a,N=I.c,q=I.b,z=I.d;let D=0,X=0,L=0;if(o&&(o?D=w[T-1]:g[M+1]==0?D=w[T+2]:D=Math.atan2(B,F)),D-=Math.atan2(q,Y),y){X=Math.cos(D),L=Math.sin(D);const O=k.data.length;b+=(O*(X*Y-L*q)-F)*n,p+=(O*(L*Y+X*q)-B)*n}else D+=S;D>C.PI?D-=C.PI2:D<-C.PI&&(D+=C.PI2),D*=n,X=Math.cos(D),L=Math.sin(D),I.a=X*Y-L*q,I.c=X*N-L*z,I.b=L*Y+X*q,I.d=L*N+X*z}k.appliedValid=!1}}computeWorldPositions(t,n,e,i,r){const h=this.target;let l=this.position;const s=this.spaces,a=v.setArraySize(this.positions,n*3+2);let o=null;const d=t.closed;let f=t.worldVerticesLength,u=f/6,m=nn.NONE;if(!t.constantSpeed){const D=t.lengths;u-=d?1:2;const X=D[u];if(i&&(l*=X),r)for(let L=0;L<n;L++)s[L]*=X;o=v.setArraySize(this.world,8);for(let L=0,O=0,W=0;L<n;L++,O+=3){const U=s[L];l+=U;let $=l;if(d)$%=X,$<0&&($+=X),W=0;else if($<0){m!=nn.BEFORE&&(m=nn.BEFORE,t.computeWorldVertices(h,2,4,o,0,2)),this.addBeforePosition($,o,0,a,O);continue}else if($>X){m!=nn.AFTER&&(m=nn.AFTER,t.computeWorldVertices(h,f-6,4,o,0,2)),this.addAfterPosition($-X,o,0,a,O);continue}for(;;W++){const G=D[W];if(!($>G)){if(W==0)$/=G;else{const lt=D[W-1];$=($-lt)/(G-lt)}break}}W!=m&&(m=W,d&&W==u?(t.computeWorldVertices(h,f-4,4,o,0,2),t.computeWorldVertices(h,0,4,o,4,2)):t.computeWorldVertices(h,W*6+2,8,o,0,2)),this.addCurvePosition($,o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],a,O,e||L>0&&U==0)}return a}d?(f+=2,o=v.setArraySize(this.world,f),t.computeWorldVertices(h,2,f-4,o,0,2),t.computeWorldVertices(h,0,2,o,f-4,2),o[f-2]=o[0],o[f-1]=o[1]):(u--,f-=4,o=v.setArraySize(this.world,f),t.computeWorldVertices(h,2,f,o,0,2));const g=v.setArraySize(this.curves,u);let x=0,E=o[0],w=o[1],b=0,p=0,S=0,y=0,M=0,T=0,k=0,I=0,R=0,V=0,F=0,B=0,Y=0,N=0;for(let D=0,X=2;D<u;D++,X+=6)b=o[X],p=o[X+1],S=o[X+2],y=o[X+3],M=o[X+4],T=o[X+5],k=(E-b*2+S)*.1875,I=(w-p*2+y)*.1875,R=((b-S)*3-E+M)*.09375,V=((p-y)*3-w+T)*.09375,F=k*2+R,B=I*2+V,Y=(b-E)*.75+k+R*.16666667,N=(p-w)*.75+I+V*.16666667,x+=Math.sqrt(Y*Y+N*N),Y+=F,N+=B,F+=R,B+=V,x+=Math.sqrt(Y*Y+N*N),Y+=F,N+=B,x+=Math.sqrt(Y*Y+N*N),Y+=F+R,N+=B+V,x+=Math.sqrt(Y*Y+N*N),g[D]=x,E=M,w=T;if(i&&(l*=x),r)for(let D=0;D<n;D++)s[D]*=x;const q=this.segments;let z=0;for(let D=0,X=0,L=0,O=0;D<n;D++,X+=3){const W=s[D];l+=W;let U=l;if(d)U%=x,U<0&&(U+=x),L=0;else if(U<0){this.addBeforePosition(U,o,0,a,X);continue}else if(U>x){this.addAfterPosition(U-x,o,f-4,a,X);continue}for(;;L++){const $=g[L];if(!(U>$)){if(L==0)U/=$;else{const G=g[L-1];U=(U-G)/($-G)}break}}if(L!=m){m=L;let $=L*6;for(E=o[$],w=o[$+1],b=o[$+2],p=o[$+3],S=o[$+4],y=o[$+5],M=o[$+6],T=o[$+7],k=(E-b*2+S)*.03,I=(w-p*2+y)*.03,R=((b-S)*3-E+M)*.006,V=((p-y)*3-w+T)*.006,F=k*2+R,B=I*2+V,Y=(b-E)*.3+k+R*.16666667,N=(p-w)*.3+I+V*.16666667,z=Math.sqrt(Y*Y+N*N),q[0]=z,$=1;$<8;$++)Y+=F,N+=B,F+=R,B+=V,z+=Math.sqrt(Y*Y+N*N),q[$]=z;Y+=F,N+=B,z+=Math.sqrt(Y*Y+N*N),q[8]=z,Y+=F+R,N+=B+V,z+=Math.sqrt(Y*Y+N*N),q[9]=z,O=0}for(U*=z;;O++){const $=q[O];if(!(U>$)){if(O==0)U/=$;else{const G=q[O-1];U=O+(U-G)/($-G)}break}}this.addCurvePosition(U*.1,E,w,b,p,S,y,M,T,a,X,e||D>0&&W==0)}return a}addBeforePosition(t,n,e,i,r){const h=n[e],l=n[e+1],s=n[e+2]-h,a=n[e+3]-l,o=Math.atan2(a,s);i[r]=h+t*Math.cos(o),i[r+1]=l+t*Math.sin(o),i[r+2]=o}addAfterPosition(t,n,e,i,r){const h=n[e+2],l=n[e+3],s=h-n[e],a=l-n[e+1],o=Math.atan2(a,s);i[r]=h+t*Math.cos(o),i[r+1]=l+t*Math.sin(o),i[r+2]=o}addCurvePosition(t,n,e,i,r,h,l,s,a,o,d,f){(t==0||isNaN(t))&&(t=1e-4);const u=t*t,m=u*t,g=1-t,x=g*g,E=x*g,w=g*t,b=w*3,p=g*b,S=b*t,y=n*E+i*p+h*S+s*m,M=e*E+r*p+l*S+a*m;o[d]=y,o[d+1]=M,f&&(o[d+2]=Math.atan2(M-(e*x+r*w*2+l*u),y-(n*x+i*w*2+h*u)))}};let pn=nn;pn.NONE=-1,pn.BEFORE=-2,pn.AFTER=-3,pn.epsilon=1e-5;let Yi=class{constructor(t,n){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new un,this.active=!1,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let e=0;e<t.bones.length;e++)this.bones.push(n.findBone(t.bones[e].name));this.target=n.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,n=this.translateMix,e=this.scaleMix,i=this.shearMix,r=this.target,h=r.matrix,l=h.a,s=h.c,a=h.b,o=h.d,d=l*o-s*a>0?C.degRad:-C.degRad,f=this.data.offsetRotation*d,u=this.data.offsetShearY*d,m=this.bones;for(let g=0,x=m.length;g<x;g++){const E=m[g];let w=!1;const b=E.matrix;if(t!=0){const p=b.a,S=b.c,y=b.b,M=b.d;let T=Math.atan2(a,l)-Math.atan2(y,p)+f;T>C.PI?T-=C.PI2:T<-C.PI&&(T+=C.PI2),T*=t;const k=Math.cos(T),I=Math.sin(T);b.a=k*p-I*y,b.c=k*S-I*M,b.b=I*p+k*y,b.d=I*S+k*M,w=!0}if(n!=0){const p=this.temp;r.localToWorld(p.set(this.data.offsetX,this.data.offsetY)),b.tx+=(p.x-b.tx)*n,b.ty+=(p.y-b.ty)*n,w=!0}if(e>0){let p=Math.sqrt(b.a*b.a+b.b*b.b),S=Math.sqrt(l*l+a*a);p>1e-5&&(p=(p+(S-p+this.data.offsetScaleX)*e)/p),b.a*=p,b.b*=p,p=Math.sqrt(b.c*b.c+b.d*b.d),S=Math.sqrt(s*s+o*o),p>1e-5&&(p=(p+(S-p+this.data.offsetScaleY)*e)/p),b.c*=p,b.d*=p,w=!0}if(i>0){const p=b.c,S=b.d,y=Math.atan2(S,p);let M=Math.atan2(o,s)-Math.atan2(a,l)-(y-Math.atan2(b.b,b.a));M>C.PI?M-=C.PI2:M<-C.PI&&(M+=C.PI2),M=y+(M+u)*i;const T=Math.sqrt(p*p+S*S);b.c=Math.cos(M)*T,b.d=Math.sin(M)*T,w=!0}w&&(E.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,n=this.translateMix,e=this.scaleMix,i=this.shearMix,r=this.target,h=r.matrix,l=h.a,s=h.c,a=h.b,o=h.d,d=l*o-s*a>0?C.degRad:-C.degRad,f=this.data.offsetRotation*d,u=this.data.offsetShearY*d,m=this.bones;for(let g=0,x=m.length;g<x;g++){const E=m[g];let w=!1;const b=E.matrix;if(t!=0){const p=b.a,S=b.c,y=b.b,M=b.d;let T=Math.atan2(a,l)+f;T>C.PI?T-=C.PI2:T<-C.PI&&(T+=C.PI2),T*=t;const k=Math.cos(T),I=Math.sin(T);b.a=k*p-I*y,b.c=k*S-I*M,b.b=I*p+k*y,b.d=I*S+k*M,w=!0}if(n!=0){const p=this.temp;r.localToWorld(p.set(this.data.offsetX,this.data.offsetY)),b.tx+=p.x*n,b.ty+=p.y*n,w=!0}if(e>0){let p=(Math.sqrt(l*l+a*a)-1+this.data.offsetScaleX)*e+1;b.a*=p,b.b*=p,p=(Math.sqrt(s*s+o*o)-1+this.data.offsetScaleY)*e+1,b.c*=p,b.d*=p,w=!0}if(i>0){let p=Math.atan2(o,s)-Math.atan2(a,l);p>C.PI?p-=C.PI2:p<-C.PI&&(p+=C.PI2);const S=b.c,y=b.d;p=Math.atan2(y,S)+(p-C.PI/2+u)*i;const M=Math.sqrt(S*S+y*y);b.c=Math.cos(p)*M,b.d=Math.sin(p)*M,w=!0}w&&(E.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,n=this.translateMix,e=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();const h=this.bones;for(let l=0,s=h.length;l<s;l++){const a=h[l];a.appliedValid||a.updateAppliedTransform();let o=a.arotation;if(t!=0){let x=r.arotation-o+this.data.offsetRotation;x-=(16384-(16384.499999999996-x/360|0))*360,o+=x*t}let d=a.ax,f=a.ay;n!=0&&(d+=(r.ax-d+this.data.offsetX)*n,f+=(r.ay-f+this.data.offsetY)*n);let u=a.ascaleX,m=a.ascaleY;e>0&&(u>1e-5&&(u=(u+(r.ascaleX-u+this.data.offsetScaleX)*e)/u),m>1e-5&&(m=(m+(r.ascaleY-m+this.data.offsetScaleY)*e)/m));const g=a.ashearY;if(i>0){let x=r.ashearY-g+this.data.offsetShearY;x-=(16384-(16384.499999999996-x/360|0))*360,a.shearY+=x*i}a.updateWorldTransformWith(d,f,o,u,m,a.ashearX,g)}}applyRelativeLocal(){const t=this.rotateMix,n=this.translateMix,e=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();const h=this.bones;for(let l=0,s=h.length;l<s;l++){const a=h[l];a.appliedValid||a.updateAppliedTransform();let o=a.arotation;t!=0&&(o+=(r.arotation+this.data.offsetRotation)*t);let d=a.ax,f=a.ay;n!=0&&(d+=(r.ax+this.data.offsetX)*n,f+=(r.ay+this.data.offsetY)*n);let u=a.ascaleX,m=a.ascaleY;e>0&&(u>1e-5&&(u*=(r.ascaleX-1+this.data.offsetScaleX)*e+1),m>1e-5&&(m*=(r.ascaleY-1+this.data.offsetScaleY)*e+1));let g=a.ashearY;i>0&&(g+=(r.ashearY+this.data.offsetShearY)*i),a.updateWorldTransformWith(d,f,o,u,m,a.ashearX,g)}}};const Tn=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,t==null)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let n=0;n<t.bones.length;n++){const e=t.bones[n];let i;if(e.parent==null)i=new xs(e,this,null);else{const r=this.bones[e.parent.index];i=new xs(e,this,r),r.children.push(i)}this.bones.push(i)}this.slots=new Array,this.drawOrder=new Array;for(let n=0;n<t.slots.length;n++){const e=t.slots[n],i=this.bones[e.boneData.index],r=new cs(e,i);this.slots.push(r),this.drawOrder.push(r)}this.ikConstraints=new Array;for(let n=0;n<t.ikConstraints.length;n++){const e=t.ikConstraints[n];this.ikConstraints.push(new Fi(e,this))}this.transformConstraints=new Array;for(let n=0;n<t.transformConstraints.length;n++){const e=t.transformConstraints[n];this.transformConstraints.push(new Yi(e,this))}this.pathConstraints=new Array;for(let n=0;n<t.pathConstraints.length;n++){const e=t.pathConstraints[n];this.pathConstraints.push(new pn(e,this))}this.color=new _(1,1,1,1),this.updateCache()}updateCache(){const t=this._updateCache;t.length=0,this.updateCacheReset.length=0;const n=this.bones;for(let o=0,d=n.length;o<d;o++){const f=n[o];f.sorted=f.data.skinRequired,f.active=!f.sorted}if(this.skin!=null){const o=this.skin.bones;for(let d=0,f=this.skin.bones.length;d<f;d++){let u=this.bones[o[d].index];do u.sorted=!1,u.active=!0,u=u.parent;while(u!=null)}}const e=this.ikConstraints,i=this.transformConstraints,r=this.pathConstraints,h=e.length,l=i.length,s=r.length,a=h+l+s;t:for(let o=0;o<a;o++){for(let d=0;d<h;d++){const f=e[d];if(f.data.order==o){this.sortIkConstraint(f);continue t}}for(let d=0;d<l;d++){const f=i[d];if(f.data.order==o){this.sortTransformConstraint(f);continue t}}for(let d=0;d<s;d++){const f=r[d];if(f.data.order==o){this.sortPathConstraint(f);continue t}}}for(let o=0,d=n.length;o<d;o++)this.sortBone(n[o])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin!=null&&v.contains(this.skin.constraints,t.data,!0)),!t.active)return;const n=t.target;this.sortBone(n);const e=t.bones,i=e[0];if(this.sortBone(i),e.length>1){const r=e[e.length-1];this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}this._updateCache.push(t),this.sortReset(i.children),e[e.length-1].sorted=!0}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin!=null&&v.contains(this.skin.constraints,t.data,!0)),!t.active)return;const n=t.target,e=n.data.index,i=n.bone;this.skin!=null&&this.sortPathConstraintAttachment(this.skin,e,i),this.data.defaultSkin!=null&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,e,i);for(let s=0,a=this.data.skins.length;s<a;s++)this.sortPathConstraintAttachment(this.data.skins[s],e,i);const r=n.getAttachment();r instanceof gn&&this.sortPathConstraintAttachmentWith(r,i);const h=t.bones,l=h.length;for(let s=0;s<l;s++)this.sortBone(h[s]);this._updateCache.push(t);for(let s=0;s<l;s++)this.sortReset(h[s].children);for(let s=0;s<l;s++)h[s].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin!=null&&v.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const n=t.bones,e=n.length;if(t.data.local)for(let i=0;i<e;i++){const r=n[i];this.sortBone(r.parent),this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}else for(let i=0;i<e;i++)this.sortBone(n[i]);this._updateCache.push(t);for(let i=0;i<e;i++)this.sortReset(n[i].children);for(let i=0;i<e;i++)n[i].sorted=!0}sortPathConstraintAttachment(t,n,e){const i=t.attachments[n];if(i)for(const r in i)this.sortPathConstraintAttachmentWith(i[r],e)}sortPathConstraintAttachmentWith(t,n){if(!(t instanceof gn))return;const e=t.bones;if(e==null)this.sortBone(n);else{const i=this.bones;let r=0;for(;r<e.length;){const h=e[r++];for(let l=r+h;r<l;r++){const s=e[r];this.sortBone(i[s])}}}}sortBone(t){if(t.sorted)return;const n=t.parent;n!=null&&this.sortBone(n),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let n=0,e=t.length;n<e;n++){const i=t[n];i.active&&(i.sorted&&this.sortReset(i.children),i.sorted=!1)}}updateWorldTransform(){const t=this.updateCacheReset;for(let e=0,i=t.length;e<i;e++){const r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}const n=this._updateCache;for(let e=0,i=n.length;e<i;e++)n[e].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let r=0,h=t.length;r<h;r++)t[r].setToSetupPose();const n=this.ikConstraints;for(let r=0,h=n.length;r<h;r++){const l=n[r];l.mix=l.data.mix,l.softness=l.data.softness,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch}const e=this.transformConstraints;for(let r=0,h=e.length;r<h;r++){const l=e[r],s=l.data;l.rotateMix=s.rotateMix,l.translateMix=s.translateMix,l.scaleMix=s.scaleMix,l.shearMix=s.shearMix}const i=this.pathConstraints;for(let r=0,h=i.length;r<h;r++){const l=i[r],s=l.data;l.position=s.position,l.spacing=s.spacing,l.rotateMix=s.rotateMix,l.translateMix=s.translateMix}}setSlotsToSetupPose(){const t=this.slots;v.arrayCopy(t,0,this.drawOrder,0,t.length);for(let n=0,e=t.length;n<e;n++)t[n].setToSetupPose()}getRootBone(){return this.bones.length==0?null:this.bones[0]}findBone(t){if(t==null)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}findBoneIndex(t){if(t==null)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++)if(n[e].data.name==t)return e;return-1}findSlot(t){if(t==null)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}findSlotIndex(t){if(t==null)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++)if(n[e].data.name==t)return e;return-1}setSkinByName(t){const n=this.data.findSkin(t);if(n==null)throw new Error(`Skin not found: ${t}`);this.setSkin(n)}setSkin(t){if(t!=this.skin){if(t!=null)if(this.skin!=null)t.attachAll(this,this.skin);else{const n=this.slots;for(let e=0,i=n.length;e<i;e++){const r=n[e],h=r.data.attachmentName;if(h!=null){const l=t.getAttachment(e,h);l!=null&&r.setAttachment(l)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,n){return this.getAttachment(this.data.findSlotIndex(t),n)}getAttachment(t,n){if(n==null)throw new Error("attachmentName cannot be null.");if(this.skin!=null){const e=this.skin.getAttachment(t,n);if(e!=null)return e}return this.data.defaultSkin!=null?this.data.defaultSkin.getAttachment(t,n):null}setAttachment(t,n){if(t==null)throw new Error("slotName cannot be null.");const e=this.slots;for(let i=0,r=e.length;i<r;i++){const h=e[i];if(h.data.name==t){let l=null;if(n!=null&&(l=this.getAttachment(i,n),l==null))throw new Error(`Attachment not found: ${n}, for slot: ${t}`);h.setAttachment(l);return}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.ikConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.transformConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}findPathConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.pathConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}getBounds(t,n,e=new Array(2)){if(t==null)throw new Error("offset cannot be null.");if(n==null)throw new Error("size cannot be null.");const i=this.drawOrder;let r=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let a=0,o=i.length;a<o;a++){const d=i[a];if(!d.bone.active)continue;let f=0,u=null;const m=d.getAttachment();if(m instanceof Q)f=8,u=v.setArraySize(e,f,0),m.computeWorldVertices(d.bone,u,0,2);else if(m instanceof mn){const g=m;f=g.worldVerticesLength,u=v.setArraySize(e,f,0),g.computeWorldVertices(d,0,f,u,0,2)}if(u!=null)for(let g=0,x=u.length;g<x;g+=2){const E=u[g],w=u[g+1];r=Math.min(r,E),h=Math.min(h,w),l=Math.max(l,E),s=Math.max(s,w)}}t.set(r,h),n.set(l-r,s-h)}update(t){this.time+=t}get flipX(){return this.scaleX==-1}set flipX(t){Tn.deprecatedWarning1||(Tn.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return this.scaleY==-1}set flipY(t){Tn.deprecatedWarning1||(Tn.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let ys=Tn;ys.deprecatedWarning1=!1;let Ms=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(t==null)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findBoneIndex(t){if(t==null)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}findSlot(t){if(t==null)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findSlotIndex(t){if(t==null)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}findSkin(t){if(t==null)throw new Error("skinName cannot be null.");const n=this.skins;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findEvent(t){if(t==null)throw new Error("eventDataName cannot be null.");const n=this.events;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findAnimation(t){if(t==null)throw new Error("animationName cannot be null.");const n=this.animations;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findIkConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.ikConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findTransformConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.transformConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findPathConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.pathConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(t==null)throw new Error("pathConstraintName cannot be null.");const n=this.pathConstraints;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}},As=class{constructor(t,n,e){if(this.color=new _(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(n==null)throw new Error("name cannot be null.");if(e==null)throw new Error("boneData cannot be null.");this.index=t,this.name=n,this.boneData=e}},Cs=class extends Nn{constructor(t){super(t,0,!1),this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}},Ts=class{constructor(t,n,e){this.slotIndex=t,this.name=n,this.attachment=e}},Bn=class{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,t==null)throw new Error("name cannot be null.");this.name=t}setAttachment(t,n,e){if(e==null)throw new Error("attachment cannot be null.");const i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][n]=e}addSkin(t){for(let e=0;e<t.bones.length;e++){const i=t.bones[e];let r=!1;for(let h=0;h<this.bones.length;h++)if(this.bones[h]==i){r=!0;break}r||this.bones.push(i)}for(let e=0;e<t.constraints.length;e++){const i=t.constraints[e];let r=!1;for(let h=0;h<this.constraints.length;h++)if(this.constraints[h]==i){r=!0;break}r||this.constraints.push(i)}const n=t.getAttachments();for(let e=0;e<n.length;e++){const i=n[e];this.setAttachment(i.slotIndex,i.name,i.attachment)}}copySkin(t){for(let e=0;e<t.bones.length;e++){const i=t.bones[e];let r=!1;for(let h=0;h<this.bones.length;h++)if(this.bones[h]==i){r=!0;break}r||this.bones.push(i)}for(let e=0;e<t.constraints.length;e++){const i=t.constraints[e];let r=!1;for(let h=0;h<this.constraints.length;h++)if(this.constraints[h]==i){r=!0;break}r||this.constraints.push(i)}const n=t.getAttachments();for(let e=0;e<n.length;e++){const i=n[e];i.attachment!=null&&(i.attachment instanceof mn?(i.attachment=i.attachment.newLinkedMesh(),this.setAttachment(i.slotIndex,i.name,i.attachment)):(i.attachment=i.attachment.copy(),this.setAttachment(i.slotIndex,i.name,i.attachment)))}}getAttachment(t,n){const e=this.attachments[t];return e?e[n]:null}removeAttachment(t,n){const e=this.attachments[t];e&&(e[n]=null)}getAttachments(){const t=new Array;for(let n=0;n<this.attachments.length;n++){const e=this.attachments[n];if(e)for(const i in e){const r=e[i];r&&t.push(new Ts(n,i,r))}}return t}getAttachmentsForSlot(t,n){const e=this.attachments[t];if(e)for(const i in e){const r=e[i];r&&n.push(new Ts(t,i,r))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,n){let e=0;for(let i=0;i<t.slots.length;i++){const r=t.slots[i],h=r.getAttachment();if(h&&e<n.attachments.length){const l=n.attachments[e];for(const s in l){const a=l[s];if(h==a){const o=this.getAttachment(e,s);o!=null&&r.setAttachment(o);break}}}e++}}};const wt=class{constructor(c){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=c}readSkeletonData(c){const t=this.scale,n=new Ms;n.name="";const e=new Mn(c);n.hash=e.readString(),n.version=e.readString(),n.version==="3.8.75"&&console.error("Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine."),n.x=e.readFloat(),n.y=e.readFloat(),n.width=e.readFloat(),n.height=e.readFloat();const i=e.readBoolean();i&&(n.fps=e.readFloat(),n.imagesPath=e.readString(),n.audioPath=e.readString());let r=0;r=e.readInt(!0);for(let l=0;l<r;l++)e.strings.push(e.readString());r=e.readInt(!0);for(let l=0;l<r;l++){const s=e.readString(),a=l==0?null:n.bones[e.readInt(!0)],o=new ps(l,s,a);o.rotation=e.readFloat(),o.x=e.readFloat()*t,o.y=e.readFloat()*t,o.scaleX=e.readFloat(),o.scaleY=e.readFloat(),o.shearX=e.readFloat(),o.shearY=e.readFloat(),o.length=e.readFloat()*t,o.transformMode=wt.TransformModeValues[e.readInt(!0)],o.skinRequired=e.readBoolean(),i&&_.rgba8888ToColor(o.color,e.readInt32()),n.bones.push(o)}r=e.readInt(!0);for(let l=0;l<r;l++){const s=e.readString(),a=n.bones[e.readInt(!0)],o=new As(l,s,a);_.rgba8888ToColor(o.color,e.readInt32());const d=e.readInt32();d!=-1&&_.rgb888ToColor(o.darkColor=new _,d),o.attachmentName=e.readStringRef(),o.blendMode=wt.BlendModeValues[e.readInt(!0)],n.slots.push(o)}r=e.readInt(!0);for(let l=0,s;l<r;l++){const a=new Es(e.readString());a.order=e.readInt(!0),a.skinRequired=e.readBoolean(),s=e.readInt(!0);for(let o=0;o<s;o++)a.bones.push(n.bones[e.readInt(!0)]);a.target=n.bones[e.readInt(!0)],a.mix=e.readFloat(),a.softness=e.readFloat()*t,a.bendDirection=e.readByte(),a.compress=e.readBoolean(),a.stretch=e.readBoolean(),a.uniform=e.readBoolean(),n.ikConstraints.push(a)}r=e.readInt(!0);for(let l=0,s;l<r;l++){const a=new Cs(e.readString());a.order=e.readInt(!0),a.skinRequired=e.readBoolean(),s=e.readInt(!0);for(let o=0;o<s;o++)a.bones.push(n.bones[e.readInt(!0)]);a.target=n.bones[e.readInt(!0)],a.local=e.readBoolean(),a.relative=e.readBoolean(),a.offsetRotation=e.readFloat(),a.offsetX=e.readFloat()*t,a.offsetY=e.readFloat()*t,a.offsetScaleX=e.readFloat(),a.offsetScaleY=e.readFloat(),a.offsetShearY=e.readFloat(),a.rotateMix=e.readFloat(),a.translateMix=e.readFloat(),a.scaleMix=e.readFloat(),a.shearMix=e.readFloat(),n.transformConstraints.push(a)}r=e.readInt(!0);for(let l=0,s;l<r;l++){const a=new Ss(e.readString());a.order=e.readInt(!0),a.skinRequired=e.readBoolean(),s=e.readInt(!0);for(let o=0;o<s;o++)a.bones.push(n.bones[e.readInt(!0)]);a.target=n.slots[e.readInt(!0)],a.positionMode=wt.PositionModeValues[e.readInt(!0)],a.spacingMode=wt.SpacingModeValues[e.readInt(!0)],a.rotateMode=wt.RotateModeValues[e.readInt(!0)],a.offsetRotation=e.readFloat(),a.position=e.readFloat(),a.positionMode==dt.Fixed&&(a.position*=t),a.spacing=e.readFloat(),(a.spacingMode==vt.Length||a.spacingMode==vt.Fixed)&&(a.spacing*=t),a.rotateMix=e.readFloat(),a.translateMix=e.readFloat(),n.pathConstraints.push(a)}const h=this.readSkin(e,n,!0,i);h!=null&&(n.defaultSkin=h,n.skins.push(h));{let l=n.skins.length;for(v.setArraySize(n.skins,r=l+e.readInt(!0));l<r;l++)n.skins[l]=this.readSkin(e,n,!1,i)}r=this.linkedMeshes.length;for(let l=0;l<r;l++){const s=this.linkedMeshes[l],a=s.skin==null?n.defaultSkin:n.findSkin(s.skin);if(a==null)throw new Error(`Skin not found: ${s.skin}`);const o=a.getAttachment(s.slotIndex,s.parent);if(o==null)throw new Error(`Parent mesh not found: ${s.parent}`);s.mesh.deformAttachment=s.inheritDeform?o:s.mesh,s.mesh.setParentMesh(o)}this.linkedMeshes.length=0,r=e.readInt(!0);for(let l=0;l<r;l++){const s=new bs(e.readStringRef());s.intValue=e.readInt(!1),s.floatValue=e.readFloat(),s.stringValue=e.readString(),s.audioPath=e.readString(),s.audioPath!=null&&(s.volume=e.readFloat(),s.balance=e.readFloat()),n.events.push(s)}r=e.readInt(!0);for(let l=0;l<r;l++)n.animations.push(this.readAnimation(e,e.readString(),n));return n}readSkin(c,t,n,e){let i=null,r=0;if(n){if(r=c.readInt(!0),r==0)return null;i=new Bn("default")}else{i=new Bn(c.readStringRef()),i.bones.length=c.readInt(!0);for(let h=0,l=i.bones.length;h<l;h++)i.bones[h]=t.bones[c.readInt(!0)];for(let h=0,l=c.readInt(!0);h<l;h++)i.constraints.push(t.ikConstraints[c.readInt(!0)]);for(let h=0,l=c.readInt(!0);h<l;h++)i.constraints.push(t.transformConstraints[c.readInt(!0)]);for(let h=0,l=c.readInt(!0);h<l;h++)i.constraints.push(t.pathConstraints[c.readInt(!0)]);r=c.readInt(!0)}for(let h=0;h<r;h++){const l=c.readInt(!0);for(let s=0,a=c.readInt(!0);s<a;s++){const o=c.readStringRef(),d=this.readAttachment(c,t,i,l,o,e);d!=null&&i.setAttachment(l,o,d)}}return i}readAttachment(c,t,n,e,i,r){const h=this.scale;let l=c.readStringRef();l==null&&(l=i);const s=c.readByte();switch(wt.AttachmentTypeValues[s]){case Z.Region:{let o=c.readStringRef();const d=c.readFloat(),f=c.readFloat(),u=c.readFloat(),m=c.readFloat(),g=c.readFloat(),x=c.readFloat(),E=c.readFloat(),w=c.readInt32();o==null&&(o=l);const b=this.attachmentLoader.newRegionAttachment(n,l,o);return b==null?null:(b.path=o,b.x=f*h,b.y=u*h,b.scaleX=m,b.scaleY=g,b.rotation=d,b.width=x*h,b.height=E*h,_.rgba8888ToColor(b.color,w),b)}case Z.BoundingBox:{const o=c.readInt(!0),d=this.readVertices(c,o),f=r?c.readInt32():0,u=this.attachmentLoader.newBoundingBoxAttachment(n,l);return u==null?null:(u.worldVerticesLength=o<<1,u.vertices=d.vertices,u.bones=d.bones,r&&_.rgba8888ToColor(u.color,f),u)}case Z.Mesh:{let o=c.readStringRef();const d=c.readInt32(),f=c.readInt(!0),u=this.readFloatArray(c,f<<1,1),m=this.readShortArray(c),g=this.readVertices(c,f),x=c.readInt(!0);let E=null,w=0,b=0;r&&(E=this.readShortArray(c),w=c.readFloat(),b=c.readFloat()),o==null&&(o=l);const p=this.attachmentLoader.newMeshAttachment(n,l,o);return p==null?null:(p.path=o,_.rgba8888ToColor(p.color,d),p.bones=g.bones,p.vertices=g.vertices,p.worldVerticesLength=f<<1,p.triangles=m,p.regionUVs=new Float32Array(u),p.hullLength=x<<1,r&&(p.edges=E,p.width=w*h,p.height=b*h),p)}case Z.LinkedMesh:{let o=c.readStringRef();const d=c.readInt32(),f=c.readStringRef(),u=c.readStringRef(),m=c.readBoolean();let g=0,x=0;r&&(g=c.readFloat(),x=c.readFloat()),o==null&&(o=l);const E=this.attachmentLoader.newMeshAttachment(n,l,o);return E==null?null:(E.path=o,_.rgba8888ToColor(E.color,d),r&&(E.width=g*h,E.height=x*h),this.linkedMeshes.push(new Vr(E,f,e,u,m)),E)}case Z.Path:{const o=c.readBoolean(),d=c.readBoolean(),f=c.readInt(!0),u=this.readVertices(c,f),m=v.newArray(f/3,0);for(let E=0,w=m.length;E<w;E++)m[E]=c.readFloat()*h;const g=r?c.readInt32():0,x=this.attachmentLoader.newPathAttachment(n,l);return x==null?null:(x.closed=o,x.constantSpeed=d,x.worldVerticesLength=f<<1,x.vertices=u.vertices,x.bones=u.bones,x.lengths=m,r&&_.rgba8888ToColor(x.color,g),x)}case Z.Point:{const o=c.readFloat(),d=c.readFloat(),f=c.readFloat(),u=r?c.readInt32():0,m=this.attachmentLoader.newPointAttachment(n,l);return m==null?null:(m.x=d*h,m.y=f*h,m.rotation=o,r&&_.rgba8888ToColor(m.color,u),m)}case Z.Clipping:{const o=c.readInt(!0),d=c.readInt(!0),f=this.readVertices(c,d),u=r?c.readInt32():0,m=this.attachmentLoader.newClippingAttachment(n,l);return m==null?null:(m.endSlot=t.slots[o],m.worldVerticesLength=d<<1,m.vertices=f.vertices,m.bones=f.bones,r&&_.rgba8888ToColor(m.color,u),m)}}return null}readVertices(c,t){const n=t<<1,e=new Fr,i=this.scale;if(!c.readBoolean())return e.vertices=this.readFloatArray(c,n,i),e;const r=new Array,h=new Array;for(let l=0;l<t;l++){const s=c.readInt(!0);h.push(s);for(let a=0;a<s;a++)h.push(c.readInt(!0)),r.push(c.readFloat()*i),r.push(c.readFloat()*i),r.push(c.readFloat())}return e.vertices=v.toFloatArray(r),e.bones=h,e}readFloatArray(c,t,n){const e=new Array(t);if(n==1)for(let i=0;i<t;i++)e[i]=c.readFloat();else for(let i=0;i<t;i++)e[i]=c.readFloat()*n;return e}readShortArray(c){const t=c.readInt(!0),n=new Array(t);for(let e=0;e<t;e++)n[e]=c.readShort();return n}readAnimation(c,t,n){const e=new Array,i=this.scale;let r=0;const h=new _,l=new _;for(let o=0,d=c.readInt(!0);o<d;o++){const f=c.readInt(!0);for(let u=0,m=c.readInt(!0);u<m;u++){const g=c.readByte(),x=c.readInt(!0);switch(g){case wt.SLOT_ATTACHMENT:{const E=new en(x);E.slotIndex=f;for(let w=0;w<x;w++)E.setFrame(w,c.readFloat(),c.readStringRef());e.push(E),r=Math.max(r,E.frames[x-1]);break}case wt.SLOT_COLOR:{const E=new Lt(x);E.slotIndex=f;for(let w=0;w<x;w++){const b=c.readFloat();_.rgba8888ToColor(h,c.readInt32()),E.setFrame(w,b,h.r,h.g,h.b,h.a),w<x-1&&this.readCurve(c,w,E)}e.push(E),r=Math.max(r,E.frames[(x-1)*Lt.ENTRIES]);break}case wt.SLOT_TWO_COLOR:{const E=new yt(x);E.slotIndex=f;for(let w=0;w<x;w++){const b=c.readFloat();_.rgba8888ToColor(h,c.readInt32()),_.rgb888ToColor(l,c.readInt32()),E.setFrame(w,b,h.r,h.g,h.b,h.a,l.r,l.g,l.b),w<x-1&&this.readCurve(c,w,E)}e.push(E),r=Math.max(r,E.frames[(x-1)*yt.ENTRIES]);break}}}}for(let o=0,d=c.readInt(!0);o<d;o++){const f=c.readInt(!0);for(let u=0,m=c.readInt(!0);u<m;u++){const g=c.readByte(),x=c.readInt(!0);switch(g){case wt.BONE_ROTATE:{const E=new Vt(x);E.boneIndex=f;for(let w=0;w<x;w++)E.setFrame(w,c.readFloat(),c.readFloat()),w<x-1&&this.readCurve(c,w,E);e.push(E),r=Math.max(r,E.frames[(x-1)*Vt.ENTRIES]);break}case wt.BONE_TRANSLATE:case wt.BONE_SCALE:case wt.BONE_SHEAR:{let E,w=1;g==wt.BONE_SCALE?E=new te(x):g==wt.BONE_SHEAR?E=new ee(x):(E=new Jt(x),w=i),E.boneIndex=f;for(let b=0;b<x;b++)E.setFrame(b,c.readFloat(),c.readFloat()*w,c.readFloat()*w),b<x-1&&this.readCurve(c,b,E);e.push(E),r=Math.max(r,E.frames[(x-1)*Jt.ENTRIES]);break}}}}for(let o=0,d=c.readInt(!0);o<d;o++){const f=c.readInt(!0),u=c.readInt(!0),m=new Ft(u);m.ikConstraintIndex=f;for(let g=0;g<u;g++)m.setFrame(g,c.readFloat(),c.readFloat(),c.readFloat()*i,c.readByte(),c.readBoolean(),c.readBoolean()),g<u-1&&this.readCurve(c,g,m);e.push(m),r=Math.max(r,m.frames[(u-1)*Ft.ENTRIES])}for(let o=0,d=c.readInt(!0);o<d;o++){const f=c.readInt(!0),u=c.readInt(!0),m=new _t(u);m.transformConstraintIndex=f;for(let g=0;g<u;g++)m.setFrame(g,c.readFloat(),c.readFloat(),c.readFloat(),c.readFloat(),c.readFloat()),g<u-1&&this.readCurve(c,g,m);e.push(m),r=Math.max(r,m.frames[(u-1)*_t.ENTRIES])}for(let o=0,d=c.readInt(!0);o<d;o++){const f=c.readInt(!0),u=n.pathConstraints[f];for(let m=0,g=c.readInt(!0);m<g;m++){const x=c.readByte(),E=c.readInt(!0);switch(x){case wt.PATH_POSITION:case wt.PATH_SPACING:{let w,b=1;x==wt.PATH_SPACING?(w=new ke(E),(u.spacingMode==vt.Length||u.spacingMode==vt.Fixed)&&(b=i)):(w=new Te(E),u.positionMode==dt.Fixed&&(b=i)),w.pathConstraintIndex=f;for(let p=0;p<E;p++)w.setFrame(p,c.readFloat(),c.readFloat()*b),p<E-1&&this.readCurve(c,p,w);e.push(w),r=Math.max(r,w.frames[(E-1)*Te.ENTRIES]);break}case wt.PATH_MIX:{const w=new me(E);w.pathConstraintIndex=f;for(let b=0;b<E;b++)w.setFrame(b,c.readFloat(),c.readFloat(),c.readFloat()),b<E-1&&this.readCurve(c,b,w);e.push(w),r=Math.max(r,w.frames[(E-1)*me.ENTRIES]);break}}}}for(let o=0,d=c.readInt(!0);o<d;o++){const f=n.skins[c.readInt(!0)];for(let u=0,m=c.readInt(!0);u<m;u++){const g=c.readInt(!0);for(let x=0,E=c.readInt(!0);x<E;x++){const w=f.getAttachment(g,c.readStringRef()),b=w.bones!=null,p=w.vertices,S=b?p.length/3*2:p.length,y=c.readInt(!0),M=new hs(y);M.slotIndex=g,M.attachment=w;for(let T=0;T<y;T++){const k=c.readFloat();let I,R=c.readInt(!0);if(R==0)I=b?v.newFloatArray(S):p;else{I=v.newFloatArray(S);const V=c.readInt(!0);if(R+=V,i==1)for(let F=V;F<R;F++)I[F]=c.readFloat();else for(let F=V;F<R;F++)I[F]=c.readFloat()*i;if(!b)for(let F=0,B=I.length;F<B;F++)I[F]+=p[F]}M.setFrame(T,k,I),T<y-1&&this.readCurve(c,T,M)}e.push(M),r=Math.max(r,M.frames[y-1])}}}const s=c.readInt(!0);if(s>0){const o=new xn(s),d=n.slots.length;for(let f=0;f<s;f++){const u=c.readFloat(),m=c.readInt(!0),g=v.newArray(d,0);for(let b=d-1;b>=0;b--)g[b]=-1;const x=v.newArray(d-m,0);let E=0,w=0;for(let b=0;b<m;b++){const p=c.readInt(!0);for(;E!=p;)x[w++]=E++;g[E+c.readInt(!0)]=E++}for(;E<d;)x[w++]=E++;for(let b=d-1;b>=0;b--)g[b]==-1&&(g[b]=x[--w]);o.setFrame(f,u,g)}e.push(o),r=Math.max(r,o.frames[s-1])}const a=c.readInt(!0);if(a>0){const o=new Yn(a);for(let d=0;d<a;d++){const f=c.readFloat(),u=n.events[c.readInt(!0)],m=new ws(f,u);m.intValue=c.readInt(!1),m.floatValue=c.readFloat(),m.stringValue=c.readBoolean()?c.readString():u.stringValue,m.data.audioPath!=null&&(m.volume=c.readFloat(),m.balance=c.readFloat()),o.setFrame(d,m)}e.push(o),r=Math.max(r,o.frames[a-1])}return new Et(t,e,r)}readCurve(c,t,n){switch(c.readByte()){case wt.CURVE_STEPPED:n.setStepped(t);break;case wt.CURVE_BEZIER:this.setCurve(n,t,c.readFloat(),c.readFloat(),c.readFloat(),c.readFloat());break}}setCurve(c,t,n,e,i,r){c.setCurve(t,n,e,i,r)}};let Mt=wt;Mt.AttachmentTypeValues=[0,1,2,3,4,5,6],Mt.TransformModeValues=[j.Normal,j.OnlyTranslation,j.NoRotationOrReflection,j.NoScale,j.NoScaleOrReflection],Mt.PositionModeValues=[dt.Fixed,dt.Percent],Mt.SpacingModeValues=[vt.Length,vt.Fixed,vt.Percent],Mt.RotateModeValues=[pt.Tangent,pt.Chain,pt.ChainScale],Mt.BlendModeValues=[H.BLEND_MODES.NORMAL,H.BLEND_MODES.ADD,H.BLEND_MODES.MULTIPLY,H.BLEND_MODES.SCREEN],Mt.BONE_ROTATE=0,Mt.BONE_TRANSLATE=1,Mt.BONE_SCALE=2,Mt.BONE_SHEAR=3,Mt.SLOT_ATTACHMENT=0,Mt.SLOT_COLOR=1,Mt.SLOT_TWO_COLOR=2,Mt.PATH_POSITION=0,Mt.PATH_SPACING=1,Mt.PATH_MIX=2,Mt.CURVE_LINEAR=0,Mt.CURVE_STEPPED=1,Mt.CURVE_BEZIER=2;let Vr=class{constructor(t,n,e,i,r){this.mesh=t,this.skin=n,this.slotIndex=e,this.parent=i,this.inheritDeform=r}},Fr=class{constructor(t=null,n=null){this.bones=t,this.vertices=n}},Yr=class extends Cn{},sn=class{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const n=this.scale,e=new Ms,i=typeof t=="string"?JSON.parse(t):t,r=i.skeleton;if(r!=null){if(e.hash=r.hash,e.version=r.spine,e.version.substr(0,3)!=="3.8"){const h=`Spine 3.8 loader cant load version ${r.spine}. Please configure your pixi-spine bundle`;console.error(h)}e.version==="3.8.75"&&console.error("Unsupported skeleton data, 3.8.75 is deprecated, please export with a newer version of Spine."),e.x=r.x,e.y=r.y,e.width=r.width,e.height=r.height,e.fps=r.fps,e.imagesPath=r.images}if(i.bones)for(let h=0;h<i.bones.length;h++){const l=i.bones[h];let s=null;const a=this.getValue(l,"parent",null);if(a!=null&&(s=e.findBone(a),s==null))throw new Error(`Parent bone not found: ${a}`);const o=new ps(e.bones.length,l.name,s);o.length=this.getValue(l,"length",0)*n,o.x=this.getValue(l,"x",0)*n,o.y=this.getValue(l,"y",0)*n,o.rotation=this.getValue(l,"rotation",0),o.scaleX=this.getValue(l,"scaleX",1),o.scaleY=this.getValue(l,"scaleY",1),o.shearX=this.getValue(l,"shearX",0),o.shearY=this.getValue(l,"shearY",0),o.transformMode=sn.transformModeFromString(this.getValue(l,"transform","normal")),o.skinRequired=this.getValue(l,"skin",!1),e.bones.push(o)}if(i.slots)for(let h=0;h<i.slots.length;h++){const l=i.slots[h],s=l.name,a=l.bone,o=e.findBone(a);if(o==null)throw new Error(`Slot bone not found: ${a}`);const d=new As(e.slots.length,s,o),f=this.getValue(l,"color",null);f!=null&&d.color.setFromString(f);const u=this.getValue(l,"dark",null);u!=null&&(d.darkColor=new _(1,1,1,1),d.darkColor.setFromString(u)),d.attachmentName=this.getValue(l,"attachment",null),d.blendMode=sn.blendModeFromString(this.getValue(l,"blend","normal")),e.slots.push(d)}if(i.ik)for(let h=0;h<i.ik.length;h++){const l=i.ik[h],s=new Es(l.name);s.order=this.getValue(l,"order",0),s.skinRequired=this.getValue(l,"skin",!1);for(let o=0;o<l.bones.length;o++){const d=l.bones[o],f=e.findBone(d);if(f==null)throw new Error(`IK bone not found: ${d}`);s.bones.push(f)}const a=l.target;if(s.target=e.findBone(a),s.target==null)throw new Error(`IK target bone not found: ${a}`);s.mix=this.getValue(l,"mix",1),s.softness=this.getValue(l,"softness",0)*n,s.bendDirection=this.getValue(l,"bendPositive",!0)?1:-1,s.compress=this.getValue(l,"compress",!1),s.stretch=this.getValue(l,"stretch",!1),s.uniform=this.getValue(l,"uniform",!1),e.ikConstraints.push(s)}if(i.transform)for(let h=0;h<i.transform.length;h++){const l=i.transform[h],s=new Cs(l.name);s.order=this.getValue(l,"order",0),s.skinRequired=this.getValue(l,"skin",!1);for(let o=0;o<l.bones.length;o++){const d=l.bones[o],f=e.findBone(d);if(f==null)throw new Error(`Transform constraint bone not found: ${d}`);s.bones.push(f)}const a=l.target;if(s.target=e.findBone(a),s.target==null)throw new Error(`Transform constraint target bone not found: ${a}`);s.local=this.getValue(l,"local",!1),s.relative=this.getValue(l,"relative",!1),s.offsetRotation=this.getValue(l,"rotation",0),s.offsetX=this.getValue(l,"x",0)*n,s.offsetY=this.getValue(l,"y",0)*n,s.offsetScaleX=this.getValue(l,"scaleX",0),s.offsetScaleY=this.getValue(l,"scaleY",0),s.offsetShearY=this.getValue(l,"shearY",0),s.rotateMix=this.getValue(l,"rotateMix",1),s.translateMix=this.getValue(l,"translateMix",1),s.scaleMix=this.getValue(l,"scaleMix",1),s.shearMix=this.getValue(l,"shearMix",1),e.transformConstraints.push(s)}if(i.path)for(let h=0;h<i.path.length;h++){const l=i.path[h],s=new Ss(l.name);s.order=this.getValue(l,"order",0),s.skinRequired=this.getValue(l,"skin",!1);for(let o=0;o<l.bones.length;o++){const d=l.bones[o],f=e.findBone(d);if(f==null)throw new Error(`Transform constraint bone not found: ${d}`);s.bones.push(f)}const a=l.target;if(s.target=e.findSlot(a),s.target==null)throw new Error(`Path target slot not found: ${a}`);s.positionMode=sn.positionModeFromString(this.getValue(l,"positionMode","percent")),s.spacingMode=sn.spacingModeFromString(this.getValue(l,"spacingMode","length")),s.rotateMode=sn.rotateModeFromString(this.getValue(l,"rotateMode","tangent")),s.offsetRotation=this.getValue(l,"rotation",0),s.position=this.getValue(l,"position",0),s.positionMode==dt.Fixed&&(s.position*=n),s.spacing=this.getValue(l,"spacing",0),(s.spacingMode==vt.Length||s.spacingMode==vt.Fixed)&&(s.spacing*=n),s.rotateMix=this.getValue(l,"rotateMix",1),s.translateMix=this.getValue(l,"translateMix",1),e.pathConstraints.push(s)}if(i.skins)for(let h=0;h<i.skins.length;h++){const l=i.skins[h],s=new Bn(l.name);if(l.bones)for(let a=0;a<l.bones.length;a++){const o=e.findBone(l.bones[a]);if(o==null)throw new Error(`Skin bone not found: ${l.bones[h]}`);s.bones.push(o)}if(l.ik)for(let a=0;a<l.ik.length;a++){const o=e.findIkConstraint(l.ik[a]);if(o==null)throw new Error(`Skin IK constraint not found: ${l.ik[h]}`);s.constraints.push(o)}if(l.transform)for(let a=0;a<l.transform.length;a++){const o=e.findTransformConstraint(l.transform[a]);if(o==null)throw new Error(`Skin transform constraint not found: ${l.transform[h]}`);s.constraints.push(o)}if(l.path)for(let a=0;a<l.path.length;a++){const o=e.findPathConstraint(l.path[a]);if(o==null)throw new Error(`Skin path constraint not found: ${l.path[h]}`);s.constraints.push(o)}for(const a in l.attachments){const o=e.findSlot(a);if(o==null)throw new Error(`Slot not found: ${a}`);const d=l.attachments[a];for(const f in d){const u=this.readAttachment(d[f],s,o.index,f,e);u!=null&&s.setAttachment(o.index,f,u)}}e.skins.push(s),s.name=="default"&&(e.defaultSkin=s)}for(let h=0,l=this.linkedMeshes.length;h<l;h++){const s=this.linkedMeshes[h],a=s.skin==null?e.defaultSkin:e.findSkin(s.skin);if(a==null)throw new Error(`Skin not found: ${s.skin}`);const o=a.getAttachment(s.slotIndex,s.parent);if(o==null)throw new Error(`Parent mesh not found: ${s.parent}`);s.mesh.deformAttachment=s.inheritDeform?o:s.mesh,s.mesh.setParentMesh(o)}if(this.linkedMeshes.length=0,i.events)for(const h in i.events){const l=i.events[h],s=new bs(h);s.intValue=this.getValue(l,"int",0),s.floatValue=this.getValue(l,"float",0),s.stringValue=this.getValue(l,"string",""),s.audioPath=this.getValue(l,"audio",null),s.audioPath!=null&&(s.volume=this.getValue(l,"volume",1),s.balance=this.getValue(l,"balance",0)),e.events.push(s)}if(i.animations)for(const h in i.animations){const l=i.animations[h];this.readAnimation(l,h,e)}return e}readAttachment(t,n,e,i,r){const h=this.scale;switch(i=this.getValue(t,"name",i),this.getValue(t,"type","region")){case"region":{const s=this.getValue(t,"path",i),a=this.attachmentLoader.newRegionAttachment(n,i,s);if(a==null)return null;a.path=s,a.x=this.getValue(t,"x",0)*h,a.y=this.getValue(t,"y",0)*h,a.scaleX=this.getValue(t,"scaleX",1),a.scaleY=this.getValue(t,"scaleY",1),a.rotation=this.getValue(t,"rotation",0),a.width=t.width*h,a.height=t.height*h;const o=this.getValue(t,"color",null);return o!=null&&a.color.setFromString(o),a}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(n,i);if(s==null)return null;this.readVertices(t,s,t.vertexCount<<1);const a=this.getValue(t,"color",null);return a!=null&&s.color.setFromString(a),s}case"mesh":case"linkedmesh":{const s=this.getValue(t,"path",i),a=this.attachmentLoader.newMeshAttachment(n,i,s);if(a==null)return null;a.path=s;const o=this.getValue(t,"color",null);o!=null&&a.color.setFromString(o),a.width=this.getValue(t,"width",0)*h,a.height=this.getValue(t,"height",0)*h;const d=this.getValue(t,"parent",null);if(d!=null)return this.linkedMeshes.push(new Xr(a,this.getValue(t,"skin",null),e,d,this.getValue(t,"deform",!0))),a;const f=t.uvs;return this.readVertices(t,a,f.length),a.triangles=t.triangles,a.regionUVs=new Float32Array(f),a.edges=this.getValue(t,"edges",null),a.hullLength=this.getValue(t,"hull",0)*2,a}case"path":{const s=this.attachmentLoader.newPathAttachment(n,i);if(s==null)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=v.newArray(a/3,0);for(let f=0;f<t.lengths.length;f++)o[f]=t.lengths[f]*h;s.lengths=o;const d=this.getValue(t,"color",null);return d!=null&&s.color.setFromString(d),s}case"point":{const s=this.attachmentLoader.newPointAttachment(n,i);if(s==null)return null;s.x=this.getValue(t,"x",0)*h,s.y=this.getValue(t,"y",0)*h,s.rotation=this.getValue(t,"rotation",0);const a=this.getValue(t,"color",null);return a!=null&&s.color.setFromString(a),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(n,i);if(s==null)return null;const a=this.getValue(t,"end",null);if(a!=null){const f=r.findSlot(a);if(f==null)throw new Error(`Clipping end slot not found: ${a}`);s.endSlot=f}const o=t.vertexCount;this.readVertices(t,s,o<<1);const d=this.getValue(t,"color",null);return d!=null&&s.color.setFromString(d),s}}return null}readVertices(t,n,e){const i=this.scale;n.worldVerticesLength=e;const r=t.vertices;if(e==r.length){const s=v.toFloatArray(r);if(i!=1)for(let a=0,o=r.length;a<o;a++)s[a]*=i;n.vertices=s;return}const h=new Array,l=new Array;for(let s=0,a=r.length;s<a;){const o=r[s++];l.push(o);for(let d=s+o*4;s<d;s+=4)l.push(r[s]),h.push(r[s+1]*i),h.push(r[s+2]*i),h.push(r[s+3])}n.bones=l,n.vertices=v.toFloatArray(h)}readAnimation(t,n,e){const i=this.scale,r=new Array;let h=0;if(t.slots)for(const s in t.slots){const a=t.slots[s],o=e.findSlotIndex(s);if(o==-1)throw new Error(`Slot not found: ${s}`);for(const d in a){const f=a[d];if(d=="attachment"){const u=new en(f.length);u.slotIndex=o;let m=0;for(let g=0;g<f.length;g++){const x=f[g];u.setFrame(m++,this.getValue(x,"time",0),x.name)}r.push(u),h=Math.max(h,u.frames[u.getFrameCount()-1])}else if(d=="color"){const u=new Lt(f.length);u.slotIndex=o;let m=0;for(let g=0;g<f.length;g++){const x=f[g],E=new _;E.setFromString(x.color||"ffffffff"),u.setFrame(m,this.getValue(x,"time",0),E.r,E.g,E.b,E.a),this.readCurve(x,u,m),m++}r.push(u),h=Math.max(h,u.frames[(u.getFrameCount()-1)*Lt.ENTRIES])}else if(d=="twoColor"){const u=new yt(f.length);u.slotIndex=o;let m=0;for(let g=0;g<f.length;g++){const x=f[g],E=new _,w=new _;E.setFromString(x.light),w.setFromString(x.dark),u.setFrame(m,this.getValue(x,"time",0),E.r,E.g,E.b,E.a,w.r,w.g,w.b),this.readCurve(x,u,m),m++}r.push(u),h=Math.max(h,u.frames[(u.getFrameCount()-1)*yt.ENTRIES])}else throw new Error(`Invalid timeline type for a slot: ${d} (${s})`)}}if(t.bones)for(const s in t.bones){const a=t.bones[s],o=e.findBoneIndex(s);if(o==-1)throw new Error(`Bone not found: ${s}`);for(const d in a){const f=a[d];if(d==="rotate"){const u=new Vt(f.length);u.boneIndex=o;let m=0;for(let g=0;g<f.length;g++){const x=f[g];u.setFrame(m,this.getValue(x,"time",0),this.getValue(x,"angle",0)),this.readCurve(x,u,m),m++}r.push(u),h=Math.max(h,u.frames[(u.getFrameCount()-1)*Vt.ENTRIES])}else if(d==="translate"||d==="scale"||d==="shear"){let u=null,m=1,g=0;d==="scale"?(u=new te(f.length),g=1):d==="shear"?u=new ee(f.length):(u=new Jt(f.length),m=i),u.boneIndex=o;let x=0;for(let E=0;E<f.length;E++){const w=f[E],b=this.getValue(w,"x",g),p=this.getValue(w,"y",g);u.setFrame(x,this.getValue(w,"time",0),b*m,p*m),this.readCurve(w,u,x),x++}r.push(u),h=Math.max(h,u.frames[(u.getFrameCount()-1)*Jt.ENTRIES])}else throw new Error(`Invalid timeline type for a bone: ${d} (${s})`)}}if(t.ik)for(const s in t.ik){const a=t.ik[s],o=e.findIkConstraint(s),d=new Ft(a.length);d.ikConstraintIndex=e.ikConstraints.indexOf(o);let f=0;for(let u=0;u<a.length;u++){const m=a[u];d.setFrame(f,this.getValue(m,"time",0),this.getValue(m,"mix",1),this.getValue(m,"softness",0)*i,this.getValue(m,"bendPositive",!0)?1:-1,this.getValue(m,"compress",!1),this.getValue(m,"stretch",!1)),this.readCurve(m,d,f),f++}r.push(d),h=Math.max(h,d.frames[(d.getFrameCount()-1)*Ft.ENTRIES])}if(t.transform)for(const s in t.transform){const a=t.transform[s],o=e.findTransformConstraint(s),d=new _t(a.length);d.transformConstraintIndex=e.transformConstraints.indexOf(o);let f=0;for(let u=0;u<a.length;u++){const m=a[u];d.setFrame(f,this.getValue(m,"time",0),this.getValue(m,"rotateMix",1),this.getValue(m,"translateMix",1),this.getValue(m,"scaleMix",1),this.getValue(m,"shearMix",1)),this.readCurve(m,d,f),f++}r.push(d),h=Math.max(h,d.frames[(d.getFrameCount()-1)*_t.ENTRIES])}if(t.path)for(const s in t.path){const a=t.path[s],o=e.findPathConstraintIndex(s);if(o==-1)throw new Error(`Path constraint not found: ${s}`);const d=e.pathConstraints[o];for(const f in a){const u=a[f];if(f==="position"||f==="spacing"){let m=null,g=1;f==="spacing"?(m=new ke(u.length),(d.spacingMode==vt.Length||d.spacingMode==vt.Fixed)&&(g=i)):(m=new Te(u.length),d.positionMode==dt.Fixed&&(g=i)),m.pathConstraintIndex=o;let x=0;for(let E=0;E<u.length;E++){const w=u[E];m.setFrame(x,this.getValue(w,"time",0),this.getValue(w,f,0)*g),this.readCurve(w,m,x),x++}r.push(m),h=Math.max(h,m.frames[(m.getFrameCount()-1)*Te.ENTRIES])}else if(f==="mix"){const m=new me(u.length);m.pathConstraintIndex=o;let g=0;for(let x=0;x<u.length;x++){const E=u[x];m.setFrame(g,this.getValue(E,"time",0),this.getValue(E,"rotateMix",1),this.getValue(E,"translateMix",1)),this.readCurve(E,m,g),g++}r.push(m),h=Math.max(h,m.frames[(m.getFrameCount()-1)*me.ENTRIES])}}}if(t.deform)for(const s in t.deform){const a=t.deform[s],o=e.findSkin(s);if(o==null){if(zt.FAIL_ON_NON_EXISTING_SKIN)throw new Error(`Skin not found: ${s}`);continue}for(const d in a){const f=a[d],u=e.findSlotIndex(d);if(u==-1)throw new Error(`Slot not found: ${f.name}`);for(const m in f){const g=f[m],x=o.getAttachment(u,m);if(x==null)throw new Error(`Deform attachment not found: ${g.name}`);const E=x.bones!=null,w=x.vertices,b=E?w.length/3*2:w.length,p=new hs(g.length);p.slotIndex=u,p.attachment=x;let S=0;for(let y=0;y<g.length;y++){const M=g[y];let T;const k=this.getValue(M,"vertices",null);if(k==null)T=E?v.newFloatArray(b):w;else{T=v.newFloatArray(b);const I=this.getValue(M,"offset",0);if(v.arrayCopy(k,0,T,I,k.length),i!=1)for(let R=I,V=R+k.length;R<V;R++)T[R]*=i;if(!E)for(let R=0;R<b;R++)T[R]+=w[R]}p.setFrame(S,this.getValue(M,"time",0),T),this.readCurve(M,p,S),S++}r.push(p),h=Math.max(h,p.frames[p.getFrameCount()-1])}}}let l=t.drawOrder;if(l==null&&(l=t.draworder),l!=null){const s=new xn(l.length),a=e.slots.length;let o=0;for(let d=0;d<l.length;d++){const f=l[d];let u=null;const m=this.getValue(f,"offsets",null);if(m!=null){u=v.newArray(a,-1);const g=v.newArray(a-m.length,0);let x=0,E=0;for(let w=0;w<m.length;w++){const b=m[w],p=e.findSlotIndex(b.slot);if(p==-1)throw new Error(`Slot not found: ${b.slot}`);for(;x!=p;)g[E++]=x++;u[x+b.offset]=x++}for(;x<a;)g[E++]=x++;for(let w=a-1;w>=0;w--)u[w]==-1&&(u[w]=g[--E])}s.setFrame(o++,this.getValue(f,"time",0),u)}r.push(s),h=Math.max(h,s.frames[s.getFrameCount()-1])}if(t.events){const s=new Yn(t.events.length);let a=0;for(let o=0;o<t.events.length;o++){const d=t.events[o],f=e.findEvent(d.name);if(f==null)throw new Error(`Event not found: ${d.name}`);const u=new ws(v.toSinglePrecision(this.getValue(d,"time",0)),f);u.intValue=this.getValue(d,"int",f.intValue),u.floatValue=this.getValue(d,"float",f.floatValue),u.stringValue=this.getValue(d,"string",f.stringValue),u.data.audioPath!=null&&(u.volume=this.getValue(d,"volume",1),u.balance=this.getValue(d,"balance",0)),s.setFrame(a++,u)}r.push(s),h=Math.max(h,s.frames[s.getFrameCount()-1])}if(isNaN(h))throw new Error("Error while parsing animation, duration is NaN");e.animations.push(new Et(n,r,h))}readCurve(t,n,e){if(t.hasOwnProperty("curve"))if(t.curve==="stepped")n.setStepped(e);else{const i=t.curve;n.setCurve(e,i,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}getValue(t,n,e){return t[n]!==void 0?t[n]:e}static blendModeFromString(t){if(t=t.toLowerCase(),t=="normal")return H.BLEND_MODES.NORMAL;if(t=="additive")return H.BLEND_MODES.ADD;if(t=="multiply")return H.BLEND_MODES.MULTIPLY;if(t=="screen")return H.BLEND_MODES.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if(t=t.toLowerCase(),t=="fixed")return dt.Fixed;if(t=="percent")return dt.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if(t=t.toLowerCase(),t=="length")return vt.Length;if(t=="fixed")return vt.Fixed;if(t=="percent")return vt.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if(t=t.toLowerCase(),t=="tangent")return pt.Tangent;if(t=="chain")return pt.Chain;if(t=="chainscale")return pt.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if(t=t.toLowerCase(),t=="normal")return j.Normal;if(t=="onlytranslation")return j.OnlyTranslation;if(t=="norotationorreflection")return j.NoRotationOrReflection;if(t=="noscale")return j.NoScale;if(t=="noscaleorreflection")return j.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},Xr=class{constructor(t,n,e,i,r){this.mesh=t,this.skin=n,this.slotIndex=e,this.parent=i,this.inheritDeform=r}};var Nr=Object.freeze({__proto__:null,Animation:Et,AnimationState:ne,AnimationStateAdapter:Pr,AnimationStateData:ms,AtlasAttachmentLoader:gs,Attachment:rs,AttachmentTimeline:en,Bone:xs,BoneData:ps,BoundingBoxAttachment:as,ClippingAttachment:os,ColorTimeline:Lt,ConstraintData:Nn,CurveTimeline:Ht,DeformTimeline:hs,DrawOrderTimeline:xn,Event:ws,EventData:bs,EventQueue:fs,EventTimeline:Yn,EventType:Gt,IkConstraint:Fi,IkConstraintData:Es,IkConstraintTimeline:Ft,JitterEffect:vr,MeshAttachment:mn,PathAttachment:gn,PathConstraint:pn,PathConstraintData:Ss,PathConstraintMixTimeline:me,PathConstraintPositionTimeline:Te,PathConstraintSpacingTimeline:ke,PointAttachment:ls,RegionAttachment:Q,RotateTimeline:Vt,ScaleTimeline:te,ShearTimeline:ee,Skeleton:ys,SkeletonBinary:Mt,SkeletonBounds:Yr,SkeletonData:Ms,SkeletonJson:sn,Skin:Bn,SkinEntry:Ts,Slot:cs,SlotData:As,SpacingMode:vt,Spine:class extends tn{createSkeleton(t){this.skeleton=new ys(t),this.skeleton.updateWorldTransform(),this.stateData=new ms(t),this.state=new ne(this.stateData)}},SwirlEffect:vi,TimelineType:Pi,TrackEntry:Xn,TransformConstraint:Yi,TransformConstraintData:Cs,TransformConstraintTimeline:_t,TranslateTimeline:Jt,TwoColorTimeline:yt,VertexAttachment:ze});let ks=class{constructor(t){if(t==null)throw new Error("name cannot be null.");this.name=t}};const Xi=class extends ks{constructor(t){super(t),this.id=(Xi.nextID++&65535)<<11,this.worldVerticesLength=0}computeWorldVerticesOld(t,n){this.computeWorldVertices(t,0,this.worldVerticesLength,n,0,2)}computeWorldVertices(t,n,e,i,r,h){e=r+(e>>1)*h;const l=t.bone.skeleton,s=t.attachmentVertices;let a=this.vertices;const o=this.bones;if(o==null){s.length>0&&(a=s);const m=t.bone.matrix,g=m.tx,x=m.ty,E=m.a,w=m.c,b=m.b,p=m.d;for(let S=n,y=r;y<e;S+=2,y+=h){const M=a[S],T=a[S+1];i[y]=M*E+T*w+g,i[y+1]=M*b+T*p+x}return}let d=0,f=0;for(let m=0;m<n;m+=2){const g=o[d];d+=g+1,f+=g}const u=l.bones;if(s.length==0)for(let m=r,g=f*3;m<e;m+=h){let x=0,E=0,w=o[d++];for(w+=d;d<w;d++,g+=3){const b=u[o[d]].matrix,p=a[g],S=a[g+1],y=a[g+2];x+=(p*b.a+S*b.c+b.tx)*y,E+=(p*b.b+S*b.d+b.ty)*y}i[m]=x,i[m+1]=E}else{const m=s;for(let g=r,x=f*3,E=f<<1;g<e;g+=h){let w=0,b=0,p=o[d++];for(p+=d;d<p;d++,x+=3,E+=2){const S=u[o[d]].matrix,y=a[x]+m[E],M=a[x+1]+m[E+1],T=a[x+2];w+=(y*S.a+M*S.c+S.tx)*T,b+=(y*S.b+M*S.d+S.ty)*T}i[g]=w,i[g+1]=b}}}applyDeform(t){return this==t}};let Ge=Xi;Ge.nextID=0;let Ni=class extends Ge{constructor(t){super(t),this.type=Z.BoundingBox,this.color=new _(1,1,1,1)}},Bi=class extends Ge{constructor(t){super(t),this.type=Z.Clipping,this.color=new _(.2275,.2275,.8078,1)}},Is=class extends Ge{constructor(t){super(t),this.type=Z.Mesh,this.color=new _(1,1,1,1),this.inheritDeform=!1,this.tempColor=new _(0,0,0,0)}applyDeform(t){return this==t||this.inheritDeform&&this.parentMesh==t}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t!=null&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},kn=class extends Ge{constructor(t){super(t),this.type=Z.Path,this.closed=!1,this.constantSpeed=!1,this.color=new _(1,1,1,1)}},Di=class extends Ge{constructor(t){super(t),this.type=Z.Point,this.color=new _(.38,.94,0,1)}computeWorldPosition(t,n){const e=t.matrix;return n.x=this.x*e.a+this.y*e.c+t.worldX,n.y=this.x*e.b+this.y*e.d+t.worldY,n}computeWorldRotation(t){const n=t.matrix,e=C.cosDeg(this.rotation),i=C.sinDeg(this.rotation),r=e*n.a+i*n.c,h=e*n.b+i*n.d;return Math.atan2(h,r)*C.radDeg}},Rs=class{constructor(t,n){if(this.attachmentVertices=new Array,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("bone cannot be null.");this.data=t,this.bone=n,this.color=new _,this.darkColor=t.darkColor==null?null:new _,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor!=null&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName==null?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const Yt=class extends ks{constructor(t){super(t),this.type=Z.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new _(1,1,1,1),this.offset=v.newFloatArray(8),this.uvs=v.newFloatArray(8),this.tempColor=new _(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,n=this.height/this.region.originalHeight*this.scaleY,e=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*n,r=e+this.region.width*t,h=i+this.region.height*n,l=this.rotation*Math.PI/180,s=Math.cos(l),a=Math.sin(l),o=e*s+this.x,d=e*a,f=i*s+this.y,u=i*a,m=r*s+this.x,g=r*a,x=h*s+this.y,E=h*a,w=this.offset;w[Yt.OX1]=o-u,w[Yt.OY1]=f+d,w[Yt.OX2]=o-E,w[Yt.OY2]=x+d,w[Yt.OX3]=m-E,w[Yt.OY3]=x+g,w[Yt.OX4]=m-u,w[Yt.OY4]=f+g}setRegion(t){this.region=t;const n=this.uvs;t.rotate?(n[2]=t.u,n[3]=t.v2,n[4]=t.u,n[5]=t.v,n[6]=t.u2,n[7]=t.v,n[0]=t.u2,n[1]=t.v2):(n[0]=t.u,n[1]=t.v2,n[2]=t.u,n[3]=t.v,n[4]=t.u2,n[5]=t.v,n[6]=t.u2,n[7]=t.v2)}computeWorldVertices(t,n,e,i){const r=this.offset,h=t instanceof Rs?t.bone.matrix:t.matrix,l=h.tx,s=h.ty,a=h.a,o=h.c,d=h.b,f=h.d;let u=0,m=0;u=r[Yt.OX1],m=r[Yt.OY1],n[e]=u*a+m*o+l,n[e+1]=u*d+m*f+s,e+=i,u=r[Yt.OX2],m=r[Yt.OY2],n[e]=u*a+m*o+l,n[e+1]=u*d+m*f+s,e+=i,u=r[Yt.OX3],m=r[Yt.OY3],n[e]=u*a+m*o+l,n[e+1]=u*d+m*f+s,e+=i,u=r[Yt.OX4],m=r[Yt.OY4],n[e]=u*a+m*o+l,n[e+1]=u*d+m*f+s}};let K=Yt;K.OX1=0,K.OY1=1,K.OX2=2,K.OY2=3,K.OX3=4,K.OY3=5,K.OX4=6,K.OY4=7,K.X1=0,K.Y1=1,K.C1R=2,K.C1G=3,K.C1B=4,K.C1A=5,K.U1=6,K.V1=7,K.X2=8,K.Y2=9,K.C2R=10,K.C2G=11,K.C2B=12,K.C2A=13,K.U2=14,K.V2=15,K.X3=16,K.Y3=17,K.C3R=18,K.C3G=19,K.C3B=20,K.C3A=21,K.U3=22,K.V3=23,K.X4=24,K.Y4=25,K.C4R=26,K.C4G=27,K.C4B=28,K.C4A=29,K.U4=30,K.V4=31;class Br{constructor(t,n){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=n}begin(t){}transform(t,n,e,i){t.x+=C.randomTriangular(-this.jitterX,this.jitterY),t.y+=C.randomTriangular(-this.jitterX,this.jitterY)}end(){}}const Li=class{constructor(c){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=c}begin(c){this.worldX=c.x+this.centerX,this.worldY=c.y+this.centerY}transform(c,t,n,e){const i=this.angle*C.degreesToRadians,r=c.x-this.worldX,h=c.y-this.worldY,l=Math.sqrt(r*r+h*h);if(l<this.radius){const s=Li.interpolation.apply(0,i,(this.radius-l)/this.radius),a=Math.cos(s),o=Math.sin(s);c.x=a*r-o*h+this.worldX,c.y=o*r+a*h+this.worldY}}end(){}};let _i=Li;_i.interpolation=new is(2);let Ct=class{constructor(t,n,e){if(t==null)throw new Error("name cannot be null.");if(n==null)throw new Error("timelines cannot be null.");this.name=t,this.timelines=n,this.duration=e}apply(t,n,e,i,r,h,l,s){if(t==null)throw new Error("skeleton cannot be null.");i&&this.duration!=0&&(e%=this.duration,n>0&&(n%=this.duration));const a=this.timelines;for(let o=0,d=a.length;o<d;o++)a[o].apply(t,n,e,r,h,l,s)}static binarySearch(t,n,e=1){let i=0,r=t.length/e-2;if(r==0)return e;let h=r>>>1;for(;;){if(t[(h+1)*e]<=n?i=h+1:r=h,i==r)return(i+1)*e;h=i+r>>>1}}static linearSearch(t,n,e){for(let i=0,r=t.length-e;i<=r;i+=e)if(t[i]>n)return i;return-1}};var Oi=(c=>(c[c.rotate=0]="rotate",c[c.translate=1]="translate",c[c.scale=2]="scale",c[c.shear=3]="shear",c[c.attachment=4]="attachment",c[c.color=5]="color",c[c.deform=6]="deform",c[c.event=7]="event",c[c.drawOrder=8]="drawOrder",c[c.ikConstraint=9]="ikConstraint",c[c.transformConstraint=10]="transformConstraint",c[c.pathConstraintPosition=11]="pathConstraintPosition",c[c.pathConstraintSpacing=12]="pathConstraintSpacing",c[c.pathConstraintMix=13]="pathConstraintMix",c[c.twoColor=14]="twoColor",c))(Oi||{});const At=class{constructor(c){if(c<=0)throw new Error(`frameCount must be > 0: ${c}`);this.curves=v.newFloatArray((c-1)*At.BEZIER_SIZE)}getFrameCount(){return this.curves.length/At.BEZIER_SIZE+1}setLinear(c){this.curves[c*At.BEZIER_SIZE]=At.LINEAR}setStepped(c){this.curves[c*At.BEZIER_SIZE]=At.STEPPED}getCurveType(c){const t=c*At.BEZIER_SIZE;if(t==this.curves.length)return At.LINEAR;const n=this.curves[t];return n==At.LINEAR?At.LINEAR:n==At.STEPPED?At.STEPPED:At.BEZIER}setCurve(c,t,n,e,i){const r=(-t*2+e)*.03,h=(-n*2+i)*.03,l=((t-e)*3+1)*.006,s=((n-i)*3+1)*.006;let a=r*2+l,o=h*2+s,d=t*.3+r+l*.16666667,f=n*.3+h+s*.16666667,u=c*At.BEZIER_SIZE;const m=this.curves;m[u++]=At.BEZIER;let g=d,x=f;for(let E=u+At.BEZIER_SIZE-1;u<E;u+=2)m[u]=g,m[u+1]=x,d+=a,f+=o,a+=l,o+=s,g+=d,x+=f}getCurvePercent(c,t){t=C.clamp(t,0,1);const n=this.curves;let e=c*At.BEZIER_SIZE;const i=n[e];if(i==At.LINEAR)return t;if(i==At.STEPPED)return 0;e++;let r=0;for(let l=e,s=e+At.BEZIER_SIZE-1;e<s;e+=2)if(r=n[e],r>=t){let a,o;return e==l?(a=0,o=0):(a=n[e-2],o=n[e-1]),o+(n[e+1]-o)*(t-a)/(r-a)}const h=n[e-1];return h+(1-h)*(t-r)/(1-r)}};let jt=At;jt.LINEAR=0,jt.STEPPED=1,jt.BEZIER=2,jt.BEZIER_SIZE=10*2-1;const je=class extends jt{constructor(c){super(c),this.frames=v.newFloatArray(c<<1)}getPropertyId(){return(0<<24)+this.boneIndex}setFrame(c,t,n){c<<=1,this.frames[c]=t,this.frames[c+je.ROTATION]=n}apply(c,t,n,e,i,r,h){const l=this.frames,s=c.bones[this.boneIndex];if(n<l[0]){switch(r){case A.setup:s.rotation=s.data.rotation;return;case A.first:const m=s.data.rotation-s.rotation;s.rotation+=(m-(16384-(16384.499999999996-m/360|0))*360)*i}return}if(n>=l[l.length-je.ENTRIES]){let m=l[l.length+je.PREV_ROTATION];switch(r){case A.setup:s.rotation=s.data.rotation+m*i;break;case A.first:case A.replace:m+=s.data.rotation-s.rotation,m-=(16384-(16384.499999999996-m/360|0))*360;case A.add:s.rotation+=m*i}return}const a=Ct.binarySearch(l,n,je.ENTRIES),o=l[a+je.PREV_ROTATION],d=l[a],f=this.getCurvePercent((a>>1)-1,1-(n-d)/(l[a+je.PREV_TIME]-d));let u=l[a+je.ROTATION]-o;switch(u=o+(u-(16384-(16384.499999999996-u/360|0))*360)*f,r){case A.setup:s.rotation=s.data.rotation+(u-(16384-(16384.499999999996-u/360|0))*360)*i;break;case A.first:case A.replace:u+=s.data.rotation-s.rotation;case A.add:s.rotation+=(u-(16384-(16384.499999999996-u/360|0))*360)*i}}};let $t=je;$t.ENTRIES=2,$t.PREV_TIME=-2,$t.PREV_ROTATION=-1,$t.ROTATION=1;const Wt=class extends jt{constructor(c){super(c),this.frames=v.newFloatArray(c*Wt.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(c,t,n,e){c*=Wt.ENTRIES,this.frames[c]=t,this.frames[c+Wt.X]=n,this.frames[c+Wt.Y]=e}apply(c,t,n,e,i,r,h){const l=this.frames,s=c.bones[this.boneIndex];if(n<l[0]){switch(r){case A.setup:s.x=s.data.x,s.y=s.data.y;return;case A.first:s.x+=(s.data.x-s.x)*i,s.y+=(s.data.y-s.y)*i}return}let a=0,o=0;if(n>=l[l.length-Wt.ENTRIES])a=l[l.length+Wt.PREV_X],o=l[l.length+Wt.PREV_Y];else{const d=Ct.binarySearch(l,n,Wt.ENTRIES);a=l[d+Wt.PREV_X],o=l[d+Wt.PREV_Y];const f=l[d],u=this.getCurvePercent(d/Wt.ENTRIES-1,1-(n-f)/(l[d+Wt.PREV_TIME]-f));a+=(l[d+Wt.X]-a)*u,o+=(l[d+Wt.Y]-o)*u}switch(r){case A.setup:s.x=s.data.x+a*i,s.y=s.data.y+o*i;break;case A.first:case A.replace:s.x+=(s.data.x+a-s.x)*i,s.y+=(s.data.y+o-s.y)*i;break;case A.add:s.x+=a*i,s.y+=o*i}}};let ge=Wt;ge.ENTRIES=3,ge.PREV_TIME=-3,ge.PREV_X=-2,ge.PREV_Y=-1,ge.X=1,ge.Y=2;let le=class extends ge{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.bones[this.boneIndex];if(e<s[0]){switch(h){case A.setup:a.scaleX=a.data.scaleX,a.scaleY=a.data.scaleY;return;case A.first:a.scaleX+=(a.data.scaleX-a.scaleX)*r,a.scaleY+=(a.data.scaleY-a.scaleY)*r}return}let o=0,d=0;if(e>=s[s.length-le.ENTRIES])o=s[s.length+le.PREV_X]*a.data.scaleX,d=s[s.length+le.PREV_Y]*a.data.scaleY;else{const f=Ct.binarySearch(s,e,le.ENTRIES);o=s[f+le.PREV_X],d=s[f+le.PREV_Y];const u=s[f],m=this.getCurvePercent(f/le.ENTRIES-1,1-(e-u)/(s[f+le.PREV_TIME]-u));o=(o+(s[f+le.X]-o)*m)*a.data.scaleX,d=(d+(s[f+le.Y]-d)*m)*a.data.scaleY}if(r==1)h==A.add?(a.scaleX+=o-a.data.scaleX,a.scaleY+=d-a.data.scaleY):(a.scaleX=o,a.scaleY=d);else{let f=0,u=0;if(l==J.mixOut)switch(h){case A.setup:f=a.data.scaleX,u=a.data.scaleY,a.scaleX=f+(Math.abs(o)*C.signum(f)-f)*r,a.scaleY=u+(Math.abs(d)*C.signum(u)-u)*r;break;case A.first:case A.replace:f=a.scaleX,u=a.scaleY,a.scaleX=f+(Math.abs(o)*C.signum(f)-f)*r,a.scaleY=u+(Math.abs(d)*C.signum(u)-u)*r;break;case A.add:f=a.scaleX,u=a.scaleY,a.scaleX=f+(Math.abs(o)*C.signum(f)-a.data.scaleX)*r,a.scaleY=u+(Math.abs(d)*C.signum(u)-a.data.scaleY)*r}else switch(h){case A.setup:f=Math.abs(a.data.scaleX)*C.signum(o),u=Math.abs(a.data.scaleY)*C.signum(d),a.scaleX=f+(o-f)*r,a.scaleY=u+(d-u)*r;break;case A.first:case A.replace:f=Math.abs(a.scaleX)*C.signum(o),u=Math.abs(a.scaleY)*C.signum(d),a.scaleX=f+(o-f)*r,a.scaleY=u+(d-u)*r;break;case A.add:f=C.signum(o),u=C.signum(d),a.scaleX=Math.abs(a.scaleX)*f+(o-Math.abs(a.data.scaleX)*f)*r,a.scaleY=Math.abs(a.scaleY)*u+(d-Math.abs(a.data.scaleY)*u)*r}}}},ce=class extends ge{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.bones[this.boneIndex];if(e<s[0]){switch(h){case A.setup:a.shearX=a.data.shearX,a.shearY=a.data.shearY;return;case A.first:a.shearX+=(a.data.shearX-a.shearX)*r,a.shearY+=(a.data.shearY-a.shearY)*r}return}let o=0,d=0;if(e>=s[s.length-ce.ENTRIES])o=s[s.length+ce.PREV_X],d=s[s.length+ce.PREV_Y];else{const f=Ct.binarySearch(s,e,ce.ENTRIES);o=s[f+ce.PREV_X],d=s[f+ce.PREV_Y];const u=s[f],m=this.getCurvePercent(f/ce.ENTRIES-1,1-(e-u)/(s[f+ce.PREV_TIME]-u));o=o+(s[f+ce.X]-o)*m,d=d+(s[f+ce.Y]-d)*m}switch(h){case A.setup:a.shearX=a.data.shearX+o*r,a.shearY=a.data.shearY+d*r;break;case A.first:case A.replace:a.shearX+=(a.data.shearX+o-a.shearX)*r,a.shearY+=(a.data.shearY+d-a.shearY)*r;break;case A.add:a.shearX+=o*r,a.shearY+=d*r}}};const gt=class extends jt{constructor(c){super(c),this.frames=v.newFloatArray(c*gt.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(c,t,n,e,i,r){c*=gt.ENTRIES,this.frames[c]=t,this.frames[c+gt.R]=n,this.frames[c+gt.G]=e,this.frames[c+gt.B]=i,this.frames[c+gt.A]=r}apply(c,t,n,e,i,r,h){const l=c.slots[this.slotIndex],s=this.frames;if(n<s[0]){switch(r){case A.setup:l.color.setFromColor(l.data.color);return;case A.first:const u=l.color,m=l.data.color;u.add((m.r-u.r)*i,(m.g-u.g)*i,(m.b-u.b)*i,(m.a-u.a)*i)}return}let a=0,o=0,d=0,f=0;if(n>=s[s.length-gt.ENTRIES]){const u=s.length;a=s[u+gt.PREV_R],o=s[u+gt.PREV_G],d=s[u+gt.PREV_B],f=s[u+gt.PREV_A]}else{const u=Ct.binarySearch(s,n,gt.ENTRIES);a=s[u+gt.PREV_R],o=s[u+gt.PREV_G],d=s[u+gt.PREV_B],f=s[u+gt.PREV_A];const m=s[u],g=this.getCurvePercent(u/gt.ENTRIES-1,1-(n-m)/(s[u+gt.PREV_TIME]-m));a+=(s[u+gt.R]-a)*g,o+=(s[u+gt.G]-o)*g,d+=(s[u+gt.B]-d)*g,f+=(s[u+gt.A]-f)*g}if(i==1)l.color.set(a,o,d,f);else{const u=l.color;r==A.setup&&u.setFromColor(l.data.color),u.add((a-u.r)*i,(o-u.g)*i,(d-u.b)*i,(f-u.a)*i)}}};let se=gt;se.ENTRIES=5,se.PREV_TIME=-5,se.PREV_R=-4,se.PREV_G=-3,se.PREV_B=-2,se.PREV_A=-1,se.R=1,se.G=2,se.B=3,se.A=4;const st=class extends jt{constructor(c){super(c),this.frames=v.newFloatArray(c*st.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(c,t,n,e,i,r,h,l,s){c*=st.ENTRIES,this.frames[c]=t,this.frames[c+st.R]=n,this.frames[c+st.G]=e,this.frames[c+st.B]=i,this.frames[c+st.A]=r,this.frames[c+st.R2]=h,this.frames[c+st.G2]=l,this.frames[c+st.B2]=s}apply(c,t,n,e,i,r,h){const l=c.slots[this.slotIndex],s=this.frames;if(n<s[0]){switch(r){case A.setup:l.color.setFromColor(l.data.color),l.darkColor.setFromColor(l.data.darkColor);return;case A.first:const x=l.color,E=l.darkColor,w=l.data.color,b=l.data.darkColor;x.add((w.r-x.r)*i,(w.g-x.g)*i,(w.b-x.b)*i,(w.a-x.a)*i),E.add((b.r-E.r)*i,(b.g-E.g)*i,(b.b-E.b)*i,0)}return}let a=0,o=0,d=0,f=0,u=0,m=0,g=0;if(n>=s[s.length-st.ENTRIES]){const x=s.length;a=s[x+st.PREV_R],o=s[x+st.PREV_G],d=s[x+st.PREV_B],f=s[x+st.PREV_A],u=s[x+st.PREV_R2],m=s[x+st.PREV_G2],g=s[x+st.PREV_B2]}else{const x=Ct.binarySearch(s,n,st.ENTRIES);a=s[x+st.PREV_R],o=s[x+st.PREV_G],d=s[x+st.PREV_B],f=s[x+st.PREV_A],u=s[x+st.PREV_R2],m=s[x+st.PREV_G2],g=s[x+st.PREV_B2];const E=s[x],w=this.getCurvePercent(x/st.ENTRIES-1,1-(n-E)/(s[x+st.PREV_TIME]-E));a+=(s[x+st.R]-a)*w,o+=(s[x+st.G]-o)*w,d+=(s[x+st.B]-d)*w,f+=(s[x+st.A]-f)*w,u+=(s[x+st.R2]-u)*w,m+=(s[x+st.G2]-m)*w,g+=(s[x+st.B2]-g)*w}if(i==1)l.color.set(a,o,d,f),l.darkColor.set(u,m,g,1);else{const x=l.color,E=l.darkColor;r==A.setup&&(x.setFromColor(l.data.color),E.setFromColor(l.data.darkColor)),x.add((a-x.r)*i,(o-x.g)*i,(d-x.b)*i,(f-x.a)*i),E.add((u-E.r)*i,(m-E.g)*i,(g-E.b)*i,0)}}};let Tt=st;Tt.ENTRIES=8,Tt.PREV_TIME=-8,Tt.PREV_R=-7,Tt.PREV_G=-6,Tt.PREV_B=-5,Tt.PREV_A=-4,Tt.PREV_R2=-3,Tt.PREV_G2=-2,Tt.PREV_B2=-1,Tt.R=1,Tt.G=2,Tt.B=3,Tt.A=4,Tt.R2=5,Tt.G2=6,Tt.B2=7;let Dn=class{constructor(t){this.frames=v.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,n,e){this.frames[t]=n,this.attachmentNames[t]=e}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(l==J.mixOut&&h==A.setup){const f=s.data.attachmentName;s.setAttachment(f==null?null:t.getAttachment(this.slotIndex,f));return}const a=this.frames;if(e<a[0]){if(h==A.setup||h==A.first){const f=s.data.attachmentName;s.setAttachment(f==null?null:t.getAttachment(this.slotIndex,f))}return}let o=0;e>=a[a.length-1]?o=a.length-1:o=Ct.binarySearch(a,e,1)-1;const d=this.attachmentNames[o];t.slots[this.slotIndex].setAttachment(d==null?null:t.getAttachment(this.slotIndex,d))}},$i=null,Wi=class extends jt{constructor(t){super(t),this.frames=v.newFloatArray(t),this.frameVertices=new Array(t),$i==null&&($i=v.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,n,e){this.frames[t]=n,this.frameVertices[t]=e}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex],a=s.getAttachment();if(!(a instanceof Ge)||!a.applyDeform(this.attachment))return;const o=s.attachmentVertices;o.length==0&&(h=A.setup);const d=this.frameVertices,f=d[0].length,u=this.frames;if(e<u[0]){const p=a;switch(h){case A.setup:o.length=0;return;case A.first:if(r==1){o.length=0;break}const S=v.setArraySize(o,f);if(p.bones==null){const y=p.vertices;for(let M=0;M<f;M++)S[M]+=(y[M]-S[M])*r}else{r=1-r;for(let y=0;y<f;y++)S[y]*=r}}return}const m=v.setArraySize(o,f);if(e>=u[u.length-1]){const p=d[u.length-1];if(r==1){if(h==A.add){const S=a;if(S.bones==null){const y=S.vertices;for(let M=0;M<f;M++)m[M]+=p[M]-y[M]}else for(let y=0;y<f;y++)m[y]+=p[y]}else v.arrayCopy(p,0,m,0,f);}else switch(h){case A.setup:{const y=a;if(y.bones==null){const M=y.vertices;for(let T=0;T<f;T++){const k=M[T];m[T]=k+(p[T]-k)*r}}else for(let M=0;M<f;M++)m[M]=p[M]*r;break}case A.first:case A.replace:for(let y=0;y<f;y++)m[y]+=(p[y]-m[y])*r;case A.add:const S=a;if(S.bones==null){const y=S.vertices;for(let M=0;M<f;M++)m[M]+=(p[M]-y[M])*r}else for(let y=0;y<f;y++)m[y]+=p[y]*r}return}const g=Ct.binarySearch(u,e),x=d[g-1],E=d[g],w=u[g],b=this.getCurvePercent(g-1,1-(e-w)/(u[g-1]-w));if(r==1){if(h==A.add){const p=a;if(p.bones==null){const S=p.vertices;for(let y=0;y<f;y++){const M=x[y];m[y]+=M+(E[y]-M)*b-S[y]}}else for(let S=0;S<f;S++){const y=x[S];m[S]+=y+(E[S]-y)*b}}else for(let p=0;p<f;p++){const S=x[p];m[p]=S+(E[p]-S)*b}}else switch(h){case A.setup:{const S=a;if(S.bones==null){const y=S.vertices;for(let M=0;M<f;M++){const T=x[M],k=y[M];m[M]=k+(T+(E[M]-T)*b-k)*r}}else for(let y=0;y<f;y++){const M=x[y];m[y]=(M+(E[y]-M)*b)*r}break}case A.first:case A.replace:for(let S=0;S<f;S++){const y=x[S];m[S]+=(y+(E[S]-y)*b-m[S])*r}break;case A.add:const p=a;if(p.bones==null){const S=p.vertices;for(let y=0;y<f;y++){const M=x[y];m[y]+=(M+(E[y]-M)*b-S[y])*r}}else for(let S=0;S<f;S++){const y=x[S];m[S]+=(y+(E[S]-y)*b)*r}}}},qi=class{constructor(t){this.frames=v.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,n){this.frames[t]=n.time,this.events[t]=n}apply(t,n,e,i,r,h,l){if(i==null)return;const s=this.frames,a=this.frames.length;if(n>e)this.apply(t,n,Number.MAX_VALUE,i,r,h,l),n=-1;else if(n>=s[a-1])return;if(e<s[0])return;let o=0;if(n<s[0])o=0;else{o=Ct.binarySearch(s,n);const d=s[o];for(;o>0&&s[o-1]==d;)o--}for(;o<a&&e>=s[o];o++)i.push(this.events[o])}},Ln=class{constructor(t){this.frames=v.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,n,e){this.frames[t]=n,this.drawOrders[t]=e}apply(t,n,e,i,r,h,l){const s=t.drawOrder,a=t.slots;if(l==J.mixOut&&h==A.setup){v.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);return}const o=this.frames;if(e<o[0]){(h==A.setup||h==A.first)&&v.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);return}let d=0;e>=o[o.length-1]?d=o.length-1:d=Ct.binarySearch(o,e)-1;const f=this.drawOrders[d];if(f==null)v.arrayCopy(a,0,s,0,a.length);else for(let u=0,m=f.length;u<m;u++)s[u]=a[f[u]]}};const ht=class extends jt{constructor(c){super(c),this.frames=v.newFloatArray(c*ht.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(c,t,n,e,i,r){c*=ht.ENTRIES,this.frames[c]=t,this.frames[c+ht.MIX]=n,this.frames[c+ht.BEND_DIRECTION]=e,this.frames[c+ht.COMPRESS]=i?1:0,this.frames[c+ht.STRETCH]=r?1:0}apply(c,t,n,e,i,r,h){const l=this.frames,s=c.ikConstraints[this.ikConstraintIndex];if(n<l[0]){switch(r){case A.setup:s.mix=s.data.mix,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch;return;case A.first:s.mix+=(s.data.mix-s.mix)*i,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}return}if(n>=l[l.length-ht.ENTRIES]){r==A.setup?(s.mix=s.data.mix+(l[l.length+ht.PREV_MIX]-s.data.mix)*i,h==J.mixOut?(s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch):(s.bendDirection=l[l.length+ht.PREV_BEND_DIRECTION],s.compress=l[l.length+ht.PREV_COMPRESS]!=0,s.stretch=l[l.length+ht.PREV_STRETCH]!=0)):(s.mix+=(l[l.length+ht.PREV_MIX]-s.mix)*i,h==J.mixIn&&(s.bendDirection=l[l.length+ht.PREV_BEND_DIRECTION],s.compress=l[l.length+ht.PREV_COMPRESS]!=0,s.stretch=l[l.length+ht.PREV_STRETCH]!=0));return}const a=Ct.binarySearch(l,n,ht.ENTRIES),o=l[a+ht.PREV_MIX],d=l[a],f=this.getCurvePercent(a/ht.ENTRIES-1,1-(n-d)/(l[a+ht.PREV_TIME]-d));r==A.setup?(s.mix=s.data.mix+(o+(l[a+ht.MIX]-o)*f-s.data.mix)*i,h==J.mixOut?(s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch):(s.bendDirection=l[a+ht.PREV_BEND_DIRECTION],s.compress=l[a+ht.PREV_COMPRESS]!=0,s.stretch=l[a+ht.PREV_STRETCH]!=0)):(s.mix+=(o+(l[a+ht.MIX]-o)*f-s.mix)*i,h==J.mixIn&&(s.bendDirection=l[a+ht.PREV_BEND_DIRECTION],s.compress=l[a+ht.PREV_COMPRESS]!=0,s.stretch=l[a+ht.PREV_STRETCH]!=0))}};let ie=ht;ie.ENTRIES=5,ie.PREV_TIME=-5,ie.PREV_MIX=-4,ie.PREV_BEND_DIRECTION=-3,ie.PREV_COMPRESS=-2,ie.PREV_STRETCH=-1,ie.MIX=1,ie.BEND_DIRECTION=2,ie.COMPRESS=3,ie.STRETCH=4;const xt=class extends jt{constructor(c){super(c),this.frames=v.newFloatArray(c*xt.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(c,t,n,e,i,r){c*=xt.ENTRIES,this.frames[c]=t,this.frames[c+xt.ROTATE]=n,this.frames[c+xt.TRANSLATE]=e,this.frames[c+xt.SCALE]=i,this.frames[c+xt.SHEAR]=r}apply(c,t,n,e,i,r,h){const l=this.frames,s=c.transformConstraints[this.transformConstraintIndex];if(n<l[0]){const u=s.data;switch(r){case A.setup:s.rotateMix=u.rotateMix,s.translateMix=u.translateMix,s.scaleMix=u.scaleMix,s.shearMix=u.shearMix;return;case A.first:s.rotateMix+=(u.rotateMix-s.rotateMix)*i,s.translateMix+=(u.translateMix-s.translateMix)*i,s.scaleMix+=(u.scaleMix-s.scaleMix)*i,s.shearMix+=(u.shearMix-s.shearMix)*i}return}let a=0,o=0,d=0,f=0;if(n>=l[l.length-xt.ENTRIES]){const u=l.length;a=l[u+xt.PREV_ROTATE],o=l[u+xt.PREV_TRANSLATE],d=l[u+xt.PREV_SCALE],f=l[u+xt.PREV_SHEAR]}else{const u=Ct.binarySearch(l,n,xt.ENTRIES);a=l[u+xt.PREV_ROTATE],o=l[u+xt.PREV_TRANSLATE],d=l[u+xt.PREV_SCALE],f=l[u+xt.PREV_SHEAR];const m=l[u],g=this.getCurvePercent(u/xt.ENTRIES-1,1-(n-m)/(l[u+xt.PREV_TIME]-m));a+=(l[u+xt.ROTATE]-a)*g,o+=(l[u+xt.TRANSLATE]-o)*g,d+=(l[u+xt.SCALE]-d)*g,f+=(l[u+xt.SHEAR]-f)*g}if(r==A.setup){const u=s.data;s.rotateMix=u.rotateMix+(a-u.rotateMix)*i,s.translateMix=u.translateMix+(o-u.translateMix)*i,s.scaleMix=u.scaleMix+(d-u.scaleMix)*i,s.shearMix=u.shearMix+(f-u.shearMix)*i}else s.rotateMix+=(a-s.rotateMix)*i,s.translateMix+=(o-s.translateMix)*i,s.scaleMix+=(d-s.scaleMix)*i,s.shearMix+=(f-s.shearMix)*i}};let re=xt;re.ENTRIES=5,re.PREV_TIME=-5,re.PREV_ROTATE=-4,re.PREV_TRANSLATE=-3,re.PREV_SCALE=-2,re.PREV_SHEAR=-1,re.ROTATE=1,re.TRANSLATE=2,re.SCALE=3,re.SHEAR=4;const xe=class extends jt{constructor(c){super(c),this.frames=v.newFloatArray(c*xe.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(c,t,n){c*=xe.ENTRIES,this.frames[c]=t,this.frames[c+xe.VALUE]=n}apply(c,t,n,e,i,r,h){const l=this.frames,s=c.pathConstraints[this.pathConstraintIndex];if(n<l[0]){switch(r){case A.setup:s.position=s.data.position;return;case A.first:s.position+=(s.data.position-s.position)*i}return}let a=0;if(n>=l[l.length-xe.ENTRIES])a=l[l.length+xe.PREV_VALUE];else{const o=Ct.binarySearch(l,n,xe.ENTRIES);a=l[o+xe.PREV_VALUE];const d=l[o],f=this.getCurvePercent(o/xe.ENTRIES-1,1-(n-d)/(l[o+xe.PREV_TIME]-d));a+=(l[o+xe.VALUE]-a)*f}r==A.setup?s.position=s.data.position+(a-s.data.position)*i:s.position+=(a-s.position)*i}};let Ze=xe;Ze.ENTRIES=2,Ze.PREV_TIME=-2,Ze.PREV_VALUE=-1,Ze.VALUE=1;let Xe=class extends Ze{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(t,n,e,i,r,h,l){const s=this.frames,a=t.pathConstraints[this.pathConstraintIndex];if(e<s[0]){switch(h){case A.setup:a.spacing=a.data.spacing;return;case A.first:a.spacing+=(a.data.spacing-a.spacing)*r}return}let o=0;if(e>=s[s.length-Xe.ENTRIES])o=s[s.length+Xe.PREV_VALUE];else{const d=Ct.binarySearch(s,e,Xe.ENTRIES);o=s[d+Xe.PREV_VALUE];const f=s[d],u=this.getCurvePercent(d/Xe.ENTRIES-1,1-(e-f)/(s[d+Xe.PREV_TIME]-f));o+=(s[d+Xe.VALUE]-o)*u}h==A.setup?a.spacing=a.data.spacing+(o-a.data.spacing)*r:a.spacing+=(o-a.spacing)*r}};const qt=class extends jt{constructor(c){super(c),this.frames=v.newFloatArray(c*qt.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(c,t,n,e){c*=qt.ENTRIES,this.frames[c]=t,this.frames[c+qt.ROTATE]=n,this.frames[c+qt.TRANSLATE]=e}apply(c,t,n,e,i,r,h){const l=this.frames,s=c.pathConstraints[this.pathConstraintIndex];if(n<l[0]){switch(r){case A.setup:s.rotateMix=s.data.rotateMix,s.translateMix=s.data.translateMix;return;case A.first:s.rotateMix+=(s.data.rotateMix-s.rotateMix)*i,s.translateMix+=(s.data.translateMix-s.translateMix)*i}return}let a=0,o=0;if(n>=l[l.length-qt.ENTRIES])a=l[l.length+qt.PREV_ROTATE],o=l[l.length+qt.PREV_TRANSLATE];else{const d=Ct.binarySearch(l,n,qt.ENTRIES);a=l[d+qt.PREV_ROTATE],o=l[d+qt.PREV_TRANSLATE];const f=l[d],u=this.getCurvePercent(d/qt.ENTRIES-1,1-(n-f)/(l[d+qt.PREV_TIME]-f));a+=(l[d+qt.ROTATE]-a)*u,o+=(l[d+qt.TRANSLATE]-o)*u}r==A.setup?(s.rotateMix=s.data.rotateMix+(a-s.data.rotateMix)*i,s.translateMix=s.data.translateMix+(o-s.data.translateMix)*i):(s.rotateMix+=(a-s.rotateMix)*i,s.translateMix+=(o-s.translateMix)*i)}};let Ne=qt;Ne.ENTRIES=3,Ne.PREV_TIME=-3,Ne.PREV_ROTATE=-2,Ne.PREV_TRANSLATE=-1,Ne.ROTATE=1,Ne.TRANSLATE=2;const Pt=class{constructor(t){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new Ps(this),this.propertyIDs=new ns,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new An(()=>new _n),this.data=t}update(t){t*=this.timeScale;const n=this.tracks;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r==null)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let h=t*r.timeScale;if(r.delay>0){if(r.delay-=h,r.delay>0)continue;h=-r.delay,r.delay=0}let l=r.next;if(l!=null){const s=r.trackLast-l.delay;if(s>=0){for(l.delay=0,l.trackTime=r.timeScale==0?0:(s/r.timeScale+t)*l.timeScale,r.trackTime+=h,this.setCurrent(e,l,!0);l.mixingFrom!=null;)l.mixTime+=t,l=l.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&r.mixingFrom==null){n[e]=null,this.queue.end(r),this.disposeNext(r);continue}if(r.mixingFrom!=null&&this.updateMixingFrom(r,t)){let s=r.mixingFrom;for(r.mixingFrom=null,s!=null&&(s.mixingTo=null);s!=null;)this.queue.end(s),s=s.mixingFrom}r.trackTime+=h}this.queue.drain()}updateMixingFrom(t,n){const e=t.mixingFrom;if(e==null)return!0;const i=this.updateMixingFrom(e,n);return e.animationLast=e.nextAnimationLast,e.trackLast=e.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?((e.totalAlpha==0||t.mixDuration==0)&&(t.mixingFrom=e.mixingFrom,e.mixingFrom!=null&&(e.mixingFrom.mixingTo=t),t.interruptAlpha=e.interruptAlpha,this.queue.end(e)),i):(e.trackTime+=n*e.timeScale,t.mixTime+=n,!1)}apply(t){if(t==null)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const n=this.events,e=this.tracks;let i=!1;for(let r=0,h=e.length;r<h;r++){const l=e[r];if(l==null||l.delay>0)continue;i=!0;const s=r==0?A.first:l.mixBlend;let a=l.alpha;l.mixingFrom!=null?a*=this.applyMixingFrom(l,t,s):l.trackTime>=l.trackEnd&&l.next==null&&(a=0);const o=l.animationLast,d=l.getAnimationTime(),f=l.animation.timelines.length,u=l.animation.timelines;if(r==0&&a==1||s==A.add)for(let m=0;m<f;m++)v.webkit602BugfixHelper(a,s),u[m].apply(t,o,d,n,a,s,J.mixIn);else{const m=l.timelineMode,g=l.timelinesRotation.length==0;g&&v.setArraySize(l.timelinesRotation,f<<1,null);const x=l.timelinesRotation;for(let E=0;E<f;E++){const w=u[E],b=m[E]==Pt.SUBSEQUENT?s:A.setup;w instanceof $t?this.applyRotateTimeline(w,t,d,a,b,x,E<<1,g):(v.webkit602BugfixHelper(a,s),w.apply(t,o,d,n,a,b,J.mixIn))}}this.queueEvents(l,d),n.length=0,l.nextAnimationLast=d,l.nextTrackLast=l.trackTime}return this.queue.drain(),i}applyMixingFrom(t,n,e){const i=t.mixingFrom;i.mixingFrom!=null&&this.applyMixingFrom(i,n,e);let r=0;t.mixDuration==0?(r=1,e==A.first&&(e=A.setup)):(r=t.mixTime/t.mixDuration,r>1&&(r=1),e!=A.first&&(e=i.mixBlend));const h=r<i.eventThreshold?this.events:null,l=r<i.attachmentThreshold,s=r<i.drawOrderThreshold,a=i.animationLast,o=i.getAnimationTime(),d=i.animation.timelines.length,f=i.animation.timelines,u=i.alpha*t.interruptAlpha,m=u*(1-r);if(e==A.add)for(let g=0;g<d;g++)f[g].apply(n,a,o,h,m,e,J.mixOut);else{const g=i.timelineMode,x=i.timelineHoldMix,E=i.timelinesRotation.length==0;E&&v.setArraySize(i.timelinesRotation,d<<1,null);const w=i.timelinesRotation;i.totalAlpha=0;for(let b=0;b<d;b++){const p=f[b];let S=J.mixOut,y,M=0;switch(g[b]){case Pt.SUBSEQUENT:if(!l&&p instanceof Dn||!s&&p instanceof Ln)continue;y=e,M=m;break;case Pt.FIRST:y=A.setup,M=m;break;case Pt.HOLD:y=A.setup,M=u;break;default:y=A.setup;const T=x[b];M=u*Math.max(0,1-T.mixTime/T.mixDuration);break}i.totalAlpha+=M,p instanceof $t?this.applyRotateTimeline(p,n,o,M,y,w,b<<1,E):(v.webkit602BugfixHelper(M,e),y==A.setup&&(p instanceof Dn?l&&(S=J.mixOut):p instanceof Ln&&s&&(S=J.mixOut)),p.apply(n,a,o,h,M,y,S))}}return t.mixDuration>0&&this.queueEvents(i,o),this.events.length=0,i.nextAnimationLast=o,i.nextTrackLast=i.trackTime,r}applyRotateTimeline(t,n,e,i,r,h,l,s){if(s&&(h[l]=0),i==1){t.apply(n,0,e,null,1,r,J.mixIn);return}const a=t,o=a.frames,d=n.bones[a.boneIndex];let f=0,u=0;if(e<o[0])switch(r){case A.setup:d.rotation=d.data.rotation;default:return;case A.first:f=d.rotation,u=d.data.rotation}else if(f=r==A.setup?d.data.rotation:d.rotation,e>=o[o.length-$t.ENTRIES])u=d.data.rotation+o[o.length+$t.PREV_ROTATION];else{const x=Ct.binarySearch(o,e,$t.ENTRIES),E=o[x+$t.PREV_ROTATION],w=o[x],b=a.getCurvePercent((x>>1)-1,1-(e-w)/(o[x+$t.PREV_TIME]-w));u=o[x+$t.ROTATION]-E,u-=(16384-(16384.499999999996-u/360|0))*360,u=E+u*b+d.data.rotation,u-=(16384-(16384.499999999996-u/360|0))*360}let m=0,g=u-f;if(g-=(16384-(16384.499999999996-g/360|0))*360,g==0)m=h[l];else{let x=0,E=0;s?(x=0,E=g):(x=h[l],E=h[l+1]);const w=g>0;let b=x>=0;C.signum(E)!=C.signum(g)&&Math.abs(E)<=90&&(Math.abs(x)>180&&(x+=360*C.signum(x)),b=w),m=g+x-x%360,b!=w&&(m+=360*C.signum(x)),h[l]=m}h[l+1]=g,f+=m*i,d.rotation=f-(16384-(16384.499999999996-f/360|0))*360}queueEvents(t,n){const e=t.animationStart,i=t.animationEnd,r=i-e,h=t.trackLast%r,l=this.events;let s=0;const a=l.length;for(;s<a;s++){const d=l[s];if(d.time<h)break;d.time>i||this.queue.event(t,d)}let o=!1;for(t.loop?o=r==0||h>t.trackTime%r:o=n>=i&&t.animationLast<i,o&&this.queue.complete(t);s<a;s++)l[s].time<e||this.queue.event(t,l[s])}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let n=0,e=this.tracks.length;n<e;n++)this.clearTrack(n);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const n=this.tracks[t];if(n==null)return;this.queue.end(n),this.disposeNext(n);let e=n;for(;;){const i=e.mixingFrom;if(i==null)break;this.queue.end(i),e.mixingFrom=null,e.mixingTo=null,e=i}this.tracks[n.trackIndex]=null,this.queue.drain()}setCurrent(t,n,e){const i=this.expandToIndex(t);this.tracks[t]=n,i!=null&&(e&&this.queue.interrupt(i),n.mixingFrom=i,i.mixingTo=n,n.mixTime=0,i.mixingFrom!=null&&i.mixDuration>0&&(n.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(n)}setAnimation(t,n,e){const i=this.data.skeletonData.findAnimation(n);if(i==null)throw new Error(`Animation not found: ${n}`);return this.setAnimationWith(t,i,e)}setAnimationWith(t,n,e){if(n==null)throw new Error("animation cannot be null.");let i=!0,r=this.expandToIndex(t);r!=null&&(r.nextTrackLast==-1?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,i=!1):this.disposeNext(r));const h=this.trackEntry(t,n,e,r);return this.setCurrent(t,h,i),this.queue.drain(),h}addAnimation(t,n,e,i){const r=this.data.skeletonData.findAnimation(n);if(r==null)throw new Error(`Animation not found: ${n}`);return this.addAnimationWith(t,r,e,i)}addAnimationWith(t,n,e,i){if(n==null)throw new Error("animation cannot be null.");let r=this.expandToIndex(t);if(r!=null)for(;r.next!=null;)r=r.next;const h=this.trackEntry(t,n,e,r);if(r==null)this.setCurrent(t,h,!0),this.queue.drain();else if(r.next=h,i<=0){const l=r.animationEnd-r.animationStart;l!=0?(r.loop?i+=l*(1+(r.trackTime/l|0)):i+=Math.max(l,r.trackTime),i-=this.data.getMix(r.animation,n)):i=r.trackTime}return h.delay=i,h}setEmptyAnimation(t,n){const e=this.setAnimationWith(t,Pt.emptyAnimation,!1);return e.mixDuration=n,e.trackEnd=n,e}addEmptyAnimation(t,n,e){e<=0&&(e-=n);const i=this.addAnimationWith(t,Pt.emptyAnimation,!1,e);return i.mixDuration=n,i.trackEnd=n,i}setEmptyAnimations(t){const n=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,i=this.tracks.length;e<i;e++){const r=this.tracks[e];r!=null&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=n,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(v.ensureArrayCapacity(this.tracks,t-this.tracks.length+1,null),this.tracks.length=t+1,null)}trackEntry(t,n,e,i){const r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=n,r.loop=e,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=n.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=i==null?0:this.data.getMix(i.animation,n),r}disposeNext(t){let n=t.next;for(;n!=null;)this.queue.dispose(n),n=n.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,n=this.tracks.length;t<n;t++){let e=this.tracks[t];if(e!=null){for(;e.mixingFrom!=null;)e=e.mixingFrom;do(e.mixingFrom==null||e.mixBlend!=A.add)&&this.setTimelineModes(e),e=e.mixingTo;while(e!=null)}}}setTimelineModes(t){const n=t.mixingTo,e=t.animation.timelines,i=t.animation.timelines.length,r=v.setArraySize(t.timelineMode,i);t.timelineHoldMix.length=0;const h=v.setArraySize(t.timelineHoldMix,i),l=this.propertyIDs;if(n!=null&&n.holdPrevious){for(let s=0;s<i;s++)l.add(e[s].getPropertyId()),r[s]=Pt.HOLD;return}t:for(let s=0;s<i;s++){const a=e[s].getPropertyId();if(!l.add(a))r[s]=Pt.SUBSEQUENT;else if(n==null||!this.hasTimeline(n,a))r[s]=Pt.FIRST;else{for(let o=n.mixingTo;o!=null;o=o.mixingTo)if(!this.hasTimeline(o,a)){if(t.mixDuration>0){r[s]=Pt.HOLD_MIX,h[s]=o;continue t}break}r[s]=Pt.HOLD}}}hasTimeline(t,n){const e=t.animation.timelines;for(let i=0,r=e.length;i<r;i++)if(e[i].getPropertyId()==n)return!0;return!1}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(t==null)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const n=this.listeners.indexOf(t);n>=0&&this.listeners.splice(n,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,n,e){Pt.deprecatedWarning1||(Pt.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(t,n,e)}addAnimationByName(t,n,e,i){Pt.deprecatedWarning2||(Pt.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(t,n,e,i)}hasAnimation(t){return this.data.skeletonData.findAnimation(t)!==null}hasAnimationByName(t){return Pt.deprecatedWarning3||(Pt.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(t)}};let Ie=Pt;Ie.emptyAnimation=new Ct("<empty>",[],0),Ie.SUBSEQUENT=0,Ie.FIRST=1,Ie.HOLD=2,Ie.HOLD_MIX=3,Ie.deprecatedWarning1=!1,Ie.deprecatedWarning2=!1,Ie.deprecatedWarning3=!1;const Be=class{constructor(){this.mixBlend=A.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return t==0?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return Be.deprecatedWarning1||(Be.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(t){Be.deprecatedWarning1||(Be.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=t}get endTime(){return Be.deprecatedWarning2||(Be.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(t){Be.deprecatedWarning2||(Be.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let _n=Be;_n.deprecatedWarning1=!1,_n.deprecatedWarning2=!1;const vs=class{constructor(c){this.objects=[],this.drainDisabled=!1,this.animState=c}start(c){this.objects.push(Zt.start),this.objects.push(c),this.animState.animationsChanged=!0}interrupt(c){this.objects.push(Zt.interrupt),this.objects.push(c)}end(c){this.objects.push(Zt.end),this.objects.push(c),this.animState.animationsChanged=!0}dispose(c){this.objects.push(Zt.dispose),this.objects.push(c)}complete(c){this.objects.push(Zt.complete),this.objects.push(c)}event(c,t){this.objects.push(Zt.event),this.objects.push(c),this.objects.push(t)}deprecateStuff(){return vs.deprecatedWarning1||(vs.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: onComplete, onStart, onEnd, onEvent art deprecated, please use listeners from now on. 'state.addListener({ complete: function(track, event) { } })'")),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const c=this.objects,t=this.animState.listeners;for(let n=0;n<c.length;n+=2){const e=c[n],i=c[n+1];switch(e){case Zt.start:i.listener!=null&&i.listener.start&&i.listener.start(i);for(let l=0;l<t.length;l++)t[l].start&&t[l].start(i);i.onStart&&this.deprecateStuff()&&i.onStart(i.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(i.trackIndex);break;case Zt.interrupt:i.listener!=null&&i.listener.interrupt&&i.listener.interrupt(i);for(let l=0;l<t.length;l++)t[l].interrupt&&t[l].interrupt(i);break;case Zt.end:i.listener!=null&&i.listener.end&&i.listener.end(i);for(let l=0;l<t.length;l++)t[l].end&&t[l].end(i);i.onEnd&&this.deprecateStuff()&&i.onEnd(i.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(i.trackIndex);case Zt.dispose:i.listener!=null&&i.listener.dispose&&i.listener.dispose(i);for(let l=0;l<t.length;l++)t[l].dispose&&t[l].dispose(i);this.animState.trackEntryPool.free(i);break;case Zt.complete:i.listener!=null&&i.listener.complete&&i.listener.complete(i);for(let l=0;l<t.length;l++)t[l].complete&&t[l].complete(i);const r=C.toInt(i.loopsCount());i.onComplete&&this.deprecateStuff()&&i.onComplete(i.trackIndex,r),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(i.trackIndex,r);break;case Zt.event:const h=c[n++ +2];i.listener!=null&&i.listener.event&&i.listener.event(i,h);for(let l=0;l<t.length;l++)t[l].event&&t[l].event(i,h);i.onEvent&&this.deprecateStuff()&&i.onEvent(i.trackIndex,h),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(i.trackIndex,h);break}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let Ps=vs;Ps.deprecatedWarning1=!1;var Zt=(c=>(c[c.start=0]="start",c[c.interrupt=1]="interrupt",c[c.end=2]="end",c[c.dispose=3]="dispose",c[c.complete=4]="complete",c[c.event=5]="event",c))(Zt||{});class Dr{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,n){}}const Vs=class{constructor(c){if(this.animationToMixTime={},this.defaultMix=0,c==null)throw new Error("skeletonData cannot be null.");this.skeletonData=c}setMix(c,t,n){const e=this.skeletonData.findAnimation(c);if(e==null)throw new Error(`Animation not found: ${c}`);const i=this.skeletonData.findAnimation(t);if(i==null)throw new Error(`Animation not found: ${t}`);this.setMixWith(e,i,n)}setMixByName(c,t,n){Vs.deprecatedWarning1||(Vs.deprecatedWarning1=!0,console.warn("Deprecation Warning: AnimationStateData.setMixByName is deprecated, please use setMix from now on.")),this.setMix(c,t,n)}setMixWith(c,t,n){if(c==null)throw new Error("from cannot be null.");if(t==null)throw new Error("to cannot be null.");const e=`${c.name}.${t.name}`;this.animationToMixTime[e]=n}getMix(c,t){const n=`${c.name}.${t.name}`,e=this.animationToMixTime[n];return e===void 0?this.defaultMix:e}};let Fs=Vs;Fs.deprecatedWarning1=!1;let Ui=class{constructor(t){this.atlas=t}newRegionAttachment(t,n,e){const i=this.atlas.findRegion(e);if(i==null)throw new Error(`Region not found in atlas: ${e} (region attachment: ${n})`);const r=new K(n);return r.region=i,r}newMeshAttachment(t,n,e){const i=this.atlas.findRegion(e);if(i==null)throw new Error(`Region not found in atlas: ${e} (mesh attachment: ${n})`);const r=new Is(n);return r.region=i,r}newBoundingBoxAttachment(t,n){return new Ni(n)}newPathAttachment(t,n){return new kn(n)}newPointAttachment(t,n){return new Di(n)}newClippingAttachment(t,n){return new Bi(n)}},Ys=class{constructor(t,n,e){if(this.matrix=new H.Matrix,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!0,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=n,this.parent=e,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,n,e,i,r,h,l){this.ax=t,this.ay=n,this.arotation=e,this.ascaleX=i,this.ascaleY=r,this.ashearX=h,this.ashearY=l,this.appliedValid=!0;const s=this.parent,a=this.matrix,o=this.skeleton.scaleX,d=zt.yDown?-this.skeleton.scaleY:this.skeleton.scaleY;if(s==null){const x=this.skeleton,E=e+90+l;a.a=C.cosDeg(e+h)*i*o,a.c=C.cosDeg(E)*r*o,a.b=C.sinDeg(e+h)*i*d,a.d=C.sinDeg(E)*r*d,a.tx=t*o+x.x,a.ty=n*d+x.y;return}let f=s.matrix.a,u=s.matrix.c,m=s.matrix.b,g=s.matrix.d;switch(a.tx=f*t+u*n+s.matrix.tx,a.ty=m*t+g*n+s.matrix.ty,this.data.transformMode){case j.Normal:{const x=e+90+l,E=C.cosDeg(e+h)*i,w=C.cosDeg(x)*r,b=C.sinDeg(e+h)*i,p=C.sinDeg(x)*r;a.a=f*E+u*b,a.c=f*w+u*p,a.b=m*E+g*b,a.d=m*w+g*p;return}case j.OnlyTranslation:{const x=e+90+l;a.a=C.cosDeg(e+h)*i,a.c=C.cosDeg(x)*r,a.b=C.sinDeg(e+h)*i,a.d=C.sinDeg(x)*r;break}case j.NoRotationOrReflection:{let x=f*f+m*m,E=0;x>1e-4?(x=Math.abs(f*g-u*m)/x,u=m*x,g=f*x,E=Math.atan2(m,f)*C.radDeg):(f=0,m=0,E=90-Math.atan2(g,u)*C.radDeg);const w=e+h-E,b=e+l-E+90,p=C.cosDeg(w)*i,S=C.cosDeg(b)*r,y=C.sinDeg(w)*i,M=C.sinDeg(b)*r;a.a=f*p-u*y,a.c=f*S-u*M,a.b=m*p+g*y,a.d=m*S+g*M;break}case j.NoScale:case j.NoScaleOrReflection:{const x=C.cosDeg(e),E=C.sinDeg(e);let w=(f*x+u*E)/o,b=(m*x+g*E)/d,p=Math.sqrt(w*w+b*b);p>1e-5&&(p=1/p),w*=p,b*=p,p=Math.sqrt(w*w+b*b),this.data.transformMode==j.NoScale&&f*g-u*m<0!=(zt.yDown?this.skeleton.scaleX<0!=this.skeleton.scaleY>0:this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(p=-p);const S=Math.PI/2+Math.atan2(b,w),y=Math.cos(S)*p,M=Math.sin(S)*p,T=C.cosDeg(h)*i,k=C.cosDeg(90+l)*r,I=C.sinDeg(h)*i,R=C.sinDeg(90+l)*r;a.a=w*T+y*I,a.c=w*k+y*R,a.b=b*T+M*I,a.d=b*k+M*R;break}}a.a*=o,a.c*=o,a.b*=d,a.d*=d}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*C.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*C.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,n=this.matrix;if(t==null){this.ax=n.tx,this.ay=n.ty,this.arotation=Math.atan2(n.b,n.a)*C.radDeg,this.ascaleX=Math.sqrt(n.a*n.a+n.b*n.b),this.ascaleY=Math.sqrt(n.c*n.c+n.d*n.d),this.ashearX=0,this.ashearY=Math.atan2(n.a*n.c+n.b*n.d,n.a*n.d-n.b*n.c)*C.radDeg;return}const e=t.matrix,i=1/(e.a*e.d-e.b*e.c),r=n.tx-e.tx,h=n.ty-e.ty;this.ax=r*e.d*i-h*e.c*i,this.ay=h*e.a*i-r*e.b*i;const l=i*e.d,s=i*e.a,a=i*e.c,o=i*e.b,d=l*n.a-a*n.b,f=l*n.c-a*n.d,u=s*n.b-o*n.a,m=s*n.d-o*n.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(d*d+u*u),this.ascaleX>1e-4){const g=d*m-f*u;this.ascaleY=g/this.ascaleX,this.ashearY=Math.atan2(d*f+u*m,g)*C.radDeg,this.arotation=Math.atan2(u,d)*C.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,f)*C.radDeg}worldToLocal(t){const n=this.matrix,e=n.a,i=n.c,r=n.b,h=n.d,l=1/(e*h-i*r),s=t.x-n.tx,a=t.y-n.ty;return t.x=s*h*l-a*i*l,t.y=a*e*l-s*r*l,t}localToWorld(t){const n=this.matrix,e=t.x,i=t.y;return t.x=e*n.a+i*n.c+n.tx,t.y=e*n.b+i*n.d+n.ty,t}worldToLocalRotation(t){const n=C.sinDeg(t),e=C.cosDeg(t),i=this.matrix;return Math.atan2(i.a*n-i.b*e,i.d*e-i.c*n)*C.radDeg}localToWorldRotation(t){const n=C.sinDeg(t),e=C.cosDeg(t),i=this.matrix;return Math.atan2(e*i.b+n*i.d,e*i.a+n*i.c)*C.radDeg}rotateWorld(t){const n=this.matrix,e=n.a,i=n.c,r=n.b,h=n.d,l=C.cosDeg(t),s=C.sinDeg(t);n.a=l*e-s*r,n.c=l*i-s*h,n.b=s*e+l*r,n.d=s*i+l*h,this.appliedValid=!1}},zi=class{constructor(t,n,e){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=j.Normal,t<0)throw new Error("index must be >= 0.");if(n==null)throw new Error("name cannot be null.");this.index=t,this.name=n,this.parent=e}},Hi=class{constructor(t,n){if(n==null)throw new Error("data cannot be null.");this.time=t,this.data=n}},Gi=class{constructor(t){this.name=t}},ji=class{constructor(t,n){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let e=0;e<t.bones.length;e++)this.bones.push(n.findBone(t.bones[e].name));this.target=n.findBone(t.target.name)}getOrder(){return this.data.order}apply(){this.update()}update(){const t=this.target,n=this.bones;switch(n.length){case 1:this.apply1(n[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(n[0],n[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.mix);break}}apply1(t,n,e,i,r,h,l){t.appliedValid||t.updateAppliedTransform();const s=t.parent.matrix,a=1/(s.a*s.d-s.b*s.c),o=n-s.tx,d=e-s.ty,f=(o*s.d-d*s.c)*a-t.ax,u=(d*s.a-o*s.b)*a-t.ay;let m=Math.atan2(u,f)*C.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(m+=180),m>180?m-=360:m<-180&&(m+=360);let g=t.ascaleX,x=t.ascaleY;if(i||r){const E=t.data.length*g,w=Math.sqrt(f*f+u*u);if(i&&w<E||r&&w>E&&E>1e-4){const b=(w/E-1)*l+1;g*=b,h&&(x*=b)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+m*l,g,x,t.ashearX,t.ashearY)}apply2(t,n,e,i,r,h,l){if(l==0){n.updateWorldTransform();return}t.appliedValid||t.updateAppliedTransform(),n.appliedValid||n.updateAppliedTransform();const s=t.ax,a=t.ay;let o=t.ascaleX,d=o,f=t.ascaleY,u=n.ascaleX;const m=t.matrix;let g=0,x=0,E=0;o<0?(o=-o,g=180,E=-1):(g=0,E=1),f<0&&(f=-f,E=-E),u<0?(u=-u,x=180):x=0;const w=n.ax;let b=0,p=0,S=0,y=m.a,M=m.c,T=m.b,k=m.d;const I=Math.abs(o-f)<=1e-4;I?(b=n.ay,p=y*w+M*b+m.tx,S=T*w+k*b+m.ty):(b=0,p=y*w+m.tx,S=T*w+m.ty);const R=t.parent.matrix;y=R.a,M=R.c,T=R.b,k=R.d;const V=1/(y*k-M*T);let F=e-R.tx,B=i-R.ty;const Y=(F*k-B*M)*V-s,N=(B*y-F*T)*V-a,q=Y*Y+N*N;F=p-R.tx,B=S-R.ty;const z=(F*k-B*M)*V-s,D=(B*y-F*T)*V-a,X=Math.sqrt(z*z+D*D);let L=n.data.length*u,O=0,W=0;t:if(I){L*=o;let G=(q-X*X-L*L)/(2*X*L);G<-1?G=-1:G>1&&(G=1,h&&X+L>1e-4&&(d*=(Math.sqrt(q)/(X+L)-1)*l+1)),W=Math.acos(G)*r,y=X+L*G,M=L*Math.sin(W),O=Math.atan2(N*y-Y*M,Y*y+N*M)}else{y=o*L,M=f*L;const G=y*y,lt=M*M,It=Math.atan2(N,Y);T=lt*X*X+G*q-G*lt;const ct=-2*lt*X,Xt=lt-G;if(k=ct*ct-4*Xt*T,k>=0){let Kt=Math.sqrt(k);ct<0&&(Kt=-Kt),Kt=-(ct+Kt)/2;const ae=Kt/Xt,Ke=T/Kt,Nt=Math.abs(ae)<Math.abs(Ke)?ae:Ke;if(Nt*Nt<=q){B=Math.sqrt(q-Nt*Nt)*r,O=It-Math.atan2(B,Nt),W=Math.atan2(B/f,(Nt-X)/o);break t}}let Ut=C.PI,de=X-y,Me=de*de,Oe=0,Ve=0,Ae=X+y,Ce=Ae*Ae,$e=0;T=-y*X/(G-lt),T>=-1&&T<=1&&(T=Math.acos(T),F=y*Math.cos(T)+X,B=M*Math.sin(T),k=F*F+B*B,k<Me&&(Ut=T,Me=k,de=F,Oe=B),k>Ce&&(Ve=T,Ce=k,Ae=F,$e=B)),q<=(Me+Ce)/2?(O=It-Math.atan2(Oe*r,de),W=Ut*r):(O=It-Math.atan2($e*r,Ae),W=Ve*r)}const U=Math.atan2(b,w)*E;let $=t.arotation;O=(O-U)*C.radDeg+g-$,O>180?O-=360:O<-180&&(O+=360),t.updateWorldTransformWith(s,a,$+O*l,d,t.ascaleY,0,0),$=n.arotation,W=((W+U)*C.radDeg-n.ashearX)*E+x-$,W>180?W-=360:W<-180&&(W+=360),n.updateWorldTransformWith(w,b,$+W*l,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY)}},Zi=class{constructor(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.name=t}},Qi=class{constructor(t){this.order=0,this.bones=new Array,this.name=t}};var pe=(c=>(c[c.Length=0]="Length",c[c.Fixed=1]="Fixed",c[c.Percent=2]="Percent",c))(pe||{});const rn=class{constructor(t,n){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let e=0,i=t.bones.length;e<i;e++)this.bones.push(n.findBone(t.bones[e].name));this.target=n.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof kn))return;const n=this.rotateMix,e=this.translateMix,i=e>0,r=n>0;if(!i&&!r)return;const h=this.data,l=h.spacingMode,s=l==pe.Length,a=h.rotateMode,o=a==pt.Tangent,d=a==pt.ChainScale,f=this.bones.length,u=o?f:f+1,m=this.bones,g=v.setArraySize(this.spaces,u);let x=null;const E=this.spacing;if(d||s){d&&(x=v.setArraySize(this.lengths,f));for(let M=0,T=u-1;M<T;){const k=m[M],I=k.data.length;if(I<rn.epsilon)d&&(x[M]=0),g[++M]=0;else{const R=I*k.matrix.a,V=I*k.matrix.b,F=Math.sqrt(R*R+V*V);d&&(x[M]=F),g[++M]=(s?I+E:E)*F/I}}}else for(let M=1;M<u;M++)g[M]=E;const w=this.computeWorldPositions(t,u,o,h.positionMode==dt.Percent,l==pe.Percent);let b=w[0],p=w[1],S=h.offsetRotation,y=!1;if(S==0)y=a==pt.Chain;else{y=!1;const M=this.target.bone.matrix;S*=M.a*M.d-M.b*M.c>0?C.degRad:-C.degRad}for(let M=0,T=3;M<f;M++,T+=3){const k=m[M],I=k.matrix;I.tx+=(b-I.tx)*e,I.ty+=(p-I.ty)*e;const R=w[T],V=w[T+1],F=R-b,B=V-p;if(d){const Y=x[M];if(Y!=0){const N=(Math.sqrt(F*F+B*B)/Y-1)*n+1;I.a*=N,I.b*=N}}if(b=R,p=V,r){const Y=I.a,N=I.c,q=I.b,z=I.d;let D=0,X=0,L=0;if(o&&(o?D=w[T-1]:g[M+1]==0?D=w[T+2]:D=Math.atan2(B,F)),D-=Math.atan2(q,Y),y){X=Math.cos(D),L=Math.sin(D);const O=k.data.length;b+=(O*(X*Y-L*q)-F)*n,p+=(O*(L*Y+X*q)-B)*n}else D+=S;D>C.PI?D-=C.PI2:D<-C.PI&&(D+=C.PI2),D*=n,X=Math.cos(D),L=Math.sin(D),I.a=X*Y-L*q,I.c=X*N-L*z,I.b=L*Y+X*q,I.d=L*N+X*z}k.appliedValid=!1}}computeWorldPositions(t,n,e,i,r){const h=this.target;let l=this.position;const s=this.spaces,a=v.setArraySize(this.positions,n*3+2);let o=null;const d=t.closed;let f=t.worldVerticesLength,u=f/6,m=rn.NONE;if(!t.constantSpeed){const D=t.lengths;u-=d?1:2;const X=D[u];if(i&&(l*=X),r)for(let L=0;L<n;L++)s[L]*=X;o=v.setArraySize(this.world,8);for(let L=0,O=0,W=0;L<n;L++,O+=3){const U=s[L];l+=U;let $=l;if(d)$%=X,$<0&&($+=X),W=0;else if($<0){m!=rn.BEFORE&&(m=rn.BEFORE,t.computeWorldVertices(h,2,4,o,0,2)),this.addBeforePosition($,o,0,a,O);continue}else if($>X){m!=rn.AFTER&&(m=rn.AFTER,t.computeWorldVertices(h,f-6,4,o,0,2)),this.addAfterPosition($-X,o,0,a,O);continue}for(;;W++){const G=D[W];if(!($>G)){if(W==0)$/=G;else{const lt=D[W-1];$=($-lt)/(G-lt)}break}}W!=m&&(m=W,d&&W==u?(t.computeWorldVertices(h,f-4,4,o,0,2),t.computeWorldVertices(h,0,4,o,4,2)):t.computeWorldVertices(h,W*6+2,8,o,0,2)),this.addCurvePosition($,o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],a,O,e||L>0&&U==0)}return a}d?(f+=2,o=v.setArraySize(this.world,f),t.computeWorldVertices(h,2,f-4,o,0,2),t.computeWorldVertices(h,0,2,o,f-4,2),o[f-2]=o[0],o[f-1]=o[1]):(u--,f-=4,o=v.setArraySize(this.world,f),t.computeWorldVertices(h,2,f,o,0,2));const g=v.setArraySize(this.curves,u);let x=0,E=o[0],w=o[1],b=0,p=0,S=0,y=0,M=0,T=0,k=0,I=0,R=0,V=0,F=0,B=0,Y=0,N=0;for(let D=0,X=2;D<u;D++,X+=6)b=o[X],p=o[X+1],S=o[X+2],y=o[X+3],M=o[X+4],T=o[X+5],k=(E-b*2+S)*.1875,I=(w-p*2+y)*.1875,R=((b-S)*3-E+M)*.09375,V=((p-y)*3-w+T)*.09375,F=k*2+R,B=I*2+V,Y=(b-E)*.75+k+R*.16666667,N=(p-w)*.75+I+V*.16666667,x+=Math.sqrt(Y*Y+N*N),Y+=F,N+=B,F+=R,B+=V,x+=Math.sqrt(Y*Y+N*N),Y+=F,N+=B,x+=Math.sqrt(Y*Y+N*N),Y+=F+R,N+=B+V,x+=Math.sqrt(Y*Y+N*N),g[D]=x,E=M,w=T;if(i&&(l*=x),r)for(let D=0;D<n;D++)s[D]*=x;const q=this.segments;let z=0;for(let D=0,X=0,L=0,O=0;D<n;D++,X+=3){const W=s[D];l+=W;let U=l;if(d)U%=x,U<0&&(U+=x),L=0;else if(U<0){this.addBeforePosition(U,o,0,a,X);continue}else if(U>x){this.addAfterPosition(U-x,o,f-4,a,X);continue}for(;;L++){const $=g[L];if(!(U>$)){if(L==0)U/=$;else{const G=g[L-1];U=(U-G)/($-G)}break}}if(L!=m){m=L;let $=L*6;for(E=o[$],w=o[$+1],b=o[$+2],p=o[$+3],S=o[$+4],y=o[$+5],M=o[$+6],T=o[$+7],k=(E-b*2+S)*.03,I=(w-p*2+y)*.03,R=((b-S)*3-E+M)*.006,V=((p-y)*3-w+T)*.006,F=k*2+R,B=I*2+V,Y=(b-E)*.3+k+R*.16666667,N=(p-w)*.3+I+V*.16666667,z=Math.sqrt(Y*Y+N*N),q[0]=z,$=1;$<8;$++)Y+=F,N+=B,F+=R,B+=V,z+=Math.sqrt(Y*Y+N*N),q[$]=z;Y+=F,N+=B,z+=Math.sqrt(Y*Y+N*N),q[8]=z,Y+=F+R,N+=B+V,z+=Math.sqrt(Y*Y+N*N),q[9]=z,O=0}for(U*=z;;O++){const $=q[O];if(!(U>$)){if(O==0)U/=$;else{const G=q[O-1];U=O+(U-G)/($-G)}break}}this.addCurvePosition(U*.1,E,w,b,p,S,y,M,T,a,X,e||D>0&&W==0)}return a}addBeforePosition(t,n,e,i,r){const h=n[e],l=n[e+1],s=n[e+2]-h,a=n[e+3]-l,o=Math.atan2(a,s);i[r]=h+t*Math.cos(o),i[r+1]=l+t*Math.sin(o),i[r+2]=o}addAfterPosition(t,n,e,i,r){const h=n[e+2],l=n[e+3],s=h-n[e],a=l-n[e+1],o=Math.atan2(a,s);i[r]=h+t*Math.cos(o),i[r+1]=l+t*Math.sin(o),i[r+2]=o}addCurvePosition(t,n,e,i,r,h,l,s,a,o,d,f){(t==0||isNaN(t))&&(t=1e-4);const u=t*t,m=u*t,g=1-t,x=g*g,E=x*g,w=g*t,b=w*3,p=g*b,S=b*t,y=n*E+i*p+h*S+s*m,M=e*E+r*p+l*S+a*m;o[d]=y,o[d+1]=M,f&&(o[d+2]=Math.atan2(M-(e*x+r*w*2+l*u),y-(n*x+i*w*2+h*u)))}getOrder(){return this.data.order}};let wn=rn;wn.NONE=-1,wn.BEFORE=-2,wn.AFTER=-3,wn.epsilon=1e-5;let Ki=class{constructor(t,n){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new un,t==null)throw new Error("data cannot be null.");if(n==null)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let e=0;e<t.bones.length;e++)this.bones.push(n.findBone(t.bones[e].name));this.target=n.findBone(t.target.name)}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,n=this.translateMix,e=this.scaleMix,i=this.shearMix,r=this.target,h=r.matrix,l=h.a,s=h.c,a=h.b,o=h.d,d=l*o-s*a>0?C.degRad:-C.degRad,f=this.data.offsetRotation*d,u=this.data.offsetShearY*d,m=this.bones;for(let g=0,x=m.length;g<x;g++){const E=m[g];let w=!1;const b=E.matrix;if(t!=0){const p=b.a,S=b.c,y=b.b,M=b.d;let T=Math.atan2(a,l)-Math.atan2(y,p)+f;T>C.PI?T-=C.PI2:T<-C.PI&&(T+=C.PI2),T*=t;const k=Math.cos(T),I=Math.sin(T);b.a=k*p-I*y,b.c=k*S-I*M,b.b=I*p+k*y,b.d=I*S+k*M,w=!0}if(n!=0){const p=this.temp;r.localToWorld(p.set(this.data.offsetX,this.data.offsetY)),b.tx+=(p.x-b.tx)*n,b.ty+=(p.y-b.ty)*n,w=!0}if(e>0){let p=Math.sqrt(b.a*b.a+b.b*b.b),S=Math.sqrt(l*l+a*a);p>1e-5&&(p=(p+(S-p+this.data.offsetScaleX)*e)/p),b.a*=p,b.b*=p,p=Math.sqrt(b.c*b.c+b.d*b.d),S=Math.sqrt(s*s+o*o),p>1e-5&&(p=(p+(S-p+this.data.offsetScaleY)*e)/p),b.c*=p,b.d*=p,w=!0}if(i>0){const p=b.c,S=b.d,y=Math.atan2(S,p);let M=Math.atan2(o,s)-Math.atan2(a,l)-(y-Math.atan2(b.b,b.a));M>C.PI?M-=C.PI2:M<-C.PI&&(M+=C.PI2),M=y+(M+u)*i;const T=Math.sqrt(p*p+S*S);b.c=Math.cos(M)*T,b.d=Math.sin(M)*T,w=!0}w&&(E.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,n=this.translateMix,e=this.scaleMix,i=this.shearMix,r=this.target,h=r.matrix,l=h.a,s=h.c,a=h.b,o=h.d,d=l*o-s*a>0?C.degRad:-C.degRad,f=this.data.offsetRotation*d,u=this.data.offsetShearY*d,m=this.bones;for(let g=0,x=m.length;g<x;g++){const E=m[g];let w=!1;const b=E.matrix;if(t!=0){const p=b.a,S=b.c,y=b.b,M=b.d;let T=Math.atan2(a,l)+f;T>C.PI?T-=C.PI2:T<-C.PI&&(T+=C.PI2),T*=t;const k=Math.cos(T),I=Math.sin(T);b.a=k*p-I*y,b.c=k*S-I*M,b.b=I*p+k*y,b.d=I*S+k*M,w=!0}if(n!=0){const p=this.temp;r.localToWorld(p.set(this.data.offsetX,this.data.offsetY)),b.tx+=p.x*n,b.ty+=p.y*n,w=!0}if(e>0){let p=(Math.sqrt(l*l+a*a)-1+this.data.offsetScaleX)*e+1;b.a*=p,b.b*=p,p=(Math.sqrt(s*s+o*o)-1+this.data.offsetScaleY)*e+1,b.c*=p,b.d*=p,w=!0}if(i>0){let p=Math.atan2(o,s)-Math.atan2(a,l);p>C.PI?p-=C.PI2:p<-C.PI&&(p+=C.PI2);const S=b.c,y=b.d;p=Math.atan2(y,S)+(p-C.PI/2+u)*i;const M=Math.sqrt(S*S+y*y);b.c=Math.cos(p)*M,b.d=Math.sin(p)*M,w=!0}w&&(E.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,n=this.translateMix,e=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();const h=this.bones;for(let l=0,s=h.length;l<s;l++){const a=h[l];a.appliedValid||a.updateAppliedTransform();let o=a.arotation;if(t!=0){let x=r.arotation-o+this.data.offsetRotation;x-=(16384-(16384.499999999996-x/360|0))*360,o+=x*t}let d=a.ax,f=a.ay;n!=0&&(d+=(r.ax-d+this.data.offsetX)*n,f+=(r.ay-f+this.data.offsetY)*n);let u=a.ascaleX,m=a.ascaleY;e>0&&(u>1e-5&&(u=(u+(r.ascaleX-u+this.data.offsetScaleX)*e)/u),m>1e-5&&(m=(m+(r.ascaleY-m+this.data.offsetScaleY)*e)/m));const g=a.ashearY;if(i>0){let x=r.ashearY-g+this.data.offsetShearY;x-=(16384-(16384.499999999996-x/360|0))*360,a.shearY+=x*i}a.updateWorldTransformWith(d,f,o,u,m,a.ashearX,g)}}applyRelativeLocal(){const t=this.rotateMix,n=this.translateMix,e=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();const h=this.bones;for(let l=0,s=h.length;l<s;l++){const a=h[l];a.appliedValid||a.updateAppliedTransform();let o=a.arotation;t!=0&&(o+=(r.arotation+this.data.offsetRotation)*t);let d=a.ax,f=a.ay;n!=0&&(d+=(r.ax+this.data.offsetX)*n,f+=(r.ay+this.data.offsetY)*n);let u=a.ascaleX,m=a.ascaleY;e>0&&(u>1e-5&&(u*=(r.ascaleX-1+this.data.offsetScaleX)*e+1),m>1e-5&&(m*=(r.ascaleY-1+this.data.offsetScaleY)*e+1));let g=a.ashearY;i>0&&(g+=(r.ashearY+this.data.offsetShearY)*i),a.updateWorldTransformWith(d,f,o,u,m,a.ashearX,g)}}getOrder(){return this.data.order}};const In=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,t==null)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let n=0;n<t.bones.length;n++){const e=t.bones[n];let i;if(e.parent==null)i=new Ys(e,this,null);else{const r=this.bones[e.parent.index];i=new Ys(e,this,r),r.children.push(i)}this.bones.push(i)}this.slots=new Array,this.drawOrder=new Array;for(let n=0;n<t.slots.length;n++){const e=t.slots[n],i=this.bones[e.boneData.index],r=new Rs(e,i);this.slots.push(r),this.drawOrder.push(r)}this.ikConstraints=new Array;for(let n=0;n<t.ikConstraints.length;n++){const e=t.ikConstraints[n];this.ikConstraints.push(new ji(e,this))}this.transformConstraints=new Array;for(let n=0;n<t.transformConstraints.length;n++){const e=t.transformConstraints[n];this.transformConstraints.push(new Ki(e,this))}this.pathConstraints=new Array;for(let n=0;n<t.pathConstraints.length;n++){const e=t.pathConstraints[n];this.pathConstraints.push(new wn(e,this))}this.color=new _(1,1,1,1),this.updateCache()}updateCache(){const t=this._updateCache;t.length=0,this.updateCacheReset.length=0;const n=this.bones;for(let o=0,d=n.length;o<d;o++)n[o].sorted=!1;const e=this.ikConstraints,i=this.transformConstraints,r=this.pathConstraints,h=e.length,l=i.length,s=r.length,a=h+l+s;t:for(let o=0;o<a;o++){for(let d=0;d<h;d++){const f=e[d];if(f.data.order==o){this.sortIkConstraint(f);continue t}}for(let d=0;d<l;d++){const f=i[d];if(f.data.order==o){this.sortTransformConstraint(f);continue t}}for(let d=0;d<s;d++){const f=r[d];if(f.data.order==o){this.sortPathConstraint(f);continue t}}}for(let o=0,d=n.length;o<d;o++)this.sortBone(n[o])}sortIkConstraint(t){const n=t.target;this.sortBone(n);const e=t.bones,i=e[0];if(this.sortBone(i),e.length>1){const r=e[e.length-1];this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}this._updateCache.push(t),this.sortReset(i.children),e[e.length-1].sorted=!0}sortPathConstraint(t){const n=t.target,e=n.data.index,i=n.bone;this.skin!=null&&this.sortPathConstraintAttachment(this.skin,e,i),this.data.defaultSkin!=null&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,e,i);for(let s=0,a=this.data.skins.length;s<a;s++)this.sortPathConstraintAttachment(this.data.skins[s],e,i);const r=n.getAttachment();r instanceof kn&&this.sortPathConstraintAttachmentWith(r,i);const h=t.bones,l=h.length;for(let s=0;s<l;s++)this.sortBone(h[s]);this._updateCache.push(t);for(let s=0;s<l;s++)this.sortReset(h[s].children);for(let s=0;s<l;s++)h[s].sorted=!0}sortTransformConstraint(t){this.sortBone(t.target);const n=t.bones,e=n.length;if(t.data.local)for(let i=0;i<e;i++){const r=n[i];this.sortBone(r.parent),this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}else for(let i=0;i<e;i++)this.sortBone(n[i]);this._updateCache.push(t);for(let i=0;i<e;i++)this.sortReset(n[i].children);for(let i=0;i<e;i++)n[i].sorted=!0}sortPathConstraintAttachment(t,n,e){const i=t.attachments[n];if(i)for(const r in i)this.sortPathConstraintAttachmentWith(i[r],e)}sortPathConstraintAttachmentWith(t,n){if(!(t instanceof kn))return;const e=t.bones;if(e==null)this.sortBone(n);else{const i=this.bones;let r=0;for(;r<e.length;){const h=e[r++];for(let l=r+h;r<l;r++){const s=e[r];this.sortBone(i[s])}}}}sortBone(t){if(t.sorted)return;const n=t.parent;n!=null&&this.sortBone(n),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let n=0,e=t.length;n<e;n++){const i=t[n];i.sorted&&this.sortReset(i.children),i.sorted=!1}}updateWorldTransform(){const t=this.updateCacheReset;for(let e=0,i=t.length;e<i;e++){const r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}const n=this._updateCache;for(let e=0,i=n.length;e<i;e++)n[e].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let r=0,h=t.length;r<h;r++)t[r].setToSetupPose();const n=this.ikConstraints;for(let r=0,h=n.length;r<h;r++){const l=n[r];l.bendDirection=l.data.bendDirection,l.mix=l.data.mix}const e=this.transformConstraints;for(let r=0,h=e.length;r<h;r++){const l=e[r],s=l.data;l.rotateMix=s.rotateMix,l.translateMix=s.translateMix,l.scaleMix=s.scaleMix,l.shearMix=s.shearMix}const i=this.pathConstraints;for(let r=0,h=i.length;r<h;r++){const l=i[r],s=l.data;l.position=s.position,l.spacing=s.spacing,l.rotateMix=s.rotateMix,l.translateMix=s.translateMix}}setSlotsToSetupPose(){const t=this.slots;v.arrayCopy(t,0,this.drawOrder,0,t.length);for(let n=0,e=t.length;n<e;n++)t[n].setToSetupPose()}getRootBone(){return this.bones.length==0?null:this.bones[0]}findBone(t){if(t==null)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}findBoneIndex(t){if(t==null)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++)if(n[e].data.name==t)return e;return-1}findSlot(t){if(t==null)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}findSlotIndex(t){if(t==null)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++)if(n[e].data.name==t)return e;return-1}setSkinByName(t){const n=this.data.findSkin(t);if(n==null)throw new Error(`Skin not found: ${t}`);this.setSkin(n)}setSkin(t){if(t!=null)if(this.skin!=null)t.attachAll(this,this.skin);else{const n=this.slots;for(let e=0,i=n.length;e<i;e++){const r=n[e],h=r.data.attachmentName;if(h!=null){const l=t.getAttachment(e,h);l!=null&&r.setAttachment(l)}}}this.skin=t}getAttachmentByName(t,n){return this.getAttachment(this.data.findSlotIndex(t),n)}getAttachment(t,n){if(n==null)throw new Error("attachmentName cannot be null.");if(this.skin!=null){const e=this.skin.getAttachment(t,n);if(e!=null)return e}return this.data.defaultSkin!=null?this.data.defaultSkin.getAttachment(t,n):null}setAttachment(t,n){if(t==null)throw new Error("slotName cannot be null.");const e=this.slots;for(let i=0,r=e.length;i<r;i++){const h=e[i];if(h.data.name==t){let l=null;if(n!=null&&(l=this.getAttachment(i,n),l==null))throw new Error(`Attachment not found: ${n}, for slot: ${t}`);h.setAttachment(l);return}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.ikConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.transformConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}findPathConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.pathConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==t)return r}return null}getBounds(t,n,e){if(t==null)throw new Error("offset cannot be null.");if(n==null)throw new Error("size cannot be null.");const i=this.drawOrder;let r=Number.POSITIVE_INFINITY,h=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let a=0,o=i.length;a<o;a++){const d=i[a];let f=0,u=null;const m=d.getAttachment();if(m instanceof K)f=8,u=v.setArraySize(e,f,0),m.computeWorldVertices(d.bone,u,0,2);else if(m instanceof Is){const g=m;f=g.worldVerticesLength,u=v.setArraySize(e,f,0),g.computeWorldVertices(d,0,f,u,0,2)}if(u!=null)for(let g=0,x=u.length;g<x;g+=2){const E=u[g],w=u[g+1];r=Math.min(r,E),h=Math.min(h,w),l=Math.max(l,E),s=Math.max(s,w)}}t.set(r,h),n.set(l-r,s-h)}update(t){this.time+=t}get flipX(){return this.scaleX==-1}set flipX(t){In.deprecatedWarning1||(In.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=t?1:-1}get flipY(){return this.scaleY==-1}set flipY(t){In.deprecatedWarning1||(In.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=t?1:-1}};let Xs=In;Xs.deprecatedWarning1=!1;let Lr=class extends Cn{},Ji=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(t==null)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findBoneIndex(t){if(t==null)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}findSlot(t){if(t==null)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findSlotIndex(t){if(t==null)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}findSkin(t){if(t==null)throw new Error("skinName cannot be null.");const n=this.skins;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findEvent(t){if(t==null)throw new Error("eventDataName cannot be null.");const n=this.events;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findAnimation(t){if(t==null)throw new Error("animationName cannot be null.");const n=this.animations;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findIkConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.ikConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findTransformConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.transformConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findPathConstraint(t){if(t==null)throw new Error("constraintName cannot be null.");const n=this.pathConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(t==null)throw new Error("pathConstraintName cannot be null.");const n=this.pathConstraints;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}},tr=class{constructor(t,n,e){if(this.color=new _(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(n==null)throw new Error("name cannot be null.");if(e==null)throw new Error("boneData cannot be null.");this.index=t,this.name=n,this.boneData=e}},er=class{constructor(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1,t==null)throw new Error("name cannot be null.");this.name=t}},nr=class{constructor(t){if(this.attachments=new Array,t==null)throw new Error("name cannot be null.");this.name=t}addAttachment(t,n,e){if(e==null)throw new Error("attachment cannot be null.");const i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][n]=e}getAttachment(t,n){const e=this.attachments[t];return e?e[n]:null}attachAll(t,n){let e=0;for(let i=0;i<t.slots.length;i++){const r=t.slots[i],h=r.getAttachment();if(h&&e<n.attachments.length){const l=n.attachments[e];for(const s in l){const a=l[s];if(h==a){const o=this.getAttachment(e,s);o!=null&&r.setAttachment(o);break}}}e++}}},an=class{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const n=this.scale,e=new Ji,i=typeof t=="string"?JSON.parse(t):t,r=i.skeleton;if(r!=null&&(e.hash=r.hash,e.version=r.spine,e.width=r.width,e.height=r.height,e.fps=r.fps,e.imagesPath=r.images),i.bones)for(let h=0;h<i.bones.length;h++){const l=i.bones[h];let s=null;const a=this.getValue(l,"parent",null);if(a!=null&&(s=e.findBone(a),s==null))throw new Error(`Parent bone not found: ${a}`);const o=new zi(e.bones.length,l.name,s);o.length=this.getValue(l,"length",0)*n,o.x=this.getValue(l,"x",0)*n,o.y=this.getValue(l,"y",0)*n,o.rotation=this.getValue(l,"rotation",0),o.scaleX=this.getValue(l,"scaleX",1),o.scaleY=this.getValue(l,"scaleY",1),o.shearX=this.getValue(l,"shearX",0),o.shearY=this.getValue(l,"shearY",0),o.transformMode=an.transformModeFromString(this.getValue(l,"transform","normal")),e.bones.push(o)}if(i.slots)for(let h=0;h<i.slots.length;h++){const l=i.slots[h],s=l.name,a=l.bone,o=e.findBone(a);if(o==null)throw new Error(`Slot bone not found: ${a}`);const d=new tr(e.slots.length,s,o),f=this.getValue(l,"color",null);f!=null&&d.color.setFromString(f);const u=this.getValue(l,"dark",null);u!=null&&(d.darkColor=new _(1,1,1,1),d.darkColor.setFromString(u)),d.attachmentName=this.getValue(l,"attachment",null),d.blendMode=an.blendModeFromString(this.getValue(l,"blend","normal")),e.slots.push(d)}if(i.ik)for(let h=0;h<i.ik.length;h++){const l=i.ik[h],s=new Zi(l.name);s.order=this.getValue(l,"order",0);for(let o=0;o<l.bones.length;o++){const d=l.bones[o],f=e.findBone(d);if(f==null)throw new Error(`IK bone not found: ${d}`);s.bones.push(f)}const a=l.target;if(s.target=e.findBone(a),s.target==null)throw new Error(`IK target bone not found: ${a}`);s.bendDirection=this.getValue(l,"bendPositive",!0)?1:-1,s.mix=this.getValue(l,"mix",1),e.ikConstraints.push(s)}if(i.transform)for(let h=0;h<i.transform.length;h++){const l=i.transform[h],s=new er(l.name);s.order=this.getValue(l,"order",0);for(let o=0;o<l.bones.length;o++){const d=l.bones[o],f=e.findBone(d);if(f==null)throw new Error(`Transform constraint bone not found: ${d}`);s.bones.push(f)}const a=l.target;if(s.target=e.findBone(a),s.target==null)throw new Error(`Transform constraint target bone not found: ${a}`);s.local=this.getValue(l,"local",!1),s.relative=this.getValue(l,"relative",!1),s.offsetRotation=this.getValue(l,"rotation",0),s.offsetX=this.getValue(l,"x",0)*n,s.offsetY=this.getValue(l,"y",0)*n,s.offsetScaleX=this.getValue(l,"scaleX",0),s.offsetScaleY=this.getValue(l,"scaleY",0),s.offsetShearY=this.getValue(l,"shearY",0),s.rotateMix=this.getValue(l,"rotateMix",1),s.translateMix=this.getValue(l,"translateMix",1),s.scaleMix=this.getValue(l,"scaleMix",1),s.shearMix=this.getValue(l,"shearMix",1),e.transformConstraints.push(s)}if(i.path)for(let h=0;h<i.path.length;h++){const l=i.path[h],s=new Qi(l.name);s.order=this.getValue(l,"order",0);for(let o=0;o<l.bones.length;o++){const d=l.bones[o],f=e.findBone(d);if(f==null)throw new Error(`Transform constraint bone not found: ${d}`);s.bones.push(f)}const a=l.target;if(s.target=e.findSlot(a),s.target==null)throw new Error(`Path target slot not found: ${a}`);s.positionMode=an.positionModeFromString(this.getValue(l,"positionMode","percent")),s.spacingMode=an.spacingModeFromString(this.getValue(l,"spacingMode","length")),s.rotateMode=an.rotateModeFromString(this.getValue(l,"rotateMode","tangent")),s.offsetRotation=this.getValue(l,"rotation",0),s.position=this.getValue(l,"position",0),s.positionMode==dt.Fixed&&(s.position*=n),s.spacing=this.getValue(l,"spacing",0),(s.spacingMode==pe.Length||s.spacingMode==pe.Fixed)&&(s.spacing*=n),s.rotateMix=this.getValue(l,"rotateMix",1),s.translateMix=this.getValue(l,"translateMix",1),e.pathConstraints.push(s)}if(i.skins)for(const h in i.skins){const l=i.skins[h],s=new nr(h);for(const a in l){const o=e.findSlotIndex(a);if(o==-1)throw new Error(`Slot not found: ${a}`);const d=l[a];for(const f in d){const u=this.readAttachment(d[f],s,o,f,e);u!=null&&s.addAttachment(o,f,u)}}e.skins.push(s),s.name=="default"&&(e.defaultSkin=s)}for(let h=0,l=this.linkedMeshes.length;h<l;h++){const s=this.linkedMeshes[h],a=s.skin==null?e.defaultSkin:e.findSkin(s.skin);if(a==null)throw new Error(`Skin not found: ${s.skin}`);const o=a.getAttachment(s.slotIndex,s.parent);if(o==null)throw new Error(`Parent mesh not found: ${s.parent}`);s.mesh.setParentMesh(o)}if(this.linkedMeshes.length=0,i.events)for(const h in i.events){const l=i.events[h],s=new Gi(h);s.intValue=this.getValue(l,"int",0),s.floatValue=this.getValue(l,"float",0),s.stringValue=this.getValue(l,"string",""),s.audioPath=this.getValue(l,"audio",null),s.audioPath!=null&&(s.volume=this.getValue(l,"volume",1),s.balance=this.getValue(l,"balance",0)),e.events.push(s)}if(i.animations)for(const h in i.animations){const l=i.animations[h];this.readAnimation(l,h,e)}return e}readAttachment(t,n,e,i,r){const h=this.scale;switch(i=this.getValue(t,"name",i),this.getValue(t,"type","region")){case"region":{const s=this.getValue(t,"path",i),a=this.attachmentLoader.newRegionAttachment(n,i,s);if(a==null)return null;a.path=s,a.x=this.getValue(t,"x",0)*h,a.y=this.getValue(t,"y",0)*h,a.scaleX=this.getValue(t,"scaleX",1),a.scaleY=this.getValue(t,"scaleY",1),a.rotation=this.getValue(t,"rotation",0),a.width=t.width*h,a.height=t.height*h;const o=this.getValue(t,"color",null);return o!=null&&a.color.setFromString(o),a}case"boundingbox":{const s=this.attachmentLoader.newBoundingBoxAttachment(n,i);if(s==null)return null;this.readVertices(t,s,t.vertexCount<<1);const a=this.getValue(t,"color",null);return a!=null&&s.color.setFromString(a),s}case"mesh":case"linkedmesh":{const s=this.getValue(t,"path",i),a=this.attachmentLoader.newMeshAttachment(n,i,s);if(a==null)return null;a.path=s;const o=this.getValue(t,"color",null);o!=null&&a.color.setFromString(o);const d=this.getValue(t,"parent",null);if(d!=null)return a.inheritDeform=this.getValue(t,"deform",!0),this.linkedMeshes.push(new _r(a,this.getValue(t,"skin",null),e,d)),a;const f=t.uvs;return this.readVertices(t,a,f.length),a.triangles=t.triangles,a.regionUVs=new Float32Array(f),a.hullLength=this.getValue(t,"hull",0)*2,a}case"path":{const s=this.attachmentLoader.newPathAttachment(n,i);if(s==null)return null;s.closed=this.getValue(t,"closed",!1),s.constantSpeed=this.getValue(t,"constantSpeed",!0);const a=t.vertexCount;this.readVertices(t,s,a<<1);const o=v.newArray(a/3,0);for(let f=0;f<t.lengths.length;f++)o[f]=t.lengths[f]*h;s.lengths=o;const d=this.getValue(t,"color",null);return d!=null&&s.color.setFromString(d),s}case"point":{const s=this.attachmentLoader.newPointAttachment(n,i);if(s==null)return null;s.x=this.getValue(t,"x",0)*h,s.y=this.getValue(t,"y",0)*h,s.rotation=this.getValue(t,"rotation",0);const a=this.getValue(t,"color",null);return a!=null&&s.color.setFromString(a),s}case"clipping":{const s=this.attachmentLoader.newClippingAttachment(n,i);if(s==null)return null;const a=this.getValue(t,"end",null);if(a!=null){const f=r.findSlot(a);if(f==null)throw new Error(`Clipping end slot not found: ${a}`);s.endSlot=f}const o=t.vertexCount;this.readVertices(t,s,o<<1);const d=this.getValue(t,"color",null);return d!=null&&s.color.setFromString(d),s}}return null}readVertices(t,n,e){const i=this.scale;n.worldVerticesLength=e;const r=t.vertices;if(e==r.length){const s=v.toFloatArray(r);if(i!=1)for(let a=0,o=r.length;a<o;a++)s[a]*=i;n.vertices=s;return}const h=new Array,l=new Array;for(let s=0,a=r.length;s<a;){const o=r[s++];l.push(o);for(let d=s+o*4;s<d;s+=4)l.push(r[s]),h.push(r[s+1]*i),h.push(r[s+2]*i),h.push(r[s+3])}n.bones=l,n.vertices=v.toFloatArray(h)}readAnimation(t,n,e){const i=this.scale,r=new Array;let h=0;if(t.slots)for(const s in t.slots){const a=t.slots[s],o=e.findSlotIndex(s);if(o==-1)throw new Error(`Slot not found: ${s}`);for(const d in a){const f=a[d];if(d=="attachment"){const u=new Dn(f.length);u.slotIndex=o;let m=0;for(let g=0;g<f.length;g++){const x=f[g];u.setFrame(m++,x.time,x.name)}r.push(u),h=Math.max(h,u.frames[u.getFrameCount()-1])}else if(d=="color"){const u=new se(f.length);u.slotIndex=o;let m=0;for(let g=0;g<f.length;g++){const x=f[g],E=new _;E.setFromString(x.color||"ffffffff"),u.setFrame(m,x.time,E.r,E.g,E.b,E.a),this.readCurve(x,u,m),m++}r.push(u),h=Math.max(h,u.frames[(u.getFrameCount()-1)*se.ENTRIES])}else if(d=="twoColor"){const u=new Tt(f.length);u.slotIndex=o;let m=0;for(let g=0;g<f.length;g++){const x=f[g],E=new _,w=new _;E.setFromString(x.light),w.setFromString(x.dark),u.setFrame(m,x.time,E.r,E.g,E.b,E.a,w.r,w.g,w.b),this.readCurve(x,u,m),m++}r.push(u),h=Math.max(h,u.frames[(u.getFrameCount()-1)*Tt.ENTRIES])}else throw new Error(`Invalid timeline type for a slot: ${d} (${s})`)}}if(t.bones)for(const s in t.bones){const a=t.bones[s],o=e.findBoneIndex(s);if(o==-1)throw new Error(`Bone not found: ${s}`);for(const d in a){const f=a[d];if(d==="rotate"){const u=new $t(f.length);u.boneIndex=o;let m=0;for(let g=0;g<f.length;g++){const x=f[g];u.setFrame(m,x.time,x.angle),this.readCurve(x,u,m),m++}r.push(u),h=Math.max(h,u.frames[(u.getFrameCount()-1)*$t.ENTRIES])}else if(d==="translate"||d==="scale"||d==="shear"){let u=null,m=1;d==="scale"?u=new le(f.length):d==="shear"?u=new ce(f.length):(u=new ge(f.length),m=i),u.boneIndex=o;let g=0;for(let x=0;x<f.length;x++){const E=f[x],w=this.getValue(E,"x",0),b=this.getValue(E,"y",0);u.setFrame(g,E.time,w*m,b*m),this.readCurve(E,u,g),g++}r.push(u),h=Math.max(h,u.frames[(u.getFrameCount()-1)*ge.ENTRIES])}else throw new Error(`Invalid timeline type for a bone: ${d} (${s})`)}}if(t.ik)for(const s in t.ik){const a=t.ik[s],o=e.findIkConstraint(s),d=new ie(a.length);d.ikConstraintIndex=e.ikConstraints.indexOf(o);let f=0;for(let u=0;u<a.length;u++){const m=a[u];d.setFrame(f,m.time,this.getValue(m,"mix",1),this.getValue(m,"bendPositive",!0)?1:-1,this.getValue(m,"compress",!1),this.getValue(m,"stretch",!1)),this.readCurve(m,d,f),f++}r.push(d),h=Math.max(h,d.frames[(d.getFrameCount()-1)*ie.ENTRIES])}if(t.transform)for(const s in t.transform){const a=t.transform[s],o=e.findTransformConstraint(s),d=new re(a.length);d.transformConstraintIndex=e.transformConstraints.indexOf(o);let f=0;for(let u=0;u<a.length;u++){const m=a[u];d.setFrame(f,m.time,this.getValue(m,"rotateMix",1),this.getValue(m,"translateMix",1),this.getValue(m,"scaleMix",1),this.getValue(m,"shearMix",1)),this.readCurve(m,d,f),f++}r.push(d),h=Math.max(h,d.frames[(d.getFrameCount()-1)*re.ENTRIES])}if(t.paths)for(const s in t.paths){const a=t.paths[s],o=e.findPathConstraintIndex(s);if(o==-1)throw new Error(`Path constraint not found: ${s}`);const d=e.pathConstraints[o];for(const f in a){const u=a[f];if(f==="position"||f==="spacing"){let m=null,g=1;f==="spacing"?(m=new Xe(u.length),(d.spacingMode==pe.Length||d.spacingMode==pe.Fixed)&&(g=i)):(m=new Ze(u.length),d.positionMode==dt.Fixed&&(g=i)),m.pathConstraintIndex=o;let x=0;for(let E=0;E<u.length;E++){const w=u[E];m.setFrame(x,w.time,this.getValue(w,f,0)*g),this.readCurve(w,m,x),x++}r.push(m),h=Math.max(h,m.frames[(m.getFrameCount()-1)*Ze.ENTRIES])}else if(f==="mix"){const m=new Ne(u.length);m.pathConstraintIndex=o;let g=0;for(let x=0;x<u.length;x++){const E=u[x];m.setFrame(g,E.time,this.getValue(E,"rotateMix",1),this.getValue(E,"translateMix",1)),this.readCurve(E,m,g),g++}r.push(m),h=Math.max(h,m.frames[(m.getFrameCount()-1)*Ne.ENTRIES])}}}if(t.deform)for(const s in t.deform){const a=t.deform[s],o=e.findSkin(s);if(o==null){if(zt.FAIL_ON_NON_EXISTING_SKIN)throw new Error(`Skin not found: ${s}`);continue}for(const d in a){const f=a[d],u=e.findSlotIndex(d);if(u==-1)throw new Error(`Slot not found: ${f.name}`);for(const m in f){const g=f[m],x=o.getAttachment(u,m);if(x==null)throw new Error(`Deform attachment not found: ${g.name}`);const E=x.bones!=null,w=x.vertices,b=E?w.length/3*2:w.length,p=new Wi(g.length);p.slotIndex=u,p.attachment=x;let S=0;for(let y=0;y<g.length;y++){const M=g[y];let T;const k=this.getValue(M,"vertices",null);if(k==null)T=E?v.newFloatArray(b):w;else{T=v.newFloatArray(b);const I=this.getValue(M,"offset",0);if(v.arrayCopy(k,0,T,I,k.length),i!=1)for(let R=I,V=R+k.length;R<V;R++)T[R]*=i;if(!E)for(let R=0;R<b;R++)T[R]+=w[R]}p.setFrame(S,M.time,T),this.readCurve(M,p,S),S++}r.push(p),h=Math.max(h,p.frames[p.getFrameCount()-1])}}}let l=t.drawOrder;if(l==null&&(l=t.draworder),l!=null){const s=new Ln(l.length),a=e.slots.length;let o=0;for(let d=0;d<l.length;d++){const f=l[d];let u=null;const m=this.getValue(f,"offsets",null);if(m!=null){u=v.newArray(a,-1);const g=v.newArray(a-m.length,0);let x=0,E=0;for(let w=0;w<m.length;w++){const b=m[w],p=e.findSlotIndex(b.slot);if(p==-1)throw new Error(`Slot not found: ${b.slot}`);for(;x!=p;)g[E++]=x++;u[x+b.offset]=x++}for(;x<a;)g[E++]=x++;for(let w=a-1;w>=0;w--)u[w]==-1&&(u[w]=g[--E])}s.setFrame(o++,f.time,u)}r.push(s),h=Math.max(h,s.frames[s.getFrameCount()-1])}if(t.events){const s=new qi(t.events.length);let a=0;for(let o=0;o<t.events.length;o++){const d=t.events[o],f=e.findEvent(d.name);if(f==null)throw new Error(`Event not found: ${d.name}`);const u=new Hi(v.toSinglePrecision(d.time),f);u.intValue=this.getValue(d,"int",f.intValue),u.floatValue=this.getValue(d,"float",f.floatValue),u.stringValue=this.getValue(d,"string",f.stringValue),u.data.audioPath!=null&&(u.volume=this.getValue(d,"volume",1),u.balance=this.getValue(d,"balance",0)),s.setFrame(a++,u)}r.push(s),h=Math.max(h,s.frames[s.getFrameCount()-1])}if(isNaN(h))throw new Error("Error while parsing animation, duration is NaN");e.animations.push(new Ct(n,r,h))}readCurve(t,n,e){if(t.curve){if(t.curve==="stepped")n.setStepped(e);else if(Object.prototype.toString.call(t.curve)==="[object Array]"){const i=t.curve;n.setCurve(e,i[0],i[1],i[2],i[3])}}}getValue(t,n,e){return t[n]!==void 0?t[n]:e}static blendModeFromString(t){if(t=t.toLowerCase(),t=="normal")return H.BLEND_MODES.NORMAL;if(t=="additive")return H.BLEND_MODES.ADD;if(t=="multiply")return H.BLEND_MODES.MULTIPLY;if(t=="screen")return H.BLEND_MODES.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if(t=t.toLowerCase(),t=="fixed")return dt.Fixed;if(t=="percent")return dt.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if(t=t.toLowerCase(),t=="length")return pe.Length;if(t=="fixed")return pe.Fixed;if(t=="percent")return pe.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if(t=t.toLowerCase(),t=="tangent")return pt.Tangent;if(t=="chain")return pt.Chain;if(t=="chainscale")return pt.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if(t=t.toLowerCase(),t=="normal")return j.Normal;if(t=="onlytranslation")return j.OnlyTranslation;if(t=="norotationorreflection")return j.NoRotationOrReflection;if(t=="noscale")return j.NoScale;if(t=="noscaleorreflection")return j.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},_r=class{constructor(t,n,e,i){this.mesh=t,this.skin=n,this.slotIndex=e,this.parent=i}};var Or=Object.freeze({__proto__:null,Animation:Ct,AnimationState:Ie,AnimationStateAdapter2:Dr,AnimationStateData:Fs,AtlasAttachmentLoader:Ui,Attachment:ks,AttachmentTimeline:Dn,Bone:Ys,BoneData:zi,BoundingBoxAttachment:Ni,ClippingAttachment:Bi,ColorTimeline:se,CurveTimeline:jt,DeformTimeline:Wi,DrawOrderTimeline:Ln,Event:Hi,EventData:Gi,EventQueue:Ps,EventTimeline:qi,EventType:Zt,IkConstraint:ji,IkConstraintData:Zi,IkConstraintTimeline:ie,JitterEffect:Br,MeshAttachment:Is,PathAttachment:kn,PathConstraint:wn,PathConstraintData:Qi,PathConstraintMixTimeline:Ne,PathConstraintPositionTimeline:Ze,PathConstraintSpacingTimeline:Xe,PointAttachment:Di,RegionAttachment:K,RotateTimeline:$t,ScaleTimeline:le,ShearTimeline:ce,Skeleton:Xs,SkeletonBounds:Lr,SkeletonData:Ji,SkeletonJson:an,Skin:nr,Slot:Rs,SlotData:tr,SpacingMode:pe,Spine:class extends tn{createSkeleton(t){this.skeleton=new Xs(t),this.skeleton.updateWorldTransform(),this.stateData=new Fs(t),this.state=new Ie(this.stateData)}},SwirlEffect:_i,TimelineType:Oi,TrackEntry:_n,TransformConstraint:Ki,TransformConstraintData:er,TransformConstraintTimeline:re,TranslateTimeline:ge,TwoColorTimeline:Tt,VertexAttachment:Ge});class Ns{constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}const sr=class extends Ns{constructor(c){super(c),this.id=sr.nextID++,this.bones=null,this.vertices=[],this.worldVerticesLength=0,this.timelineAttachment=this}computeWorldVerticesOld(c,t){this.computeWorldVertices(c,0,this.worldVerticesLength,t,0,2)}computeWorldVertices(c,t,n,e,i,r){n=i+(n>>1)*r;const h=c.bone.skeleton,l=c.deform;let s=this.vertices;const a=this.bones;if(!a){l.length>0&&(s=l);const u=c.bone.matrix,m=u.tx,g=u.ty,x=u.a,E=u.c,w=u.b,b=u.d;for(let p=t,S=i;S<n;p+=2,S+=r){const y=s[p],M=s[p+1];e[S]=y*x+M*E+m,e[S+1]=y*w+M*b+g}return}let o=0,d=0;for(let u=0;u<t;u+=2){const m=a[o];o+=m+1,d+=m}const f=h.bones;if(l.length==0)for(let u=i,m=d*3;u<n;u+=r){let g=0,x=0,E=a[o++];for(E+=o;o<E;o++,m+=3){const w=f[a[o]].matrix,b=s[m],p=s[m+1],S=s[m+2];g+=(b*w.a+p*w.c+w.tx)*S,x+=(b*w.b+p*w.d+w.ty)*S}e[u]=g,e[u+1]=x}else{const u=l;for(let m=i,g=d*3,x=d<<1;m<n;m+=r){let E=0,w=0,b=a[o++];for(b+=o;o<b;o++,g+=3,x+=2){const p=f[a[o]].matrix,S=s[g]+u[x],y=s[g+1]+u[x+1],M=s[g+2];E+=(S*p.a+y*p.c+p.tx)*M,w+=(S*p.b+y*p.d+p.ty)*M}e[m]=E,e[m+1]=w}}}copyTo(c){this.bones?(c.bones=new Array(this.bones.length),v.arrayCopy(this.bones,0,c.bones,0,this.bones.length)):c.bones=null,this.vertices&&(c.vertices=v.newFloatArray(this.vertices.length),v.arrayCopy(this.vertices,0,c.vertices,0,this.vertices.length)),c.worldVerticesLength=this.worldVerticesLength,c.timelineAttachment=this.timelineAttachment}};let we=sr;we.nextID=0;class On extends we{constructor(t){super(t),this.type=Z.BoundingBox,this.color=new _(1,1,1,1)}copy(){const t=new On(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class $n extends we{constructor(t){super(t),this.type=Z.Clipping,this.endSlot=null,this.color=new _(.2275,.2275,.8078,1)}copy(){const t=new $n(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class on extends we{constructor(t,n){super(t),this.type=Z.Mesh,this.region=null,this.triangles=[],this.color=new _(1,1,1,1),this.width=0,this.height=0,this.hullLength=0,this.edges=[],this.parentMesh=null,this.sequence=null,this.tempColor=new _(0,0,0,0),this.path=n}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();const t=new on(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),v.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),v.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=this.sequence!=null?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),v.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,n,e,i,r,h){this.sequence!=null&&this.sequence.apply(t,this),super.computeWorldVertices(t,n,e,i,r,h)}newLinkedMesh(){const t=new on(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t}}class ln extends we{constructor(t){super(t),this.type=Z.Path,this.lengths=[],this.closed=!1,this.constantSpeed=!1,this.color=new _(1,1,1,1)}copy(){const t=new ln(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),v.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class Wn extends we{constructor(t){super(t),this.type=Z.Point,this.x=0,this.y=0,this.rotation=0,this.color=new _(.38,.94,0,1)}computeWorldPosition(t,n){const e=t.matrix;return n.x=this.x*e.a+this.y*e.c+t.worldX,n.y=this.x*e.b+this.y*e.d+t.worldY,n}computeWorldRotation(t){const n=t.matrix,e=C.cosDeg(this.rotation),i=C.sinDeg(this.rotation),r=e*n.a+i*n.c,h=e*n.b+i*n.d;return Math.atan2(h,r)*C.radDeg}copy(){const t=new Wn(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}const ir=class extends Ns{constructor(c,t){super(c),this.type=Z.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new _(1,1,1,1),this.rendererObject=null,this.region=null,this.sequence=null,this.offset=v.newFloatArray(8),this.uvs=v.newFloatArray(8),this.tempColor=new _(1,1,1,1),this.path=t}updateRegion(){if(!this.region)throw new Error("Region not set.");const c=this.region,t=this.width/this.region.originalWidth*this.scaleX,n=this.height/this.region.originalHeight*this.scaleY,e=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*n,r=e+this.region.width*t,h=i+this.region.height*n,l=this.rotation*Math.PI/180,s=Math.cos(l),a=Math.sin(l),o=this.x,d=this.y,f=e*s+o,u=e*a,m=i*s+d,g=i*a,x=r*s+o,E=r*a,w=h*s+d,b=h*a,p=this.offset;p[0]=f-g,p[1]=m+u,p[2]=f-b,p[3]=w+u,p[4]=x-b,p[5]=w+E,p[6]=x-g,p[7]=m+E;const S=this.uvs;c.degrees==90?(S[2]=c.u,S[3]=c.v2,S[4]=c.u,S[5]=c.v,S[6]=c.u2,S[7]=c.v,S[0]=c.u2,S[1]=c.v2):(S[0]=c.u,S[1]=c.v2,S[2]=c.u,S[3]=c.v,S[4]=c.u2,S[5]=c.v,S[6]=c.u2,S[7]=c.v2)}computeWorldVertices(c,t,n,e){this.sequence!=null&&this.sequence.apply(c,this);const i=c.bone,r=this.offset,h=i.matrix,l=h.tx,s=h.ty,a=h.a,o=h.c,d=h.b,f=h.d;let u=0,m=0;u=r[0],m=r[1],t[n]=u*a+m*o+l,t[n+1]=u*d+m*f+s,n+=e,u=r[2],m=r[3],t[n]=u*a+m*o+l,t[n+1]=u*d+m*f+s,n+=e,u=r[4],m=r[5],t[n]=u*a+m*o+l,t[n+1]=u*d+m*f+s,n+=e,u=r[6],m=r[7],t[n]=u*a+m*o+l,t[n+1]=u*d+m*f+s}copy(){const c=new ir(this.name,this.path);return c.region=this.region,c.rendererObject=this.rendererObject,c.x=this.x,c.y=this.y,c.scaleX=this.scaleX,c.scaleY=this.scaleY,c.rotation=this.rotation,c.width=this.width,c.height=this.height,v.arrayCopy(this.uvs,0,c.uvs,0,8),v.arrayCopy(this.offset,0,c.offset,0,8),c.color.setFromColor(this.color),c.sequence=this.sequence!=null?this.sequence.copy():null,c}};let it=ir;it.X1=0,it.Y1=1,it.C1R=2,it.C1G=3,it.C1B=4,it.C1A=5,it.U1=6,it.V1=7,it.X2=8,it.Y2=9,it.C2R=10,it.C2G=11,it.C2B=12,it.C2A=13,it.U2=14,it.V2=15,it.X3=16,it.Y3=17,it.C3R=18,it.C3G=19,it.C3B=20,it.C3A=21,it.U3=22,it.V3=23,it.X4=24,it.Y4=25,it.C4R=26,it.C4G=27,it.C4B=28,it.C4A=29,it.U4=30,it.V4=31;const qn=class{constructor(c){this.id=qn.nextID(),this.start=0,this.digits=0,this.setupIndex=0,this.regions=new Array(c)}copy(){const c=new qn(this.regions.length);return v.arrayCopy(this.regions,0,c.regions,0,this.regions.length),c.start=this.start,c.digits=this.digits,c.setupIndex=this.setupIndex,c}apply(c,t){let n=c.sequenceIndex;n==-1&&(n=this.setupIndex),n>=this.regions.length&&(n=this.regions.length-1);const e=this.regions[n];t.region!=e&&(t.region=e)}getPath(c,t){let n=c;const e=(this.start+t).toString();for(let i=this.digits-e.length;i>0;i--)n+="0";return n+=e,n}static nextID(){return qn._nextID++}};let Un=qn;Un._nextID=0;var Re=(c=>(c[c.hold=0]="hold",c[c.once=1]="once",c[c.loop=2]="loop",c[c.pingpong=3]="pingpong",c[c.onceReverse=4]="onceReverse",c[c.loopReverse=5]="loopReverse",c[c.pingpongReverse=6]="pingpongReverse",c))(Re||{});const Bs=[0,1,2,3,4,5,6];class zn{constructor(t,n,e){if(this.timelines=[],this.timelineIds=new ss,!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(n),this.duration=e}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(let n=0;n<t.length;n++)this.timelineIds.addAll(t[n].getPropertyIds())}hasTimeline(t){for(let n=0;n<t.length;n++)if(this.timelineIds.contains(t[n]))return!0;return!1}apply(t,n,e,i,r,h,l,s){if(!t)throw new Error("skeleton cannot be null.");i&&this.duration!=0&&(e%=this.duration,n>0&&(n%=this.duration));const a=this.timelines;for(let o=0,d=a.length;o<d;o++)a[o].apply(t,n,e,r,h,l,s)}}const ot={rotate:0,x:1,y:2,scaleX:3,scaleY:4,shearX:5,shearY:6,rgb:7,alpha:8,rgb2:9,attachment:10,deform:11,event:12,drawOrder:13,ikConstraint:14,transformConstraint:15,pathConstraintPosition:16,pathConstraintSpacing:17,pathConstraintMix:18,sequence:19};class bt{constructor(t,n){this.propertyIds=n,this.frames=v.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,n){const e=t.length;for(let i=1;i<e;i++)if(t[i]>n)return i-1;return e-1}static search(t,n,e){const i=t.length;for(let r=e;r<i;r+=e)if(t[r]>n)return r-e;return i-e}}class be extends bt{constructor(t,n,e){super(t,e),this.curves=v.newFloatArray(t+n*18),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){const n=this.getFrameCount()+t*18;if(this.curves.length>n){const e=v.newFloatArray(n);v.arrayCopy(this.curves,0,e,0,n),this.curves=e}}setBezier(t,n,e,i,r,h,l,s,a,o,d){const f=this.curves;let u=this.getFrameCount()+t*18;e==0&&(f[n]=2+u);const m=(i-h*2+s)*.03,g=(r-l*2+a)*.03,x=((h-s)*3-i+o)*.006,E=((l-a)*3-r+d)*.006;let w=m*2+x,b=g*2+E,p=(h-i)*.3+m+x*.16666667,S=(l-r)*.3+g+E*.16666667,y=i+p,M=r+S;for(let T=u+18;u<T;u+=2)f[u]=y,f[u+1]=M,p+=w,S+=b,w+=x,b+=E,y+=p,M+=S}getBezierValue(t,n,e,i){const r=this.curves;if(r[i]>t){const a=this.frames[n],o=this.frames[n+e];return o+(t-a)/(r[i]-a)*(r[i+1]-o)}const h=i+18;for(i+=2;i<h;i+=2)if(r[i]>=t){const a=r[i-2],o=r[i-1];return o+(t-a)/(r[i]-a)*(r[i+1]-o)}n+=this.getFrameEntries();const l=r[h-2],s=r[h-1];return s+(t-l)/(this.frames[n]-l)*(this.frames[n+e]-s)}}class Ee extends be{constructor(t,n,e){super(t,n,[e])}getFrameEntries(){return 2}setFrame(t,n,e){t<<=1,this.frames[t]=n,this.frames[t+1]=e}getCurveValue(t){const n=this.frames;let e=n.length-2;for(let r=2;r<=e;r+=2)if(n[r]>t){e=r-2;break}const i=this.curves[e>>1];switch(i){case 0:const r=n[e],h=n[e+1];return h+(t-r)/(n[e+2]-r)*(n[e+2+1]-h);case 1:return n[e+1]}return this.getBezierValue(t,e,1,i-2)}}class Hn extends be{constructor(t,n,e,i){super(t,n,[e,i])}getFrameEntries(){return 3}setFrame(t,n,e,i){t*=3,this.frames[t]=n,this.frames[t+1]=e,this.frames[t+2]=i}}class Rn extends Ee{constructor(t,n,e){super(t,n,`${ot.rotate}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.rotation=s.data.rotation;return;case A.first:s.rotation+=(s.data.rotation-s.rotation)*r}return}let o=this.getCurveValue(e);switch(h){case A.setup:s.rotation=s.data.rotation+o*r;break;case A.first:case A.replace:o+=s.data.rotation-s.rotation;case A.add:s.rotation+=o*r}}}class Ds extends Hn{constructor(t,n,e){super(t,n,`${ot.x}|${e}`,`${ot.y}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.x=s.data.x,s.y=s.data.y;return;case A.first:s.x+=(s.data.x-s.x)*r,s.y+=(s.data.y-s.y)*r}return}let o=0,d=0;const f=bt.search(a,e,3),u=this.curves[f/3];switch(u){case 0:const m=a[f];o=a[f+1],d=a[f+2];const g=(e-m)/(a[f+3]-m);o+=(a[f+3+1]-o)*g,d+=(a[f+3+2]-d)*g;break;case 1:o=a[f+1],d=a[f+2];break;default:o=this.getBezierValue(e,f,1,u-2),d=this.getBezierValue(e,f,2,u+18-2)}switch(h){case A.setup:s.x=s.data.x+o*r,s.y=s.data.y+d*r;break;case A.first:case A.replace:s.x+=(s.data.x+o-s.x)*r,s.y+=(s.data.y+d-s.y)*r;break;case A.add:s.x+=o*r,s.y+=d*r}}}class Ls extends Ee{constructor(t,n,e){super(t,n,`${ot.x}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.x=s.data.x;return;case A.first:s.x+=(s.data.x-s.x)*r}return}const o=this.getCurveValue(e);switch(h){case A.setup:s.x=s.data.x+o*r;break;case A.first:case A.replace:s.x+=(s.data.x+o-s.x)*r;break;case A.add:s.x+=o*r}}}class _s extends Ee{constructor(t,n,e){super(t,n,`${ot.y}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.y=s.data.y;return;case A.first:s.y+=(s.data.y-s.y)*r}return}const o=this.getCurveValue(e);switch(h){case A.setup:s.y=s.data.y+o*r;break;case A.first:case A.replace:s.y+=(s.data.y+o-s.y)*r;break;case A.add:s.y+=o*r}}}class Os extends Hn{constructor(t,n,e){super(t,n,`${ot.scaleX}|${e}`,`${ot.scaleY}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.scaleX=s.data.scaleX,s.scaleY=s.data.scaleY;return;case A.first:s.scaleX+=(s.data.scaleX-s.scaleX)*r,s.scaleY+=(s.data.scaleY-s.scaleY)*r}return}let o,d;const f=bt.search(a,e,3),u=this.curves[f/3];switch(u){case 0:const m=a[f];o=a[f+1],d=a[f+2];const g=(e-m)/(a[f+3]-m);o+=(a[f+3+1]-o)*g,d+=(a[f+3+2]-d)*g;break;case 1:o=a[f+1],d=a[f+2];break;default:o=this.getBezierValue(e,f,1,u-2),d=this.getBezierValue(e,f,2,u+18-2)}if(o*=s.data.scaleX,d*=s.data.scaleY,r==1)h==A.add?(s.scaleX+=o-s.data.scaleX,s.scaleY+=d-s.data.scaleY):(s.scaleX=o,s.scaleY=d);else{let m=0,g=0;if(l==J.mixOut)switch(h){case A.setup:m=s.data.scaleX,g=s.data.scaleY,s.scaleX=m+(Math.abs(o)*C.signum(m)-m)*r,s.scaleY=g+(Math.abs(d)*C.signum(g)-g)*r;break;case A.first:case A.replace:m=s.scaleX,g=s.scaleY,s.scaleX=m+(Math.abs(o)*C.signum(m)-m)*r,s.scaleY=g+(Math.abs(d)*C.signum(g)-g)*r;break;case A.add:s.scaleX+=(o-s.data.scaleX)*r,s.scaleY+=(d-s.data.scaleY)*r}else switch(h){case A.setup:m=Math.abs(s.data.scaleX)*C.signum(o),g=Math.abs(s.data.scaleY)*C.signum(d),s.scaleX=m+(o-m)*r,s.scaleY=g+(d-g)*r;break;case A.first:case A.replace:m=Math.abs(s.scaleX)*C.signum(o),g=Math.abs(s.scaleY)*C.signum(d),s.scaleX=m+(o-m)*r,s.scaleY=g+(d-g)*r;break;case A.add:s.scaleX+=(o-s.data.scaleX)*r,s.scaleY+=(d-s.data.scaleY)*r}}}}class $s extends Ee{constructor(t,n,e){super(t,n,`${ot.scaleX}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.scaleX=s.data.scaleX;return;case A.first:s.scaleX+=(s.data.scaleX-s.scaleX)*r}return}const o=this.getCurveValue(e)*s.data.scaleX;if(r==1)h==A.add?s.scaleX+=o-s.data.scaleX:s.scaleX=o;else{let d=0;if(l==J.mixOut)switch(h){case A.setup:d=s.data.scaleX,s.scaleX=d+(Math.abs(o)*C.signum(d)-d)*r;break;case A.first:case A.replace:d=s.scaleX,s.scaleX=d+(Math.abs(o)*C.signum(d)-d)*r;break;case A.add:s.scaleX+=(o-s.data.scaleX)*r}else switch(h){case A.setup:d=Math.abs(s.data.scaleX)*C.signum(o),s.scaleX=d+(o-d)*r;break;case A.first:case A.replace:d=Math.abs(s.scaleX)*C.signum(o),s.scaleX=d+(o-d)*r;break;case A.add:s.scaleX+=(o-s.data.scaleX)*r}}}}class Ws extends Ee{constructor(t,n,e){super(t,n,`${ot.scaleY}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.scaleY=s.data.scaleY;return;case A.first:s.scaleY+=(s.data.scaleY-s.scaleY)*r}return}const o=this.getCurveValue(e)*s.data.scaleY;if(r==1)h==A.add?s.scaleY+=o-s.data.scaleY:s.scaleY=o;else{let d=0;if(l==J.mixOut)switch(h){case A.setup:d=s.data.scaleY,s.scaleY=d+(Math.abs(o)*C.signum(d)-d)*r;break;case A.first:case A.replace:d=s.scaleY,s.scaleY=d+(Math.abs(o)*C.signum(d)-d)*r;break;case A.add:s.scaleY+=(o-s.data.scaleY)*r}else switch(h){case A.setup:d=Math.abs(s.data.scaleY)*C.signum(o),s.scaleY=d+(o-d)*r;break;case A.first:case A.replace:d=Math.abs(s.scaleY)*C.signum(o),s.scaleY=d+(o-d)*r;break;case A.add:s.scaleY+=(o-s.data.scaleY)*r}}}}class qs extends Hn{constructor(t,n,e){super(t,n,`${ot.shearX}|${e}`,`${ot.shearY}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.shearX=s.data.shearX,s.shearY=s.data.shearY;return;case A.first:s.shearX+=(s.data.shearX-s.shearX)*r,s.shearY+=(s.data.shearY-s.shearY)*r}return}let o=0,d=0;const f=bt.search(a,e,3),u=this.curves[f/3];switch(u){case 0:const m=a[f];o=a[f+1],d=a[f+2];const g=(e-m)/(a[f+3]-m);o+=(a[f+3+1]-o)*g,d+=(a[f+3+2]-d)*g;break;case 1:o=a[f+1],d=a[f+2];break;default:o=this.getBezierValue(e,f,1,u-2),d=this.getBezierValue(e,f,2,u+18-2)}switch(h){case A.setup:s.shearX=s.data.shearX+o*r,s.shearY=s.data.shearY+d*r;break;case A.first:case A.replace:s.shearX+=(s.data.shearX+o-s.shearX)*r,s.shearY+=(s.data.shearY+d-s.shearY)*r;break;case A.add:s.shearX+=o*r,s.shearY+=d*r}}}class Us extends Ee{constructor(t,n,e){super(t,n,`${ot.shearX}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.shearX=s.data.shearX;return;case A.first:s.shearX+=(s.data.shearX-s.shearX)*r}return}const o=this.getCurveValue(e);switch(h){case A.setup:s.shearX=s.data.shearX+o*r;break;case A.first:case A.replace:s.shearX+=(s.data.shearX+o-s.shearX)*r;break;case A.add:s.shearX+=o*r}}}class zs extends Ee{constructor(t,n,e){super(t,n,`${ot.shearY}|${e}`),this.boneIndex=0,this.boneIndex=e}apply(t,n,e,i,r,h,l){const s=t.bones[this.boneIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.shearY=s.data.shearY;return;case A.first:s.shearY+=(s.data.shearY-s.shearY)*r}return}const o=this.getCurveValue(e);switch(h){case A.setup:s.shearY=s.data.shearY+o*r;break;case A.first:case A.replace:s.shearY+=(s.data.shearY+o-s.shearY)*r;break;case A.add:s.shearY+=o*r}}}class Hs extends be{constructor(t,n,e){super(t,n,[`${ot.rgb}|${e}`,`${ot.alpha}|${e}`]),this.slotIndex=0,this.slotIndex=e}getFrameEntries(){return 5}setFrame(t,n,e,i,r,h){t*=5,this.frames[t]=n,this.frames[t+1]=e,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=h}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=this.frames,o=s.color;if(e<a[0]){const E=s.data.color;switch(h){case A.setup:o.setFromColor(E);return;case A.first:o.add((E.r-o.r)*r,(E.g-o.g)*r,(E.b-o.b)*r,(E.a-o.a)*r)}return}let d=0,f=0,u=0,m=0;const g=bt.search(a,e,5),x=this.curves[g/5];switch(x){case 0:const E=a[g];d=a[g+1],f=a[g+2],u=a[g+3],m=a[g+4];const w=(e-E)/(a[g+5]-E);d+=(a[g+5+1]-d)*w,f+=(a[g+5+2]-f)*w,u+=(a[g+5+3]-u)*w,m+=(a[g+5+4]-m)*w;break;case 1:d=a[g+1],f=a[g+2],u=a[g+3],m=a[g+4];break;default:d=this.getBezierValue(e,g,1,x-2),f=this.getBezierValue(e,g,2,x+18-2),u=this.getBezierValue(e,g,3,x+18*2-2),m=this.getBezierValue(e,g,4,x+18*3-2)}r==1?o.set(d,f,u,m):(h==A.setup&&o.setFromColor(s.data.color),o.add((d-o.r)*r,(f-o.g)*r,(u-o.b)*r,(m-o.a)*r))}}class Gs extends be{constructor(t,n,e){super(t,n,[`${ot.rgb}|${e}`]),this.slotIndex=0,this.slotIndex=e}getFrameEntries(){return 4}setFrame(t,n,e,i,r){t<<=2,this.frames[t]=n,this.frames[t+1]=e,this.frames[t+2]=i,this.frames[t+3]=r}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=this.frames,o=s.color;if(e<a[0]){const x=s.data.color;switch(h){case A.setup:o.r=x.r,o.g=x.g,o.b=x.b;return;case A.first:o.r+=(x.r-o.r)*r,o.g+=(x.g-o.g)*r,o.b+=(x.b-o.b)*r}return}let d=0,f=0,u=0;const m=bt.search(a,e,4),g=this.curves[m>>2];switch(g){case 0:const x=a[m];d=a[m+1],f=a[m+2],u=a[m+3];const E=(e-x)/(a[m+4]-x);d+=(a[m+4+1]-d)*E,f+=(a[m+4+2]-f)*E,u+=(a[m+4+3]-u)*E;break;case 1:d=a[m+1],f=a[m+2],u=a[m+3];break;default:d=this.getBezierValue(e,m,1,g-2),f=this.getBezierValue(e,m,2,g+18-2),u=this.getBezierValue(e,m,3,g+18*2-2)}if(r==1)o.r=d,o.g=f,o.b=u;else{if(h==A.setup){const x=s.data.color;o.r=x.r,o.g=x.g,o.b=x.b}o.r+=(d-o.r)*r,o.g+=(f-o.g)*r,o.b+=(u-o.b)*r}}}class js extends Ee{constructor(t,n,e){super(t,n,`${ot.alpha}|${e}`),this.slotIndex=0,this.slotIndex=e}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=s.color;if(e<this.frames[0]){const d=s.data.color;switch(h){case A.setup:a.a=d.a;return;case A.first:a.a+=(d.a-a.a)*r}return}const o=this.getCurveValue(e);r==1?a.a=o:(h==A.setup&&(a.a=s.data.color.a),a.a+=(o-a.a)*r)}}class Zs extends be{constructor(t,n,e){super(t,n,[`${ot.rgb}|${e}`,`${ot.alpha}|${e}`,`${ot.rgb2}|${e}`]),this.slotIndex=0,this.slotIndex=e}getFrameEntries(){return 8}setFrame(t,n,e,i,r,h,l,s,a){t<<=3,this.frames[t]=n,this.frames[t+1]=e,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=h,this.frames[t+5]=l,this.frames[t+6]=s,this.frames[t+7]=a}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=this.frames,o=s.color,d=s.darkColor;if(e<a[0]){const S=s.data.color,y=s.data.darkColor;switch(h){case A.setup:o.setFromColor(S),d.r=y.r,d.g=y.g,d.b=y.b;return;case A.first:o.add((S.r-o.r)*r,(S.g-o.g)*r,(S.b-o.b)*r,(S.a-o.a)*r),d.r+=(y.r-d.r)*r,d.g+=(y.g-d.g)*r,d.b+=(y.b-d.b)*r}return}let f=0,u=0,m=0,g=0,x=0,E=0,w=0;const b=bt.search(a,e,8),p=this.curves[b>>3];switch(p){case 0:const S=a[b];f=a[b+1],u=a[b+2],m=a[b+3],g=a[b+4],x=a[b+5],E=a[b+6],w=a[b+7];const y=(e-S)/(a[b+8]-S);f+=(a[b+8+1]-f)*y,u+=(a[b+8+2]-u)*y,m+=(a[b+8+3]-m)*y,g+=(a[b+8+4]-g)*y,x+=(a[b+8+5]-x)*y,E+=(a[b+8+6]-E)*y,w+=(a[b+8+7]-w)*y;break;case 1:f=a[b+1],u=a[b+2],m=a[b+3],g=a[b+4],x=a[b+5],E=a[b+6],w=a[b+7];break;default:f=this.getBezierValue(e,b,1,p-2),u=this.getBezierValue(e,b,2,p+18-2),m=this.getBezierValue(e,b,3,p+18*2-2),g=this.getBezierValue(e,b,4,p+18*3-2),x=this.getBezierValue(e,b,5,p+18*4-2),E=this.getBezierValue(e,b,6,p+18*5-2),w=this.getBezierValue(e,b,7,p+18*6-2)}if(r==1)o.set(f,u,m,g),d.r=x,d.g=E,d.b=w;else{if(h==A.setup){o.setFromColor(s.data.color);const S=s.data.darkColor;d.r=S.r,d.g=S.g,d.b=S.b}o.add((f-o.r)*r,(u-o.g)*r,(m-o.b)*r,(g-o.a)*r),d.r+=(x-d.r)*r,d.g+=(E-d.g)*r,d.b+=(w-d.b)*r}}}class Qs extends be{constructor(t,n,e){super(t,n,[`${ot.rgb}|${e}`,`${ot.rgb2}|${e}`]),this.slotIndex=0,this.slotIndex=e}getFrameEntries(){return 7}setFrame(t,n,e,i,r,h,l,s){t*=7,this.frames[t]=n,this.frames[t+1]=e,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=h,this.frames[t+5]=l,this.frames[t+6]=s}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=this.frames,o=s.color,d=s.darkColor;if(e<a[0]){const p=s.data.color,S=s.data.darkColor;switch(h){case A.setup:o.r=p.r,o.g=p.g,o.b=p.b,d.r=S.r,d.g=S.g,d.b=S.b;return;case A.first:o.r+=(p.r-o.r)*r,o.g+=(p.g-o.g)*r,o.b+=(p.b-o.b)*r,d.r+=(S.r-d.r)*r,d.g+=(S.g-d.g)*r,d.b+=(S.b-d.b)*r}return}let f=0,u=0,m=0,g=0,x=0,E=0;const w=bt.search(a,e,7),b=this.curves[w/7];switch(b){case 0:const p=a[w];f=a[w+1],u=a[w+2],m=a[w+3],g=a[w+4],x=a[w+5],E=a[w+6];const S=(e-p)/(a[w+7]-p);f+=(a[w+7+1]-f)*S,u+=(a[w+7+2]-u)*S,m+=(a[w+7+3]-m)*S,g+=(a[w+7+4]-g)*S,x+=(a[w+7+5]-x)*S,E+=(a[w+7+6]-E)*S;break;case 1:f=a[w+1],u=a[w+2],m=a[w+3],g=a[w+4],x=a[w+5],E=a[w+6];break;default:f=this.getBezierValue(e,w,1,b-2),u=this.getBezierValue(e,w,2,b+18-2),m=this.getBezierValue(e,w,3,b+18*2-2),g=this.getBezierValue(e,w,4,b+18*3-2),x=this.getBezierValue(e,w,5,b+18*4-2),E=this.getBezierValue(e,w,6,b+18*5-2)}if(r==1)o.r=f,o.g=u,o.b=m,d.r=g,d.g=x,d.b=E;else{if(h==A.setup){const p=s.data.color,S=s.data.darkColor;o.r=p.r,o.g=p.g,o.b=p.b,d.r=S.r,d.g=S.g,d.b=S.b}o.r+=(f-o.r)*r,o.g+=(u-o.g)*r,o.b+=(m-o.b)*r,d.r+=(g-d.r)*r,d.g+=(x-d.g)*r,d.b+=(E-d.b)*r}}}class cn extends bt{constructor(t,n){super(t,[`${ot.attachment}|${n}`]),this.slotIndex=0,this.slotIndex=n,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,n,e){this.frames[t]=n,this.attachmentNames[t]=e}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(s.bone.active){if(l==J.mixOut){h==A.setup&&this.setAttachment(t,s,s.data.attachmentName);return}if(e<this.frames[0]){(h==A.setup||h==A.first)&&this.setAttachment(t,s,s.data.attachmentName);return}this.setAttachment(t,s,this.attachmentNames[bt.search1(this.frames,e)])}}setAttachment(t,n,e){n.setAttachment(e?t.getAttachment(this.slotIndex,e):null)}}class Ks extends be{constructor(t,n,e,i){super(t,n,[`${ot.deform}|${e}|${i.id}`]),this.slotIndex=0,this.slotIndex=e,this.attachment=i,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,n,e){this.frames[t]=n,this.vertices[t]=e}setBezier(t,n,e,i,r,h,l,s,a,o,d){const f=this.curves;let u=this.getFrameCount()+t*18;e==0&&(f[n]=2+u);const m=(i-h*2+s)*.03,g=a*.03-l*.06,x=((h-s)*3-i+o)*.006,E=(l-a+.33333333)*.018;let w=m*2+x,b=g*2+E,p=(h-i)*.3+m+x*.16666667,S=l*.3+g+E*.16666667,y=i+p,M=S;for(let T=u+18;u<T;u+=2)f[u]=y,f[u+1]=M,p+=w,S+=b,w+=x,b+=E,y+=p,M+=S}getCurvePercent(t,n){const e=this.curves;let i=e[n];switch(i){case 0:const s=this.frames[n];return(t-s)/(this.frames[n+this.getFrameEntries()]-s);case 1:return 0}if(i-=2,e[i]>t){const s=this.frames[n];return e[i+1]*(t-s)/(e[i]-s)}const r=i+18;for(i+=2;i<r;i+=2)if(e[i]>=t){const s=e[i-2],a=e[i-1];return a+(t-s)/(e[i]-s)*(e[i+1]-a)}const h=e[r-2],l=e[r-1];return l+(1-l)*(t-h)/(this.frames[n+this.getFrameEntries()]-h)}apply(t,n,e,i,r,h,l){const s=t.slots[this.slotIndex];if(!s.bone.active)return;const a=s.getAttachment();if(!a||!(a instanceof we)||a.timelineAttachment!=this.attachment)return;const o=s.deform;o.length==0&&(h=A.setup);const d=this.vertices,f=d[0].length,u=this.frames;if(e<u[0]){switch(h){case A.setup:o.length=0;return;case A.first:if(r==1){o.length=0;return}o.length=f;const w=a;if(w.bones){r=1-r;for(let b=0;b<f;b++)o[b]*=r}else{const b=w.vertices;for(let p=0;p<f;p++)o[p]+=(b[p]-o[p])*r}}return}if(o.length=f,e>=u[u.length-1]){const w=d[u.length-1];if(r==1){if(h==A.add){const b=a;if(b.bones)for(let p=0;p<f;p++)o[p]+=w[p];else{const p=b.vertices;for(let S=0;S<f;S++)o[S]+=w[S]-p[S]}}else v.arrayCopy(w,0,o,0,f);}else switch(h){case A.setup:{const p=a;if(p.bones)for(let S=0;S<f;S++)o[S]=w[S]*r;else{const S=p.vertices;for(let y=0;y<f;y++){const M=S[y];o[y]=M+(w[y]-M)*r}}break}case A.first:case A.replace:for(let p=0;p<f;p++)o[p]+=(w[p]-o[p])*r;break;case A.add:const b=a;if(b.bones)for(let p=0;p<f;p++)o[p]+=w[p]*r;else{const p=b.vertices;for(let S=0;S<f;S++)o[S]+=(w[S]-p[S])*r}}return}const m=bt.search1(u,e),g=this.getCurvePercent(e,m),x=d[m],E=d[m+1];if(r==1){if(h==A.add){const w=a;if(w.bones)for(let b=0;b<f;b++){const p=x[b];o[b]+=p+(E[b]-p)*g}else{const b=w.vertices;for(let p=0;p<f;p++){const S=x[p];o[p]+=S+(E[p]-S)*g-b[p]}}}else for(let w=0;w<f;w++){const b=x[w];o[w]=b+(E[w]-b)*g}}else switch(h){case A.setup:{const b=a;if(b.bones)for(let p=0;p<f;p++){const S=x[p];o[p]=(S+(E[p]-S)*g)*r}else{const p=b.vertices;for(let S=0;S<f;S++){const y=x[S],M=p[S];o[S]=M+(y+(E[S]-y)*g-M)*r}}break}case A.first:case A.replace:for(let b=0;b<f;b++){const p=x[b];o[b]+=(p+(E[b]-p)*g-o[b])*r}break;case A.add:const w=a;if(w.bones)for(let b=0;b<f;b++){const p=x[b];o[b]+=(p+(E[b]-p)*g)*r}else{const b=w.vertices;for(let p=0;p<f;p++){const S=x[p];o[p]+=(S+(E[p]-S)*g-b[p])*r}}}}}const rr=class extends bt{constructor(c){super(c,rr.propertyIds),this.events=new Array(c)}getFrameCount(){return this.frames.length}setFrame(c,t){this.frames[c]=t.time,this.events[c]=t}apply(c,t,n,e,i,r,h){if(!e)return;const l=this.frames,s=this.frames.length;if(t>n)this.apply(c,t,Number.MAX_VALUE,e,i,r,h),t=-1;else if(t>=l[s-1])return;if(n<l[0])return;let a=0;if(t<l[0])a=0;else{a=bt.search1(l,t)+1;const o=l[a];for(;a>0&&l[a-1]==o;)a--}for(;a<s&&n>=l[a];a++)e.push(this.events[a])}};let vn=rr;vn.propertyIds=[`${ot.event}`];const ar=class extends bt{constructor(c){super(c,ar.propertyIds),this.drawOrders=new Array(c)}getFrameCount(){return this.frames.length}setFrame(c,t,n){this.frames[c]=t,this.drawOrders[c]=n}apply(c,t,n,e,i,r,h){if(h==J.mixOut){r==A.setup&&v.arrayCopy(c.slots,0,c.drawOrder,0,c.slots.length);return}if(n<this.frames[0]){(r==A.setup||r==A.first)&&v.arrayCopy(c.slots,0,c.drawOrder,0,c.slots.length);return}const l=bt.search1(this.frames,n),s=this.drawOrders[l];if(!s)v.arrayCopy(c.slots,0,c.drawOrder,0,c.slots.length);else{const a=c.drawOrder,o=c.slots;for(let d=0,f=s.length;d<f;d++)a[d]=o[s[d]]}}};let hn=ar;hn.propertyIds=[`${ot.drawOrder}`];class Js extends be{constructor(t,n,e){super(t,n,[`${ot.ikConstraint}|${e}`]),this.ikConstraintIndex=0,this.ikConstraintIndex=e}getFrameEntries(){return 6}setFrame(t,n,e,i,r,h,l){t*=6,this.frames[t]=n,this.frames[t+1]=e,this.frames[t+2]=i,this.frames[t+3]=r,this.frames[t+4]=h?1:0,this.frames[t+5]=l?1:0}apply(t,n,e,i,r,h,l){const s=t.ikConstraints[this.ikConstraintIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch;return;case A.first:s.mix+=(s.data.mix-s.mix)*r,s.softness+=(s.data.softness-s.softness)*r,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}return}let o=0,d=0;const f=bt.search(a,e,6),u=this.curves[f/6];switch(u){case 0:const m=a[f];o=a[f+1],d=a[f+2];const g=(e-m)/(a[f+6]-m);o+=(a[f+6+1]-o)*g,d+=(a[f+6+2]-d)*g;break;case 1:o=a[f+1],d=a[f+2];break;default:o=this.getBezierValue(e,f,1,u-2),d=this.getBezierValue(e,f,2,u+18-2)}h==A.setup?(s.mix=s.data.mix+(o-s.data.mix)*r,s.softness=s.data.softness+(d-s.data.softness)*r,l==J.mixOut?(s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch):(s.bendDirection=a[f+3],s.compress=a[f+4]!=0,s.stretch=a[f+5]!=0)):(s.mix+=(o-s.mix)*r,s.softness+=(d-s.softness)*r,l==J.mixIn&&(s.bendDirection=a[f+3],s.compress=a[f+4]!=0,s.stretch=a[f+5]!=0))}}class ti extends be{constructor(t,n,e){super(t,n,[`${ot.transformConstraint}|${e}`]),this.transformConstraintIndex=0,this.transformConstraintIndex=e}getFrameEntries(){return 7}setFrame(t,n,e,i,r,h,l,s){const a=this.frames;t*=7,a[t]=n,a[t+1]=e,a[t+2]=i,a[t+3]=r,a[t+4]=h,a[t+5]=l,a[t+6]=s}apply(t,n,e,i,r,h,l){const s=t.transformConstraints[this.transformConstraintIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){const w=s.data;switch(h){case A.setup:s.mixRotate=w.mixRotate,s.mixX=w.mixX,s.mixY=w.mixY,s.mixScaleX=w.mixScaleX,s.mixScaleY=w.mixScaleY,s.mixShearY=w.mixShearY;return;case A.first:s.mixRotate+=(w.mixRotate-s.mixRotate)*r,s.mixX+=(w.mixX-s.mixX)*r,s.mixY+=(w.mixY-s.mixY)*r,s.mixScaleX+=(w.mixScaleX-s.mixScaleX)*r,s.mixScaleY+=(w.mixScaleY-s.mixScaleY)*r,s.mixShearY+=(w.mixShearY-s.mixShearY)*r}return}let o,d,f,u,m,g;const x=bt.search(a,e,7),E=this.curves[x/7];switch(E){case 0:const w=a[x];o=a[x+1],d=a[x+2],f=a[x+3],u=a[x+4],m=a[x+5],g=a[x+6];const b=(e-w)/(a[x+7]-w);o+=(a[x+7+1]-o)*b,d+=(a[x+7+2]-d)*b,f+=(a[x+7+3]-f)*b,u+=(a[x+7+4]-u)*b,m+=(a[x+7+5]-m)*b,g+=(a[x+7+6]-g)*b;break;case 1:o=a[x+1],d=a[x+2],f=a[x+3],u=a[x+4],m=a[x+5],g=a[x+6];break;default:o=this.getBezierValue(e,x,1,E-2),d=this.getBezierValue(e,x,2,E+18-2),f=this.getBezierValue(e,x,3,E+18*2-2),u=this.getBezierValue(e,x,4,E+18*3-2),m=this.getBezierValue(e,x,5,E+18*4-2),g=this.getBezierValue(e,x,6,E+18*5-2)}if(h==A.setup){const w=s.data;s.mixRotate=w.mixRotate+(o-w.mixRotate)*r,s.mixX=w.mixX+(d-w.mixX)*r,s.mixY=w.mixY+(f-w.mixY)*r,s.mixScaleX=w.mixScaleX+(u-w.mixScaleX)*r,s.mixScaleY=w.mixScaleY+(m-w.mixScaleY)*r,s.mixShearY=w.mixShearY+(g-w.mixShearY)*r}else s.mixRotate+=(o-s.mixRotate)*r,s.mixX+=(d-s.mixX)*r,s.mixY+=(f-s.mixY)*r,s.mixScaleX+=(u-s.mixScaleX)*r,s.mixScaleY+=(m-s.mixScaleY)*r,s.mixShearY+=(g-s.mixShearY)*r}}class ei extends Ee{constructor(t,n,e){super(t,n,`${ot.pathConstraintPosition}|${e}`),this.pathConstraintIndex=0,this.pathConstraintIndex=e}apply(t,n,e,i,r,h,l){const s=t.pathConstraints[this.pathConstraintIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.position=s.data.position;return;case A.first:s.position+=(s.data.position-s.position)*r}return}const o=this.getCurveValue(e);h==A.setup?s.position=s.data.position+(o-s.data.position)*r:s.position+=(o-s.position)*r}}class ni extends Ee{constructor(t,n,e){super(t,n,`${ot.pathConstraintSpacing}|${e}`),this.pathConstraintIndex=0,this.pathConstraintIndex=e}apply(t,n,e,i,r,h,l){const s=t.pathConstraints[this.pathConstraintIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.spacing=s.data.spacing;return;case A.first:s.spacing+=(s.data.spacing-s.spacing)*r}return}const o=this.getCurveValue(e);h==A.setup?s.spacing=s.data.spacing+(o-s.data.spacing)*r:s.spacing+=(o-s.spacing)*r}}class si extends be{constructor(t,n,e){super(t,n,[`${ot.pathConstraintMix}|${e}`]),this.pathConstraintIndex=0,this.pathConstraintIndex=e}getFrameEntries(){return 4}setFrame(t,n,e,i,r){const h=this.frames;t<<=2,h[t]=n,h[t+1]=e,h[t+2]=i,h[t+3]=r}apply(t,n,e,i,r,h,l){const s=t.pathConstraints[this.pathConstraintIndex];if(!s.active)return;const a=this.frames;if(e<a[0]){switch(h){case A.setup:s.mixRotate=s.data.mixRotate,s.mixX=s.data.mixX,s.mixY=s.data.mixY;return;case A.first:s.mixRotate+=(s.data.mixRotate-s.mixRotate)*r,s.mixX+=(s.data.mixX-s.mixX)*r,s.mixY+=(s.data.mixY-s.mixY)*r}return}let o,d,f;const u=bt.search(a,e,4),m=this.curves[u>>2];switch(m){case 0:const g=a[u];o=a[u+1],d=a[u+2],f=a[u+3];const x=(e-g)/(a[u+4]-g);o+=(a[u+4+1]-o)*x,d+=(a[u+4+2]-d)*x,f+=(a[u+4+3]-f)*x;break;case 1:o=a[u+1],d=a[u+2],f=a[u+3];break;default:o=this.getBezierValue(e,u,1,m-2),d=this.getBezierValue(e,u,2,m+18-2),f=this.getBezierValue(e,u,3,m+18*2-2)}if(h==A.setup){const g=s.data;s.mixRotate=g.mixRotate+(o-g.mixRotate)*r,s.mixX=g.mixX+(d-g.mixX)*r,s.mixY=g.mixY+(f-g.mixY)*r}else s.mixRotate+=(o-s.mixRotate)*r,s.mixX+=(d-s.mixX)*r,s.mixY+=(f-s.mixY)*r}}const Qe=class extends bt{constructor(c,t,n){super(c,[`${ot.sequence}|${t}|${n.sequence.id}`]),this.slotIndex=t,this.attachment=n}getFrameEntries(){return Qe.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(c,t,n,e,i){const r=this.frames;c*=Qe.ENTRIES,r[c]=t,r[c+Qe.MODE]=n|e<<4,r[c+Qe.DELAY]=i}apply(c,t,n,e,i,r,h){const l=c.slots[this.slotIndex];if(!l.bone.active)return;const s=l.attachment,a=this.attachment;if(s!=a&&(!(s instanceof we)||s.timelineAttachment!=a))return;const o=this.frames;if(n<o[0]){(r==A.setup||r==A.first)&&(l.sequenceIndex=-1);return}const d=bt.search(o,n,Qe.ENTRIES),f=o[d],u=o[d+Qe.MODE],m=o[d+Qe.DELAY];if(!this.attachment.sequence)return;let g=u>>4;const x=this.attachment.sequence.regions.length,E=Bs[u&15];if(E!=Re.hold)switch(g+=(n-f)/m+1e-5|0,E){case Re.once:g=Math.min(x-1,g);break;case Re.loop:g%=x;break;case Re.pingpong:{const w=(x<<1)-2;g=w==0?0:g%w,g>=x&&(g=w-g);break}case Re.onceReverse:g=Math.max(x-1-g,0);break;case Re.loopReverse:g=x-1-g%x;break;case Re.pingpongReverse:{const w=(x<<1)-2;g=w==0?0:(g+x-1)%w,g>=x&&(g=w-g)}}l.sequenceIndex=g}};let bn=Qe;bn.ENTRIES=3,bn.MODE=1,bn.DELAY=2;const ve=class{constructor(c){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new or(this),this.propertyIDs=new ss,this.animationsChanged=!1,this.trackEntryPool=new An(()=>new Gn),this.data=c}static emptyAnimation(){return ve._emptyAnimation}update(c){c*=this.timeScale;const t=this.tracks;for(let n=0,e=t.length;n<e;n++){const i=t[n];if(!i)continue;i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;let r=c*i.timeScale;if(i.delay>0){if(i.delay-=r,i.delay>0)continue;r=-i.delay,i.delay=0}let h=i.next;if(h){const l=i.trackLast-h.delay;if(l>=0){for(h.delay=0,h.trackTime+=i.timeScale==0?0:(l/i.timeScale+c)*h.timeScale,i.trackTime+=r,this.setCurrent(n,h,!0);h.mixingFrom;)h.mixTime+=c,h=h.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&!i.mixingFrom){t[n]=null,this.queue.end(i),this.clearNext(i);continue}if(i.mixingFrom&&this.updateMixingFrom(i,c)){let l=i.mixingFrom;for(i.mixingFrom=null,l&&(l.mixingTo=null);l;)this.queue.end(l),l=l.mixingFrom}i.trackTime+=r}this.queue.drain()}updateMixingFrom(c,t){const n=c.mixingFrom;if(!n)return!0;const e=this.updateMixingFrom(n,t);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,c.mixTime>0&&c.mixTime>=c.mixDuration?((n.totalAlpha==0||c.mixDuration==0)&&(c.mixingFrom=n.mixingFrom,n.mixingFrom&&(n.mixingFrom.mixingTo=c),c.interruptAlpha=n.interruptAlpha,this.queue.end(n)),e):(n.trackTime+=t*n.timeScale,c.mixTime+=t,!1)}apply(c){if(!c)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const t=this.events,n=this.tracks;let e=!1;for(let h=0,l=n.length;h<l;h++){const s=n[h];if(!s||s.delay>0)continue;e=!0;const a=h==0?A.first:s.mixBlend;let o=s.alpha;s.mixingFrom?o*=this.applyMixingFrom(s,c,a):s.trackTime>=s.trackEnd&&!s.next&&(o=0);const d=s.animationLast,f=s.getAnimationTime();let u=f,m=t;s.reverse&&(u=s.animation.duration-u,m=null);const g=s.animation.timelines,x=g.length;if(h==0&&o==1||a==A.add)for(let E=0;E<x;E++){v.webkit602BugfixHelper(o,a);const w=g[E];w instanceof cn?this.applyAttachmentTimeline(w,c,u,a,!0):w.apply(c,d,u,m,o,a,J.mixIn)}else{const E=s.timelineMode,w=s.shortestRotation,b=!w&&s.timelinesRotation.length!=x<<1;b&&(s.timelinesRotation.length=x<<1);for(let p=0;p<x;p++){const S=g[p],y=E[p]==ii?a:A.setup;!w&&S instanceof Rn?this.applyRotateTimeline(S,c,u,o,y,s.timelinesRotation,p<<1,b):S instanceof cn?this.applyAttachmentTimeline(S,c,u,a,!0):(v.webkit602BugfixHelper(o,a),S.apply(c,d,u,m,o,y,J.mixIn))}}this.queueEvents(s,f),t.length=0,s.nextAnimationLast=f,s.nextTrackLast=s.trackTime}const i=this.unkeyedState+hr,r=c.slots;for(let h=0,l=c.slots.length;h<l;h++){const s=r[h];if(s.attachmentState==i){const a=s.data.attachmentName;s.setAttachment(a?c.getAttachment(s.data.index,a):null)}}return this.unkeyedState+=2,this.queue.drain(),e}applyMixingFrom(c,t,n){const e=c.mixingFrom;e.mixingFrom&&this.applyMixingFrom(e,t,n);let i=0;c.mixDuration==0?(i=1,n==A.first&&(n=A.setup)):(i=c.mixTime/c.mixDuration,i>1&&(i=1),n!=A.first&&(n=e.mixBlend));const r=i<e.attachmentThreshold,h=i<e.drawOrderThreshold,l=e.animation.timelines,s=l.length,a=e.alpha*c.interruptAlpha,o=a*(1-i),d=e.animationLast,f=e.getAnimationTime();let u=f,m=null;if(e.reverse?u=e.animation.duration-u:i<e.eventThreshold&&(m=this.events),n==A.add)for(let g=0;g<s;g++)l[g].apply(t,d,u,m,o,n,J.mixOut);else{const g=e.timelineMode,x=e.timelineHoldMix,E=e.shortestRotation,w=!E&&e.timelinesRotation.length!=s<<1;w&&(e.timelinesRotation.length=s<<1),e.totalAlpha=0;for(let b=0;b<s;b++){const p=l[b];let S=J.mixOut,y,M=0;switch(g[b]){case ii:if(!h&&p instanceof hn)continue;y=n,M=o;break;case lr:y=A.setup,M=o;break;case cr:y=n,M=a;break;case ri:y=A.setup,M=a;break;default:y=A.setup;const T=x[b];M=a*Math.max(0,1-T.mixTime/T.mixDuration);break}e.totalAlpha+=M,!E&&p instanceof Rn?this.applyRotateTimeline(p,t,u,M,y,e.timelinesRotation,b<<1,w):p instanceof cn?this.applyAttachmentTimeline(p,t,u,y,r):(v.webkit602BugfixHelper(M,n),h&&p instanceof hn&&y==A.setup&&(S=J.mixIn),p.apply(t,d,u,m,M,y,S))}}return c.mixDuration>0&&this.queueEvents(e,f),this.events.length=0,e.nextAnimationLast=f,e.nextTrackLast=e.trackTime,i}applyAttachmentTimeline(c,t,n,e,i){const r=t.slots[c.slotIndex];r.bone.active&&(n<c.frames[0]?(e==A.setup||e==A.first)&&this.setAttachment(t,r,r.data.attachmentName,i):this.setAttachment(t,r,c.attachmentNames[bt.search1(c.frames,n)],i),r.attachmentState<=this.unkeyedState&&(r.attachmentState=this.unkeyedState+hr))}setAttachment(c,t,n,e){t.setAttachment(n?c.getAttachment(t.data.index,n):null),e&&(t.attachmentState=this.unkeyedState+qr)}applyRotateTimeline(c,t,n,e,i,r,h,l){if(l&&(r[h]=0),e==1){c.apply(t,0,n,null,1,i,J.mixIn);return}const s=t.bones[c.boneIndex];if(!s.active)return;const a=c.frames;let o=0,d=0;if(n<a[0])switch(i){case A.setup:s.rotation=s.data.rotation;default:return;case A.first:o=s.rotation,d=s.data.rotation}else o=i==A.setup?s.data.rotation:s.rotation,d=s.data.rotation+c.getCurveValue(n);let f=0,u=d-o;if(u-=(16384-(16384.499999999996-u/360|0))*360,u==0)f=r[h];else{let m=0,g=0;l?(m=0,g=u):(m=r[h],g=r[h+1]);const x=u>0;let E=m>=0;C.signum(g)!=C.signum(u)&&Math.abs(g)<=90&&(Math.abs(m)>180&&(m+=360*C.signum(m)),E=x),f=u+m-m%360,E!=x&&(f+=360*C.signum(m)),r[h]=f}r[h+1]=u,s.rotation=o+f*e}queueEvents(c,t){const n=c.animationStart,e=c.animationEnd,i=e-n,r=c.trackLast%i,h=this.events;let l=0;const s=h.length;for(;l<s;l++){const o=h[l];if(o.time<r)break;o.time>e||this.queue.event(c,o)}let a=!1;for(c.loop?a=i==0||r>c.trackTime%i:a=t>=e&&c.animationLast<e,a&&this.queue.complete(c);l<s;l++){const o=h[l];o.time<n||this.queue.event(c,o)}}clearTracks(){const c=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,n=this.tracks.length;t<n;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=c,this.queue.drain()}clearTrack(c){if(c>=this.tracks.length)return;const t=this.tracks[c];if(!t)return;this.queue.end(t),this.clearNext(t);let n=t;for(;;){const e=n.mixingFrom;if(!e)break;this.queue.end(e),n.mixingFrom=null,n.mixingTo=null,n=e}this.tracks[t.trackIndex]=null,this.queue.drain()}setCurrent(c,t,n){const e=this.expandToIndex(c);this.tracks[c]=t,t.previous=null,e&&(n&&this.queue.interrupt(e),t.mixingFrom=e,e.mixingTo=t,t.mixTime=0,e.mixingFrom&&e.mixDuration>0&&(t.interruptAlpha*=Math.min(1,e.mixTime/e.mixDuration)),e.timelinesRotation.length=0),this.queue.start(t)}setAnimation(c,t,n=!1){const e=this.data.skeletonData.findAnimation(t);if(!e)throw new Error(`Animation not found: ${t}`);return this.setAnimationWith(c,e,n)}setAnimationWith(c,t,n=!1){if(!t)throw new Error("animation cannot be null.");let e=!0,i=this.expandToIndex(c);i&&(i.nextTrackLast==-1?(this.tracks[c]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.clearNext(i),i=i.mixingFrom,e=!1):this.clearNext(i));const r=this.trackEntry(c,t,n,i);return this.setCurrent(c,r,e),this.queue.drain(),r}addAnimation(c,t,n=!1,e=0){const i=this.data.skeletonData.findAnimation(t);if(!i)throw new Error(`Animation not found: ${t}`);return this.addAnimationWith(c,i,n,e)}addAnimationWith(c,t,n=!1,e=0){if(!t)throw new Error("animation cannot be null.");let i=this.expandToIndex(c);if(i)for(;i.next;)i=i.next;const r=this.trackEntry(c,t,n,i);return i?(i.next=r,r.previous=i,e<=0&&(e+=i.getTrackComplete()-r.mixDuration)):(this.setCurrent(c,r,!0),this.queue.drain()),r.delay=e,r}setEmptyAnimation(c,t=0){const n=this.setAnimationWith(c,ve.emptyAnimation(),!1);return n.mixDuration=t,n.trackEnd=t,n}addEmptyAnimation(c,t=0,n=0){const e=this.addAnimationWith(c,ve.emptyAnimation(),!1,n);return n<=0&&(e.delay+=e.mixDuration-t),e.mixDuration=t,e.trackEnd=t,e}setEmptyAnimations(c=0){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let n=0,e=this.tracks.length;n<e;n++){const i=this.tracks[n];i&&this.setEmptyAnimation(i.trackIndex,c)}this.queue.drainDisabled=t,this.queue.drain()}expandToIndex(c){return c<this.tracks.length?this.tracks[c]:(v.ensureArrayCapacity(this.tracks,c+1,null),this.tracks.length=c+1,null)}trackEntry(c,t,n,e){const i=this.trackEntryPool.obtain();return i.reset(),i.trackIndex=c,i.animation=t,i.loop=n,i.holdPrevious=!1,i.reverse=!1,i.shortestRotation=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=t.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.mixTime=0,i.mixDuration=e?this.data.getMix(e.animation,t):0,i.interruptAlpha=1,i.totalAlpha=0,i.mixBlend=A.replace,i}clearNext(c){let t=c.next;for(;t;)this.queue.dispose(t),t=t.next;c.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();const c=this.tracks;for(let t=0,n=c.length;t<n;t++){let e=c[t];if(e){for(;e.mixingFrom;)e=e.mixingFrom;do(!e.mixingTo||e.mixBlend!=A.add)&&this.computeHold(e),e=e.mixingTo;while(e)}}}computeHold(c){const t=c.mixingTo,n=c.animation.timelines,e=c.animation.timelines.length,i=c.timelineMode;i.length=e;const r=c.timelineHoldMix;r.length=0;const h=this.propertyIDs;if(t&&t.holdPrevious){for(let l=0;l<e;l++)i[l]=h.addAll(n[l].getPropertyIds())?ri:cr;return}t:for(let l=0;l<e;l++){const s=n[l],a=s.getPropertyIds();if(!h.addAll(a))i[l]=ii;else if(!t||s instanceof cn||s instanceof hn||s instanceof vn||!t.animation.hasTimeline(a))i[l]=lr;else{for(let o=t.mixingTo;o;o=o.mixingTo)if(!o.animation.hasTimeline(a)){if(c.mixDuration>0){i[l]=Wr,r[l]=o;continue t}break}i[l]=ri}}}getCurrent(c){return c>=this.tracks.length?null:this.tracks[c]}addListener(c){if(!c)throw new Error("listener cannot be null.");this.listeners.push(c)}removeListener(c){const t=this.listeners.indexOf(c);t>=0&&this.listeners.splice(t,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(c,t,n){ve.deprecatedWarning1||(ve.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: AnimationState.setAnimationByName is deprecated, please use setAnimation from now on.")),this.setAnimation(c,t,n)}addAnimationByName(c,t,n,e){ve.deprecatedWarning2||(ve.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: AnimationState.addAnimationByName is deprecated, please use addAnimation from now on.")),this.addAnimation(c,t,n,e)}hasAnimation(c){return this.data.skeletonData.findAnimation(c)!==null}hasAnimationByName(c){return ve.deprecatedWarning3||(ve.deprecatedWarning3=!0,console.warn("Spine Deprecation Warning: AnimationState.hasAnimationByName is deprecated, please use hasAnimation from now on.")),this.hasAnimation(c)}};let En=ve;En._emptyAnimation=new zn("<empty>",[],0),En.deprecatedWarning1=!1,En.deprecatedWarning2=!1,En.deprecatedWarning3=!1;const De=class{constructor(){this.animation=null,this.previous=null,this.next=null,this.mixingFrom=null,this.mixingTo=null,this.listener=null,this.trackIndex=0,this.loop=!1,this.holdPrevious=!1,this.reverse=!1,this.shortestRotation=!1,this.eventThreshold=0,this.attachmentThreshold=0,this.drawOrderThreshold=0,this.animationStart=0,this.animationEnd=0,this.animationLast=0,this.nextAnimationLast=0,this.delay=0,this.trackTime=0,this.trackLast=0,this.nextTrackLast=0,this.trackEnd=0,this.timeScale=0,this.alpha=0,this.mixTime=0,this.mixDuration=0,this.interruptAlpha=0,this.totalAlpha=0,this.mixBlend=A.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const c=this.animationEnd-this.animationStart;return c==0?this.animationStart:this.trackTime%c+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(c){this.animationLast=c,this.nextAnimationLast=c}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){const c=this.animationEnd-this.animationStart;if(c!=0){if(this.loop)return c*(1+(this.trackTime/c|0));if(this.trackTime<c)return c}return this.trackTime}get time(){return De.deprecatedWarning1||(De.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime}set time(c){De.deprecatedWarning1||(De.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: TrackEntry.time is deprecated, please use trackTime from now on.")),this.trackTime=c}get endTime(){return De.deprecatedWarning2||(De.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime}set endTime(c){De.deprecatedWarning2||(De.deprecatedWarning2=!0,console.warn("Spine Deprecation Warning: TrackEntry.endTime is deprecated, please use trackEnd from now on.")),this.trackTime=c}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let Gn=De;Gn.deprecatedWarning1=!1,Gn.deprecatedWarning2=!1;class or{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(Qt.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Qt.interrupt),this.objects.push(t)}end(t){this.objects.push(Qt.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Qt.dispose),this.objects.push(t)}complete(t){this.objects.push(Qt.complete),this.objects.push(t)}event(t,n){this.objects.push(Qt.event),this.objects.push(t),this.objects.push(n)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,n=this.animState.listeners;for(let e=0;e<t.length;e+=2){const i=t[e],r=t[e+1];switch(i){case Qt.start:r.listener&&r.listener.start&&r.listener.start(r);for(let l=0;l<n.length;l++){const s=n[l];s.start&&s.start(r)}break;case Qt.interrupt:r.listener&&r.listener.interrupt&&r.listener.interrupt(r);for(let l=0;l<n.length;l++){const s=n[l];s.interrupt&&s.interrupt(r)}break;case Qt.end:r.listener&&r.listener.end&&r.listener.end(r);for(let l=0;l<n.length;l++){const s=n[l];s.end&&s.end(r)}case Qt.dispose:r.listener&&r.listener.dispose&&r.listener.dispose(r);for(let l=0;l<n.length;l++){const s=n[l];s.dispose&&s.dispose(r)}this.animState.trackEntryPool.free(r);break;case Qt.complete:r.listener&&r.listener.complete&&r.listener.complete(r);for(let l=0;l<n.length;l++){const s=n[l];s.complete&&s.complete(r)}break;case Qt.event:const h=t[e++ +2];r.listener&&r.listener.event&&r.listener.event(r,h);for(let l=0;l<n.length;l++){const s=n[l];s.event&&s.event(r,h)}break}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var Qt=(c=>(c[c.start=0]="start",c[c.interrupt=1]="interrupt",c[c.end=2]="end",c[c.dispose=3]="dispose",c[c.complete=4]="complete",c[c.event=5]="event",c))(Qt||{});class $r{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,n){}}const ii=0,lr=1,cr=2,ri=3,Wr=4,hr=1,qr=2;class dr{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,n,e){const i=this.skeletonData.findAnimation(t);if(!i)throw new Error(`Animation not found: ${t}`);const r=this.skeletonData.findAnimation(n);if(!r)throw new Error(`Animation not found: ${n}`);this.setMixWith(i,r,e)}setMixWith(t,n,e){if(!t)throw new Error("from cannot be null.");if(!n)throw new Error("to cannot be null.");const i=`${t.name}.${n.name}`;this.animationToMixTime[i]=e}getMix(t,n){const e=`${t.name}.${n.name}`,i=this.animationToMixTime[e];return i===void 0?this.defaultMix:i}}class ai{constructor(t){this.atlas=t}loadSequence(t,n,e){const i=e.regions;for(let r=0,h=i.length;r<h;r++){const l=e.getPath(n,r),s=this.atlas.findRegion(l);if(s==null)throw new Error(`Region not found in atlas: ${l} (sequence: ${t})`);i[r]=s,i[r].renderObject=i[r]}}newRegionAttachment(t,n,e,i){const r=new it(n,e);if(i!=null)this.loadSequence(n,e,i);else{const h=this.atlas.findRegion(e);if(!h)throw new Error(`Region not found in atlas: ${e} (region attachment: ${n})`);h.renderObject=h,r.region=h}return r}newMeshAttachment(t,n,e,i){const r=new on(n,e);if(i!=null)this.loadSequence(n,e,i);else{const h=this.atlas.findRegion(e);if(!h)throw new Error(`Region not found in atlas: ${e} (mesh attachment: ${n})`);h.renderObject=h,r.region=h}return r}newBoundingBoxAttachment(t,n){return new On(n)}newPathAttachment(t,n){return new ln(n)}newPointAttachment(t,n){return new Wn(n)}newClippingAttachment(t,n){return new $n(n)}}class oi{constructor(t,n,e){if(this.matrix=new H.Matrix,this.parent=null,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!n)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=n,this.parent=e,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,n,e,i,r,h,l){this.ax=t,this.ay=n,this.arotation=e,this.ascaleX=i,this.ascaleY=r,this.ashearX=h,this.ashearY=l;const s=this.parent,a=this.matrix,o=this.skeleton.scaleX,d=zt.yDown?-this.skeleton.scaleY:this.skeleton.scaleY;if(!s){const x=this.skeleton,E=e+90+l;a.a=C.cosDeg(e+h)*i*o,a.c=C.cosDeg(E)*r*o,a.b=C.sinDeg(e+h)*i*d,a.d=C.sinDeg(E)*r*d,a.tx=t*o+x.x,a.ty=n*d+x.y;return}let f=s.matrix.a,u=s.matrix.c,m=s.matrix.b,g=s.matrix.d;switch(a.tx=f*t+u*n+s.matrix.tx,a.ty=m*t+g*n+s.matrix.ty,this.data.transformMode){case j.Normal:{const x=e+90+l,E=C.cosDeg(e+h)*i,w=C.cosDeg(x)*r,b=C.sinDeg(e+h)*i,p=C.sinDeg(x)*r;a.a=f*E+u*b,a.c=f*w+u*p,a.b=m*E+g*b,a.d=m*w+g*p;return}case j.OnlyTranslation:{const x=e+90+l;a.a=C.cosDeg(e+h)*i,a.c=C.cosDeg(x)*r,a.b=C.sinDeg(e+h)*i,a.d=C.sinDeg(x)*r;break}case j.NoRotationOrReflection:{let x=f*f+m*m,E=0;x>1e-4?(x=Math.abs(f*g-u*m)/x,f/=o,m/=d,u=m*x,g=f*x,E=Math.atan2(m,f)*C.radDeg):(f=0,m=0,E=90-Math.atan2(g,u)*C.radDeg);const w=e+h-E,b=e+l-E+90,p=C.cosDeg(w)*i,S=C.cosDeg(b)*r,y=C.sinDeg(w)*i,M=C.sinDeg(b)*r;a.a=f*p-u*y,a.c=f*S-u*M,a.b=m*p+g*y,a.d=m*S+g*M;break}case j.NoScale:case j.NoScaleOrReflection:{const x=C.cosDeg(e),E=C.sinDeg(e);let w=(f*x+u*E)/o,b=(m*x+g*E)/d,p=Math.sqrt(w*w+b*b);p>1e-5&&(p=1/p),w*=p,b*=p,p=Math.sqrt(w*w+b*b),this.data.transformMode==j.NoScale&&f*g-u*m<0!=(o<0!=d<0)&&(p=-p);const S=Math.PI/2+Math.atan2(b,w),y=Math.cos(S)*p,M=Math.sin(S)*p,T=C.cosDeg(h)*i,k=C.cosDeg(90+l)*r,I=C.sinDeg(h)*i,R=C.sinDeg(90+l)*r;a.a=w*T+y*I,a.c=w*k+y*R,a.b=b*T+M*I,a.d=b*k+M*R;break}}a.a*=o,a.c*=o,a.b*=d,a.d*=d}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*C.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*C.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.b*t.b)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.c*t.c+t.d*t.d)}updateAppliedTransform(){const t=this.parent,n=this.matrix;if(!t){this.ax=n.tx-this.skeleton.x,this.ay=n.ty-this.skeleton.y,this.arotation=Math.atan2(n.b,n.a)*C.radDeg,this.ascaleX=Math.sqrt(n.a*n.a+n.b*n.b),this.ascaleY=Math.sqrt(n.c*n.c+n.d*n.d),this.ashearX=0,this.ashearY=Math.atan2(n.a*n.c+n.b*n.d,n.a*n.d-n.b*n.c)*C.radDeg;return}const e=t.matrix,i=1/(e.a*e.d-e.b*e.c),r=n.tx-e.tx,h=n.ty-e.ty;this.ax=r*e.d*i-h*e.c*i,this.ay=h*e.a*i-r*e.b*i;const l=i*e.d,s=i*e.a,a=i*e.c,o=i*e.b,d=l*n.a-a*n.b,f=l*n.c-a*n.d,u=s*n.b-o*n.a,m=s*n.d-o*n.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(d*d+u*u),this.ascaleX>1e-4){const g=d*m-f*u;this.ascaleY=g/this.ascaleX,this.ashearY=Math.atan2(d*f+u*m,g)*C.radDeg,this.arotation=Math.atan2(u,d)*C.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,f)*C.radDeg}worldToLocal(t){const n=this.matrix,e=n.a,i=n.c,r=n.b,h=n.d,l=1/(e*h-i*r),s=t.x-n.tx,a=t.y-n.ty;return t.x=s*h*l-a*i*l,t.y=a*e*l-s*r*l,t}localToWorld(t){const n=this.matrix,e=t.x,i=t.y;return t.x=e*n.a+i*n.c+n.tx,t.y=e*n.b+i*n.d+n.ty,t}worldToLocalRotation(t){const n=C.sinDeg(t),e=C.cosDeg(t),i=this.matrix;return Math.atan2(i.a*n-i.b*e,i.d*e-i.c*n)*C.radDeg}localToWorldRotation(t){t-=this.rotation-this.shearX;const n=C.sinDeg(t),e=C.cosDeg(t),i=this.matrix;return Math.atan2(e*i.b+n*i.d,e*i.a+n*i.c)*C.radDeg}rotateWorld(t){const n=this.matrix,e=n.a,i=n.c,r=n.b,h=n.d,l=C.cosDeg(t),s=C.sinDeg(t);n.a=l*e-s*r,n.c=l*i-s*h,n.b=s*e+l*r,n.d=s*i+l*h}}class li{constructor(t,n,e){if(this.index=0,this.parent=null,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=j.Normal,this.skinRequired=!1,this.color=new _,t<0)throw new Error("index must be >= 0.");if(!n)throw new Error("name cannot be null.");this.index=t,this.name=n,this.parent=e}}class jn{constructor(t,n,e){this.name=t,this.order=n,this.skinRequired=e}}class ci{constructor(t,n){if(this.intValue=0,this.floatValue=0,this.stringValue=null,this.time=0,this.volume=0,this.balance=0,!n)throw new Error("data cannot be null.");this.time=t,this.data=n}}class hi{constructor(t){this.intValue=0,this.floatValue=0,this.stringValue=null,this.audioPath=null,this.volume=0,this.balance=0,this.name=t}}class fr{constructor(t,n){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!n)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let i=0;i<t.bones.length;i++){const r=n.findBone(t.bones[i].name);if(!r)throw new Error(`Couldn't find bone ${t.bones[i].name}`);this.bones.push(r)}const e=n.findBone(t.target.name);if(!e)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=e}isActive(){return this.active}update(){if(this.mix==0)return;const t=this.target,n=this.bones;switch(n.length){case 1:this.apply1(n[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(n[0],n[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix);break}}apply1(t,n,e,i,r,h,l){const s=t.parent.matrix;if(!s)throw new Error("IK bone must have parent.");const a=s.a;let o=s.c;const d=s.b;let f=s.d,u=-t.ashearX-t.arotation,m=0,g=0;const x=t.skeleton.scaleX,E=zt.yDown?-t.skeleton.scaleY:t.skeleton.scaleY;switch(t.data.transformMode){case j.OnlyTranslation:m=n-t.worldX,g=e-t.worldY,zt.yDown&&(g=-g);break;case j.NoRotationOrReflection:const p=Math.abs(a*f-o*d)/(a*a+d*d),S=a/x,y=d/E;o=-y*p*x,f=S*p*E,u+=Math.atan2(y,S)*C.radDeg;default:const M=n-s.tx,T=e-s.ty,k=a*f-o*d;m=(M*f-T*o)/k-t.ax,g=(T*a-M*d)/k-t.ay}u+=Math.atan2(g,m)*C.radDeg,t.ascaleX<0&&(u+=180),u>180?u-=360:u<-180&&(u+=360);let w=t.ascaleX,b=t.ascaleY;if(i||r){switch(t.data.transformMode){case j.NoScale:case j.NoScaleOrReflection:m=n-t.worldX,g=e-t.worldY}const p=t.data.length*w,S=Math.sqrt(m*m+g*g);if(i&&S<p||r&&S>p&&p>1e-4){const y=(S/p-1)*l+1;w*=y,h&&(b*=y)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+u*l,w,b,t.ashearX,t.ashearY)}apply2(t,n,e,i,r,h,l,s,a){const o=t.ax,d=t.ay;let f=t.ascaleX,u=t.ascaleY,m=f,g=u,x=n.ascaleX;const E=t.matrix;let w=0,b=0,p=0;f<0?(f=-f,w=180,p=-1):(w=0,p=1),u<0&&(u=-u,p=-p),x<0?(x=-x,b=180):b=0;const S=n.ax;let y=0,M=0,T=0,k=E.a,I=E.c,R=E.b,V=E.d;const F=Math.abs(f-u)<=1e-4;!F||h?(y=0,M=k*S+E.tx,T=R*S+E.ty):(y=n.ay,M=k*S+I*y+E.tx,T=R*S+V*y+E.ty);const B=t.parent.matrix;if(!B)throw new Error("IK parent must itself have a parent.");k=B.a,I=B.c,R=B.b,V=B.d;const Y=1/(k*V-I*R);let N=M-B.tx,q=T-B.ty;const z=(N*V-q*I)*Y-o,D=(q*k-N*R)*Y-d,X=Math.sqrt(z*z+D*D);let L=n.data.length*x,O,W;if(X<1e-4){this.apply1(t,e,i,!1,h,!1,a),n.updateWorldTransformWith(S,y,0,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY);return}N=e-B.tx,q=i-B.ty;let U=(N*V-q*I)*Y-o,$=(q*k-N*R)*Y-d,G=U*U+$*$;if(s!=0){s*=f*(x+1)*.5;const ct=Math.sqrt(G),Xt=ct-X-L*f+s;if(Xt>0){let Ut=Math.min(1,Xt/(s*2))-1;Ut=(Xt-s*(1-Ut*Ut))/ct,U-=Ut*U,$-=Ut*$,G=U*U+$*$}}t:if(F){L*=f;let ct=(G-X*X-L*L)/(2*X*L);ct<-1?(ct=-1,W=Math.PI*r):ct>1?(ct=1,W=0,h&&(k=(Math.sqrt(G)/(X+L)-1)*a+1,m*=k,l&&(g*=k))):W=Math.acos(ct)*r,k=X+L*ct,I=L*Math.sin(W),O=Math.atan2($*k-U*I,U*k+$*I)}else{k=f*L,I=u*L;const ct=k*k,Xt=I*I,Ut=Math.atan2($,U);R=Xt*X*X+ct*G-ct*Xt;const de=-2*Xt*X,Me=Xt-ct;if(V=de*de-4*Me*R,V>=0){let Nt=Math.sqrt(V);de<0&&(Nt=-Nt),Nt=-(de+Nt)*.5;const We=Nt/Me,pr=R/Nt,yn=Math.abs(We)<Math.abs(pr)?We:pr;if(yn*yn<=G){q=Math.sqrt(G-yn*yn)*r,O=Ut-Math.atan2(q,yn),W=Math.atan2(q/u,(yn-X)/f);break t}}let Oe=C.PI,Ve=X-k,Ae=Ve*Ve,Ce=0,$e=0,Kt=X+k,ae=Kt*Kt,Ke=0;R=-k*X/(ct-Xt),R>=-1&&R<=1&&(R=Math.acos(R),N=k*Math.cos(R)+X,q=I*Math.sin(R),V=N*N+q*q,V<Ae&&(Oe=R,Ae=V,Ve=N,Ce=q),V>ae&&($e=R,ae=V,Kt=N,Ke=q)),G<=(Ae+ae)*.5?(O=Ut-Math.atan2(Ce*r,Ve),W=Oe*r):(O=Ut-Math.atan2(Ke*r,Kt),W=$e*r)}const lt=Math.atan2(y,S)*p;let It=t.arotation;O=(O-lt)*C.radDeg+w-It,O>180?O-=360:O<-180&&(O+=360),t.updateWorldTransformWith(o,d,It+O*a,m,g,0,0),It=n.arotation,W=((W+lt)*C.radDeg-n.ashearX)*p+b-It,W>180?W-=360:W<-180&&(W+=360),n.updateWorldTransformWith(S,y,It+W*a,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY)}}class di extends jn{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class fi extends jn{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.positionMode=dt.Fixed,this.spacingMode=kt.Fixed,this.rotateMode=pt.Chain,this.offsetRotation=0,this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}}var kt=(c=>(c[c.Length=0]="Length",c[c.Fixed=1]="Fixed",c[c.Percent=2]="Percent",c[c.Proportional=3]="Proportional",c))(kt||{});const Le=class{constructor(c,t){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,!c)throw new Error("data cannot be null.");if(!t)throw new Error("skeleton cannot be null.");this.data=c,this.bones=new Array;for(let e=0,i=c.bones.length;e<i;e++){const r=t.findBone(c.bones[e].name);if(!r)throw new Error(`Couldn't find bone ${c.bones[e].name}.`);this.bones.push(r)}const n=t.findSlot(c.target.name);if(!n)throw new Error(`Couldn't find target bone ${c.target.name}`);this.target=n,this.position=c.position,this.spacing=c.spacing,this.mixRotate=c.mixRotate,this.mixX=c.mixX,this.mixY=c.mixY}isActive(){return this.active}update(){const c=this.target.getAttachment();if(!(c instanceof ln))return;const t=this.mixRotate,n=this.mixX,e=this.mixY;if(t==0&&n==0&&e==0)return;const i=this.data,r=i.rotateMode==pt.Tangent,h=i.rotateMode==pt.ChainScale,l=this.bones,s=l.length,a=r?s:s+1,o=v.setArraySize(this.spaces,a),d=h?this.lengths=v.setArraySize(this.lengths,s):[],f=this.spacing;switch(i.spacingMode){case kt.Percent:if(h)for(let p=0,S=a-1;p<S;p++){const y=l[p],M=y.data.length;if(M<Le.epsilon)d[p]=0;else{const T=M*y.matrix.a,k=M*y.matrix.b;d[p]=Math.sqrt(T*T+k*k)}}v.arrayFill(o,1,a,f);break;case kt.Proportional:let w=0;for(let p=0,S=a-1;p<S;){const y=l[p],M=y.data.length;if(M<Le.epsilon)h&&(d[p]=0),o[++p]=f;else{const T=M*y.matrix.a,k=M*y.matrix.b,I=Math.sqrt(T*T+k*k);h&&(d[p]=I),o[++p]=I,w+=I}}if(w>0){w=a/w*f;for(let p=1;p<a;p++)o[p]*=w}break;default:const b=i.spacingMode==kt.Length;for(let p=0,S=a-1;p<S;){const y=l[p],M=y.data.length;if(M<Le.epsilon)h&&(d[p]=0),o[++p]=f;else{const T=M*y.matrix.a,k=M*y.matrix.b,I=Math.sqrt(T*T+k*k);h&&(d[p]=I),o[++p]=(b?M+f:f)*I/M}}}const u=this.computeWorldPositions(c,a,r);let m=u[0],g=u[1],x=i.offsetRotation,E=!1;if(x==0)E=i.rotateMode==pt.Chain;else{E=!1;const w=this.target.bone.matrix;x*=w.a*w.d-w.b*w.c>0?C.degRad:-C.degRad}for(let w=0,b=3;w<s;w++,b+=3){const p=l[w],S=p.matrix;S.tx+=(m-S.tx)*n,S.ty+=(g-S.ty)*e;const y=u[b],M=u[b+1],T=y-m,k=M-g;if(h){const I=d[w];if(I!=0){const R=(Math.sqrt(T*T+k*k)/I-1)*t+1;S.a*=R,S.b*=R}}if(m=y,g=M,t>0){const I=S.a,R=S.c,V=S.b,F=S.d;let B=0,Y=0,N=0;if(r?B=u[b-1]:o[w+1]==0?B=u[b+2]:B=Math.atan2(k,T),B-=Math.atan2(V,I),E){Y=Math.cos(B),N=Math.sin(B);const q=p.data.length;m+=(q*(Y*I-N*V)-T)*t,g+=(q*(N*I+Y*V)-k)*t}else B+=x;B>C.PI?B-=C.PI2:B<-C.PI&&(B+=C.PI2),B*=t,Y=Math.cos(B),N=Math.sin(B),S.a=Y*I-N*V,S.c=Y*R-N*F,S.b=N*I+Y*V,S.d=N*R+Y*F}p.updateAppliedTransform()}}computeWorldPositions(c,t,n){const e=this.target;let i=this.position;const r=this.spaces,h=v.setArraySize(this.positions,t*3+2);let l=this.world;const s=c.closed;let a=c.worldVerticesLength,o=a/6,d=Le.NONE;if(!c.constantSpeed){const q=c.lengths;o-=s?1:2;const z=q[o];this.data.positionMode==dt.Percent&&(i*=z);let D;switch(this.data.spacingMode){case kt.Percent:D=z;break;case kt.Proportional:D=z/t;break;default:D=1}l=v.setArraySize(this.world,8);for(let X=0,L=0,O=0;X<t;X++,L+=3){const W=r[X]*D;i+=W;let U=i;if(s)U%=z,U<0&&(U+=z),O=0;else if(U<0){d!=Le.BEFORE&&(d=Le.BEFORE,c.computeWorldVertices(e,2,4,l,0,2)),this.addBeforePosition(U,l,0,h,L);continue}else if(U>z){d!=Le.AFTER&&(d=Le.AFTER,c.computeWorldVertices(e,a-6,4,l,0,2)),this.addAfterPosition(U-z,l,0,h,L);continue}for(;;O++){const $=q[O];if(!(U>$)){if(O==0)U/=$;else{const G=q[O-1];U=(U-G)/($-G)}break}}O!=d&&(d=O,s&&O==o?(c.computeWorldVertices(e,a-4,4,l,0,2),c.computeWorldVertices(e,0,4,l,4,2)):c.computeWorldVertices(e,O*6+2,8,l,0,2)),this.addCurvePosition(U,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],h,L,n||X>0&&W==0)}return h}s?(a+=2,l=v.setArraySize(this.world,a),c.computeWorldVertices(e,2,a-4,l,0,2),c.computeWorldVertices(e,0,2,l,a-4,2),l[a-2]=l[0],l[a-1]=l[1]):(o--,a-=4,l=v.setArraySize(this.world,a),c.computeWorldVertices(e,2,a,l,0,2));const f=v.setArraySize(this.curves,o);let u=0,m=l[0],g=l[1],x=0,E=0,w=0,b=0,p=0,S=0,y=0,M=0,T=0,k=0,I=0,R=0,V=0,F=0;for(let q=0,z=2;q<o;q++,z+=6)x=l[z],E=l[z+1],w=l[z+2],b=l[z+3],p=l[z+4],S=l[z+5],y=(m-x*2+w)*.1875,M=(g-E*2+b)*.1875,T=((x-w)*3-m+p)*.09375,k=((E-b)*3-g+S)*.09375,I=y*2+T,R=M*2+k,V=(x-m)*.75+y+T*.16666667,F=(E-g)*.75+M+k*.16666667,u+=Math.sqrt(V*V+F*F),V+=I,F+=R,I+=T,R+=k,u+=Math.sqrt(V*V+F*F),V+=I,F+=R,u+=Math.sqrt(V*V+F*F),V+=I+T,F+=R+k,u+=Math.sqrt(V*V+F*F),f[q]=u,m=p,g=S;this.data.positionMode==dt.Percent&&(i*=u);let B;switch(this.data.spacingMode){case kt.Percent:B=u;break;case kt.Proportional:B=u/t;break;default:B=1}const Y=this.segments;let N=0;for(let q=0,z=0,D=0,X=0;q<t;q++,z+=3){const L=r[q]*B;i+=L;let O=i;if(s)O%=u,O<0&&(O+=u),D=0;else if(O<0){this.addBeforePosition(O,l,0,h,z);continue}else if(O>u){this.addAfterPosition(O-u,l,a-4,h,z);continue}for(;;D++){const W=f[D];if(!(O>W)){if(D==0)O/=W;else{const U=f[D-1];O=(O-U)/(W-U)}break}}if(D!=d){d=D;let W=D*6;for(m=l[W],g=l[W+1],x=l[W+2],E=l[W+3],w=l[W+4],b=l[W+5],p=l[W+6],S=l[W+7],y=(m-x*2+w)*.03,M=(g-E*2+b)*.03,T=((x-w)*3-m+p)*.006,k=((E-b)*3-g+S)*.006,I=y*2+T,R=M*2+k,V=(x-m)*.3+y+T*.16666667,F=(E-g)*.3+M+k*.16666667,N=Math.sqrt(V*V+F*F),Y[0]=N,W=1;W<8;W++)V+=I,F+=R,I+=T,R+=k,N+=Math.sqrt(V*V+F*F),Y[W]=N;V+=I,F+=R,N+=Math.sqrt(V*V+F*F),Y[8]=N,V+=I+T,F+=R+k,N+=Math.sqrt(V*V+F*F),Y[9]=N,X=0}for(O*=N;;X++){const W=Y[X];if(!(O>W)){if(X==0)O/=W;else{const U=Y[X-1];O=X+(O-U)/(W-U)}break}}this.addCurvePosition(O*.1,m,g,x,E,w,b,p,S,h,z,n||q>0&&L==0)}return h}addBeforePosition(c,t,n,e,i){const r=t[n],h=t[n+1],l=t[n+2]-r,s=t[n+3]-h,a=Math.atan2(s,l);e[i]=r+c*Math.cos(a),e[i+1]=h+c*Math.sin(a),e[i+2]=a}addAfterPosition(c,t,n,e,i){const r=t[n+2],h=t[n+3],l=r-t[n],s=h-t[n+1],a=Math.atan2(s,l);e[i]=r+c*Math.cos(a),e[i+1]=h+c*Math.sin(a),e[i+2]=a}addCurvePosition(c,t,n,e,i,r,h,l,s,a,o,d){if(c==0||isNaN(c)){a[o]=t,a[o+1]=n,a[o+2]=Math.atan2(i-n,e-t);return}const f=c*c,u=f*c,m=1-c,g=m*m,x=g*m,E=m*c,w=E*3,b=m*w,p=w*c,S=t*x+e*b+r*p+l*u,y=n*x+i*b+h*p+s*u;a[o]=S,a[o+1]=y,d&&(c<.001?a[o+2]=Math.atan2(i-n,e-t):a[o+2]=Math.atan2(y-(n*g+i*E*2+h*f),S-(t*g+e*E*2+r*f)))}};let Sn=Le;Sn.NONE=-1,Sn.BEFORE=-2,Sn.AFTER=-3,Sn.epsilon=1e-5;class ur{constructor(t,n){if(this.darkColor=null,this.attachment=null,this.attachmentState=0,this.sequenceIndex=-1,this.deform=new Array,!t)throw new Error("data cannot be null.");if(!n)throw new Error("bone cannot be null.");this.data=t,this.bone=n,this.color=new _,this.darkColor=t.darkColor?new _:null,this.setToSetupPose(),this.blendMode=this.data.blendMode}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&((!(t instanceof we)||!(this.attachment instanceof we)||t.timelineAttachment!=this.attachment.timelineAttachment)&&(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class mr{constructor(t,n){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new un,this.active=!1,!t)throw new Error("data cannot be null.");if(!n)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let i=0;i<t.bones.length;i++){const r=n.findBone(t.bones[i].name);if(!r)throw new Error(`Couldn't find bone ${t.bones[i].name}.`);this.bones.push(r)}const e=n.findBone(t.target.name);if(!e)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=e}isActive(){return this.active}update(){this.mixRotate==0&&this.mixX==0&&this.mixY==0&&this.mixScaleX==0&&this.mixScaleX==0&&this.mixShearY==0||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){const t=this.mixRotate,n=this.mixX,e=this.mixY,i=this.mixScaleX,r=this.mixScaleY,h=this.mixShearY,l=n!=0||e!=0,s=this.target,a=s.matrix,o=a.a,d=a.c,f=a.b,u=a.d,m=o*u-d*f>0?C.degRad:-C.degRad,g=this.data.offsetRotation*m,x=this.data.offsetShearY*m,E=this.bones;for(let w=0,b=E.length;w<b;w++){const p=E[w],S=p.matrix;if(t!=0){const y=S.a,M=S.c,T=S.b,k=S.d;let I=Math.atan2(f,o)-Math.atan2(T,y)+g;I>C.PI?I-=C.PI2:I<-C.PI&&(I+=C.PI2),I*=t;const R=Math.cos(I),V=Math.sin(I);S.a=R*y-V*T,S.c=R*M-V*k,S.b=V*y+R*T,S.d=V*M+R*k}if(l){const y=this.temp;s.localToWorld(y.set(this.data.offsetX,this.data.offsetY)),S.tx+=(y.x-S.tx)*n,S.ty+=(y.y-S.ty)*e}if(i!=0){let y=Math.sqrt(S.a*S.a+S.b*S.b);y!=0&&(y=(y+(Math.sqrt(o*o+f*f)-y+this.data.offsetScaleX)*i)/y),S.a*=y,S.b*=y}if(r!=0){let y=Math.sqrt(S.c*S.c+S.d*S.d);y!=0&&(y=(y+(Math.sqrt(d*d+u*u)-y+this.data.offsetScaleY)*r)/y),S.c*=y,S.d*=y}if(h>0){const y=S.c,M=S.d,T=Math.atan2(M,y);let k=Math.atan2(u,d)-Math.atan2(f,o)-(T-Math.atan2(S.b,S.a));k>C.PI?k-=C.PI2:k<-C.PI&&(k+=C.PI2),k=T+(k+x)*h;const I=Math.sqrt(y*y+M*M);S.c=Math.cos(k)*I,S.d=Math.sin(k)*I}p.updateAppliedTransform()}}applyRelativeWorld(){const t=this.mixRotate,n=this.mixX,e=this.mixY,i=this.mixScaleX,r=this.mixScaleY,h=this.mixShearY,l=n!=0||e!=0,s=this.target,a=s.matrix,o=a.a,d=a.c,f=a.b,u=a.d,m=o*u-d*f>0?C.degRad:-C.degRad,g=this.data.offsetRotation*m,x=this.data.offsetShearY*m,E=this.bones;for(let w=0,b=E.length;w<b;w++){const p=E[w],S=p.matrix;if(t!=0){const y=S.a,M=S.c,T=S.b,k=S.d;let I=Math.atan2(f,o)+g;I>C.PI?I-=C.PI2:I<-C.PI&&(I+=C.PI2),I*=t;const R=Math.cos(I),V=Math.sin(I);S.a=R*y-V*T,S.c=R*M-V*k,S.b=V*y+R*T,S.d=V*M+R*k}if(l){const y=this.temp;s.localToWorld(y.set(this.data.offsetX,this.data.offsetY)),S.tx+=y.x*n,S.ty+=y.y*e}if(i!=0){const y=(Math.sqrt(o*o+f*f)-1+this.data.offsetScaleX)*i+1;S.a*=y,S.b*=y}if(r!=0){const y=(Math.sqrt(d*d+u*u)-1+this.data.offsetScaleY)*r+1;S.c*=y,S.d*=y}if(h>0){let y=Math.atan2(u,d)-Math.atan2(f,o);y>C.PI?y-=C.PI2:y<-C.PI&&(y+=C.PI2);const M=S.c,T=S.d;y=Math.atan2(T,M)+(y-C.PI/2+x)*h;const k=Math.sqrt(M*M+T*T);S.c=Math.cos(y)*k,S.d=Math.sin(y)*k}p.updateAppliedTransform()}}applyAbsoluteLocal(){const t=this.mixRotate,n=this.mixX,e=this.mixY,i=this.mixScaleX,r=this.mixScaleY,h=this.mixShearY,l=this.target,s=this.bones;for(let a=0,o=s.length;a<o;a++){const d=s[a];let f=d.arotation;if(t!=0){let w=l.arotation-f+this.data.offsetRotation;w-=(16384-(16384.499999999996-w/360|0))*360,f+=w*t}let u=d.ax,m=d.ay;u+=(l.ax-u+this.data.offsetX)*n,m+=(l.ay-m+this.data.offsetY)*e;let g=d.ascaleX,x=d.ascaleY;i!=0&&g!=0&&(g=(g+(l.ascaleX-g+this.data.offsetScaleX)*i)/g),r!=0&&x!=0&&(x=(x+(l.ascaleY-x+this.data.offsetScaleY)*r)/x);let E=d.ashearY;if(h!=0){let w=l.ashearY-E+this.data.offsetShearY;w-=(16384-(16384.499999999996-w/360|0))*360,E+=w*h}d.updateWorldTransformWith(u,m,f,g,x,d.ashearX,E)}}applyRelativeLocal(){const t=this.mixRotate,n=this.mixX,e=this.mixY,i=this.mixScaleX,r=this.mixScaleY,h=this.mixShearY,l=this.target,s=this.bones;for(let a=0,o=s.length;a<o;a++){const d=s[a],f=d.arotation+(l.arotation+this.data.offsetRotation)*t,u=d.ax+(l.ax+this.data.offsetX)*n,m=d.ay+(l.ay+this.data.offsetY)*e,g=d.ascaleX*((l.ascaleX-1+this.data.offsetScaleX)*i+1),x=d.ascaleY*((l.ascaleY-1+this.data.offsetScaleY)*r+1),E=d.ashearY+(l.ashearY+this.data.offsetShearY)*h;d.updateWorldTransformWith(u,m,f,g,x,d.ashearX,E)}}}const Pn=class{constructor(c){if(this._updateCache=new Array,this.skin=null,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,!c)throw new Error("data cannot be null.");this.data=c,this.bones=new Array;for(let t=0;t<c.bones.length;t++){const n=c.bones[t];let e;if(!n.parent)e=new oi(n,this,null);else{const i=this.bones[n.parent.index];e=new oi(n,this,i),i.children.push(e)}this.bones.push(e)}this.slots=new Array,this.drawOrder=new Array;for(let t=0;t<c.slots.length;t++){const n=c.slots[t],e=this.bones[n.boneData.index],i=new ur(n,e);this.slots.push(i),this.drawOrder.push(i)}this.ikConstraints=new Array;for(let t=0;t<c.ikConstraints.length;t++){const n=c.ikConstraints[t];this.ikConstraints.push(new fr(n,this))}this.transformConstraints=new Array;for(let t=0;t<c.transformConstraints.length;t++){const n=c.transformConstraints[t];this.transformConstraints.push(new mr(n,this))}this.pathConstraints=new Array;for(let t=0;t<c.pathConstraints.length;t++){const n=c.pathConstraints[t];this.pathConstraints.push(new Sn(n,this))}this.color=new _(1,1,1,1),this.updateCache()}updateCache(){const c=this._updateCache;c.length=0;const t=this.bones;for(let a=0,o=t.length;a<o;a++){const d=t[a];d.sorted=d.data.skinRequired,d.active=!d.sorted}if(this.skin){const a=this.skin.bones;for(let o=0,d=this.skin.bones.length;o<d;o++){let f=this.bones[a[o].index];do f.sorted=!1,f.active=!0,f=f.parent;while(f)}}const n=this.ikConstraints,e=this.transformConstraints,i=this.pathConstraints,r=n.length,h=e.length,l=i.length,s=r+h+l;t:for(let a=0;a<s;a++){for(let o=0;o<r;o++){const d=n[o];if(d.data.order==a){this.sortIkConstraint(d);continue t}}for(let o=0;o<h;o++){const d=e[o];if(d.data.order==a){this.sortTransformConstraint(d);continue t}}for(let o=0;o<l;o++){const d=i[o];if(d.data.order==a){this.sortPathConstraint(d);continue t}}}for(let a=0,o=t.length;a<o;a++)this.sortBone(t[a])}sortIkConstraint(c){if(c.active=c.target.isActive()&&(!c.data.skinRequired||this.skin&&v.contains(this.skin.constraints,c.data,!0)),!c.active)return;const t=c.target;this.sortBone(t);const n=c.bones,e=n[0];if(this.sortBone(e),n.length==1)this._updateCache.push(c),this.sortReset(e.children);else{const i=n[n.length-1];this.sortBone(i),this._updateCache.push(c),this.sortReset(e.children),i.sorted=!0}}sortPathConstraint(c){if(c.active=c.target.bone.isActive()&&(!c.data.skinRequired||this.skin&&v.contains(this.skin.constraints,c.data,!0)),!c.active)return;const t=c.target,n=t.data.index,e=t.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,n,e),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,e);for(let l=0,s=this.data.skins.length;l<s;l++)this.sortPathConstraintAttachment(this.data.skins[l],n,e);const i=t.getAttachment();i instanceof ln&&this.sortPathConstraintAttachmentWith(i,e);const r=c.bones,h=r.length;for(let l=0;l<h;l++)this.sortBone(r[l]);this._updateCache.push(c);for(let l=0;l<h;l++)this.sortReset(r[l].children);for(let l=0;l<h;l++)r[l].sorted=!0}sortTransformConstraint(c){if(c.active=c.target.isActive()&&(!c.data.skinRequired||this.skin&&v.contains(this.skin.constraints,c.data,!0)),!c.active)return;this.sortBone(c.target);const t=c.bones,n=t.length;if(c.data.local)for(let e=0;e<n;e++){const i=t[e];this.sortBone(i.parent),this.sortBone(i)}else for(let e=0;e<n;e++)this.sortBone(t[e]);this._updateCache.push(c);for(let e=0;e<n;e++)this.sortReset(t[e].children);for(let e=0;e<n;e++)t[e].sorted=!0}sortPathConstraintAttachment(c,t,n){const e=c.attachments[t];if(e)for(const i in e)this.sortPathConstraintAttachmentWith(e[i],n)}sortPathConstraintAttachmentWith(c,t){if(!(c instanceof ln))return;const n=c.bones;if(!n)this.sortBone(t);else{const e=this.bones;for(let i=0,r=n.length;i<r;){let h=n[i++];for(h+=i;i<h;)this.sortBone(e[n[i++]])}}}sortBone(c){if(!c||c.sorted)return;const t=c.parent;t&&this.sortBone(t),c.sorted=!0,this._updateCache.push(c)}sortReset(c){for(let t=0,n=c.length;t<n;t++){const e=c[t];e.active&&(e.sorted&&this.sortReset(e.children),e.sorted=!1)}}updateWorldTransform(){const c=this.bones;for(let n=0,e=c.length;n<e;n++){const i=c[n];i.ax=i.x,i.ay=i.y,i.arotation=i.rotation,i.ascaleX=i.scaleX,i.ascaleY=i.scaleY,i.ashearX=i.shearX,i.ashearY=i.shearY}const t=this._updateCache;for(let n=0,e=t.length;n<e;n++)t[n].update()}updateWorldTransformWith(c){const t=this.getRootBone(),n=c.matrix.a,e=c.matrix.c,i=c.matrix.b,r=c.matrix.d;t.matrix.tx=n*this.x+e*this.y+c.worldX,t.matrix.ty=i*this.x+r*this.y+c.worldY;const h=t.rotation+90+t.shearY,l=C.cosDeg(t.rotation+t.shearX)*t.scaleX,s=C.cosDeg(h)*t.scaleY,a=C.sinDeg(t.rotation+t.shearX)*t.scaleX,o=C.sinDeg(h)*t.scaleY,d=this.scaleX,f=zt.yDown?-this.scaleY:this.scaleY;t.matrix.a=(n*l+e*a)*d,t.matrix.c=(n*s+e*o)*d,t.matrix.b=(i*l+r*a)*f,t.matrix.d=(i*s+r*o)*f;const u=this._updateCache;for(let m=0,g=u.length;m<g;m++){const x=u[m];x!=t&&x.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const c=this.bones;for(let i=0,r=c.length;i<r;i++)c[i].setToSetupPose();const t=this.ikConstraints;for(let i=0,r=t.length;i<r;i++){const h=t[i];h.mix=h.data.mix,h.softness=h.data.softness,h.bendDirection=h.data.bendDirection,h.compress=h.data.compress,h.stretch=h.data.stretch}const n=this.transformConstraints;for(let i=0,r=n.length;i<r;i++){const h=n[i],l=h.data;h.mixRotate=l.mixRotate,h.mixX=l.mixX,h.mixY=l.mixY,h.mixScaleX=l.mixScaleX,h.mixScaleY=l.mixScaleY,h.mixShearY=l.mixShearY}const e=this.pathConstraints;for(let i=0,r=e.length;i<r;i++){const h=e[i],l=h.data;h.position=l.position,h.spacing=l.spacing,h.mixRotate=l.mixRotate,h.mixX=l.mixX,h.mixY=l.mixY}}setSlotsToSetupPose(){const c=this.slots;v.arrayCopy(c,0,this.drawOrder,0,c.length);for(let t=0,n=c.length;t<n;t++)c[t].setToSetupPose()}getRootBone(){return this.bones.length==0?null:this.bones[0]}findBone(c){if(!c)throw new Error("boneName cannot be null.");const t=this.bones;for(let n=0,e=t.length;n<e;n++){const i=t[n];if(i.data.name==c)return i}return null}findBoneIndex(c){if(!c)throw new Error("boneName cannot be null.");const t=this.bones;for(let n=0,e=t.length;n<e;n++)if(t[n].data.name==c)return n;return-1}findSlot(c){if(!c)throw new Error("slotName cannot be null.");const t=this.slots;for(let n=0,e=t.length;n<e;n++){const i=t[n];if(i.data.name==c)return i}return null}findSlotIndex(c){if(!c)throw new Error("slotName cannot be null.");const t=this.slots;for(let n=0,e=t.length;n<e;n++)if(t[n].data.name==c)return n;return-1}setSkinByName(c){const t=this.data.findSkin(c);if(!t)throw new Error(`Skin not found: ${c}`);this.setSkin(t)}setSkin(c){if(c!=this.skin){if(c)if(this.skin)c.attachAll(this,this.skin);else{const t=this.slots;for(let n=0,e=t.length;n<e;n++){const i=t[n],r=i.data.attachmentName;if(r){const h=c.getAttachment(n,r);h&&i.setAttachment(h)}}}this.skin=c,this.updateCache()}}getAttachmentByName(c,t){const n=this.data.findSlot(c);if(!n)throw new Error(`Can't find slot with name ${c}`);return this.getAttachment(n.index,t)}getAttachment(c,t){if(!t)throw new Error("attachmentName cannot be null.");if(this.skin){const n=this.skin.getAttachment(c,t);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(c,t):null}setAttachment(c,t){if(!c)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.data.name==c){let h=null;if(t&&(h=this.getAttachment(e,t),!h))throw new Error(`Attachment not found: ${t}, for slot: ${c}`);r.setAttachment(h);return}}throw new Error(`Slot not found: ${c}`)}findIkConstraint(c){if(!c)throw new Error("constraintName cannot be null.");const t=this.ikConstraints;for(let n=0,e=t.length;n<e;n++){const i=t[n];if(i.data.name==c)return i}return null}findTransformConstraint(c){if(!c)throw new Error("constraintName cannot be null.");const t=this.transformConstraints;for(let n=0,e=t.length;n<e;n++){const i=t[n];if(i.data.name==c)return i}return null}findPathConstraint(c){if(!c)throw new Error("constraintName cannot be null.");const t=this.pathConstraints;for(let n=0,e=t.length;n<e;n++){const i=t[n];if(i.data.name==c)return i}return null}getBoundsRect(){const c=new un,t=new un;return this.getBounds(c,t),{x:c.x,y:c.y,width:t.x,height:t.y}}getBounds(c,t,n=new Array(2)){if(!c)throw new Error("offset cannot be null.");if(!t)throw new Error("size cannot be null.");const e=this.drawOrder;let i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(let s=0,a=e.length;s<a;s++){const o=e[s];if(!o.bone.active)continue;let d=0,f=null;const u=o.getAttachment();if(u instanceof it)d=8,f=v.setArraySize(n,d,0),u.computeWorldVertices(o,f,0,2);else if(u instanceof on){const m=u;d=m.worldVerticesLength,f=v.setArraySize(n,d,0),m.computeWorldVertices(o,0,d,f,0,2)}if(f)for(let m=0,g=f.length;m<g;m+=2){const x=f[m],E=f[m+1];i=Math.min(i,x),r=Math.min(r,E),h=Math.max(h,x),l=Math.max(l,E)}}c.set(i,r),t.set(h-i,l-r)}get flipX(){return this.scaleX==-1}set flipX(c){Pn.deprecatedWarning1||(Pn.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleX=c?1:-1}get flipY(){return this.scaleY==-1}set flipY(c){Pn.deprecatedWarning1||(Pn.deprecatedWarning1=!0,console.warn("Spine Deprecation Warning: `Skeleton.flipX/flipY` was deprecated, please use scaleX/scaleY")),this.scaleY=c?1:-1}};let ui=Pn;ui.deprecatedWarning1=!1;class mi{constructor(){this.name=null,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=null,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=0,this.y=0,this.width=0,this.height=0,this.version=null,this.hash=null,this.fps=0,this.imagesPath=null,this.audioPath=null}findBone(t){if(!t)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const n=this.bones;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const n=this.slots;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}findSkin(t){if(!t)throw new Error("skinName cannot be null.");const n=this.skins;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");const n=this.events;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");const n=this.animations;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const n=this.ikConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const n=this.transformConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const n=this.pathConstraints;for(let e=0,i=n.length;e<i;e++){const r=n[e];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(t==null)throw new Error("pathConstraintName cannot be null.");const n=this.pathConstraints;for(let e=0,i=n.length;e<i;e++)if(n[e].name==t)return e;return-1}}class gi{constructor(t,n,e){if(this.index=0,this.color=new _(1,1,1,1),this.darkColor=null,this.attachmentName=null,this.blendMode=H.BLEND_MODES.NORMAL,t<0)throw new Error("index must be >= 0.");if(!n)throw new Error("name cannot be null.");if(!e)throw new Error("boneData cannot be null.");this.index=t,this.name=n,this.boneData=e}}class xi extends jn{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class pi{constructor(t,n,e){this.slotIndex=t,this.name=n,this.attachment=e}}class Zn{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,n,e){if(!e)throw new Error("attachment cannot be null.");const i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][n]=e}addSkin(t){for(let e=0;e<t.bones.length;e++){const i=t.bones[e];let r=!1;for(let h=0;h<this.bones.length;h++)if(this.bones[h]==i){r=!0;break}r||this.bones.push(i)}for(let e=0;e<t.constraints.length;e++){const i=t.constraints[e];let r=!1;for(let h=0;h<this.constraints.length;h++)if(this.constraints[h]==i){r=!0;break}r||this.constraints.push(i)}const n=t.getAttachments();for(let e=0;e<n.length;e++){const i=n[e];this.setAttachment(i.slotIndex,i.name,i.attachment)}}copySkin(t){for(let e=0;e<t.bones.length;e++){const i=t.bones[e];let r=!1;for(let h=0;h<this.bones.length;h++)if(this.bones[h]==i){r=!0;break}r||this.bones.push(i)}for(let e=0;e<t.constraints.length;e++){const i=t.constraints[e];let r=!1;for(let h=0;h<this.constraints.length;h++)if(this.constraints[h]==i){r=!0;break}r||this.constraints.push(i)}const n=t.getAttachments();for(let e=0;e<n.length;e++){const i=n[e];i.attachment&&(i.attachment instanceof on?(i.attachment=i.attachment.newLinkedMesh(),this.setAttachment(i.slotIndex,i.name,i.attachment)):(i.attachment=i.attachment.copy(),this.setAttachment(i.slotIndex,i.name,i.attachment)))}}getAttachment(t,n){const e=this.attachments[t];return e?e[n]:null}removeAttachment(t,n){const e=this.attachments[t];e&&delete e[n]}getAttachments(){const t=new Array;for(let n=0;n<this.attachments.length;n++){const e=this.attachments[n];if(e)for(const i in e){const r=e[i];r&&t.push(new pi(n,i,r))}}return t}getAttachmentsForSlot(t,n){const e=this.attachments[t];if(e)for(const i in e){const r=e[i];r&&n.push(new pi(t,i,r))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,n){let e=0;for(let i=0;i<t.slots.length;i++){const r=t.slots[i],h=r.getAttachment();if(h&&e<n.attachments.length){const l=n.attachments[e];for(const s in l){const a=l[s];if(h==a){const o=this.getAttachment(e,s);o&&r.setAttachment(o);break}}}e++}}}class wi{constructor(t){this.ver40=!1,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const n=this.scale,e=new mi;e.name="";const i=new Mn(t),r=i.readInt32(),h=i.readInt32();e.hash=h==0&&r==0?null:h.toString(16)+r.toString(16),e.version=i.readString();const l=e.version.substr(0,3);if(l!=="4.0"&&l!=="4.1"){const d=`Spine 4.1 loader cant load version ${e.version}. Please configure your pixi-spine bundle`;console.error(d)}this.ver40=l==="4.0",e.x=i.readFloat(),e.y=i.readFloat(),e.width=i.readFloat(),e.height=i.readFloat();const s=i.readBoolean();s&&(e.fps=i.readFloat(),e.imagesPath=i.readString(),e.audioPath=i.readString());let a=0;a=i.readInt(!0);for(let d=0;d<a;d++){const f=i.readString();if(!f)throw new Error("String in string table must not be null.");i.strings.push(f)}a=i.readInt(!0);for(let d=0;d<a;d++){const f=i.readString();if(!f)throw new Error("Bone name must not be null.");const u=d==0?null:e.bones[i.readInt(!0)],m=new li(d,f,u);m.rotation=i.readFloat(),m.x=i.readFloat()*n,m.y=i.readFloat()*n,m.scaleX=i.readFloat(),m.scaleY=i.readFloat(),m.shearX=i.readFloat(),m.shearY=i.readFloat(),m.length=i.readFloat()*n,m.transformMode=i.readInt(!0),m.skinRequired=i.readBoolean(),s&&_.rgba8888ToColor(m.color,i.readInt32()),e.bones.push(m)}a=i.readInt(!0);for(let d=0;d<a;d++){const f=i.readString();if(!f)throw new Error("Slot name must not be null.");const u=e.bones[i.readInt(!0)],m=new gi(d,f,u);_.rgba8888ToColor(m.color,i.readInt32());const g=i.readInt32();g!=-1&&_.rgb888ToColor(m.darkColor=new _,g),m.attachmentName=i.readStringRef(),m.blendMode=i.readInt(!0),e.slots.push(m)}a=i.readInt(!0);for(let d=0,f;d<a;d++){const u=i.readString();if(!u)throw new Error("IK constraint data name must not be null.");const m=new di(u);m.order=i.readInt(!0),m.skinRequired=i.readBoolean(),f=i.readInt(!0);for(let g=0;g<f;g++)m.bones.push(e.bones[i.readInt(!0)]);m.target=e.bones[i.readInt(!0)],m.mix=i.readFloat(),m.softness=i.readFloat()*n,m.bendDirection=i.readByte(),m.compress=i.readBoolean(),m.stretch=i.readBoolean(),m.uniform=i.readBoolean(),e.ikConstraints.push(m)}a=i.readInt(!0);for(let d=0,f;d<a;d++){const u=i.readString();if(!u)throw new Error("Transform constraint data name must not be null.");const m=new xi(u);m.order=i.readInt(!0),m.skinRequired=i.readBoolean(),f=i.readInt(!0);for(let g=0;g<f;g++)m.bones.push(e.bones[i.readInt(!0)]);m.target=e.bones[i.readInt(!0)],m.local=i.readBoolean(),m.relative=i.readBoolean(),m.offsetRotation=i.readFloat(),m.offsetX=i.readFloat()*n,m.offsetY=i.readFloat()*n,m.offsetScaleX=i.readFloat(),m.offsetScaleY=i.readFloat(),m.offsetShearY=i.readFloat(),m.mixRotate=i.readFloat(),m.mixX=i.readFloat(),m.mixY=i.readFloat(),m.mixScaleX=i.readFloat(),m.mixScaleY=i.readFloat(),m.mixShearY=i.readFloat(),e.transformConstraints.push(m)}a=i.readInt(!0);for(let d=0,f;d<a;d++){const u=i.readString();if(!u)throw new Error("Path constraint data name must not be null.");const m=new fi(u);m.order=i.readInt(!0),m.skinRequired=i.readBoolean(),f=i.readInt(!0);for(let g=0;g<f;g++)m.bones.push(e.bones[i.readInt(!0)]);m.target=e.slots[i.readInt(!0)],m.positionMode=i.readInt(!0),m.spacingMode=i.readInt(!0),m.rotateMode=i.readInt(!0),m.offsetRotation=i.readFloat(),m.position=i.readFloat(),m.positionMode==dt.Fixed&&(m.position*=n),m.spacing=i.readFloat(),(m.spacingMode==kt.Length||m.spacingMode==kt.Fixed)&&(m.spacing*=n),m.mixRotate=i.readFloat(),m.mixX=i.readFloat(),m.mixY=i.readFloat(),e.pathConstraints.push(m)}const o=this.readSkin(i,e,!0,s);o&&(e.defaultSkin=o,e.skins.push(o));{let d=e.skins.length;for(v.setArraySize(e.skins,a=d+i.readInt(!0));d<a;d++){const f=this.readSkin(i,e,!1,s);if(!f)throw new Error("readSkin() should not have returned null.");e.skins[d]=f}}a=this.linkedMeshes.length;for(let d=0;d<a;d++){const f=this.linkedMeshes[d],u=f.skin?e.findSkin(f.skin):e.defaultSkin;if(!u)throw new Error("Not skin found for linked mesh.");if(!f.parent)throw new Error("Linked mesh parent must not be null");const m=u.getAttachment(f.slotIndex,f.parent);if(!m)throw new Error(`Parent mesh not found: ${f.parent}`);f.mesh.timelineAttachment=f.inheritTimeline?m:f.mesh,f.mesh.setParentMesh(m)}this.linkedMeshes.length=0,a=i.readInt(!0);for(let d=0;d<a;d++){const f=i.readStringRef();if(!f)throw new Error;const u=new hi(f);u.intValue=i.readInt(!1),u.floatValue=i.readFloat(),u.stringValue=i.readString(),u.audioPath=i.readString(),u.audioPath&&(u.volume=i.readFloat(),u.balance=i.readFloat()),e.events.push(u)}a=i.readInt(!0);for(let d=0;d<a;d++){const f=i.readString();if(!f)throw new Error("Animatio name must not be null.");e.animations.push(this.readAnimation(i,f,e))}return e}readSkin(t,n,e,i){let r=null,h=0;if(e){if(h=t.readInt(!0),h==0)return null;r=new Zn("default")}else{const l=t.readStringRef();if(!l)throw new Error("Skin name must not be null.");r=new Zn(l),r.bones.length=t.readInt(!0);for(let s=0,a=r.bones.length;s<a;s++)r.bones[s]=n.bones[t.readInt(!0)];for(let s=0,a=t.readInt(!0);s<a;s++)r.constraints.push(n.ikConstraints[t.readInt(!0)]);for(let s=0,a=t.readInt(!0);s<a;s++)r.constraints.push(n.transformConstraints[t.readInt(!0)]);for(let s=0,a=t.readInt(!0);s<a;s++)r.constraints.push(n.pathConstraints[t.readInt(!0)]);h=t.readInt(!0)}for(let l=0;l<h;l++){const s=t.readInt(!0);for(let a=0,o=t.readInt(!0);a<o;a++){const d=t.readStringRef();if(!d)throw new Error("Attachment name must not be null");const f=this.readAttachment(t,n,r,s,d,i);f&&r.setAttachment(s,d,f)}}return r}readAttachment(t,n,e,i,r,h){const l=this.scale;let s=t.readStringRef();switch(s||(s=r),t.readByte()){case Z.Region:{let a=t.readStringRef();const o=t.readFloat(),d=t.readFloat(),f=t.readFloat(),u=t.readFloat(),m=t.readFloat(),g=t.readFloat(),x=t.readFloat(),E=t.readInt32(),w=this.readSequence(t);a||(a=s);const b=this.attachmentLoader.newRegionAttachment(e,s,a,w);return b?(b.path=a,b.x=d*l,b.y=f*l,b.scaleX=u,b.scaleY=m,b.rotation=o,b.width=g*l,b.height=x*l,_.rgba8888ToColor(b.color,E),b.sequence=w,w==null&&b.updateRegion(),b):null}case Z.BoundingBox:{const a=t.readInt(!0),o=this.readVertices(t,a),d=h?t.readInt32():0,f=this.attachmentLoader.newBoundingBoxAttachment(e,s);return f?(f.worldVerticesLength=a<<1,f.vertices=o.vertices,f.bones=o.bones,h&&_.rgba8888ToColor(f.color,d),f):null}case Z.Mesh:{let a=t.readStringRef();const o=t.readInt32(),d=t.readInt(!0),f=this.readFloatArray(t,d<<1,1),u=this.readShortArray(t),m=this.readVertices(t,d),g=t.readInt(!0),x=this.readSequence(t);let E=[],w=0,b=0;h&&(E=this.readShortArray(t),w=t.readFloat(),b=t.readFloat()),a||(a=s);const p=this.attachmentLoader.newMeshAttachment(e,s,a,x);return p?(p.path=a,_.rgba8888ToColor(p.color,o),p.bones=m.bones,p.vertices=m.vertices,p.worldVerticesLength=d<<1,p.triangles=u,p.regionUVs=new Float32Array(f),p.hullLength=g<<1,p.sequence=x,h&&(p.edges=E,p.width=w*l,p.height=b*l),p):null}case Z.LinkedMesh:{let a=t.readStringRef();const o=t.readInt32(),d=t.readStringRef(),f=t.readStringRef(),u=t.readBoolean(),m=this.readSequence(t);let g=0,x=0;h&&(g=t.readFloat(),x=t.readFloat()),a||(a=s);const E=this.attachmentLoader.newMeshAttachment(e,s,a,m);return E?(E.path=a,_.rgba8888ToColor(E.color,o),E.sequence=m,h&&(E.width=g*l,E.height=x*l),this.linkedMeshes.push(new Ur(E,d,i,f,u)),E):null}case Z.Path:{const a=t.readBoolean(),o=t.readBoolean(),d=t.readInt(!0),f=this.readVertices(t,d),u=v.newArray(d/3,0);for(let x=0,E=u.length;x<E;x++)u[x]=t.readFloat()*l;const m=h?t.readInt32():0,g=this.attachmentLoader.newPathAttachment(e,s);return g?(g.closed=a,g.constantSpeed=o,g.worldVerticesLength=d<<1,g.vertices=f.vertices,g.bones=f.bones,g.lengths=u,h&&_.rgba8888ToColor(g.color,m),g):null}case Z.Point:{const a=t.readFloat(),o=t.readFloat(),d=t.readFloat(),f=h?t.readInt32():0,u=this.attachmentLoader.newPointAttachment(e,s);return u?(u.x=o*l,u.y=d*l,u.rotation=a,h&&_.rgba8888ToColor(u.color,f),u):null}case Z.Clipping:{const a=t.readInt(!0),o=t.readInt(!0),d=this.readVertices(t,o),f=h?t.readInt32():0,u=this.attachmentLoader.newClippingAttachment(e,s);return u?(u.endSlot=n.slots[a],u.worldVerticesLength=o<<1,u.vertices=d.vertices,u.bones=d.bones,h&&_.rgba8888ToColor(u.color,f),u):null}}return null}readSequence(t){if(this.ver40||!t.readBoolean())return null;const n=new Un(t.readInt(!0));return n.start=t.readInt(!0),n.digits=t.readInt(!0),n.setupIndex=t.readInt(!0),n}readDeformTimelineType(t){return this.ver40?gr:t.readByte()}readVertices(t,n){const e=this.scale,i=n<<1,r=new zr;if(!t.readBoolean())return r.vertices=this.readFloatArray(t,i,e),r;const h=new Array,l=new Array;for(let s=0;s<n;s++){const a=t.readInt(!0);l.push(a);for(let o=0;o<a;o++)l.push(t.readInt(!0)),h.push(t.readFloat()*e),h.push(t.readFloat()*e),h.push(t.readFloat())}return r.vertices=v.toFloatArray(h),r.bones=l,r}readFloatArray(t,n,e){const i=new Array(n);if(e==1)for(let r=0;r<n;r++)i[r]=t.readFloat();else for(let r=0;r<n;r++)i[r]=t.readFloat()*e;return i}readShortArray(t){const n=t.readInt(!0),e=new Array(n);for(let i=0;i<n;i++)e[i]=t.readShort();return e}readAnimation(t,n,e){t.readInt(!0);const i=new Array,r=this.scale;for(let a=0,o=t.readInt(!0);a<o;a++){const d=t.readInt(!0);for(let f=0,u=t.readInt(!0);f<u;f++){const m=t.readByte(),g=t.readInt(!0),x=g-1;switch(m){case sa:{const E=new cn(g,d);for(let w=0;w<g;w++)E.setFrame(w,t.readFloat(),t.readStringRef());i.push(E);break}case ia:{const E=t.readInt(!0),w=new Hs(g,E,d);let b=t.readFloat(),p=t.readUnsignedByte()/255,S=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,M=t.readUnsignedByte()/255;for(let T=0,k=0;w.setFrame(T,b,p,S,y,M),T!=x;T++){const I=t.readFloat(),R=t.readUnsignedByte()/255,V=t.readUnsignedByte()/255,F=t.readUnsignedByte()/255,B=t.readUnsignedByte()/255;switch(t.readByte()){case Se:w.setStepped(T);break;case ye:et(t,w,k++,T,0,b,I,p,R,1),et(t,w,k++,T,1,b,I,S,V,1),et(t,w,k++,T,2,b,I,y,F,1),et(t,w,k++,T,3,b,I,M,B,1)}b=I,p=R,S=V,y=F,M=B}i.push(w);break}case ra:{const E=t.readInt(!0),w=new Gs(g,E,d);let b=t.readFloat(),p=t.readUnsignedByte()/255,S=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255;for(let M=0,T=0;w.setFrame(M,b,p,S,y),M!=x;M++){const k=t.readFloat(),I=t.readUnsignedByte()/255,R=t.readUnsignedByte()/255,V=t.readUnsignedByte()/255;switch(t.readByte()){case Se:w.setStepped(M);break;case ye:et(t,w,T++,M,0,b,k,p,I,1),et(t,w,T++,M,1,b,k,S,R,1),et(t,w,T++,M,2,b,k,y,V,1)}b=k,p=I,S=R,y=V}i.push(w);break}case aa:{const E=t.readInt(!0),w=new Zs(g,E,d);let b=t.readFloat(),p=t.readUnsignedByte()/255,S=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,M=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255,k=t.readUnsignedByte()/255,I=t.readUnsignedByte()/255;for(let R=0,V=0;w.setFrame(R,b,p,S,y,M,T,k,I),R!=x;R++){const F=t.readFloat(),B=t.readUnsignedByte()/255,Y=t.readUnsignedByte()/255,N=t.readUnsignedByte()/255,q=t.readUnsignedByte()/255,z=t.readUnsignedByte()/255,D=t.readUnsignedByte()/255,X=t.readUnsignedByte()/255;switch(t.readByte()){case Se:w.setStepped(R);break;case ye:et(t,w,V++,R,0,b,F,p,B,1),et(t,w,V++,R,1,b,F,S,Y,1),et(t,w,V++,R,2,b,F,y,N,1),et(t,w,V++,R,3,b,F,M,q,1),et(t,w,V++,R,4,b,F,T,z,1),et(t,w,V++,R,5,b,F,k,D,1),et(t,w,V++,R,6,b,F,I,X,1)}b=F,p=B,S=Y,y=N,M=q,T=z,k=D,I=X}i.push(w);break}case oa:{const E=t.readInt(!0),w=new Qs(g,E,d);let b=t.readFloat(),p=t.readUnsignedByte()/255,S=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,M=t.readUnsignedByte()/255,T=t.readUnsignedByte()/255,k=t.readUnsignedByte()/255;for(let I=0,R=0;w.setFrame(I,b,p,S,y,M,T,k),I!=x;I++){const V=t.readFloat(),F=t.readUnsignedByte()/255,B=t.readUnsignedByte()/255,Y=t.readUnsignedByte()/255,N=t.readUnsignedByte()/255,q=t.readUnsignedByte()/255,z=t.readUnsignedByte()/255;switch(t.readByte()){case Se:w.setStepped(I);break;case ye:et(t,w,R++,I,0,b,V,p,F,1),et(t,w,R++,I,1,b,V,S,B,1),et(t,w,R++,I,2,b,V,y,Y,1),et(t,w,R++,I,3,b,V,M,N,1),et(t,w,R++,I,4,b,V,T,q,1),et(t,w,R++,I,5,b,V,k,z,1)}b=V,p=F,S=B,y=Y,M=N,T=q,k=z}i.push(w);break}case la:{const E=new js(g,t.readInt(!0),d);let w=t.readFloat(),b=t.readUnsignedByte()/255;for(let p=0,S=0;E.setFrame(p,w,b),p!=x;p++){const y=t.readFloat(),M=t.readUnsignedByte()/255;switch(t.readByte()){case Se:E.setStepped(p);break;case ye:et(t,E,S++,p,0,w,y,b,M,1)}w=y,b=M}i.push(E)}}}}for(let a=0,o=t.readInt(!0);a<o;a++){const d=t.readInt(!0);for(let f=0,u=t.readInt(!0);f<u;f++){const m=t.readByte(),g=t.readInt(!0),x=t.readInt(!0);switch(m){case Hr:i.push(_e(t,new Rn(g,x,d),1));break;case Gr:i.push(bi(t,new Ds(g,x,d),r));break;case jr:i.push(_e(t,new Ls(g,x,d),r));break;case Zr:i.push(_e(t,new _s(g,x,d),r));break;case Qr:i.push(bi(t,new Os(g,x,d),1));break;case Kr:i.push(_e(t,new $s(g,x,d),1));break;case Jr:i.push(_e(t,new Ws(g,x,d),1));break;case ta:i.push(bi(t,new qs(g,x,d),1));break;case ea:i.push(_e(t,new Us(g,x,d),1));break;case na:i.push(_e(t,new zs(g,x,d),1))}}}for(let a=0,o=t.readInt(!0);a<o;a++){const d=t.readInt(!0),f=t.readInt(!0),u=f-1,m=new Js(f,t.readInt(!0),d);let g=t.readFloat(),x=t.readFloat(),E=t.readFloat()*r;for(let w=0,b=0;m.setFrame(w,g,x,E,t.readByte(),t.readBoolean(),t.readBoolean()),w!=u;w++){const p=t.readFloat(),S=t.readFloat(),y=t.readFloat()*r;switch(t.readByte()){case Se:m.setStepped(w);break;case ye:et(t,m,b++,w,0,g,p,x,S,1),et(t,m,b++,w,1,g,p,E,y,r)}g=p,x=S,E=y}i.push(m)}for(let a=0,o=t.readInt(!0);a<o;a++){const d=t.readInt(!0),f=t.readInt(!0),u=f-1,m=new ti(f,t.readInt(!0),d);let g=t.readFloat(),x=t.readFloat(),E=t.readFloat(),w=t.readFloat(),b=t.readFloat(),p=t.readFloat(),S=t.readFloat();for(let y=0,M=0;m.setFrame(y,g,x,E,w,b,p,S),y!=u;y++){const T=t.readFloat(),k=t.readFloat(),I=t.readFloat(),R=t.readFloat(),V=t.readFloat(),F=t.readFloat(),B=t.readFloat();switch(t.readByte()){case Se:m.setStepped(y);break;case ye:et(t,m,M++,y,0,g,T,x,k,1),et(t,m,M++,y,1,g,T,E,I,1),et(t,m,M++,y,2,g,T,w,R,1),et(t,m,M++,y,3,g,T,b,V,1),et(t,m,M++,y,4,g,T,p,F,1),et(t,m,M++,y,5,g,T,S,B,1)}g=T,x=k,E=I,w=R,b=V,p=F,S=B}i.push(m)}for(let a=0,o=t.readInt(!0);a<o;a++){const d=t.readInt(!0),f=e.pathConstraints[d];for(let u=0,m=t.readInt(!0);u<m;u++)switch(t.readByte()){case ha:i.push(_e(t,new ei(t.readInt(!0),t.readInt(!0),d),f.positionMode==dt.Fixed?r:1));break;case da:i.push(_e(t,new ni(t.readInt(!0),t.readInt(!0),d),f.spacingMode==kt.Length||f.spacingMode==kt.Fixed?r:1));break;case fa:const g=new si(t.readInt(!0),t.readInt(!0),d);let x=t.readFloat(),E=t.readFloat(),w=t.readFloat(),b=t.readFloat();for(let p=0,S=0,y=g.getFrameCount()-1;g.setFrame(p,x,E,w,b),p!=y;p++){const M=t.readFloat(),T=t.readFloat(),k=t.readFloat(),I=t.readFloat();switch(t.readByte()){case Se:g.setStepped(p);break;case ye:et(t,g,S++,p,0,x,M,E,T,1),et(t,g,S++,p,1,x,M,w,k,1),et(t,g,S++,p,2,x,M,b,I,1)}x=M,E=T,w=k,b=I}i.push(g)}}for(let a=0,o=t.readInt(!0);a<o;a++){const d=e.skins[t.readInt(!0)];for(let f=0,u=t.readInt(!0);f<u;f++){const m=t.readInt(!0);for(let g=0,x=t.readInt(!0);g<x;g++){const E=t.readStringRef();if(!E)throw new Error("attachmentName must not be null.");const w=d.getAttachment(m,E),b=this.readDeformTimelineType(t),p=t.readInt(!0),S=p-1;switch(b){case gr:{const y=w,M=y.bones,T=y.vertices,k=M?T.length/3*2:T.length,I=t.readInt(!0),R=new Ks(p,I,m,y);let V=t.readFloat();for(let F=0,B=0;;F++){let Y,N=t.readInt(!0);if(N==0)Y=M?v.newFloatArray(k):T;else{Y=v.newFloatArray(k);const z=t.readInt(!0);if(N+=z,r==1)for(let D=z;D<N;D++)Y[D]=t.readFloat();else for(let D=z;D<N;D++)Y[D]=t.readFloat()*r;if(!M)for(let D=0,X=Y.length;D<X;D++)Y[D]+=T[D]}if(R.setFrame(F,V,Y),F==S)break;const q=t.readFloat();switch(t.readByte()){case Se:R.setStepped(F);break;case ye:et(t,R,B++,F,0,V,q,0,1,1)}V=q}i.push(R);break}case ca:{const y=new bn(p,m,w);for(let M=0;M<p;M++){const T=t.readFloat(),k=t.readInt32();y.setFrame(M,T,Bs[k&15],k>>4,t.readFloat())}i.push(y);break}}}}}const h=t.readInt(!0);if(h>0){const a=new hn(h),o=e.slots.length;for(let d=0;d<h;d++){const f=t.readFloat(),u=t.readInt(!0),m=v.newArray(o,0);for(let w=o-1;w>=0;w--)m[w]=-1;const g=v.newArray(o-u,0);let x=0,E=0;for(let w=0;w<u;w++){const b=t.readInt(!0);for(;x!=b;)g[E++]=x++;m[x+t.readInt(!0)]=x++}for(;x<o;)g[E++]=x++;for(let w=o-1;w>=0;w--)m[w]==-1&&(m[w]=g[--E]);a.setFrame(d,f,m)}i.push(a)}const l=t.readInt(!0);if(l>0){const a=new vn(l);for(let o=0;o<l;o++){const d=t.readFloat(),f=e.events[t.readInt(!0)],u=new ci(d,f);u.intValue=t.readInt(!1),u.floatValue=t.readFloat(),u.stringValue=t.readBoolean()?t.readString():f.stringValue,u.data.audioPath&&(u.volume=t.readFloat(),u.balance=t.readFloat()),a.setFrame(o,u)}i.push(a)}let s=0;for(let a=0,o=i.length;a<o;a++)s=Math.max(s,i[a].getDuration());return new zn(n,i,s)}}wi.BlendModeValues=[H.BLEND_MODES.NORMAL,H.BLEND_MODES.ADD,H.BLEND_MODES.MULTIPLY,H.BLEND_MODES.SCREEN];let Ur=class{constructor(t,n,e,i,r){this.mesh=t,this.skin=n,this.slotIndex=e,this.parent=i,this.inheritTimeline=r}};class zr{constructor(t=null,n=null){this.bones=t,this.vertices=n}}function _e(c,t,n){let e=c.readFloat(),i=c.readFloat()*n;for(let r=0,h=0,l=t.getFrameCount()-1;t.setFrame(r,e,i),r!=l;r++){const s=c.readFloat(),a=c.readFloat()*n;switch(c.readByte()){case Se:t.setStepped(r);break;case ye:et(c,t,h++,r,0,e,s,i,a,n)}e=s,i=a}return t}function bi(c,t,n){let e=c.readFloat(),i=c.readFloat()*n,r=c.readFloat()*n;for(let h=0,l=0,s=t.getFrameCount()-1;t.setFrame(h,e,i,r),h!=s;h++){const a=c.readFloat(),o=c.readFloat()*n,d=c.readFloat()*n;switch(c.readByte()){case Se:t.setStepped(h);break;case ye:et(c,t,l++,h,0,e,a,i,o,n),et(c,t,l++,h,1,e,a,r,d,n)}e=a,i=o,r=d}return t}function et(c,t,n,e,i,r,h,l,s,a){t.setBezier(n,e,i,r,l,c.readFloat(),c.readFloat()*a,c.readFloat(),c.readFloat()*a,h,s)}const Hr=0,Gr=1,jr=2,Zr=3,Qr=4,Kr=5,Jr=6,ta=7,ea=8,na=9,sa=0,ia=1,ra=2,aa=3,oa=4,la=5,gr=0,ca=1,ha=0,da=1,fa=2,Se=1,ye=2;class xr extends Cn{}class Qn{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const n=this.scale,e=new mi,i=typeof t=="string"?JSON.parse(t):t,r=i.skeleton;if(r){e.hash=r.hash,e.version=r.spine;const h=e.version.substr(0,3);if(h!=="4.0"&&h!=="4.1"){const l=`Spine 4.1 loader cant load version ${r.spine}. Please configure your pixi-spine bundle`;console.error(l)}e.x=r.x,e.y=r.y,e.width=r.width,e.height=r.height,e.fps=r.fps,e.imagesPath=r.images}if(i.bones)for(let h=0;h<i.bones.length;h++){const l=i.bones[h];let s=null;const a=P(l,"parent",null);if(a!=null&&(s=e.findBone(a),s==null))throw new Error(`Parent bone not found: ${a}`);const o=new li(e.bones.length,l.name,s);o.length=P(l,"length",0)*n,o.x=P(l,"x",0)*n,o.y=P(l,"y",0)*n,o.rotation=P(l,"rotation",0),o.scaleX=P(l,"scaleX",1),o.scaleY=P(l,"scaleY",1),o.shearX=P(l,"shearX",0),o.shearY=P(l,"shearY",0),o.transformMode=v.enumValue(j,P(l,"transform","Normal")),o.skinRequired=P(l,"skin",!1);const d=P(l,"color",null);d&&o.color.setFromString(d),e.bones.push(o)}if(i.slots)for(let h=0;h<i.slots.length;h++){const l=i.slots[h],s=e.findBone(l.bone);if(!s)throw new Error(`Couldn't find bone ${l.bone} for slot ${l.name}`);const a=new gi(e.slots.length,l.name,s),o=P(l,"color",null);o&&a.color.setFromString(o);const d=P(l,"dark",null);d&&(a.darkColor=_.fromString(d)),a.attachmentName=P(l,"attachment",null),a.blendMode=Qn.blendModeFromString(P(l,"blend","normal")),e.slots.push(a)}if(i.ik)for(let h=0;h<i.ik.length;h++){const l=i.ik[h],s=new di(l.name);s.order=P(l,"order",0),s.skinRequired=P(l,"skin",!1);for(let a=0;a<l.bones.length;a++){const o=l.bones[a],d=e.findBone(o);if(d==null)throw new Error(`IK bone not found: ${o}`);s.bones.push(d)}s.target=e.findBone(l.target),s.mix=P(l,"mix",1),s.softness=P(l,"softness",0)*n,s.bendDirection=P(l,"bendPositive",!0)?1:-1,s.compress=P(l,"compress",!1),s.stretch=P(l,"stretch",!1),s.uniform=P(l,"uniform",!1),e.ikConstraints.push(s)}if(i.transform)for(let h=0;h<i.transform.length;h++){const l=i.transform[h],s=new xi(l.name);s.order=P(l,"order",0),s.skinRequired=P(l,"skin",!1);for(let d=0;d<l.bones.length;d++){const f=l.bones[d],u=e.findBone(f);if(!u)throw new Error(`Couldn't find bone ${f} for transform constraint ${l.name}.`);s.bones.push(u)}const a=l.target,o=e.findBone(a);if(!o)throw new Error(`Couldn't find target bone ${a} for transform constraint ${l.name}.`);s.target=o,s.local=P(l,"local",!1),s.relative=P(l,"relative",!1),s.offsetRotation=P(l,"rotation",0),s.offsetX=P(l,"x",0)*n,s.offsetY=P(l,"y",0)*n,s.offsetScaleX=P(l,"scaleX",0),s.offsetScaleY=P(l,"scaleY",0),s.offsetShearY=P(l,"shearY",0),s.mixRotate=P(l,"mixRotate",1),s.mixX=P(l,"mixX",1),s.mixY=P(l,"mixY",s.mixX),s.mixScaleX=P(l,"mixScaleX",1),s.mixScaleY=P(l,"mixScaleY",s.mixScaleX),s.mixShearY=P(l,"mixShearY",1),e.transformConstraints.push(s)}if(i.path)for(let h=0;h<i.path.length;h++){const l=i.path[h],s=new fi(l.name);s.order=P(l,"order",0),s.skinRequired=P(l,"skin",!1);for(let d=0;d<l.bones.length;d++){const f=l.bones[d],u=e.findBone(f);if(!u)throw new Error(`Couldn't find bone ${f} for path constraint ${l.name}.`);s.bones.push(u)}const a=l.target,o=e.findSlot(a);if(!o)throw new Error(`Couldn't find target slot ${a} for path constraint ${l.name}.`);s.target=o,s.positionMode=v.enumValue(dt,P(l,"positionMode","Percent")),s.spacingMode=v.enumValue(kt,P(l,"spacingMode","Length")),s.rotateMode=v.enumValue(pt,P(l,"rotateMode","Tangent")),s.offsetRotation=P(l,"rotation",0),s.position=P(l,"position",0),s.positionMode==dt.Fixed&&(s.position*=n),s.spacing=P(l,"spacing",0),(s.spacingMode==kt.Length||s.spacingMode==kt.Fixed)&&(s.spacing*=n),s.mixRotate=P(l,"mixRotate",1),s.mixX=P(l,"mixX",1),s.mixY=P(l,"mixY",s.mixX),e.pathConstraints.push(s)}if(i.skins)for(let h=0;h<i.skins.length;h++){const l=i.skins[h],s=new Zn(l.name);if(l.bones)for(let a=0;a<l.bones.length;a++){const o=l.bones[a],d=e.findBone(o);if(!d)throw new Error(`Couldn't find bone ${o} for skin ${l.name}.`);s.bones.push(d)}if(l.ik)for(let a=0;a<l.ik.length;a++){const o=l.ik[a],d=e.findIkConstraint(o);if(!d)throw new Error(`Couldn't find IK constraint ${o} for skin ${l.name}.`);s.constraints.push(d)}if(l.transform)for(let a=0;a<l.transform.length;a++){const o=l.transform[a],d=e.findTransformConstraint(o);if(!d)throw new Error(`Couldn't find transform constraint ${o} for skin ${l.name}.`);s.constraints.push(d)}if(l.path)for(let a=0;a<l.path.length;a++){const o=l.path[a],d=e.findPathConstraint(o);if(!d)throw new Error(`Couldn't find path constraint ${o} for skin ${l.name}.`);s.constraints.push(d)}for(const a in l.attachments){const o=e.findSlot(a);if(!o)throw new Error(`Couldn't find slot ${a} for skin ${l.name}.`);const d=l.attachments[a];for(const f in d){const u=this.readAttachment(d[f],s,o.index,f,e);u&&s.setAttachment(o.index,f,u)}}e.skins.push(s),s.name=="default"&&(e.defaultSkin=s)}for(let h=0,l=this.linkedMeshes.length;h<l;h++){const s=this.linkedMeshes[h],a=s.skin?e.findSkin(s.skin):e.defaultSkin;if(!a)throw new Error(`Skin not found: ${s.skin}`);const o=a.getAttachment(s.slotIndex,s.parent);if(!o)throw new Error(`Parent mesh not found: ${s.parent}`);s.mesh.timelineAttachment=s.inheritTimeline?o:s.mesh,s.mesh.setParentMesh(o)}if(this.linkedMeshes.length=0,i.events)for(const h in i.events){const l=i.events[h],s=new hi(h);s.intValue=P(l,"int",0),s.floatValue=P(l,"float",0),s.stringValue=P(l,"string",""),s.audioPath=P(l,"audio",null),s.audioPath&&(s.volume=P(l,"volume",1),s.balance=P(l,"balance",0)),e.events.push(s)}if(i.animations)for(const h in i.animations){const l=i.animations[h];this.readAnimation(l,h,e)}return e}readAttachment(t,n,e,i,r){const h=this.scale;switch(i=P(t,"name",i),P(t,"type","region")){case"region":{const l=P(t,"path",i),s=this.readSequence(P(t,"sequence",null)),a=this.attachmentLoader.newRegionAttachment(n,i,l,s);if(!a)return null;a.path=l,a.x=P(t,"x",0)*h,a.y=P(t,"y",0)*h,a.scaleX=P(t,"scaleX",1),a.scaleY=P(t,"scaleY",1),a.rotation=P(t,"rotation",0),a.width=t.width*h,a.height=t.height*h,a.sequence=s;const o=P(t,"color",null);return o&&a.color.setFromString(o),a}case"boundingbox":{const l=this.attachmentLoader.newBoundingBoxAttachment(n,i);if(!l)return null;this.readVertices(t,l,t.vertexCount<<1);const s=P(t,"color",null);return s&&l.color.setFromString(s),l}case"mesh":case"linkedmesh":{const l=P(t,"path",i),s=this.readSequence(P(t,"sequence",null)),a=this.attachmentLoader.newMeshAttachment(n,i,l,s);if(!a)return null;a.path=l;const o=P(t,"color",null);o&&a.color.setFromString(o),a.width=P(t,"width",0)*h,a.height=P(t,"height",0)*h,a.sequence=s;const d=P(t,"parent",null);if(d)return this.linkedMeshes.push(new ua(a,P(t,"skin",null),e,d,P(t,"timelines",!0))),a;const f=t.uvs;return this.readVertices(t,a,f.length),a.triangles=t.triangles,a.regionUVs=new Float32Array(f),a.edges=P(t,"edges",null),a.hullLength=P(t,"hull",0)*2,a}case"path":{const l=this.attachmentLoader.newPathAttachment(n,i);if(!l)return null;l.closed=P(t,"closed",!1),l.constantSpeed=P(t,"constantSpeed",!0);const s=t.vertexCount;this.readVertices(t,l,s<<1);const a=v.newArray(s/3,0);for(let d=0;d<t.lengths.length;d++)a[d]=t.lengths[d]*h;l.lengths=a;const o=P(t,"color",null);return o&&l.color.setFromString(o),l}case"point":{const l=this.attachmentLoader.newPointAttachment(n,i);if(!l)return null;l.x=P(t,"x",0)*h,l.y=P(t,"y",0)*h,l.rotation=P(t,"rotation",0);const s=P(t,"color",null);return s&&l.color.setFromString(s),l}case"clipping":{const l=this.attachmentLoader.newClippingAttachment(n,i);if(!l)return null;const s=P(t,"end",null);if(s!=null){const d=r.findSlot(s);if(d==null)throw new Error(`Clipping end slot not found: ${s}`);l.endSlot=d}const a=t.vertexCount;this.readVertices(t,l,a<<1);const o=P(t,"color",null);return o&&l.color.setFromString(o),l}}return null}readSequence(t){if(t==null)return null;const n=new Un(P(t,"count",0));return n.start=P(t,"start",1),n.digits=P(t,"digits",0),n.setupIndex=P(t,"setup",0),n}readVertices(t,n,e){const i=this.scale;n.worldVerticesLength=e;const r=t.vertices;if(e==r.length){const s=v.toFloatArray(r);if(i!=1)for(let a=0,o=r.length;a<o;a++)s[a]*=i;n.vertices=s;return}const h=new Array,l=new Array;for(let s=0,a=r.length;s<a;){const o=r[s++];l.push(o);for(let d=s+o*4;s<d;s+=4)l.push(r[s]),h.push(r[s+1]*i),h.push(r[s+2]*i),h.push(r[s+3])}n.bones=l,n.vertices=v.toFloatArray(h)}readAnimation(t,n,e){const i=this.scale,r=new Array;if(t.slots)for(const l in t.slots){const s=t.slots[l],a=e.findSlot(l);if(!a)throw new Error(`Slot not found: ${l}`);const o=a.index;for(const d in s){const f=s[d];if(!f)continue;const u=f.length;if(d=="attachment"){const m=new cn(u,o);for(let g=0;g<u;g++){const x=f[g];m.setFrame(g,P(x,"time",0),P(x,"name",null))}r.push(m)}else if(d=="rgba"){const m=new Hs(u,u<<2,o);let g=f[0],x=P(g,"time",0),E=_.fromString(g.color);for(let w=0,b=0;;w++){m.setFrame(w,x,E.r,E.g,E.b,E.a);const p=f[w+1];if(!p){m.shrink(b);break}const S=P(p,"time",0),y=_.fromString(p.color),M=g.curve;M&&(b=rt(M,m,b,w,0,x,S,E.r,y.r,1),b=rt(M,m,b,w,1,x,S,E.g,y.g,1),b=rt(M,m,b,w,2,x,S,E.b,y.b,1),b=rt(M,m,b,w,3,x,S,E.a,y.a,1)),x=S,E=y,g=p}r.push(m)}else if(d=="rgb"){const m=new Gs(u,u*3,o);let g=f[0],x=P(g,"time",0),E=_.fromString(g.color);for(let w=0,b=0;;w++){m.setFrame(w,x,E.r,E.g,E.b);const p=f[w+1];if(!p){m.shrink(b);break}const S=P(p,"time",0),y=_.fromString(p.color),M=g.curve;M&&(b=rt(M,m,b,w,0,x,S,E.r,y.r,1),b=rt(M,m,b,w,1,x,S,E.g,y.g,1),b=rt(M,m,b,w,2,x,S,E.b,y.b,1)),x=S,E=y,g=p}r.push(m)}else if(d=="alpha")r.push(Pe(f,new js(u,u,o),0,1));else if(d=="rgba2"){const m=new Zs(u,u*7,o);let g=f[0],x=P(g,"time",0),E=_.fromString(g.light),w=_.fromString(g.dark);for(let b=0,p=0;;b++){m.setFrame(b,x,E.r,E.g,E.b,E.a,w.r,w.g,w.b);const S=f[b+1];if(!S){m.shrink(p);break}const y=P(S,"time",0),M=_.fromString(S.light),T=_.fromString(S.dark),k=g.curve;k&&(p=rt(k,m,p,b,0,x,y,E.r,M.r,1),p=rt(k,m,p,b,1,x,y,E.g,M.g,1),p=rt(k,m,p,b,2,x,y,E.b,M.b,1),p=rt(k,m,p,b,3,x,y,E.a,M.a,1),p=rt(k,m,p,b,4,x,y,w.r,T.r,1),p=rt(k,m,p,b,5,x,y,w.g,T.g,1),p=rt(k,m,p,b,6,x,y,w.b,T.b,1)),x=y,E=M,w=T,g=S}r.push(m)}else if(d=="rgb2"){const m=new Qs(u,u*6,o);let g=f[0],x=P(g,"time",0),E=_.fromString(g.light),w=_.fromString(g.dark);for(let b=0,p=0;;b++){m.setFrame(b,x,E.r,E.g,E.b,w.r,w.g,w.b);const S=f[b+1];if(!S){m.shrink(p);break}const y=P(S,"time",0),M=_.fromString(S.light),T=_.fromString(S.dark),k=g.curve;k&&(p=rt(k,m,p,b,0,x,y,E.r,M.r,1),p=rt(k,m,p,b,1,x,y,E.g,M.g,1),p=rt(k,m,p,b,2,x,y,E.b,M.b,1),p=rt(k,m,p,b,3,x,y,w.r,T.r,1),p=rt(k,m,p,b,4,x,y,w.g,T.g,1),p=rt(k,m,p,b,5,x,y,w.b,T.b,1)),x=y,E=M,w=T,g=S}r.push(m)}}}if(t.bones)for(const l in t.bones){const s=t.bones[l],a=e.findBone(l);if(!a)throw new Error(`Bone not found: ${l}`);const o=a.index;for(const d in s){const f=s[d],u=f.length;if(u!=0){if(d==="rotate")r.push(Pe(f,new Rn(u,u,o),0,1));else if(d==="translate"){const m=new Ds(u,u<<1,o);r.push(Ei(f,m,"x","y",0,i))}else if(d==="translatex"){const m=new Ls(u,u,o);r.push(Pe(f,m,0,i))}else if(d==="translatey"){const m=new _s(u,u,o);r.push(Pe(f,m,0,i))}else if(d==="scale"){const m=new Os(u,u<<1,o);r.push(Ei(f,m,"x","y",1,1))}else if(d==="scalex"){const m=new $s(u,u,o);r.push(Pe(f,m,1,1))}else if(d==="scaley"){const m=new Ws(u,u,o);r.push(Pe(f,m,1,1))}else if(d==="shear"){const m=new qs(u,u<<1,o);r.push(Ei(f,m,"x","y",0,1))}else if(d==="shearx"){const m=new Us(u,u,o);r.push(Pe(f,m,0,1))}else if(d==="sheary"){const m=new zs(u,u,o);r.push(Pe(f,m,0,1))}}}}if(t.ik)for(const l in t.ik){const s=t.ik[l];let a=s[0];if(!a)continue;const o=e.findIkConstraint(l);if(!o)throw new Error(`IK Constraint not found: ${l}`);const d=e.ikConstraints.indexOf(o),f=new Js(s.length,s.length<<1,d);let u=P(a,"time",0),m=P(a,"mix",1),g=P(a,"softness",0)*i;for(let x=0,E=0;;x++){f.setFrame(x,u,m,g,P(a,"bendPositive",!0)?1:-1,P(a,"compress",!1),P(a,"stretch",!1));const w=s[x+1];if(!w){f.shrink(E);break}const b=P(w,"time",0),p=P(w,"mix",1),S=P(w,"softness",0)*i,y=a.curve;y&&(E=rt(y,f,E,x,0,u,b,m,p,1),E=rt(y,f,E,x,1,u,b,g,S,i)),u=b,m=p,g=S,a=w}r.push(f)}if(t.transform)for(const l in t.transform){const s=t.transform[l];let a=s[0];if(!a)continue;const o=e.findTransformConstraint(l);if(!o)throw new Error(`Transform constraint not found: ${l}`);const d=e.transformConstraints.indexOf(o),f=new ti(s.length,s.length*6,d);let u=P(a,"time",0),m=P(a,"mixRotate",1),g=P(a,"mixX",1),x=P(a,"mixY",g),E=P(a,"mixScaleX",1),w=P(a,"mixScaleY",E);const b=P(a,"mixShearY",1);for(let p=0,S=0;;p++){f.setFrame(p,u,m,g,x,E,w,b);const y=s[p+1];if(!y){f.shrink(S);break}const M=P(y,"time",0),T=P(y,"mixRotate",1),k=P(y,"mixX",1),I=P(y,"mixY",k),R=P(y,"mixScaleX",1),V=P(y,"mixScaleY",R),F=P(y,"mixShearY",1),B=a.curve;B&&(S=rt(B,f,S,p,0,u,M,m,T,1),S=rt(B,f,S,p,1,u,M,g,k,1),S=rt(B,f,S,p,2,u,M,x,I,1),S=rt(B,f,S,p,3,u,M,E,R,1),S=rt(B,f,S,p,4,u,M,w,V,1),S=rt(B,f,S,p,5,u,M,b,F,1)),u=M,m=T,g=k,x=I,E=R,w=V,E=R,a=y}r.push(f)}if(t.path)for(const l in t.path){const s=t.path[l],a=e.findPathConstraint(l);if(!a)throw new Error(`Path constraint not found: ${l}`);const o=e.pathConstraints.indexOf(a);for(const d in s){const f=s[d];let u=f[0];if(!u)continue;const m=f.length;if(d==="position"){const g=new ei(m,m,o);r.push(Pe(f,g,0,a.positionMode==dt.Fixed?i:1))}else if(d==="spacing"){const g=new ni(m,m,o);r.push(Pe(f,g,0,a.spacingMode==kt.Length||a.spacingMode==kt.Fixed?i:1))}else if(d==="mix"){const g=new si(m,m*3,o);let x=P(u,"time",0),E=P(u,"mixRotate",1),w=P(u,"mixX",1),b=P(u,"mixY",w);for(let p=0,S=0;;p++){g.setFrame(p,x,E,w,b);const y=f[p+1];if(!y){g.shrink(S);break}const M=P(y,"time",0),T=P(y,"mixRotate",1),k=P(y,"mixX",1),I=P(y,"mixY",k),R=u.curve;R&&(S=rt(R,g,S,p,0,x,M,E,T,1),S=rt(R,g,S,p,1,x,M,w,k,1),S=rt(R,g,S,p,2,x,M,b,I,1)),x=M,E=T,w=k,b=I,u=y}r.push(g)}}}if(t.deform){t.attachments={};for(const l in t.deform){const s=t.deform[l],a=t.attachments[l]={};for(const o in s){const d=s[o],f=a[o]={};for(const u in d)f[u]={deform:d[u]}}}}if(t.attachments)for(const l in t.attachments){const s=t.attachments[l],a=e.findSkin(l);if(a==null){if(zt.FAIL_ON_NON_EXISTING_SKIN)throw new Error(`Skin not found: ${l}`);continue}for(const o in s){const d=s[o],f=e.findSlot(o);if(!f)throw new Error(`Slot not found: ${o}`);const u=f.index;for(const m in d){const g=d[m],x=a.getAttachment(u,m);for(const E in g){const w=g[E];let b=w[0];if(b){if(E=="deform"){const p=x.bones,S=x.vertices,y=p?S.length/3*2:S.length,M=new Ks(w.length,w.length,u,x);let T=P(b,"time",0);for(let k=0,I=0;;k++){let R;const V=P(b,"vertices",null);if(!V)R=p?v.newFloatArray(y):S;else{R=v.newFloatArray(y);const N=P(b,"offset",0);if(v.arrayCopy(V,0,R,N,V.length),i!=1)for(let q=N,z=q+V.length;q<z;q++)R[q]*=i;if(!p)for(let q=0;q<y;q++)R[q]+=S[q]}M.setFrame(k,T,R);const F=w[k+1];if(!F){M.shrink(I);break}const B=P(F,"time",0),Y=b.curve;Y&&(I=rt(Y,M,I,k,0,T,B,0,1,1)),T=B,b=F}r.push(M)}else if(E=="sequence"){const p=new bn(w.length,u,x);let S=0;for(let y=0;y<w.length;y++){const M=P(b,"delay",S),T=P(b,"time",0),k=Re[P(b,"mode","hold")],I=P(b,"index",0);p.setFrame(y,T,k,I,M),S=M,b=w[y+1]}r.push(p)}}}}}}if(t.drawOrder){const l=new hn(t.drawOrder.length),s=e.slots.length;let a=0;for(let o=0;o<t.drawOrder.length;o++,a++){const d=t.drawOrder[o];let f=null;const u=P(d,"offsets",null);if(u){f=v.newArray(s,-1);const m=v.newArray(s-u.length,0);let g=0,x=0;for(let E=0;E<u.length;E++){const w=u[E],b=e.findSlot(w.slot);if(!b)throw new Error(`Slot not found: ${b}`);const p=b.index;for(;g!=p;)m[x++]=g++;f[g+w.offset]=g++}for(;g<s;)m[x++]=g++;for(let E=s-1;E>=0;E--)f[E]==-1&&(f[E]=m[--x])}l.setFrame(a,P(d,"time",0),f)}r.push(l)}if(t.events){const l=new vn(t.events.length);let s=0;for(let a=0;a<t.events.length;a++,s++){const o=t.events[a],d=e.findEvent(o.name);if(!d)throw new Error(`Event not found: ${o.name}`);const f=new ci(v.toSinglePrecision(P(o,"time",0)),d);f.intValue=P(o,"int",d.intValue),f.floatValue=P(o,"float",d.floatValue),f.stringValue=P(o,"string",d.stringValue),f.data.audioPath&&(f.volume=P(o,"volume",1),f.balance=P(o,"balance",0)),l.setFrame(s,f)}r.push(l)}let h=0;for(let l=0,s=r.length;l<s;l++)h=Math.max(h,r[l].getDuration());if(isNaN(h))throw new Error("Error while parsing animation, duration is NaN");e.animations.push(new zn(n,r,h))}static blendModeFromString(t){if(t=t.toLowerCase(),t=="normal")return H.BLEND_MODES.NORMAL;if(t=="additive")return H.BLEND_MODES.ADD;if(t=="multiply")return H.BLEND_MODES.MULTIPLY;if(t=="screen")return H.BLEND_MODES.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}}class ua{constructor(t,n,e,i,r){this.mesh=t,this.skin=n,this.slotIndex=e,this.parent=i,this.inheritTimeline=r}}function Pe(c,t,n,e){let i=c[0],r=P(i,"time",0),h=P(i,"value",n)*e,l=0;for(let s=0;;s++){t.setFrame(s,r,h);const a=c[s+1];if(!a)return t.shrink(l),t;const o=P(a,"time",0),d=P(a,"value",n)*e;i.curve&&(l=rt(i.curve,t,l,s,0,r,o,h,d,e)),r=o,h=d,i=a}}function Ei(c,t,n,e,i,r){let h=c[0],l=P(h,"time",0),s=P(h,n,i)*r,a=P(h,e,i)*r,o=0;for(let d=0;;d++){t.setFrame(d,l,s,a);const f=c[d+1];if(!f)return t.shrink(o),t;const u=P(f,"time",0),m=P(f,n,i)*r,g=P(f,e,i)*r,x=h.curve;x&&(o=rt(x,t,o,d,0,l,u,s,m,r),o=rt(x,t,o,d,1,l,u,a,g,r)),l=u,s=m,a=g,h=f}}function rt(c,t,n,e,i,r,h,l,s,a){if(c=="stepped")return t.setStepped(e),n;const o=i<<2,d=c[o],f=c[o+1]*a,u=c[o+2],m=c[o+3]*a;return t.setBezier(n,e,i,r,l,d,f,u,m,h,s),n+1}function P(c,t,n){return c[t]!==void 0?c[t]:n}var ma=Object.freeze({__proto__:null,AlphaTimeline:js,Animation:zn,AnimationState:En,AnimationStateAdapter:$r,AnimationStateData:dr,AtlasAttachmentLoader:ai,Attachment:Ns,AttachmentTimeline:cn,Bone:oi,BoneData:li,BoundingBoxAttachment:On,ClippingAttachment:$n,ConstraintData:jn,CurveTimeline:be,CurveTimeline1:Ee,CurveTimeline2:Hn,DeformTimeline:Ks,DrawOrderTimeline:hn,Event:ci,EventData:hi,EventQueue:or,EventTimeline:vn,EventType:Qt,IkConstraint:fr,IkConstraintData:di,IkConstraintTimeline:Js,MeshAttachment:on,PathAttachment:ln,PathConstraint:Sn,PathConstraintData:fi,PathConstraintMixTimeline:si,PathConstraintPositionTimeline:ei,PathConstraintSpacingTimeline:ni,PointAttachment:Wn,RGB2Timeline:Qs,RGBA2Timeline:Zs,RGBATimeline:Hs,RGBTimeline:Gs,RegionAttachment:it,RotateTimeline:Rn,ScaleTimeline:Os,ScaleXTimeline:$s,ScaleYTimeline:Ws,Sequence:Un,SequenceMode:Re,SequenceModeValues:Bs,SequenceTimeline:bn,ShearTimeline:qs,ShearXTimeline:Us,ShearYTimeline:zs,Skeleton:ui,SkeletonBinary:wi,SkeletonBounds:xr,SkeletonData:mi,SkeletonJson:Qn,Skin:Zn,SkinEntry:pi,Slot:ur,SlotData:gi,SpacingMode:kt,Spine:class extends tn{createSkeleton(t){this.skeleton=new ui(t),this.skeleton.updateWorldTransform(),this.stateData=new dr(t),this.state=new En(this.stateData)}},Timeline:bt,TrackEntry:Gn,TransformConstraint:mr,TransformConstraintData:xi,TransformConstraintTimeline:ti,TranslateTimeline:Ds,TranslateXTimeline:Ls,TranslateYTimeline:_s,VertexAttachment:we}),he=(c=>(c[c.UNKNOWN=0]="UNKNOWN",c[c.VER37=37]="VER37",c[c.VER38=38]="VER38",c[c.VER40=40]="VER40",c[c.VER41=41]="VER41",c))(he||{});function Kn(c){const t=c.substr(0,3),n=Math.floor(Number(t)*10+.001);return t==="3.7"?37:t==="3.8"?38:t==="4.0"?40:t==="4.1"?41:n<37?37:0}class ga{constructor(){this.scale=1}readSkeletonData(t,n){let e=null,i=this.readVersionOldFormat(n),r=Kn(i);if(r===he.VER38&&(e=new Mt(new gs(t))),i=this.readVersionNewFormat(n),r=Kn(i),(r===he.VER40||r===he.VER41)&&(e=new wi(new ai(t))),!e){const h=`Unsupported version of spine model ${i}, please update pixi-spine`;console.error(h)}return e.scale=this.scale,e.readSkeletonData(n)}readVersionOldFormat(t){const n=new Mn(t);let e;try{n.readString(),e=n.readString()}catch(i){e=""}return e||""}readVersionNewFormat(t){const n=new Mn(t);n.readInt32(),n.readInt32();let e;try{e=n.readString()}catch(i){e=""}return e||""}}class xa{constructor(){this.scale=1}readSkeletonData(t,n){const e=n.skeleton.spine,i=Kn(e);let r=null;if(i===he.VER37&&(r=new an(new Ui(t))),i===he.VER38&&(r=new sn(new gs(t))),(i===he.VER40||i===he.VER41)&&(r=new Qn(new ai(t))),!r){const h=`Unsupported version of spine model ${e}, please update pixi-spine`;console.error(h)}return r.scale=this.scale,r.readSkeletonData(n)}}class pa extends Rr{createBinaryParser(){return new ga}createJsonParser(){return new xa}parseData(t,n,e){return{spineData:t.readSkeletonData(n,e),spineAtlas:n}}}class wa extends tn{createSkeleton(t){const n=Kn(t.version);let e=null;if(n===he.VER37&&(e=Or),n===he.VER38&&(e=Nr),(n===he.VER40||n===he.VER41)&&(e=ma),!e){const i=`Cant detect version of spine model ${t.version}`;console.error(i)}this.skeleton=new e.Skeleton(t),this.skeleton.updateWorldTransform(),this.stateData=new e.AnimationStateData(t),this.state=new e.AnimationState(this.stateData)}}return new pa().installLoader(),tt.AttachmentType=Z,tt.BinaryInput=Mn,tt.Color=_,tt.DebugUtils=Mr,tt.IntSet=ns,tt.Interpolation=Si,tt.MathUtils=C,tt.MixBlend=A,tt.MixDirection=J,tt.Pool=An,tt.PositionMode=dt,tt.Pow=yi,tt.PowOut=is,tt.RotateMode=pt,tt.SkeletonBounds=xr,tt.SkeletonBoundsBase=Cn,tt.Spine=wa,tt.SpineBase=tn,tt.SpineDebugRenderer=Tr,tt.SpineMesh=Ai,tt.SpineSprite=Mi,tt.StringSet=ss,tt.TextureAtlas=Fn,tt.TextureAtlasPage=ts,tt.TextureAtlasRegion=es,tt.TextureFilter=Bt,tt.TextureRegion=Vn,tt.TextureWrap=fe,tt.TimeKeeper=Ar,tt.TransformMode=j,tt.Utils=v,tt.Vector2=un,tt.WindowedMean=Cr,tt.filterFromString=Jn,tt.settings=zt,tt.wrapFromString=Er,tt}({},PIXI,PIXI,PIXI,PIXI,PIXI,PIXI);this.PIXI=this.PIXI||{};(function(exports,core,constants,sprite,math,ticker$1,display){"use strict";class PropertyNode{constructor(value,time,ease){this.value=value;this.time=time;this.next=null;this.isStepped=false;if(ease){this.ease=typeof ease==="function"?ease:generateEase(ease)}else{this.ease=null}}static createList(data){if("list"in data){const array=data.list;let node;const{value,time}=array[0];const first=node=new PropertyNode(typeof value==="string"?hexToRGB(value):value,time,data.ease);if(array.length>2||array.length===2&&array[1].value!==value){for(let i=1;i<array.length;++i){const{value,time}=array[i];node.next=new PropertyNode(typeof value==="string"?hexToRGB(value):value,time);node=node.next}}first.isStepped=!!data.isStepped;return first}const start=new PropertyNode(typeof data.start==="string"?hexToRGB(data.start):data.start,0);if(data.end!==data.start){start.next=new PropertyNode(typeof data.end==="string"?hexToRGB(data.end):data.end,1)}return start}}let GetTextureFromString=core.Texture.from;const verbose=false;const DEG_TO_RADS=Math.PI/180;function rotatePoint(angle,p){if(!angle)return;const s=Math.sin(angle);const c=Math.cos(angle);const xnew=p.x*c-p.y*s;const ynew=p.x*s+p.y*c;p.x=xnew;p.y=ynew}function combineRGBComponents(r,g,b){return r<<16|g<<8|b}function length(point){return Math.sqrt(point.x*point.x+point.y*point.y)}function normalize(point){const oneOverLen=1/length(point);point.x*=oneOverLen;point.y*=oneOverLen}function scaleBy(point,value){point.x*=value;point.y*=value}function hexToRGB(color,output){if(!output){output={}}if(color.charAt(0)==="#"){color=color.substr(1)}else if(color.indexOf("0x")===0){color=color.substr(2)}let alpha;if(color.length===8){alpha=color.substr(0,2);color=color.substr(2)}output.r=parseInt(color.substr(0,2),16);output.g=parseInt(color.substr(2,2),16);output.b=parseInt(color.substr(4,2),16);if(alpha){output.a=parseInt(alpha,16)}return output}function generateEase(segments){const qty=segments.length;const oneOverQty=1/qty;return function(time){const i=qty*time|0;const t=(time-i*oneOverQty)*qty;const s=segments[i]||segments[qty-1];return s.s+t*(2*(1-t)*(s.cp-s.s)+t*(s.e-s.s))}}function getBlendMode(name){if(!name)return constants.BLEND_MODES.NORMAL;name=name.toUpperCase().replace(/ /g,"_");return constants.BLEND_MODES[name]||constants.BLEND_MODES.NORMAL}function createSteppedGradient(list,numSteps=10){if(typeof numSteps!=="number"||numSteps<=0){numSteps=10}const first=new PropertyNode(hexToRGB(list[0].value),list[0].time);first.isStepped=true;let currentNode=first;let current=list[0];let nextIndex=1;let next=list[nextIndex];for(let i=1;i<numSteps;++i){let lerp=i/numSteps;while(lerp>next.time){current=next;next=list[++nextIndex]}lerp=(lerp-current.time)/(next.time-current.time);const curVal=hexToRGB(current.value);const nextVal=hexToRGB(next.value);const output={r:(nextVal.r-curVal.r)*lerp+curVal.r,g:(nextVal.g-curVal.g)*lerp+curVal.g,b:(nextVal.b-curVal.b)*lerp+curVal.b};currentNode.next=new PropertyNode(output,i/numSteps);currentNode=currentNode.next}return first}var ParticleUtils={__proto__:null,GetTextureFromString:GetTextureFromString,verbose:verbose,DEG_TO_RADS:DEG_TO_RADS,rotatePoint:rotatePoint,combineRGBComponents:combineRGBComponents,length:length,normalize:normalize,scaleBy:scaleBy,hexToRGB:hexToRGB,generateEase:generateEase,getBlendMode:getBlendMode,createSteppedGradient:createSteppedGradient};class Particle extends sprite.Sprite{constructor(emitter){super();this.prevChild=this.nextChild=null;this.emitter=emitter;this.config={};this.anchor.x=this.anchor.y=0.5;this.maxLife=0;this.age=0;this.agePercent=0;this.oneOverLife=0;this.next=null;this.prev=null;this.init=this.init;this.kill=this.kill}init(maxLife){this.maxLife=maxLife;this.age=this.agePercent=0;this.rotation=0;this.position.x=this.position.y=0;this.scale.x=this.scale.y=1;this.tint=16777215;this.alpha=1;this.oneOverLife=1/this.maxLife;this.visible=true}kill(){this.emitter.recycle(this)}destroy(){if(this.parent){this.parent.removeChild(this)}this.emitter=this.next=this.prev=null;super.destroy()}}var BehaviorOrder;(function(BehaviorOrder){BehaviorOrder[BehaviorOrder["Spawn"]=0]="Spawn";BehaviorOrder[BehaviorOrder["Normal"]=2]="Normal";BehaviorOrder[BehaviorOrder["Late"]=5]="Late"})(BehaviorOrder||(BehaviorOrder={}));const ticker=ticker$1.Ticker.shared;const PositionParticle=Symbol("Position particle per emitter position");class Emitter{constructor(particleParent,config){this.initBehaviors=[];this.updateBehaviors=[];this.recycleBehaviors=[];this.minLifetime=0;this.maxLifetime=0;this.customEase=null;this._frequency=1;this.spawnChance=1;this.maxParticles=1000;this.emitterLifetime=-1;this.spawnPos=new math.Point;this.particlesPerWave=1;this.rotation=0;this.ownerPos=new math.Point;this._prevEmitterPos=new math.Point;this._prevPosIsValid=false;this._posChanged=false;this._parent=null;this.addAtBack=false;this.particleCount=0;this._emit=false;this._spawnTimer=0;this._emitterLife=-1;this._activeParticlesFirst=null;this._activeParticlesLast=null;this._poolFirst=null;this._origConfig=null;this._autoUpdate=false;this._destroyWhenComplete=false;this._completeCallback=null;this.parent=particleParent;if(config){this.init(config)}this.recycle=this.recycle;this.update=this.update;this.rotate=this.rotate;this.updateSpawnPos=this.updateSpawnPos;this.updateOwnerPos=this.updateOwnerPos}static registerBehavior(constructor){Emitter.knownBehaviors[constructor.type]=constructor}get frequency(){return this._frequency}set frequency(value){if(typeof value==="number"&&value>0){this._frequency=value}else{this._frequency=1}}get parent(){return this._parent}set parent(value){this.cleanup();this._parent=value}init(config){if(!config){return}this.cleanup();this._origConfig=config;this.minLifetime=config.lifetime.min;this.maxLifetime=config.lifetime.max;if(config.ease){this.customEase=typeof config.ease==="function"?config.ease:generateEase(config.ease)}else{this.customEase=null}this.particlesPerWave=1;if(config.particlesPerWave&&config.particlesPerWave>1){this.particlesPerWave=config.particlesPerWave}this.frequency=config.frequency;this.spawnChance=typeof config.spawnChance==="number"&&config.spawnChance>0?config.spawnChance:1;this.emitterLifetime=config.emitterLifetime||-1;this.maxParticles=config.maxParticles>0?config.maxParticles:1000;this.addAtBack=!!config.addAtBack;this.rotation=0;this.ownerPos.set(0);if(config.pos){this.spawnPos.copyFrom(config.pos)}else{this.spawnPos.set(0)}this._prevEmitterPos.copyFrom(this.spawnPos);this._prevPosIsValid=false;this._spawnTimer=0;this.emit=config.emit===undefined?true:!!config.emit;this.autoUpdate=!!config.autoUpdate;const behaviors=config.behaviors.map(data=>{const constructor=Emitter.knownBehaviors[data.type];if(!constructor){console.error(`Unknown behavior: ${data.type}`);return null}return new constructor(data.config)}).filter(b=>!!b);behaviors.push(PositionParticle);behaviors.sort((a,b)=>{if(a===PositionParticle){return b.order===BehaviorOrder.Spawn?1:-1}else if(b===PositionParticle){return a.order===BehaviorOrder.Spawn?-1:1}return a.order-b.order});this.initBehaviors=behaviors.slice();this.updateBehaviors=behaviors.filter(b=>b!==PositionParticle&&b.updateParticle);this.recycleBehaviors=behaviors.filter(b=>b!==PositionParticle&&b.recycleParticle)}getBehavior(type){if(!Emitter.knownBehaviors[type])return null;return this.initBehaviors.find(b=>b instanceof Emitter.knownBehaviors[type])||null}fillPool(count){for(;count>0;--count){const p=new Particle(this);p.next=this._poolFirst;this._poolFirst=p}}recycle(particle,fromCleanup=false){for(let i=0;i<this.recycleBehaviors.length;++i){this.recycleBehaviors[i].recycleParticle(particle,!fromCleanup)}if(particle.next){particle.next.prev=particle.prev}if(particle.prev){particle.prev.next=particle.next}if(particle===this._activeParticlesLast){this._activeParticlesLast=particle.prev}if(particle===this._activeParticlesFirst){this._activeParticlesFirst=particle.next}particle.prev=null;particle.next=this._poolFirst;this._poolFirst=particle;if(particle.parent){particle.parent.removeChild(particle)}--this.particleCount}rotate(newRot){if(this.rotation===newRot)return;const diff=newRot-this.rotation;this.rotation=newRot;rotatePoint(diff,this.spawnPos);this._posChanged=true}updateSpawnPos(x,y){this._posChanged=true;this.spawnPos.x=x;this.spawnPos.y=y}updateOwnerPos(x,y){this._posChanged=true;this.ownerPos.x=x;this.ownerPos.y=y}resetPositionTracking(){this._prevPosIsValid=false}get emit(){return this._emit}set emit(value){this._emit=!!value;this._emitterLife=this.emitterLifetime}get autoUpdate(){return this._autoUpdate}set autoUpdate(value){if(this._autoUpdate&&!value){ticker.remove(this.update,this)}else if(!this._autoUpdate&&value){ticker.add(this.update,this)}this._autoUpdate=!!value}playOnceAndDestroy(callback){this.autoUpdate=true;this.emit=true;this._destroyWhenComplete=true;this._completeCallback=callback}playOnce(callback){this.emit=true;this._completeCallback=callback}update(delta){if(!this._parent)return;for(let particle=this._activeParticlesFirst,next;particle;particle=next){next=particle.next;particle.age+=delta;if(particle.age>particle.maxLife||particle.age<0){this.recycle(particle)}else{let lerp=particle.age*particle.oneOverLife;if(this.customEase){if(this.customEase.length===4){lerp=this.customEase(lerp,0,1,1)}else{lerp=this.customEase(lerp)}}particle.agePercent=lerp;for(let i=0;i<this.updateBehaviors.length;++i){if(this.updateBehaviors[i].updateParticle(particle,delta)){this.recycle(particle);break}}}}let prevX;let prevY;if(this._prevPosIsValid){prevX=this._prevEmitterPos.x;prevY=this._prevEmitterPos.y}const curX=this.ownerPos.x+this.spawnPos.x;const curY=this.ownerPos.y+this.spawnPos.y;if(this._emit){this._spawnTimer-=delta<0?0:delta;while(this._spawnTimer<=0){if(this._emitterLife>=0){this._emitterLife-=this._frequency;if(this._emitterLife<=0){this._spawnTimer=0;this._emitterLife=0;this.emit=false;break}}if(this.particleCount>=this.maxParticles){this._spawnTimer+=this._frequency;continue}let emitPosX;let emitPosY;if(this._prevPosIsValid&&this._posChanged){const lerp=1+this._spawnTimer/delta;emitPosX=(curX-prevX)*lerp+prevX;emitPosY=(curY-prevY)*lerp+prevY}else{emitPosX=curX;emitPosY=curY}let waveFirst=null;let waveLast=null;for(let len=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),i=0;i<len;++i){if(this.spawnChance<1&&Math.random()>=this.spawnChance){continue}let lifetime;if(this.minLifetime===this.maxLifetime){lifetime=this.minLifetime}else{lifetime=Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime}if(-this._spawnTimer>=lifetime){continue}let p;if(this._poolFirst){p=this._poolFirst;this._poolFirst=this._poolFirst.next;p.next=null}else{p=new Particle(this)}p.init(lifetime);if(this.addAtBack){this._parent.addChildAt(p,0)}else{this._parent.addChild(p)}if(waveFirst){waveLast.next=p;p.prev=waveLast;waveLast=p}else{waveLast=waveFirst=p}++this.particleCount}if(waveFirst){if(this._activeParticlesLast){this._activeParticlesLast.next=waveFirst;waveFirst.prev=this._activeParticlesLast;this._activeParticlesLast=waveLast}else{this._activeParticlesFirst=waveFirst;this._activeParticlesLast=waveLast}for(let i=0;i<this.initBehaviors.length;++i){const behavior=this.initBehaviors[i];if(behavior===PositionParticle){for(let particle=waveFirst,next;particle;particle=next){next=particle.next;if(this.rotation!==0){rotatePoint(this.rotation,particle.position);particle.rotation+=this.rotation}particle.position.x+=emitPosX;particle.position.y+=emitPosY;particle.age+=-this._spawnTimer;let lerp=particle.age*particle.oneOverLife;if(this.customEase){if(this.customEase.length===4){lerp=this.customEase(lerp,0,1,1)}else{lerp=this.customEase(lerp)}}particle.agePercent=lerp}}else{behavior.initParticles(waveFirst)}}for(let particle=waveFirst,next;particle;particle=next){next=particle.next;for(let i=0;i<this.updateBehaviors.length;++i){if(this.updateBehaviors[i].updateParticle(particle,-this._spawnTimer)){this.recycle(particle);break}}}}this._spawnTimer+=this._frequency}}if(this._posChanged){this._prevEmitterPos.x=curX;this._prevEmitterPos.y=curY;this._prevPosIsValid=true;this._posChanged=false}if(!this._emit&&!this._activeParticlesFirst){if(this._completeCallback){const cb=this._completeCallback;this._completeCallback=null;cb()}if(this._destroyWhenComplete){this.destroy()}}}emitNow(){const emitPosX=this.ownerPos.x+this.spawnPos.x;const emitPosY=this.ownerPos.y+this.spawnPos.y;let waveFirst=null;let waveLast=null;for(let len=Math.min(this.particlesPerWave,this.maxParticles-this.particleCount),i=0;i<len;++i){if(this.spawnChance<1&&Math.random()>=this.spawnChance){continue}let p;if(this._poolFirst){p=this._poolFirst;this._poolFirst=this._poolFirst.next;p.next=null}else{p=new Particle(this)}let lifetime;if(this.minLifetime===this.maxLifetime){lifetime=this.minLifetime}else{lifetime=Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime}p.init(lifetime);if(this.addAtBack){this._parent.addChildAt(p,0)}else{this._parent.addChild(p)}if(waveFirst){waveLast.next=p;p.prev=waveLast;waveLast=p}else{waveLast=waveFirst=p}++this.particleCount}if(waveFirst){if(this._activeParticlesLast){this._activeParticlesLast.next=waveFirst;waveFirst.prev=this._activeParticlesLast;this._activeParticlesLast=waveLast}else{this._activeParticlesFirst=waveFirst;this._activeParticlesLast=waveLast}for(let i=0;i<this.initBehaviors.length;++i){const behavior=this.initBehaviors[i];if(behavior===PositionParticle){for(let particle=waveFirst,next;particle;particle=next){next=particle.next;if(this.rotation!==0){rotatePoint(this.rotation,particle.position);particle.rotation+=this.rotation}particle.position.x+=emitPosX;particle.position.y+=emitPosY}}else{behavior.initParticles(waveFirst)}}}}cleanup(){let particle;let next;for(particle=this._activeParticlesFirst;particle;particle=next){next=particle.next;this.recycle(particle,true)}this._activeParticlesFirst=this._activeParticlesLast=null;this.particleCount=0}get destroyed(){return!(this._parent&&this.initBehaviors.length)}destroy(){this.autoUpdate=false;this.cleanup();let next;for(let particle=this._poolFirst;particle;particle=next){next=particle.next;particle.destroy()}this._poolFirst=this._parent=this.spawnPos=this.ownerPos=this.customEase=this._completeCallback=null;this.initBehaviors.length=this.updateBehaviors.length=this.recycleBehaviors.length=0}}Emitter.knownBehaviors={};class Rectangle{constructor(config){this.x=config.x;this.y=config.y;this.w=config.w;this.h=config.h}getRandPos(particle){particle.x=Math.random()*this.w+this.x;particle.y=Math.random()*this.h+this.y}}Rectangle.type="rect";Rectangle.editorConfig=null;class Torus{constructor(config){this.x=config.x||0;this.y=config.y||0;this.radius=config.radius;this.innerRadius=config.innerRadius||0;this.rotation=!!config.affectRotation}getRandPos(particle){if(this.innerRadius!==this.radius){particle.x=Math.random()*(this.radius-this.innerRadius)+this.innerRadius}else{particle.x=this.radius}particle.y=0;const angle=Math.random()*Math.PI*2;if(this.rotation){particle.rotation+=angle}rotatePoint(angle,particle.position);particle.position.x+=this.x;particle.position.y+=this.y}}Torus.type="torus";Torus.editorConfig=null;class PolygonalChain{constructor(data){this.segments=[];this.countingLengths=[];this.totalLength=0;this.init(data)}init(data){if(!data||!data.length){this.segments.push({p1:{x:0,y:0},p2:{x:0,y:0},l:0})}else if(Array.isArray(data[0])){for(let i=0;i<data.length;++i){const chain=data[i];let prevPoint=chain[0];for(let j=1;j<chain.length;++j){const second=chain[j];this.segments.push({p1:prevPoint,p2:second,l:0});prevPoint=second}}}else{let prevPoint=data[0];for(let i=1;i<data.length;++i){const second=data[i];this.segments.push({p1:prevPoint,p2:second,l:0});prevPoint=second}}for(let i=0;i<this.segments.length;++i){const{p1,p2}=this.segments[i];const segLength=Math.sqrt((p2.x-p1.x)*(p2.x-p1.x)+(p2.y-p1.y)*(p2.y-p1.y));this.segments[i].l=segLength;this.totalLength+=segLength;this.countingLengths.push(this.totalLength)}}getRandPos(out){const rand=Math.random()*this.totalLength;let chosenSeg;let lerp;if(this.segments.length===1){chosenSeg=this.segments[0];lerp=rand}else{for(let i=0;i<this.countingLengths.length;++i){if(rand<this.countingLengths[i]){chosenSeg=this.segments[i];lerp=i===0?rand:rand-this.countingLengths[i-1];break}}}lerp/=chosenSeg.l||1;const{p1,p2}=chosenSeg;out.x=p1.x+lerp*(p2.x-p1.x);out.y=p1.y+lerp*(p2.y-p1.y)}}PolygonalChain.type="polygonalChain";PolygonalChain.editorConfig=null;var index={__proto__:null,Rectangle:Rectangle,Torus:Torus,PolygonalChain:PolygonalChain};var Types={__proto__:null};class AccelerationBehavior{constructor(config){var _a;this.order=BehaviorOrder.Late;this.minStart=config.minStart;this.maxStart=config.maxStart;this.accel=config.accel;this.rotate=!!config.rotate;this.maxSpeed=(_a=config.maxSpeed)!==null&&_a!==void 0?_a:0}initParticles(first){let next=first;while(next){const speed=Math.random()*(this.maxStart-this.minStart)+this.minStart;if(!next.config.velocity){next.config.velocity=new math.Point(speed,0)}else{next.config.velocity.set(speed,0)}rotatePoint(next.rotation,next.config.velocity);next=next.next}}updateParticle(particle,deltaSec){const vel=particle.config.velocity;const oldVX=vel.x;const oldVY=vel.y;vel.x+=this.accel.x*deltaSec;vel.y+=this.accel.y*deltaSec;if(this.maxSpeed){const currentSpeed=length(vel);if(currentSpeed>this.maxSpeed){scaleBy(vel,this.maxSpeed/currentSpeed)}}particle.x+=(oldVX+vel.x)/2*deltaSec;particle.y+=(oldVY+vel.y)/2*deltaSec;if(this.rotate){particle.rotation=Math.atan2(vel.y,vel.x)}}}AccelerationBehavior.type="moveAcceleration";AccelerationBehavior.editorConfig=null;function intValueSimple(lerp){if(this.ease)lerp=this.ease(lerp);return(this.first.next.value-this.first.value)*lerp+this.first.value}function intColorSimple(lerp){if(this.ease)lerp=this.ease(lerp);const curVal=this.first.value;const nextVal=this.first.next.value;const r=(nextVal.r-curVal.r)*lerp+curVal.r;const g=(nextVal.g-curVal.g)*lerp+curVal.g;const b=(nextVal.b-curVal.b)*lerp+curVal.b;return combineRGBComponents(r,g,b)}function intValueComplex(lerp){if(this.ease)lerp=this.ease(lerp);let current=this.first;let next=current.next;while(lerp>next.time){current=next;next=next.next}lerp=(lerp-current.time)/(next.time-current.time);return(next.value-current.value)*lerp+current.value}function intColorComplex(lerp){if(this.ease)lerp=this.ease(lerp);let current=this.first;let next=current.next;while(lerp>next.time){current=next;next=next.next}lerp=(lerp-current.time)/(next.time-current.time);const curVal=current.value;const nextVal=next.value;const r=(nextVal.r-curVal.r)*lerp+curVal.r;const g=(nextVal.g-curVal.g)*lerp+curVal.g;const b=(nextVal.b-curVal.b)*lerp+curVal.b;return combineRGBComponents(r,g,b)}function intValueStepped(lerp){if(this.ease)lerp=this.ease(lerp);let current=this.first;while(current.next&&lerp>current.next.time){current=current.next}return current.value}function intColorStepped(lerp){if(this.ease)lerp=this.ease(lerp);let current=this.first;while(current.next&&lerp>current.next.time){current=current.next}const curVal=current.value;return combineRGBComponents(curVal.r,curVal.g,curVal.b)}class PropertyList{constructor(isColor=false){this.first=null;this.isColor=!!isColor;this.interpolate=null;this.ease=null}reset(first){this.first=first;const isSimple=first.next&&first.next.time>=1;if(isSimple){this.interpolate=this.isColor?intColorSimple:intValueSimple}else if(first.isStepped){this.interpolate=this.isColor?intColorStepped:intValueStepped}else{this.interpolate=this.isColor?intColorComplex:intValueComplex}this.ease=this.first.ease}}class AlphaBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.list=new PropertyList(false);this.list.reset(PropertyNode.createList(config.alpha))}initParticles(first){let next=first;while(next){next.alpha=this.list.first.value;next=next.next}}updateParticle(particle){particle.alpha=this.list.interpolate(particle.agePercent)}}AlphaBehavior.type="alpha";AlphaBehavior.editorConfig=null;class StaticAlphaBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.value=config.alpha}initParticles(first){let next=first;while(next){next.alpha=this.value;next=next.next}}}StaticAlphaBehavior.type="alphaStatic";StaticAlphaBehavior.editorConfig=null;function getTextures(textures){const outTextures=[];for(let j=0;j<textures.length;++j){let tex=textures[j];if(typeof tex==="string"){outTextures.push(GetTextureFromString(tex))}else if(tex instanceof core.Texture){outTextures.push(tex)}else{let dupe=tex.count||1;if(typeof tex.texture==="string"){tex=GetTextureFromString(tex.texture)}else{tex=tex.texture}for(;dupe>0;--dupe){outTextures.push(tex)}}}return outTextures}class RandomAnimatedTextureBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.anims=[];for(let i=0;i<config.anims.length;++i){const anim=config.anims[i];const textures=getTextures(anim.textures);const framerate=anim.framerate<0?-1:anim.framerate>0?anim.framerate:60;const parsedAnim={textures,duration:framerate>0?textures.length/framerate:0,framerate,loop:framerate>0?!!anim.loop:false};this.anims.push(parsedAnim)}}initParticles(first){let next=first;while(next){const index=Math.floor(Math.random()*this.anims.length);const anim=next.config.anim=this.anims[index];next.texture=anim.textures[0];next.config.animElapsed=0;if(anim.framerate===-1){next.config.animDuration=next.maxLife;next.config.animFramerate=anim.textures.length/next.maxLife}else{next.config.animDuration=anim.duration;next.config.animFramerate=anim.framerate}next=next.next}}updateParticle(particle,deltaSec){const config=particle.config;const anim=config.anim;config.animElapsed+=deltaSec;if(config.animElapsed>=config.animDuration){if(config.anim.loop){config.animElapsed=config.animElapsed%config.animDuration}else{config.animElapsed=config.animDuration-0.000001}}const frame=config.animElapsed*config.animFramerate+1e-7|0;particle.texture=anim.textures[frame]||anim.textures[anim.textures.length-1]||core.Texture.EMPTY}}RandomAnimatedTextureBehavior.type="animatedRandom";RandomAnimatedTextureBehavior.editorConfig=null;class SingleAnimatedTextureBehavior{constructor(config){this.order=BehaviorOrder.Normal;const anim=config.anim;const textures=getTextures(anim.textures);const framerate=anim.framerate<0?-1:anim.framerate>0?anim.framerate:60;this.anim={textures,duration:framerate>0?textures.length/framerate:0,framerate,loop:framerate>0?!!anim.loop:false}}initParticles(first){let next=first;const anim=this.anim;while(next){next.texture=anim.textures[0];next.config.animElapsed=0;if(anim.framerate===-1){next.config.animDuration=next.maxLife;next.config.animFramerate=anim.textures.length/next.maxLife}else{next.config.animDuration=anim.duration;next.config.animFramerate=anim.framerate}next=next.next}}updateParticle(particle,deltaSec){const anim=this.anim;const config=particle.config;config.animElapsed+=deltaSec;if(config.animElapsed>=config.animDuration){if(anim.loop){config.animElapsed=config.animElapsed%config.animDuration}else{config.animElapsed=config.animDuration-0.000001}}const frame=config.animElapsed*config.animFramerate+1e-7|0;particle.texture=anim.textures[frame]||anim.textures[anim.textures.length-1]||core.Texture.EMPTY}}SingleAnimatedTextureBehavior.type="animatedSingle";SingleAnimatedTextureBehavior.editorConfig=null;class BlendModeBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.value=config.blendMode}initParticles(first){let next=first;while(next){next.blendMode=getBlendMode(this.value);next=next.next}}}BlendModeBehavior.type="blendMode";BlendModeBehavior.editorConfig=null;class BurstSpawnBehavior{constructor(config){this.order=BehaviorOrder.Spawn;this.spacing=config.spacing*DEG_TO_RADS;this.start=config.start*DEG_TO_RADS;this.distance=config.distance}initParticles(first){let count=0;let next=first;while(next){let angle;if(this.spacing){angle=this.start+this.spacing*count}else{angle=Math.random()*Math.PI*2}next.rotation=angle;if(this.distance){next.position.x=this.distance;rotatePoint(angle,next.position)}next=next.next;++count}}}BurstSpawnBehavior.type="spawnBurst";BurstSpawnBehavior.editorConfig=null;class ColorBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.list=new PropertyList(true);this.list.reset(PropertyNode.createList(config.color))}initParticles(first){let next=first;const color=this.list.first.value;const tint=combineRGBComponents(color.r,color.g,color.b);while(next){next.tint=tint;next=next.next}}updateParticle(particle){particle.tint=this.list.interpolate(particle.agePercent)}}ColorBehavior.type="color";ColorBehavior.editorConfig=null;class StaticColorBehavior{constructor(config){this.order=BehaviorOrder.Normal;let color=config.color;if(color.charAt(0)==="#"){color=color.substr(1)}else if(color.indexOf("0x")===0){color=color.substr(2)}this.value=parseInt(color,16)}initParticles(first){let next=first;while(next){next.tint=this.value;next=next.next}}}StaticColorBehavior.type="colorStatic";StaticColorBehavior.editorConfig=null;class OrderedTextureBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.index=0;this.textures=config.textures.map(tex=>typeof tex==="string"?GetTextureFromString(tex):tex)}initParticles(first){let next=first;while(next){next.texture=this.textures[this.index];if(++this.index>=this.textures.length){this.index=0}next=next.next}}}OrderedTextureBehavior.type="textureOrdered";OrderedTextureBehavior.editorConfig=null;const helperPoint=new math.Point;const MATH_FUNCS=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","abs","acos","acosh","asin","asinh","atan","atanh","atan2","cbrt","ceil","cos","cosh","exp","expm1","floor","fround","hypot","log","log1p","log10","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh"];const WHITELISTER=new RegExp(["[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]"].concat(MATH_FUNCS).join("|"),"g");function parsePath(pathString){const matches=pathString.match(WHITELISTER);for(let i=matches.length-1;i>=0;--i){if(MATH_FUNCS.indexOf(matches[i])>=0){matches[i]=`Math.${matches[i]}`}}pathString=matches.join("");return new Function("x",`return ${pathString};`)}class PathBehavior{constructor(config){var _a;this.order=BehaviorOrder.Late;if(config.path){if(typeof config.path==="function"){this.path=config.path}else{try{this.path=parsePath(config.path)}catch(e){if(verbose){console.error("PathParticle: error in parsing path expression",e)}this.path=null}}}else{if(verbose){console.error("PathParticle requires a path value in its config!")}this.path=x=>x}this.list=new PropertyList(false);this.list.reset(PropertyNode.createList(config.speed));this.minMult=(_a=config.minMult)!==null&&_a!==void 0?_a:1}initParticles(first){let next=first;while(next){next.config.initRotation=next.rotation;if(!next.config.initPosition){next.config.initPosition=new math.Point(next.x,next.y)}else{next.config.initPosition.copyFrom(next.position)}next.config.movement=0;const mult=Math.random()*(1-this.minMult)+this.minMult;next.config.speedMult=mult;next=next.next}}updateParticle(particle,deltaSec){const speed=this.list.interpolate(particle.agePercent)*particle.config.speedMult;particle.config.movement+=speed*deltaSec;helperPoint.x=particle.config.movement;helperPoint.y=this.path(helperPoint.x);rotatePoint(particle.config.initRotation,helperPoint);particle.position.x=particle.config.initPosition.x+helperPoint.x;particle.position.y=particle.config.initPosition.y+helperPoint.y}}PathBehavior.type="movePath";PathBehavior.editorConfig=null;class PointSpawnBehavior{constructor(){this.order=BehaviorOrder.Spawn}initParticles(_first){}}PointSpawnBehavior.type="spawnPoint";PointSpawnBehavior.editorConfig=null;class RandomTextureBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.textures=config.textures.map(tex=>typeof tex==="string"?GetTextureFromString(tex):tex)}initParticles(first){let next=first;while(next){const index=Math.floor(Math.random()*this.textures.length);next.texture=this.textures[index];next=next.next}}}RandomTextureBehavior.type="textureRandom";RandomTextureBehavior.editorConfig=null;class RotationBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.minStart=config.minStart*DEG_TO_RADS;this.maxStart=config.maxStart*DEG_TO_RADS;this.minSpeed=config.minSpeed*DEG_TO_RADS;this.maxSpeed=config.maxSpeed*DEG_TO_RADS;this.accel=config.accel*DEG_TO_RADS}initParticles(first){let next=first;while(next){if(this.minStart===this.maxStart){next.rotation+=this.maxStart}else{next.rotation+=Math.random()*(this.maxStart-this.minStart)+this.minStart}next.config.rotSpeed=Math.random()*(this.maxSpeed-this.minSpeed)+this.minSpeed;next=next.next}}updateParticle(particle,deltaSec){if(this.accel){const oldSpeed=particle.config.rotSpeed;particle.config.rotSpeed+=this.accel*deltaSec;particle.rotation+=(particle.config.rotSpeed+oldSpeed)/2*deltaSec}else{particle.rotation+=particle.config.rotSpeed*deltaSec}}}RotationBehavior.type="rotation";RotationBehavior.editorConfig=null;class StaticRotationBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.min=config.min*DEG_TO_RADS;this.max=config.max*DEG_TO_RADS}initParticles(first){let next=first;while(next){if(this.min===this.max){next.rotation+=this.max}else{next.rotation+=Math.random()*(this.max-this.min)+this.min}next=next.next}}}StaticRotationBehavior.type="rotationStatic";StaticRotationBehavior.editorConfig=null;class NoRotationBehavior{constructor(config){this.order=BehaviorOrder.Late+1;this.rotation=(config.rotation||0)*DEG_TO_RADS}initParticles(first){let next=first;while(next){next.rotation=this.rotation;next=next.next}}}NoRotationBehavior.type="noRotation";NoRotationBehavior.editorConfig=null;class ScaleBehavior{constructor(config){var _a;this.order=BehaviorOrder.Normal;this.list=new PropertyList(false);this.list.reset(PropertyNode.createList(config.scale));this.minMult=(_a=config.minMult)!==null&&_a!==void 0?_a:1}initParticles(first){let next=first;while(next){const mult=Math.random()*(1-this.minMult)+this.minMult;next.config.scaleMult=mult;next.scale.x=next.scale.y=this.list.first.value*mult;next=next.next}}updateParticle(particle){particle.scale.x=particle.scale.y=this.list.interpolate(particle.agePercent)*particle.config.scaleMult}}ScaleBehavior.type="scale";ScaleBehavior.editorConfig=null;class StaticScaleBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.min=config.min;this.max=config.max}initParticles(first){let next=first;while(next){const scale=Math.random()*(this.max-this.min)+this.min;next.scale.x=next.scale.y=scale;next=next.next}}}StaticScaleBehavior.type="scaleStatic";StaticScaleBehavior.editorConfig=null;class ShapeSpawnBehavior{constructor(config){this.order=BehaviorOrder.Spawn;const ShapeClass=ShapeSpawnBehavior.shapes[config.type];if(!ShapeClass){throw new Error(`No shape found with type '${config.type}'`)}this.shape=new ShapeClass(config.data)}static registerShape(constructor,typeOverride){ShapeSpawnBehavior.shapes[typeOverride||constructor.type]=constructor}initParticles(first){let next=first;while(next){this.shape.getRandPos(next);next=next.next}}}ShapeSpawnBehavior.type="spawnShape";ShapeSpawnBehavior.editorConfig=null;ShapeSpawnBehavior.shapes={};ShapeSpawnBehavior.registerShape(PolygonalChain);ShapeSpawnBehavior.registerShape(Rectangle);ShapeSpawnBehavior.registerShape(Torus);ShapeSpawnBehavior.registerShape(Torus,"circle");class SingleTextureBehavior{constructor(config){this.order=BehaviorOrder.Normal;this.texture=typeof config.texture==="string"?GetTextureFromString(config.texture):config.texture}initParticles(first){let next=first;while(next){next.texture=this.texture;next=next.next}}}SingleTextureBehavior.type="textureSingle";SingleTextureBehavior.editorConfig=null;class SpeedBehavior{constructor(config){var _a;this.order=BehaviorOrder.Late;this.list=new PropertyList(false);this.list.reset(PropertyNode.createList(config.speed));this.minMult=(_a=config.minMult)!==null&&_a!==void 0?_a:1}initParticles(first){let next=first;while(next){const mult=Math.random()*(1-this.minMult)+this.minMult;next.config.speedMult=mult;if(!next.config.velocity){next.config.velocity=new math.Point(this.list.first.value*mult,0)}else{next.config.velocity.set(this.list.first.value*mult,0)}rotatePoint(next.rotation,next.config.velocity);next=next.next}}updateParticle(particle,deltaSec){const speed=this.list.interpolate(particle.agePercent)*particle.config.speedMult;const vel=particle.config.velocity;normalize(vel);scaleBy(vel,speed);particle.x+=vel.x*deltaSec;particle.y+=vel.y*deltaSec}}SpeedBehavior.type="moveSpeed";SpeedBehavior.editorConfig=null;class StaticSpeedBehavior{constructor(config){this.order=BehaviorOrder.Late;this.min=config.min;this.max=config.max}initParticles(first){let next=first;while(next){const speed=Math.random()*(this.max-this.min)+this.min;if(!next.config.velocity){next.config.velocity=new math.Point(speed,0)}else{next.config.velocity.set(speed,0)}rotatePoint(next.rotation,next.config.velocity);next=next.next}}updateParticle(particle,deltaSec){const velocity=particle.config.velocity;particle.x+=velocity.x*deltaSec;particle.y+=velocity.y*deltaSec}}StaticSpeedBehavior.type="moveSpeedStatic";StaticSpeedBehavior.editorConfig=null;var index$1={__proto__:null,spawnShapes:index,editor:Types,get BehaviorOrder(){return BehaviorOrder},AccelerationBehavior:AccelerationBehavior,AlphaBehavior:AlphaBehavior,StaticAlphaBehavior:StaticAlphaBehavior,RandomAnimatedTextureBehavior:RandomAnimatedTextureBehavior,SingleAnimatedTextureBehavior:SingleAnimatedTextureBehavior,BlendModeBehavior:BlendModeBehavior,BurstSpawnBehavior:BurstSpawnBehavior,ColorBehavior:ColorBehavior,StaticColorBehavior:StaticColorBehavior,OrderedTextureBehavior:OrderedTextureBehavior,PathBehavior:PathBehavior,PointSpawnBehavior:PointSpawnBehavior,RandomTextureBehavior:RandomTextureBehavior,RotationBehavior:RotationBehavior,StaticRotationBehavior:StaticRotationBehavior,NoRotationBehavior:NoRotationBehavior,ScaleBehavior:ScaleBehavior,StaticScaleBehavior:StaticScaleBehavior,ShapeSpawnBehavior:ShapeSpawnBehavior,SingleTextureBehavior:SingleTextureBehavior,SpeedBehavior:SpeedBehavior,StaticSpeedBehavior:StaticSpeedBehavior};function upgradeConfig(config,art){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w;if("behaviors"in config){return config}const out={lifetime:config.lifetime,ease:config.ease,particlesPerWave:config.particlesPerWave,frequency:config.frequency,spawnChance:config.spawnChance,emitterLifetime:config.emitterLifetime,maxParticles:config.maxParticles,addAtBack:config.addAtBack,pos:config.pos,emit:config.emit,autoUpdate:config.autoUpdate,behaviors:[]};if(config.alpha){if("start"in config.alpha){if(config.alpha.start===config.alpha.end){if(config.alpha.start!==1){out.behaviors.push({type:"alphaStatic",config:{alpha:config.alpha.start}})}}else{const list={list:[{time:0,value:config.alpha.start},{time:1,value:config.alpha.end}]};out.behaviors.push({type:"alpha",config:{alpha:list}})}}else if(config.alpha.list.length===1){if(config.alpha.list[0].value!==1){out.behaviors.push({type:"alphaStatic",config:{alpha:config.alpha.list[0].value}})}}else{out.behaviors.push({type:"alpha",config:{alpha:config.alpha}})}}if(config.acceleration&&(config.acceleration.x||config.acceleration.y)){let minStart;let maxStart;if("start"in config.speed){minStart=config.speed.start*((_a=config.speed.minimumSpeedMultiplier)!==null&&_a!==void 0?_a:1);maxStart=config.speed.start}else{minStart=config.speed.list[0].value*((_b=config.minimumSpeedMultiplier)!==null&&_b!==void 0?_b:1);maxStart=config.speed.list[0].value}out.behaviors.push({type:"moveAcceleration",config:{accel:config.acceleration,minStart,maxStart,rotate:!config.noRotation,maxSpeed:config.maxSpeed}})}else if((_c=config.extraData)===null||_c===void 0?void 0:_c.path){let list;let mult;if("start"in config.speed){mult=(_d=config.speed.minimumSpeedMultiplier)!==null&&_d!==void 0?_d:1;if(config.speed.start===config.speed.end){list={list:[{time:0,value:config.speed.start}]}}else{list={list:[{time:0,value:config.speed.start},{time:1,value:config.speed.end}]}}}else{list=config.speed;mult=(_e=config.minimumSpeedMultiplier)!==null&&_e!==void 0?_e:1}out.behaviors.push({type:"movePath",config:{path:config.extraData.path,speed:list,minMult:mult}})}else{if(config.speed){if("start"in config.speed){if(config.speed.start===config.speed.end){out.behaviors.push({type:"moveSpeedStatic",config:{min:config.speed.start*((_f=config.speed.minimumSpeedMultiplier)!==null&&_f!==void 0?_f:1),max:config.speed.start}})}else{const list={list:[{time:0,value:config.speed.start},{time:1,value:config.speed.end}]};out.behaviors.push({type:"moveSpeed",config:{speed:list,minMult:config.speed.minimumSpeedMultiplier}})}}else if(config.speed.list.length===1){out.behaviors.push({type:"moveSpeedStatic",config:{min:config.speed.list[0].value*((_g=config.minimumSpeedMultiplier)!==null&&_g!==void 0?_g:1),max:config.speed.list[0].value}})}else{out.behaviors.push({type:"moveSpeed",config:{speed:config.speed,minMult:(_h=config.minimumSpeedMultiplier)!==null&&_h!==void 0?_h:1}})}}}if(config.scale){if("start"in config.scale){const mult=(_j=config.scale.minimumScaleMultiplier)!==null&&_j!==void 0?_j:1;if(config.scale.start===config.scale.end){out.behaviors.push({type:"scaleStatic",config:{min:config.scale.start*mult,max:config.scale.start}})}else{const list={list:[{time:0,value:config.scale.start},{time:1,value:config.scale.end}]};out.behaviors.push({type:"scale",config:{scale:list,minMult:mult}})}}else if(config.scale.list.length===1){const mult=(_k=config.minimumScaleMultiplier)!==null&&_k!==void 0?_k:1;const scale=config.scale.list[0].value;out.behaviors.push({type:"scaleStatic",config:{min:scale*mult,max:scale}})}else{out.behaviors.push({type:"scale",config:{scale:config.scale,minMult:(_l=config.minimumScaleMultiplier)!==null&&_l!==void 0?_l:1}})}}if(config.color){if("start"in config.color){if(config.color.start===config.color.end){if(config.color.start!=="ffffff"){out.behaviors.push({type:"colorStatic",config:{color:config.color.start}})}}else{const list={list:[{time:0,value:config.color.start},{time:1,value:config.color.end}]};out.behaviors.push({type:"color",config:{color:list}})}}else if(config.color.list.length===1){if(config.color.list[0].value!=="ffffff"){out.behaviors.push({type:"colorStatic",config:{color:config.color.list[0].value}})}}else{out.behaviors.push({type:"color",config:{color:config.color}})}}if(config.rotationAcceleration||((_m=config.rotationSpeed)===null||_m===void 0?void 0:_m.min)||((_o=config.rotationSpeed)===null||_o===void 0?void 0:_o.max)){out.behaviors.push({type:"rotation",config:{accel:config.rotationAcceleration||0,minSpeed:((_p=config.rotationSpeed)===null||_p===void 0?void 0:_p.min)||0,maxSpeed:((_q=config.rotationSpeed)===null||_q===void 0?void 0:_q.max)||0,minStart:((_r=config.startRotation)===null||_r===void 0?void 0:_r.min)||0,maxStart:((_s=config.startRotation)===null||_s===void 0?void 0:_s.max)||0}})}else if(((_t=config.startRotation)===null||_t===void 0?void 0:_t.min)||((_u=config.startRotation)===null||_u===void 0?void 0:_u.max)){out.behaviors.push({type:"rotationStatic",config:{min:((_v=config.startRotation)===null||_v===void 0?void 0:_v.min)||0,max:((_w=config.startRotation)===null||_w===void 0?void 0:_w.max)||0}})}if(config.noRotation){out.behaviors.push({type:"noRotation",config:{}})}if(config.blendMode&&config.blendMode!=="normal"){out.behaviors.push({type:"blendMode",config:{blendMode:config.blendMode}})}if(Array.isArray(art)&&typeof art[0]!=="string"&&"framerate"in art[0]){for(let i=0;i<art.length;++i){if(art[i].framerate==="matchLife"){art[i].framerate=-1}}out.behaviors.push({type:"animatedRandom",config:{anims:art}})}else if(typeof art!=="string"&&"framerate"in art){if(art.framerate==="matchLife"){art.framerate=-1}out.behaviors.push({type:"animatedSingle",config:{anim:art}})}else if(config.orderedArt&&Array.isArray(art)){out.behaviors.push({type:"textureOrdered",config:{textures:art}})}else if(Array.isArray(art)){out.behaviors.push({type:"textureRandom",config:{textures:art}})}else{out.behaviors.push({type:"textureSingle",config:{texture:art}})}if(config.spawnType==="burst"){out.behaviors.push({type:"spawnBurst",config:{start:config.angleStart||0,spacing:config.particleSpacing,distance:0}})}else if(config.spawnType==="point"){out.behaviors.push({type:"spawnPoint",config:{}})}else{let shape;if(config.spawnType==="ring"){shape={type:"torus",data:{x:config.spawnCircle.x,y:config.spawnCircle.y,radius:config.spawnCircle.r,innerRadius:config.spawnCircle.minR,affectRotation:true}}}else if(config.spawnType==="circle"){shape={type:"torus",data:{x:config.spawnCircle.x,y:config.spawnCircle.y,radius:config.spawnCircle.r,innerRadius:0,affectRotation:false}}}else if(config.spawnType==="rect"){shape={type:"rect",data:config.spawnRect}}else if(config.spawnType==="polygonalChain"){shape={type:"polygonalChain",data:config.spawnPolygon}}if(shape){out.behaviors.push({type:"spawnShape",config:shape})}}return out}class LinkedListContainer extends display.Container{constructor(){super(...arguments);this._firstChild=null;this._lastChild=null;this._childCount=0}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get childCount(){return this._childCount}addChild(...children){if(children.length>1){for(let i=0;i<children.length;i++){this.addChild(children[i])}}else{const child=children[0];if(child.parent){child.parent.removeChild(child)}child.parent=this;this.sortDirty=true;child.transform._parentID=-1;if(this._lastChild){this._lastChild.nextChild=child;child.prevChild=this._lastChild;this._lastChild=child}else{this._firstChild=this._lastChild=child}++this._childCount;this._boundsID++;this.onChildrenChange();this.emit("childAdded",child,this,this._childCount);child.emit("added",this)}return children[0]}addChildAt(child,index){if(index<0||index>this._childCount){throw new Error(`addChildAt: The index ${index} supplied is out of bounds ${this._childCount}`)}if(child.parent){child.parent.removeChild(child)}child.parent=this;this.sortDirty=true;child.transform._parentID=-1;const c=child;if(!this._firstChild){this._firstChild=this._lastChild=c}else if(index===0){this._firstChild.prevChild=c;c.nextChild=this._firstChild;this._firstChild=c}else if(index===this._childCount){this._lastChild.nextChild=c;c.prevChild=this._lastChild;this._lastChild=c}else{let i=0;let target=this._firstChild;while(i<index){target=target.nextChild;++i}target.prevChild.nextChild=c;c.prevChild=target.prevChild;c.nextChild=target;target.prevChild=c}++this._childCount;this._boundsID++;this.onChildrenChange(index);child.emit("added",this);this.emit("childAdded",child,this,index);return child}addChildBelow(child,relative){if(relative.parent!==this){throw new Error(`addChildBelow: The relative target must be a child of this parent`)}if(child.parent){child.parent.removeChild(child)}child.parent=this;this.sortDirty=true;child.transform._parentID=-1;relative.prevChild.nextChild=child;child.prevChild=relative.prevChild;child.nextChild=relative;relative.prevChild=child;if(this._firstChild===relative){this._firstChild=child}++this._childCount;this._boundsID++;this.onChildrenChange();this.emit("childAdded",child,this,this._childCount);child.emit("added",this);return child}addChildAbove(child,relative){if(relative.parent!==this){throw new Error(`addChildBelow: The relative target must be a child of this parent`)}if(child.parent){child.parent.removeChild(child)}child.parent=this;this.sortDirty=true;child.transform._parentID=-1;relative.nextChild.prevChild=child;child.nextChild=relative.nextChild;child.prevChild=relative;relative.nextChild=child;if(this._lastChild===relative){this._lastChild=child}++this._childCount;this._boundsID++;this.onChildrenChange();this.emit("childAdded",child,this,this._childCount);child.emit("added",this);return child}swapChildren(child,child2){if(child===child2||child.parent!==this||child2.parent!==this){return}const{prevChild,nextChild}=child;child.prevChild=child2.prevChild;child.nextChild=child2.nextChild;child2.prevChild=prevChild;child2.nextChild=nextChild;if(this._firstChild===child){this._firstChild=child2}else if(this._firstChild===child2){this._firstChild=child}if(this._lastChild===child){this._lastChild=child2}else if(this._lastChild===child2){this._lastChild=child}this.onChildrenChange()}getChildIndex(child){let index=0;let test=this._firstChild;while(test){if(test===child){break}test=test.nextChild;++index}if(!test){throw new Error("The supplied DisplayObject must be a child of the caller")}return index}setChildIndex(child,index){if(index<0||index>=this._childCount){throw new Error(`The index ${index} supplied is out of bounds ${this._childCount}`)}if(child.parent!==this){throw new Error("The supplied DisplayObject must be a child of the caller")}if(child.nextChild){child.nextChild.prevChild=child.prevChild}if(child.prevChild){child.prevChild.nextChild=child.nextChild}if(this._firstChild===child){this._firstChild=child.nextChild}if(this._lastChild===child){this._lastChild=child.prevChild}child.nextChild=null;child.prevChild=null;if(!this._firstChild){this._firstChild=this._lastChild=child}else if(index===0){this._firstChild.prevChild=child;child.nextChild=this._firstChild;this._firstChild=child}else if(index===this._childCount){this._lastChild.nextChild=child;child.prevChild=this._lastChild;this._lastChild=child}else{let i=0;let target=this._firstChild;while(i<index){target=target.nextChild;++i}target.prevChild.nextChild=child;child.prevChild=target.prevChild;child.nextChild=target;target.prevChild=child}this.onChildrenChange(index)}removeChild(...children){if(children.length>1){for(let i=0;i<children.length;i++){this.removeChild(children[i])}}else{const child=children[0];if(child.parent!==this)return null;child.parent=null;child.transform._parentID=-1;if(child.nextChild){child.nextChild.prevChild=child.prevChild}if(child.prevChild){child.prevChild.nextChild=child.nextChild}if(this._firstChild===child){this._firstChild=child.nextChild}if(this._lastChild===child){this._lastChild=child.prevChild}child.nextChild=null;child.prevChild=null;--this._childCount;this._boundsID++;this.onChildrenChange();child.emit("removed",this);this.emit("childRemoved",child,this)}return children[0]}getChildAt(index){if(index<0||index>=this._childCount){throw new Error(`getChildAt: Index (${index}) does not exist.`)}if(index===0){return this._firstChild}else if(index===this._childCount){return this._lastChild}let i=0;let target=this._firstChild;while(i<index){target=target.nextChild;++i}return target}removeChildAt(index){const child=this.getChildAt(index);child.parent=null;child.transform._parentID=-1;if(child.nextChild){child.nextChild.prevChild=child.prevChild}if(child.prevChild){child.prevChild.nextChild=child.nextChild}if(this._firstChild===child){this._firstChild=child.nextChild}if(this._lastChild===child){this._lastChild=child.prevChild}child.nextChild=null;child.prevChild=null;--this._childCount;this._boundsID++;this.onChildrenChange(index);child.emit("removed",this);this.emit("childRemoved",child,this,index);return child}removeChildren(beginIndex=0,endIndex=this._childCount){const begin=beginIndex;if(endIndex===0&&this._childCount>0){endIndex=this._childCount}const end=endIndex;const range=end-begin;if(range>0&&range<=end){const removed=[];let child=this._firstChild;for(let i=0;i<=end&&child;++i,child=child.nextChild){if(i>=begin){removed.push(child)}}const prevChild=removed[0].prevChild;const nextChild=removed[removed.length-1].nextChild;if(!nextChild){this._lastChild=prevChild}else{nextChild.prevChild=prevChild}if(!prevChild){this._firstChild=nextChild}else{prevChild.nextChild=nextChild}for(let i=0;i<removed.length;++i){removed[i].parent=null;if(removed[i].transform){removed[i].transform._parentID=-1}removed[i].nextChild=null;removed[i].prevChild=null}this._boundsID++;this.onChildrenChange(beginIndex);for(let i=0;i<removed.length;++i){removed[i].emit("removed",this);this.emit("childRemoved",removed[i],this,i)}return removed}else if(range===0&&this._childCount===0){return[]}throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}updateTransform(){this._boundsID++;this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;let child;let next;for(child=this._firstChild;child;child=next){next=child.nextChild;if(child.visible){child.updateTransform()}}}calculateBounds(){this._bounds.clear();this._calculateBounds();let child;let next;for(child=this._firstChild;child;child=next){next=child.nextChild;if(!child.visible||!child.renderable){continue}child.calculateBounds();if(child._mask){const maskObject=child._mask.maskObject||child._mask;maskObject.calculateBounds();this._bounds.addBoundsMask(child._bounds,maskObject._bounds)}else if(child.filterArea){this._bounds.addBoundsArea(child._bounds,child.filterArea)}else{this._bounds.addBounds(child._bounds)}}this._bounds.updateID=this._boundsID}getLocalBounds(rect,skipChildrenUpdate=false){const result=display.DisplayObject.prototype.getLocalBounds.call(this,rect);if(!skipChildrenUpdate){let child;let next;for(child=this._firstChild;child;child=next){next=child.nextChild;if(child.visible){child.updateTransform()}}}return result}render(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}if(this._mask||this.filters&&this.filters.length){this.renderAdvanced(renderer)}else{this._render(renderer);let child;let next;for(child=this._firstChild;child;child=next){next=child.nextChild;child.render(renderer)}}}renderAdvanced(renderer){renderer.batch.flush();const filters=this.filters;const mask=this._mask;if(filters){if(!this._enabledFilters){this._enabledFilters=[]}this._enabledFilters.length=0;for(let i=0;i<filters.length;i++){if(filters[i].enabled){this._enabledFilters.push(filters[i])}}if(this._enabledFilters.length){renderer.filter.push(this,this._enabledFilters)}}if(mask){renderer.mask.push(this,this._mask)}this._render(renderer);let child;let next;for(child=this._firstChild;child;child=next){next=child.nextChild;child.render(renderer)}renderer.batch.flush();if(mask){renderer.mask.pop(this)}if(filters&&this._enabledFilters&&this._enabledFilters.length){renderer.filter.pop()}}renderCanvas(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}if(this._mask){renderer.maskManager.pushMask(this._mask)}this._renderCanvas(renderer);let child;let next;for(child=this._firstChild;child;child=next){next=child.nextChild;child.renderCanvas(renderer)}if(this._mask){renderer.maskManager.popMask(renderer)}}}Emitter.registerBehavior(AccelerationBehavior);Emitter.registerBehavior(AlphaBehavior);Emitter.registerBehavior(StaticAlphaBehavior);Emitter.registerBehavior(RandomAnimatedTextureBehavior);Emitter.registerBehavior(SingleAnimatedTextureBehavior);Emitter.registerBehavior(BlendModeBehavior);Emitter.registerBehavior(BurstSpawnBehavior);Emitter.registerBehavior(ColorBehavior);Emitter.registerBehavior(StaticColorBehavior);Emitter.registerBehavior(OrderedTextureBehavior);Emitter.registerBehavior(PathBehavior);Emitter.registerBehavior(PointSpawnBehavior);Emitter.registerBehavior(RandomTextureBehavior);Emitter.registerBehavior(RotationBehavior);Emitter.registerBehavior(StaticRotationBehavior);Emitter.registerBehavior(NoRotationBehavior);Emitter.registerBehavior(ScaleBehavior);Emitter.registerBehavior(StaticScaleBehavior);Emitter.registerBehavior(ShapeSpawnBehavior);Emitter.registerBehavior(SingleTextureBehavior);Emitter.registerBehavior(SpeedBehavior);Emitter.registerBehavior(StaticSpeedBehavior);exports.Emitter=Emitter;exports.LinkedListContainer=LinkedListContainer;exports.Particle=Particle;exports.ParticleUtils=ParticleUtils;exports.PropertyList=PropertyList;exports.PropertyNode=PropertyNode;exports.behaviors=index$1;exports.upgradeConfig=upgradeConfig})(this.PIXI.particles=this.PIXI.particles||{},PIXI,PIXI,PIXI,PIXI,PIXI,PIXI);